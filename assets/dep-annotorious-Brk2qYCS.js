function rp(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var _n={exports:{}},np=_n.exports,Jl;function op(){return Jl||(Jl=1,function(s){//! openseadragon 5.0.1
//! Built on 2024-12-09
//! Git commit: v5.0.1-0-480de92d
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function e(t){return new e.Viewer(t)}(function(t){t.version={versionStr:"5.0.1",major:parseInt("5",10),minor:parseInt("0",10),revision:parseInt("1",10)};var i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object AsyncFunction]":"function","[object Promise]":"promise","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},r=Object.prototype.toString,n=Object.prototype.hasOwnProperty;t.isFunction=function(o){return t.type(o)==="function"},t.isArray=Array.isArray||function(o){return t.type(o)==="array"},t.isWindow=function(o){return o&&typeof o=="object"&&"setInterval"in o},t.type=function(o){return o==null?String(o):i[r.call(o)]||"object"},t.isPlainObject=function(o){if(!o||e.type(o)!=="object"||o.nodeType||t.isWindow(o)||o.constructor&&!n.call(o,"constructor")&&!n.call(o.constructor.prototype,"isPrototypeOf"))return!1;var a;for(var l in o)a=l;return a===void 0||n.call(o,a)},t.isEmptyObject=function(o){for(var a in o)return!1;return!0},t.freezeObject=function(o){return Object.freeze?t.freezeObject=Object.freeze:t.freezeObject=function(a){return a},t.freezeObject(o)},t.supportsCanvas=function(){var o=document.createElement("canvas");return!!(t.isFunction(o.getContext)&&o.getContext("2d"))}(),t.isCanvasTainted=function(o){var a=!1;try{o.getContext("2d").getImageData(0,0,1,1)}catch{a=!0}return a},t.supportsAddEventListener=function(){return!!(document.documentElement.addEventListener&&document.addEventListener)}(),t.supportsRemoveEventListener=function(){return!!(document.documentElement.removeEventListener&&document.removeEventListener)}(),t.supportsEventListenerOptions=function(){var o=0;if(t.supportsAddEventListener)try{var a={get capture(){return o++,!1},get once(){return o++,!1},get passive(){return o++,!1}};window.addEventListener("test",null,a),window.removeEventListener("test",null,a)}catch{o=0}return o>=3}(),t.getCurrentPixelDensityRatio=function(){if(t.supportsCanvas){var o=document.createElement("canvas").getContext("2d"),a=window.devicePixelRatio||1,l=o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1;return Math.max(a,1)/l}else return 1},t.pixelDensityRatio=t.getCurrentPixelDensityRatio()})(e),function(t){t.extend=function(){var l,h,u,c,d,f,p=arguments[0]||{},m=arguments.length,g=!1,v=1;for(typeof p=="boolean"&&(g=p,p=arguments[1]||{},v=2),typeof p!="object"&&!e.isFunction(p)&&(p={}),m===v&&(p=this,--v);v<m;v++)if(l=arguments[v],l!==null||l!==void 0)for(h in l){var x=Object.getOwnPropertyDescriptor(l,h);if(x!==void 0){if(x.get||x.set){Object.defineProperty(p,h,x);continue}c=x.value}else{t.console.warn('Could not copy inherited property "'+h+'".');continue}p!==c&&(g&&c&&(e.isPlainObject(c)||(d=e.isArray(c)))?(u=p[h],d?(d=!1,f=u&&e.isArray(u)?u:[]):f=u&&e.isPlainObject(u)?u:{},p[h]=e.extend(g,f,c)):c!==void 0&&(p[h]=c))}return p};var i=function(){if(typeof navigator!="object")return!1;var l=navigator.userAgent;return typeof l!="string"?!1:l.indexOf("iPhone")!==-1||l.indexOf("iPad")!==-1||l.indexOf("iPod")!==-1};t.extend(t,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,dblClickDragToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,dblClickDragToZoom:!1,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerDblClickDrag:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:i(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,maxTilesPerFrame:1,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorElement:null,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,overlayPreserveContentDirection:!0,opacity:1,compositeOperation:null,drawer:["webgl","canvas","html"],drawerOptions:{webgl:{},canvas:{},html:{},custom:{}},preload:!1,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,tileRetryMax:0,tileRetryDelay:2500,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},delegate:function(l,h){return function(){var u=arguments;return u===void 0&&(u=[]),h.apply(l,u)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(l){return t._viewers.get(this.getElement(l))},getElement:function(l){return typeof l=="string"&&(l=document.getElementById(l)),l},getElementPosition:function(l){var h=new t.Point,u,c;for(l=t.getElement(l),u=t.getElementStyle(l).position==="fixed",c=a(l,u);c;)h.x+=l.offsetLeft,h.y+=l.offsetTop,u&&(h=h.plus(t.getPageScroll())),l=c,u=t.getElementStyle(l).position==="fixed",c=a(l,u);return h},getElementOffset:function(l){l=t.getElement(l);var h=l&&l.ownerDocument,u,c,d={top:0,left:0};return h?(u=h.documentElement,typeof l.getBoundingClientRect<"u"&&(d=l.getBoundingClientRect()),c=h===h.window?h:h.nodeType===9?h.defaultView||h.parentWindow:!1,new t.Point(d.left+(c.pageXOffset||u.scrollLeft)-(u.clientLeft||0),d.top+(c.pageYOffset||u.scrollTop)-(u.clientTop||0))):new t.Point},getElementSize:function(l){return l=t.getElement(l),new t.Point(l.clientWidth,l.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(l){return l=t.getElement(l),l.currentStyle}:function(l){return l=t.getElement(l),window.getComputedStyle(l,"")},getCssPropertyWithVendorPrefix:function(l){var h={};return t.getCssPropertyWithVendorPrefix=function(u){if(h[u]!==void 0)return h[u];var c=document.createElement("div").style,d=null;if(c[u]!==void 0)d=u;else for(var f=["Webkit","Moz","MS","O","webkit","moz","ms","o"],p=t.capitalizeFirstLetter(u),m=0;m<f.length;m++){var g=f[m]+p;if(c[g]!==void 0){d=g;break}}return h[u]=d,d},t.getCssPropertyWithVendorPrefix(l)},capitalizeFirstLetter:function(l){return l.charAt(0).toUpperCase()+l.slice(1)},positiveModulo:function(l,h){var u=l%h;return u<0&&(u+=h),u},pointInElement:function(l,h){l=t.getElement(l);var u=t.getElementOffset(l),c=t.getElementSize(l);return h.x>=u.x&&h.x<u.x+c.x&&h.y<u.y+c.y&&h.y>=u.y},getMousePosition:function(l){if(typeof l.pageX=="number")t.getMousePosition=function(h){var u=new t.Point;return u.x=h.pageX,u.y=h.pageY,u};else if(typeof l.clientX=="number")t.getMousePosition=function(h){var u=new t.Point;return u.x=h.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,u.y=h.clientY+document.body.scrollTop+document.documentElement.scrollTop,u};else throw new Error("Unknown event mouse position, no known technique.");return t.getMousePosition(l)},getPageScroll:function(){var l=document.documentElement||{},h=document.body||{};if(typeof window.pageXOffset=="number")t.getPageScroll=function(){return new t.Point(window.pageXOffset,window.pageYOffset)};else if(h.scrollLeft||h.scrollTop)t.getPageScroll=function(){return new t.Point(document.body.scrollLeft,document.body.scrollTop)};else if(l.scrollLeft||l.scrollTop)t.getPageScroll=function(){return new t.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new t.Point(0,0);return t.getPageScroll()},setPageScroll:function(l){if(typeof window.scrollTo<"u")t.setPageScroll=function(c){window.scrollTo(c.x,c.y)};else{var h=t.getPageScroll();if(h.x===l.x&&h.y===l.y)return;document.body.scrollLeft=l.x,document.body.scrollTop=l.y;var u=t.getPageScroll();if(u.x!==h.x&&u.y!==h.y){t.setPageScroll=function(c){document.body.scrollLeft=c.x,document.body.scrollTop=c.y};return}if(document.documentElement.scrollLeft=l.x,document.documentElement.scrollTop=l.y,u=t.getPageScroll(),u.x!==h.x&&u.y!==h.y){t.setPageScroll=function(c){document.documentElement.scrollLeft=c.x,document.documentElement.scrollTop=c.y};return}t.setPageScroll=function(c){}}t.setPageScroll(l)},getWindowSize:function(){var l=document.documentElement||{},h=document.body||{};if(typeof window.innerWidth=="number")t.getWindowSize=function(){return new t.Point(window.innerWidth,window.innerHeight)};else if(l.clientWidth||l.clientHeight)t.getWindowSize=function(){return new t.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(h.clientWidth||h.clientHeight)t.getWindowSize=function(){return new t.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return t.getWindowSize()},makeCenteredNode:function(l){l=t.getElement(l);var h=[t.makeNeutralElement("div"),t.makeNeutralElement("div"),t.makeNeutralElement("div")];return t.extend(h[0].style,{display:"table",height:"100%",width:"100%"}),t.extend(h[1].style,{display:"table-row"}),t.extend(h[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),h[0].appendChild(h[1]),h[1].appendChild(h[2]),h[2].appendChild(l),h[0]},makeNeutralElement:function(l){var h=document.createElement(l),u=h.style;return u.background="transparent none",u.border="none",u.margin="0px",u.padding="0px",u.position="static",h},now:function(){return Date.now?t.now=Date.now:t.now=function(){return new Date().getTime()},t.now()},makeTransparentImage:function(l){var h=t.makeNeutralElement("img");return h.src=l,h},setElementOpacity:function(l,h,u){var c,d;l=t.getElement(l),u&&!t.Browser.alpha&&(h=Math.round(h)),t.Browser.opacity?l.style.opacity=h<1?h:"":h<1?(c=Math.round(100*h),d="alpha(opacity="+c+")",l.style.filter=d):l.style.filter=""},setElementTouchActionNone:function(l){l=t.getElement(l),typeof l.style.touchAction<"u"?l.style.touchAction="none":typeof l.style.msTouchAction<"u"&&(l.style.msTouchAction="none")},setElementPointerEvents:function(l,h){l=t.getElement(l),typeof l.style<"u"&&typeof l.style.pointerEvents<"u"&&(l.style.pointerEvents=h)},setElementPointerEventsNone:function(l){t.setElementPointerEvents(l,"none")},addClass:function(l,h){l=t.getElement(l),l.className?(" "+l.className+" ").indexOf(" "+h+" ")===-1&&(l.className+=" "+h):l.className=h},indexOf:function(l,h,u){return Array.prototype.indexOf?this.indexOf=function(c,d,f){return c.indexOf(d,f)}:this.indexOf=function(c,d,f){var p,m=f||0,g;if(!c)throw new TypeError;if(g=c.length,g===0||m>=g)return-1;for(m<0&&(m=g-Math.abs(m)),p=m;p<g;p++)if(c[p]===d)return p;return-1},this.indexOf(l,h,u)},removeClass:function(l,h){var u,c=[],d;for(l=t.getElement(l),u=l.className.split(/\s+/),d=0;d<u.length;d++)u[d]&&u[d]!==h&&c.push(u[d]);l.className=c.join(" ")},normalizeEventListenerOptions:function(l){var h;return typeof l<"u"?typeof l=="boolean"?h=t.supportsEventListenerOptions?{capture:l}:l:h=t.supportsEventListenerOptions?l:typeof l.capture<"u"?l.capture:!1:h=t.supportsEventListenerOptions?{capture:!1}:!1,h},addEvent:function(){if(t.supportsAddEventListener)return function(l,h,u,c){c=t.normalizeEventListenerOptions(c),l=t.getElement(l),l.addEventListener(h,u,c)};if(document.documentElement.attachEvent&&document.attachEvent)return function(l,h,u){l=t.getElement(l),l.attachEvent("on"+h,u)};throw new Error("No known event model.")}(),removeEvent:function(){if(t.supportsRemoveEventListener)return function(l,h,u,c){c=t.normalizeEventListenerOptions(c),l=t.getElement(l),l.removeEventListener(h,u,c)};if(document.documentElement.detachEvent&&document.detachEvent)return function(l,h,u){l=t.getElement(l),l.detachEvent("on"+h,u)};throw new Error("No known event model.")}(),cancelEvent:function(l){l.preventDefault()},eventIsCanceled:function(l){return l.defaultPrevented},stopEvent:function(l){l.stopPropagation()},createCallback:function(l,h){console.error("The createCallback function is deprecated and will be removed in future versions. Please use alternativeFunction instead.");var u=[],c;for(c=2;c<arguments.length;c++)u.push(arguments[c]);return function(){var d=u.concat([]),f;for(f=0;f<arguments.length;f++)d.push(arguments[f]);return h.apply(l,d)}},getUrlParameter:function(l){var h=o[l];return h||null},getUrlProtocol:function(l){var h=l.match(/^([a-z]+:)\/\//i);return h===null?window.location.protocol:h[1].toLowerCase()},createAjaxRequest:function(){if(window.XMLHttpRequest)return t.createAjaxRequest=function(){return new XMLHttpRequest},new XMLHttpRequest;throw new Error("Browser doesn't support XMLHttpRequest.")},makeAjaxRequest:function(l,h,u){var c,d,f,p;t.isPlainObject(l)&&(h=l.success,u=l.error,c=l.withCredentials,d=l.headers,f=l.responseType||null,p=l.postData||null,l=l.url);var m=t.getUrlProtocol(l),g=t.createAjaxRequest();if(!t.isFunction(h))throw new Error("makeAjaxRequest requires a success callback");g.onreadystatechange=function(){g.readyState===4&&(g.onreadystatechange=function(){},g.status>=200&&g.status<300||g.status===0&&m!=="http:"&&m!=="https:"?h(g):t.isFunction(u)?u(g):t.console.error("AJAX request returned %d: %s",g.status,l))};var v=p?"POST":"GET";try{if(g.open(v,l,!0),f&&(g.responseType=f),d)for(var x in d)Object.prototype.hasOwnProperty.call(d,x)&&d[x]&&g.setRequestHeader(x,d[x]);c&&(g.withCredentials=!0),g.send(p)}catch(_){t.console.error("%s while making AJAX request: %s",_.name,_.message),g.onreadystatechange=function(){},t.isFunction(u)&&u(g,_)}return g},jsonp:function(l){var h,u=l.url,c=document.head||document.getElementsByTagName("head")[0]||document.documentElement,d=l.callbackName||"openseadragon"+t.now(),f=window[d],p="$1"+d+"$2",m=l.param||"callback",g=l.callback;u=u.replace(/(=)\?(&|$)|\?\?/i,p),u+=(/\?/.test(u)?"&":"?")+m+"="+d,window[d]=function(v){if(f)window[d]=f;else try{delete window[d]}catch{}g&&t.isFunction(g)&&g(v)},h=document.createElement("script"),(l.async!==void 0||l.async!==!1)&&(h.async="async"),l.scriptCharset&&(h.charset=l.scriptCharset),h.src=u,h.onload=h.onreadystatechange=function(v,x){(x||!h.readyState||/loaded|complete/.test(h.readyState))&&(h.onload=h.onreadystatechange=null,c&&h.parentNode&&c.removeChild(h),h=void 0)},c.insertBefore(h,c.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(l){if(window.DOMParser)t.parseXml=function(h){var u=null,c;return c=new DOMParser,u=c.parseFromString(h,"text/xml"),u};else throw new Error("Browser doesn't support XML DOM.");return t.parseXml(l)},parseJSON:function(l){return t.parseJSON=window.JSON.parse,t.parseJSON(l)},imageFormatSupported:function(l){return l=l||"",!!n[l.toLowerCase()]},setImageFormatsSupported:function(l){t.extend(n,l)}});var r=function(l){};t.console=window.console||{log:r,debug:r,info:r,warn:r,error:r,assert:r},t.Browser={vendor:t.BROWSERS.UNKNOWN,version:0,alpha:!0};var n={avif:!0,bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1,webp:!0},o={};(function(){var l=navigator.appVersion,h=navigator.userAgent,u;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(h.substring(h.indexOf("MSIE")+5,h.indexOf(";",h.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(h.indexOf("Edge")>=0?(t.Browser.vendor=t.BROWSERS.EDGE,t.Browser.version=parseFloat(h.substring(h.indexOf("Edge")+5))):h.indexOf("Edg")>=0?(t.Browser.vendor=t.BROWSERS.CHROMEEDGE,t.Browser.version=parseFloat(h.substring(h.indexOf("Edg")+4))):h.indexOf("Firefox")>=0?(t.Browser.vendor=t.BROWSERS.FIREFOX,t.Browser.version=parseFloat(h.substring(h.indexOf("Firefox")+8))):h.indexOf("Safari")>=0?(t.Browser.vendor=h.indexOf("Chrome")>=0?t.BROWSERS.CHROME:t.BROWSERS.SAFARI,t.Browser.version=parseFloat(h.substring(h.substring(0,h.indexOf("Safari")).lastIndexOf("/")+1,h.indexOf("Safari")))):(u=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),u.exec(h)!==null&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":t.Browser.vendor=t.BROWSERS.OPERA,t.Browser.version=parseFloat(l);break}var c=window.location.search.substring(1),d=c.split("&"),f,p,m;for(m=0;m<d.length;m++)if(f=d[m],p=f.indexOf("="),p>0){var g=f.substring(0,p),v=f.substring(p+1);try{o[g]=decodeURIComponent(v)}catch{t.console.error("Ignoring malformed URL parameter: %s=%s",g,v)}}t.Browser.alpha=!(t.Browser.vendor===t.BROWSERS.CHROME&&t.Browser.version<2),t.Browser.opacity=!0,t.Browser.vendor===t.BROWSERS.IE&&t.console.error("Internet Explorer is not supported by OpenSeadragon")})(),function(l){var h=l.requestAnimationFrame||l.mozRequestAnimationFrame||l.webkitRequestAnimationFrame||l.msRequestAnimationFrame,u=l.cancelAnimationFrame||l.mozCancelAnimationFrame||l.webkitCancelAnimationFrame||l.msCancelAnimationFrame;if(h&&u)t.requestAnimationFrame=function(){return h.apply(l,arguments)},t.cancelAnimationFrame=function(){return u.apply(l,arguments)};else{var c=[],d=[],f=0,p;t.requestAnimationFrame=function(m){return c.push([++f,m]),p||(p=setInterval(function(){if(c.length){var g=t.now(),v=d;for(d=c,c=v;d.length;)d.shift()[1](g)}else clearInterval(p),p=void 0},1e3/50)),f},t.cancelAnimationFrame=function(m){var g,v;for(g=0,v=c.length;g<v;g+=1)if(c[g][0]===m){c.splice(g,1);return}for(g=0,v=d.length;g<v;g+=1)if(d[g][0]===m){d.splice(g,1);return}}}}(window);function a(l,h){return h&&l!==document.body?document.body:l.offsetParent}}(e),function(t,i){s.exports?s.exports=i():t.OpenSeadragon=i()}(np,function(){return e}),function(t){class i{constructor(n){n||(n=[0,0,0,0,0,0,0,0,0]),this.values=n}static makeIdentity(){return new i([1,0,0,0,1,0,0,0,1])}static makeTranslation(n,o){return new i([1,0,0,0,1,0,n,o,1])}static makeRotation(n){var o=Math.cos(n),a=Math.sin(n);return new i([o,-a,0,a,o,0,0,0,1])}static makeScaling(n,o){return new i([n,0,0,0,o,0,0,0,1])}multiply(n){let o=this.values,a=n.values;var l=o[0*3+0],h=o[0*3+1],u=o[0*3+2],c=o[1*3+0],d=o[1*3+1],f=o[1*3+2],p=o[2*3+0],m=o[2*3+1],g=o[2*3+2],v=a[0*3+0],x=a[0*3+1],_=a[0*3+2],E=a[1*3+0],R=a[1*3+1],M=a[1*3+2],O=a[2*3+0],N=a[2*3+1],B=a[2*3+2];return new i([v*l+x*c+_*p,v*h+x*d+_*m,v*u+x*f+_*g,E*l+R*c+M*p,E*h+R*d+M*m,E*u+R*f+M*g,O*l+N*c+B*p,O*h+N*d+B*m,O*u+N*f+B*g])}}t.Mat3=i}(e),function(t){var i={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.fullscreenElement},i.requestFullScreen=function(r){return r.requestFullscreen().catch(function(n){t.console.error("Fullscreen request failed: ",n)})},i.exitFullScreen=function(){document.exitFullscreen().catch(function(r){t.console.error("Error while exiting fullscreen: ",r)})},i.fullScreenEventName="fullscreenchange",i.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.msFullscreenElement},i.requestFullScreen=function(r){return r.msRequestFullscreen()},i.exitFullScreen=function(){document.msExitFullscreen()},i.fullScreenEventName="MSFullscreenChange",i.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitFullscreenElement},i.requestFullScreen=function(r){return r.webkitRequestFullscreen()},i.exitFullScreen=function(){document.webkitExitFullscreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},i.requestFullScreen=function(r){return r.webkitRequestFullScreen()},i.exitFullScreen=function(){document.webkitCancelFullScreen()},i.fullScreenEventName="webkitfullscreenchange",i.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(i.supportsFullScreen=!0,i.getFullScreenElement=function(){return document.mozFullScreenElement},i.requestFullScreen=function(r){return r.mozRequestFullScreen()},i.exitFullScreen=function(){document.mozCancelFullScreen()},i.fullScreenEventName="mozfullscreenchange",i.fullScreenErrorEventName="mozfullscreenerror"),i.isFullScreen=function(){return i.getFullScreenElement()!==null},i.cancelFullScreen=function(){t.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),i.exitFullScreen()},t.extend(t,i)}(e),function(t){t.EventSource=function(){this.events={},this._rejectedEventList={}},t.EventSource.prototype={addOnceHandler:function(i,r,n,o,a){var l=this;o=o||1;var h=0,u=function(c){return h++,h===o&&l.removeHandler(i,u),r(c)};return this.addHandler(i,u,n,a)},addHandler:function(i,r,n,o){if(Object.prototype.hasOwnProperty.call(this._rejectedEventList,i))return t.console.error(`Error adding handler for ${i}. ${this._rejectedEventList[i]}`),!1;var a=this.events[i];if(a||(this.events[i]=a=[]),r&&t.isFunction(r)){var l=a.length,h={handler:r,userData:n||null,priority:o||0};for(a[l]=h;l>0&&a[l-1].priority<a[l].priority;)a[l]=a[l-1],a[l-1]=h,l--}return!0},removeHandler:function(i,r){var n=this.events[i],o=[],a;if(n&&t.isArray(n)){for(a=0;a<n.length;a++)n[a].handler!==r&&o.push(n[a]);this.events[i]=o}},numberOfHandlers:function(i){var r=this.events[i];return r?r.length:0},removeAllHandlers:function(i){if(i)this.events[i]=[];else for(var r in this.events)this.events[r]=[]},getHandler:function(i){var r=this.events[i];return!r||!r.length?null:(r=r.length===1?[r[0]]:Array.apply(null,r),function(n,o){var a,l=r.length;for(a=0;a<l;a++)r[a]&&(o.eventSource=n,o.userData=r[a].userData,r[a].handler(o))})},raiseEvent:function(i,r){if(Object.prototype.hasOwnProperty.call(this._rejectedEventList,i))return t.console.error(`Error adding handler for ${i}. ${this._rejectedEventList[i]}`),!1;var n=this.getHandler(i);return n&&n(this,r||{}),!0},rejectEventHandler(i,r=""){this._rejectedEventList[i]=r},allowEventHandler(i){delete this._rejectedEventList[i]}}}(e),function(t){var i={};t.MouseTracker=function(w){var T=arguments;t.isPlainObject(w)||(w={element:T[0],clickTimeThreshold:T[1],clickDistThreshold:T[2]}),this.hash=Math.random(),this.element=t.getElement(w.element),this.clickTimeThreshold=w.clickTimeThreshold||t.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=w.clickDistThreshold||t.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=w.dblClickTimeThreshold||t.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=w.dblClickDistThreshold||t.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=w.userData||null,this.stopDelay=w.stopDelay||50,this.preProcessEventHandler=w.preProcessEventHandler||null,this.contextMenuHandler=w.contextMenuHandler||null,this.enterHandler=w.enterHandler||null,this.leaveHandler=w.leaveHandler||null,this.exitHandler=w.exitHandler||null,this.overHandler=w.overHandler||null,this.outHandler=w.outHandler||null,this.pressHandler=w.pressHandler||null,this.nonPrimaryPressHandler=w.nonPrimaryPressHandler||null,this.releaseHandler=w.releaseHandler||null,this.nonPrimaryReleaseHandler=w.nonPrimaryReleaseHandler||null,this.moveHandler=w.moveHandler||null,this.scrollHandler=w.scrollHandler||null,this.clickHandler=w.clickHandler||null,this.dblClickHandler=w.dblClickHandler||null,this.dragHandler=w.dragHandler||null,this.dragEndHandler=w.dragEndHandler||null,this.pinchHandler=w.pinchHandler||null,this.stopHandler=w.stopHandler||null,this.keyDownHandler=w.keyDownHandler||null,this.keyUpHandler=w.keyUpHandler||null,this.keyHandler=w.keyHandler||null,this.focusHandler=w.focusHandler||null,this.blurHandler=w.blurHandler||null;var S=this;i[this.hash]={click:function(P){_(S,P)},dblclick:function(P){E(S,P)},keydown:function(P){R(S,P)},keyup:function(P){M(S,P)},keypress:function(P){O(S,P)},focus:function(P){N(S,P)},blur:function(P){B(S,P)},contextmenu:function(P){G(S,P)},wheel:function(P){K(S,P)},mousewheel:function(P){D(S,P)},DOMMouseScroll:function(P){D(S,P)},MozMousePixelScroll:function(P){D(S,P)},losecapture:function(P){I(S,P)},mouseenter:function(P){Q(S,P)},mouseleave:function(P){ae(S,P)},mouseover:function(P){de(S,P)},mouseout:function(P){be(S,P)},mousedown:function(P){De(S,P)},mouseup:function(P){Be(S,P)},mousemove:function(P){Pe(S,P)},touchstart:function(P){L(S,P)},touchend:function(P){W(S,P)},touchmove:function(P){U(S,P)},touchcancel:function(P){V(S,P)},gesturestart:function(P){ie(S,P)},gesturechange:function(P){k(S,P)},gotpointercapture:function(P){F(S,P)},lostpointercapture:function(P){Z(S,P)},pointerenter:function(P){Q(S,P)},pointerleave:function(P){ae(S,P)},pointerover:function(P){de(S,P)},pointerout:function(P){be(S,P)},pointerdown:function(P){De(S,P)},pointerup:function(P){Be(S,P)},pointermove:function(P){Pe(S,P)},pointercancel:function(P){qe(S,P)},pointerupcaptured:function(P){Ye(S,P)},pointermovecaptured:function(P){Oe(S,P)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,t.MouseTracker.havePointerEvents&&t.setElementPointerEvents(this.element,"auto"),this.exitHandler&&t.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),w.startDisabled||this.setTracking(!0)},t.MouseTracker.prototype={destroy:function(){l(this),this.element=null,i[this.hash]=null,delete i[this.hash]},isTracking:function(){return i[this.hash].tracking},setTracking:function(w){return w?a(this):l(this),this},getActivePointersListByType:function(w){var T=i[this.hash],S,P=T?T.activePointersLists.length:0,j;for(S=0;S<P;S++)if(T.activePointersLists[S].type===w)return T.activePointersLists[S];return j=new t.MouseTracker.GesturePointList(w),T&&T.activePointersLists.push(j),j},getActivePointerCount:function(){var w=i[this.hash],T,S=w.activePointersLists.length,P=0;for(T=0;T<S;T++)P+=w.activePointersLists[T].getLength();return P},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var r=function(){try{return window.self!==window.top}catch{return!0}}();function n(w){try{return w.addEventListener&&w.removeEventListener}catch{return!1}}t.MouseTracker.gesturePointVelocityTracker=function(){var w=[],T=0,S=0,P=function(Fe,ve){return Fe.hash.toString()+ve.type+ve.id.toString()},j=function(){var Fe,ve=w.length,Dt,pt,ws=t.now(),Zl,Kl,Ql;for(Zl=ws-S,S=ws,Fe=0;Fe<ve;Fe++)Dt=w[Fe],pt=Dt.gPoint,pt.direction=Math.atan2(pt.currentPos.y-Dt.lastPos.y,pt.currentPos.x-Dt.lastPos.x),Kl=Dt.lastPos.distanceTo(pt.currentPos),Dt.lastPos=pt.currentPos,Ql=1e3*Kl/(Zl+1),pt.speed=.75*Ql+.25*pt.speed},$=function(Fe,ve){var Dt=P(Fe,ve);w.push({guid:Dt,gPoint:ve,lastPos:ve.currentPos}),w.length===1&&(S=t.now(),T=window.setInterval(j,50))},pe=function(Fe,ve){var Dt=P(Fe,ve),pt,ws=w.length;for(pt=0;pt<ws;pt++)if(w[pt].guid===Dt){w.splice(pt,1),ws--,ws===0&&window.clearInterval(T);break}};return{addPoint:$,removePoint:pe}}(),t.MouseTracker.captureElement=document,t.MouseTracker.wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",t.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",t.MouseTracker.wheelEventName],t.MouseTracker.wheelEventName==="DOMMouseScroll"&&t.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(t.MouseTracker.havePointerEvents=!0,t.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),t.MouseTracker.havePointerCapture=function(){var w=document.createElement("div");return t.isFunction(w.setPointerCapture)&&t.isFunction(w.releasePointerCapture)}(),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(t.MouseTracker.havePointerEvents=!1,t.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),t.MouseTracker.mousePointerId="legacy-mouse",t.MouseTracker.havePointerCapture=function(){var w=document.createElement("div");return t.isFunction(w.setCapture)&&t.isFunction(w.releaseCapture)}(),t.MouseTracker.havePointerCapture&&t.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&t.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&t.MouseTracker.subscribeEvents.push("gesturestart","gesturechange")),t.MouseTracker.GesturePointList=function(w){this._gPoints=[],this.type=w,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},t.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(w){return this._gPoints.push(w)},removeById:function(w){var T,S=this._gPoints.length;for(T=0;T<S;T++)if(this._gPoints[T].id===w){this._gPoints.splice(T,1);break}return this._gPoints.length},getByIndex:function(w){return w<this._gPoints.length?this._gPoints[w]:null},getById:function(w){var T,S=this._gPoints.length;for(T=0;T<S;T++)if(this._gPoints[T].id===w)return this._gPoints[T];return null},getPrimary:function(w){var T,S=this._gPoints.length;for(T=0;T<S;T++)if(this._gPoints[T].isPrimary)return this._gPoints[T];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(t.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function o(w){var T=i[w.hash],S,P,j,$,pe,Fe=T.activePointersLists.length;for(S=0;S<Fe;S++)if(j=T.activePointersLists[S],j.getLength()>0){for(pe=[],$=j.asArray(),P=0;P<$.length;P++)pe.push($[P]);for(P=0;P<pe.length;P++)tt(w,j,pe[P])}for(S=0;S<Fe;S++)T.activePointersLists.pop();T.sentDragEvent=!1}function a(w){var T=i[w.hash],S,P;if(!T.tracking){for(P=0;P<t.MouseTracker.subscribeEvents.length;P++)S=t.MouseTracker.subscribeEvents[P],t.addEvent(w.element,S,T[S],S===t.MouseTracker.wheelEventName?{passive:!1,capture:!1}:!1);o(w),T.tracking=!0}}function l(w){var T=i[w.hash],S,P;if(T.tracking){for(P=0;P<t.MouseTracker.subscribeEvents.length;P++)S=t.MouseTracker.subscribeEvents[P],t.removeEvent(w.element,S,T[S],!1);o(w),T.tracking=!1}}function h(w,T){var S=i[w.hash];if(T==="pointerevent")return{upName:"pointerup",upHandler:S.pointerupcaptured,moveName:"pointermove",moveHandler:S.pointermovecaptured};if(T==="mouse")return{upName:"pointerup",upHandler:S.pointerupcaptured,moveName:"pointermove",moveHandler:S.pointermovecaptured};if(T==="touch")return{upName:"touchend",upHandler:S.touchendcaptured,moveName:"touchmove",moveHandler:S.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function u(w,T){var S;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents)try{w.element.setPointerCapture(T.id)}catch{t.console.warn("setPointerCapture() called on invalid pointer ID");return}else w.element.setCapture(!0);else S=h(w,t.MouseTracker.havePointerEvents?"pointerevent":T.type),r&&n(window.top)&&t.addEvent(window.top,S.upName,S.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,S.upName,S.upHandler,!0),t.addEvent(t.MouseTracker.captureElement,S.moveName,S.moveHandler,!0);H(w,T,!0)}function c(w,T){var S,P,j;if(t.MouseTracker.havePointerCapture)if(t.MouseTracker.havePointerEvents){if(P=w.getActivePointersListByType(T.type),j=P.getById(T.id),!j||!j.captured)return;try{w.element.releasePointerCapture(T.id)}catch{}}else w.element.releaseCapture();else S=h(w,t.MouseTracker.havePointerEvents?"pointerevent":T.type),r&&n(window.top)&&t.removeEvent(window.top,S.upName,S.upHandler,!0),t.removeEvent(t.MouseTracker.captureElement,S.moveName,S.moveHandler,!0),t.removeEvent(t.MouseTracker.captureElement,S.upName,S.upHandler,!0);H(w,T,!1)}function d(w){return t.MouseTracker.havePointerEvents?w.pointerId:t.MouseTracker.mousePointerId}function f(w){return t.MouseTracker.havePointerEvents&&w.pointerType?w.pointerType:"mouse"}function p(w){return t.MouseTracker.havePointerEvents?w.isPrimary:!0}function m(w){return t.getMousePosition(w)}function g(w,T){return v(m(w),T)}function v(w,T){var S=t.getElementOffset(T);return w.minus(S)}function x(w,T){return new t.Point((w.x+T.x)/2,(w.y+T.y)/2)}function _(w,T){var S={originalEvent:T,eventType:"click",pointerType:"mouse",isEmulated:!1};A(w,S),S.preventDefault&&!S.defaultPrevented&&t.cancelEvent(T),S.stopPropagation&&t.stopEvent(T)}function E(w,T){var S={originalEvent:T,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};A(w,S),S.preventDefault&&!S.defaultPrevented&&t.cancelEvent(T),S.stopPropagation&&t.stopEvent(T)}function R(w,T){var S=null,P={originalEvent:T,eventType:"keydown",pointerType:"",isEmulated:!1};A(w,P),w.keyDownHandler&&!P.preventGesture&&!P.defaultPrevented&&(S={eventSource:w,keyCode:T.keyCode?T.keyCode:T.charCode,ctrl:T.ctrlKey,shift:T.shiftKey,alt:T.altKey,meta:T.metaKey,originalEvent:T,preventDefault:P.preventDefault||P.defaultPrevented,userData:w.userData},w.keyDownHandler(S)),(S&&S.preventDefault||P.preventDefault&&!P.defaultPrevented)&&t.cancelEvent(T),P.stopPropagation&&t.stopEvent(T)}function M(w,T){var S=null,P={originalEvent:T,eventType:"keyup",pointerType:"",isEmulated:!1};A(w,P),w.keyUpHandler&&!P.preventGesture&&!P.defaultPrevented&&(S={eventSource:w,keyCode:T.keyCode?T.keyCode:T.charCode,ctrl:T.ctrlKey,shift:T.shiftKey,alt:T.altKey,meta:T.metaKey,originalEvent:T,preventDefault:P.preventDefault||P.defaultPrevented,userData:w.userData},w.keyUpHandler(S)),(S&&S.preventDefault||P.preventDefault&&!P.defaultPrevented)&&t.cancelEvent(T),P.stopPropagation&&t.stopEvent(T)}function O(w,T){var S=null,P={originalEvent:T,eventType:"keypress",pointerType:"",isEmulated:!1};A(w,P),w.keyHandler&&!P.preventGesture&&!P.defaultPrevented&&(S={eventSource:w,keyCode:T.keyCode?T.keyCode:T.charCode,ctrl:T.ctrlKey,shift:T.shiftKey,alt:T.altKey,meta:T.metaKey,originalEvent:T,preventDefault:P.preventDefault||P.defaultPrevented,userData:w.userData},w.keyHandler(S)),(S&&S.preventDefault||P.preventDefault&&!P.defaultPrevented)&&t.cancelEvent(T),P.stopPropagation&&t.stopEvent(T)}function N(w,T){var S={originalEvent:T,eventType:"focus",pointerType:"",isEmulated:!1};A(w,S),w.focusHandler&&!S.preventGesture&&w.focusHandler({eventSource:w,originalEvent:T,userData:w.userData})}function B(w,T){var S={originalEvent:T,eventType:"blur",pointerType:"",isEmulated:!1};A(w,S),w.blurHandler&&!S.preventGesture&&w.blurHandler({eventSource:w,originalEvent:T,userData:w.userData})}function G(w,T){var S=null,P={originalEvent:T,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};A(w,P),w.contextMenuHandler&&!P.preventGesture&&!P.defaultPrevented&&(S={eventSource:w,position:v(m(T),w.element),originalEvent:P.originalEvent,preventDefault:P.preventDefault||P.defaultPrevented,userData:w.userData},w.contextMenuHandler(S)),(S&&S.preventDefault||P.preventDefault&&!P.defaultPrevented)&&t.cancelEvent(T),P.stopPropagation&&t.stopEvent(T)}function K(w,T){C(w,T,T)}function D(w,T){var S={target:T.target||T.srcElement,type:"wheel",shiftKey:T.shiftKey||!1,clientX:T.clientX,clientY:T.clientY,pageX:T.pageX?T.pageX:T.clientX,pageY:T.pageY?T.pageY:T.clientY,deltaMode:T.type==="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};t.MouseTracker.wheelEventName==="mousewheel"?S.deltaY=-T.wheelDelta/t.DEFAULT_SETTINGS.pixelsPerWheelLine:S.deltaY=T.detail,C(w,S,T)}function C(w,T,S){var P=0,j,$=null;P=T.deltaY?T.deltaY<0?1:-1:0,j={originalEvent:T,eventType:"wheel",pointerType:"mouse",isEmulated:T!==S},A(w,j),w.scrollHandler&&!j.preventGesture&&!j.defaultPrevented&&($={eventSource:w,pointerType:"mouse",position:g(T,w.element),scroll:P,shift:T.shiftKey,isTouchEvent:!1,originalEvent:S,preventDefault:j.preventDefault||j.defaultPrevented,userData:w.userData},w.scrollHandler($)),j.stopPropagation&&t.stopEvent(S),($&&$.preventDefault||j.preventDefault&&!j.defaultPrevented)&&t.cancelEvent(S)}function I(w,T){var S={id:t.MouseTracker.mousePointerId,type:"mouse"},P={originalEvent:T,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};A(w,P),T.target===w.element&&H(w,S,!1),P.stopPropagation&&t.stopEvent(T)}function L(w,T){var S,P,j=T.changedTouches.length,$,pe=w.getActivePointersListByType("touch");S=t.now(),pe.getLength()>T.touches.length-j&&t.console.warn("Tracked touch contact count doesn't match event.touches.length");var Fe={originalEvent:T,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(A(w,Fe),P=0;P<j;P++)$={id:T.changedTouches[P].identifier,type:"touch",isPrimary:pe.getLength()===0,currentPos:m(T.changedTouches[P]),currentTime:S},X(w,Fe,$),xe(w,Fe,$,0),H(w,$,!0);Fe.preventDefault&&!Fe.defaultPrevented&&t.cancelEvent(T),Fe.stopPropagation&&t.stopEvent(T)}function W(w,T){var S,P,j=T.changedTouches.length,$;S=t.now();var pe={originalEvent:T,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(A(w,pe),P=0;P<j;P++)$={id:T.changedTouches[P].identifier,type:"touch",currentPos:m(T.changedTouches[P]),currentTime:S},Me(w,pe,$,0),H(w,$,!1),z(w,pe,$);pe.preventDefault&&!pe.defaultPrevented&&t.cancelEvent(T),pe.stopPropagation&&t.stopEvent(T)}function U(w,T){var S,P,j=T.changedTouches.length,$;S=t.now();var pe={originalEvent:T,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(A(w,pe),P=0;P<j;P++)$={id:T.changedTouches[P].identifier,type:"touch",currentPos:m(T.changedTouches[P]),currentTime:S},Ge(w,pe,$);pe.preventDefault&&!pe.defaultPrevented&&t.cancelEvent(T),pe.stopPropagation&&t.stopEvent(T)}function V(w,T){var S=T.changedTouches.length,P,j,$={originalEvent:T,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(A(w,$),P=0;P<S;P++)j={id:T.changedTouches[P].identifier,type:"touch"},Te(w,$,j);$.stopPropagation&&t.stopEvent(T)}function ie(w,T){return t.eventIsCanceled(T)||T.preventDefault(),!1}function k(w,T){return t.eventIsCanceled(T)||T.preventDefault(),!1}function F(w,T){var S={originalEvent:T,eventType:"gotpointercapture",pointerType:f(T),isEmulated:!1};A(w,S),T.target===w.element&&H(w,{id:T.pointerId,type:f(T)},!0),S.stopPropagation&&t.stopEvent(T)}function Z(w,T){var S={originalEvent:T,eventType:"lostpointercapture",pointerType:f(T),isEmulated:!1};A(w,S),T.target===w.element&&H(w,{id:T.pointerId,type:f(T)},!1),S.stopPropagation&&t.stopEvent(T)}function Q(w,T){var S={id:d(T),type:f(T),isPrimary:p(T),currentPos:m(T),currentTime:t.now()},P={originalEvent:T,eventType:"pointerenter",pointerType:S.type,isEmulated:!1};A(w,P),X(w,P,S)}function ae(w,T){var S={id:d(T),type:f(T),isPrimary:p(T),currentPos:m(T),currentTime:t.now()},P={originalEvent:T,eventType:"pointerleave",pointerType:S.type,isEmulated:!1};A(w,P),z(w,P,S)}function de(w,T){var S={id:d(T),type:f(T),isPrimary:p(T),currentPos:m(T),currentTime:t.now()},P={originalEvent:T,eventType:"pointerover",pointerType:S.type,isEmulated:!1};A(w,P),oe(w,P,S),P.preventDefault&&!P.defaultPrevented&&t.cancelEvent(T),P.stopPropagation&&t.stopEvent(T)}function be(w,T){var S={id:d(T),type:f(T),isPrimary:p(T),currentPos:m(T),currentTime:t.now()},P={originalEvent:T,eventType:"pointerout",pointerType:S.type,isEmulated:!1};A(w,P),J(w,P,S),P.preventDefault&&!P.defaultPrevented&&t.cancelEvent(T),P.stopPropagation&&t.stopEvent(T)}function De(w,T){var S={id:d(T),type:f(T),isPrimary:p(T),currentPos:m(T),currentTime:t.now()},P=t.MouseTracker.havePointerEvents&&S.type==="touch",j={originalEvent:T,eventType:"pointerdown",pointerType:S.type,isEmulated:!1};A(w,j),xe(w,j,S,T.button),j.preventDefault&&!j.defaultPrevented&&t.cancelEvent(T),j.stopPropagation&&t.stopEvent(T),j.shouldCapture&&(P?H(w,S,!0):u(w,S))}function Be(w,T){Ce(w,T)}function Ye(w,T){var S=w.getActivePointersListByType(f(T));S.getById(T.pointerId)&&Ce(w,T),t.stopEvent(T)}function Ce(w,T){var S;S={id:d(T),type:f(T),isPrimary:p(T),currentPos:m(T),currentTime:t.now()};var P={originalEvent:T,eventType:"pointerup",pointerType:S.type,isEmulated:!1};A(w,P),Me(w,P,S,T.button),P.preventDefault&&!P.defaultPrevented&&t.cancelEvent(T),P.stopPropagation&&t.stopEvent(T),P.shouldReleaseCapture&&(T.target===w.element?c(w,S):H(w,S,!1))}function Pe(w,T){He(w,T)}function Oe(w,T){var S=w.getActivePointersListByType(f(T));S.getById(T.pointerId)&&He(w,T),t.stopEvent(T)}function He(w,T){var S={id:d(T),type:f(T),isPrimary:p(T),currentPos:m(T),currentTime:t.now()},P={originalEvent:T,eventType:"pointermove",pointerType:S.type,isEmulated:!1};A(w,P),Ge(w,P,S),P.preventDefault&&!P.defaultPrevented&&t.cancelEvent(T),P.stopPropagation&&t.stopEvent(T)}function qe(w,T){var S={id:T.pointerId,type:f(T)},P={originalEvent:T,eventType:"pointercancel",pointerType:S.type,isEmulated:!1};A(w,P),Te(w,P,S),P.stopPropagation&&t.stopEvent(T)}function ot(w,T){return T.speed=0,T.direction=0,T.contactPos=T.currentPos,T.contactTime=T.currentTime,T.lastPos=T.currentPos,T.lastTime=T.currentTime,w.add(T)}function tt(w,T,S){var P,j=T.getById(S.id);return j?(j.captured&&(t.console.warn("stopTrackingPointer() called on captured pointer"),c(w,j)),T.removeContact(),P=T.removeById(S.id)):P=T.getLength(),P}function y(w,T){switch(T.eventType){case"pointermove":T.isStoppable=!0,T.isCancelable=!0,T.preventDefault=!1,T.preventGesture=!w.hasGestureHandlers,T.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":T.isStoppable=!0,T.isCancelable=!0,T.preventDefault=!1,T.preventGesture=!1,T.stopPropagation=!1;break;case"pointerdown":T.isStoppable=!0,T.isCancelable=!0,T.preventDefault=!1,T.preventGesture=!w.hasGestureHandlers,T.stopPropagation=!1;break;case"pointerup":T.isStoppable=!0,T.isCancelable=!0,T.preventDefault=!1,T.preventGesture=!w.hasGestureHandlers,T.stopPropagation=!1;break;case"wheel":T.isStoppable=!0,T.isCancelable=!0,T.preventDefault=!1,T.preventGesture=!w.hasScrollHandler,T.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":T.isStoppable=!0,T.isCancelable=!1,T.preventDefault=!1,T.preventGesture=!1,T.stopPropagation=!1;break;case"click":T.isStoppable=!0,T.isCancelable=!0,T.preventDefault=!!w.clickHandler,T.preventGesture=!1,T.stopPropagation=!1;break;case"dblclick":T.isStoppable=!0,T.isCancelable=!0,T.preventDefault=!!w.dblClickHandler,T.preventGesture=!1,T.stopPropagation=!1;break;case"focus":case"blur":case"pointerenter":case"pointerleave":default:T.isStoppable=!1,T.isCancelable=!1,T.preventDefault=!1,T.preventGesture=!1,T.stopPropagation=!1;break}}function A(w,T){T.eventSource=w,T.eventPhase=T.originalEvent&&typeof T.originalEvent.eventPhase<"u"?T.originalEvent.eventPhase:0,T.defaultPrevented=t.eventIsCanceled(T.originalEvent),T.shouldCapture=!1,T.shouldReleaseCapture=!1,T.userData=w.userData,y(w,T),w.preProcessEventHandler&&w.preProcessEventHandler(T)}function H(w,T,S){var P=w.getActivePointersListByType(T.type),j=P.getById(T.id);j?S&&!j.captured?(j.captured=!0,P.captureCount++):!S&&j.captured&&(j.captured=!1,P.captureCount--,P.captureCount<0&&(P.captureCount=0,t.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):t.console.warn("updatePointerCaptured() called on untracked pointer")}function X(w,T,S){var P=w.getActivePointersListByType(S.type),j;j=P.getById(S.id),j?(j.insideElement=!0,j.lastPos=j.currentPos,j.lastTime=j.currentTime,j.currentPos=S.currentPos,j.currentTime=S.currentTime,S=j):(S.captured=!1,S.insideElementPressed=!1,S.insideElement=!0,ot(P,S)),w.enterHandler&&w.enterHandler({eventSource:w,pointerType:S.type,position:v(S.currentPos,w.element),buttons:P.buttons,pointers:w.getActivePointerCount(),insideElementPressed:S.insideElementPressed,buttonDownAny:P.buttons!==0,isTouchEvent:S.type==="touch",originalEvent:T.originalEvent,userData:w.userData})}function z(w,T,S){var P=w.getActivePointersListByType(S.type),j,$;j=P.getById(S.id),j?(j.captured?(j.insideElement=!1,j.lastPos=j.currentPos,j.lastTime=j.currentTime,j.currentPos=S.currentPos,j.currentTime=S.currentTime):tt(w,P,j),S=j):(S.captured=!1,S.insideElementPressed=!1),(w.leaveHandler||w.exitHandler)&&($={eventSource:w,pointerType:S.type,position:S.currentPos&&v(S.currentPos,w.element),buttons:P.buttons,pointers:w.getActivePointerCount(),insideElementPressed:S.insideElementPressed,buttonDownAny:P.buttons!==0,isTouchEvent:S.type==="touch",originalEvent:T.originalEvent,userData:w.userData},w.leaveHandler&&w.leaveHandler($),w.exitHandler&&w.exitHandler($))}function oe(w,T,S){var P,j;P=w.getActivePointersListByType(S.type),j=P.getById(S.id),j?S=j:(S.captured=!1,S.insideElementPressed=!1),w.overHandler&&w.overHandler({eventSource:w,pointerType:S.type,position:v(S.currentPos,w.element),buttons:P.buttons,pointers:w.getActivePointerCount(),insideElementPressed:S.insideElementPressed,buttonDownAny:P.buttons!==0,isTouchEvent:S.type==="touch",originalEvent:T.originalEvent,userData:w.userData})}function J(w,T,S){var P,j;P=w.getActivePointersListByType(S.type),j=P.getById(S.id),j?S=j:(S.captured=!1,S.insideElementPressed=!1),w.outHandler&&w.outHandler({eventSource:w,pointerType:S.type,position:S.currentPos&&v(S.currentPos,w.element),buttons:P.buttons,pointers:w.getActivePointerCount(),insideElementPressed:S.insideElementPressed,buttonDownAny:P.buttons!==0,isTouchEvent:S.type==="touch",originalEvent:T.originalEvent,userData:w.userData})}function xe(w,T,S,P){var j=i[w.hash],$=w.getActivePointersListByType(S.type),pe;if(typeof T.originalEvent.buttons<"u"?$.buttons=T.originalEvent.buttons:P===0?$.buttons|=1:P===1?$.buttons|=4:P===2?$.buttons|=2:P===3?$.buttons|=8:P===4?$.buttons|=16:P===5&&($.buttons|=32),P!==0){T.shouldCapture=!1,T.shouldReleaseCapture=!1,w.nonPrimaryPressHandler&&!T.preventGesture&&!T.defaultPrevented&&(T.preventDefault=!0,w.nonPrimaryPressHandler({eventSource:w,pointerType:S.type,position:v(S.currentPos,w.element),button:P,buttons:$.buttons,isTouchEvent:S.type==="touch",originalEvent:T.originalEvent,userData:w.userData}));return}pe=$.getById(S.id),pe?(pe.insideElementPressed=!0,pe.insideElement=!0,pe.originalTarget=T.originalEvent.target,pe.contactPos=S.currentPos,pe.contactTime=S.currentTime,pe.lastPos=pe.currentPos,pe.lastTime=pe.currentTime,pe.currentPos=S.currentPos,pe.currentTime=S.currentTime,S=pe):(S.captured=!1,S.insideElementPressed=!0,S.insideElement=!0,S.originalTarget=T.originalEvent.target,ot($,S)),$.addContact(),!T.preventGesture&&!T.defaultPrevented?(T.shouldCapture=!0,T.shouldReleaseCapture=!1,T.preventDefault=!0,(w.dragHandler||w.dragEndHandler||w.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.addPoint(w,S),$.contacts===1?w.pressHandler&&!T.preventGesture&&w.pressHandler({eventSource:w,pointerType:S.type,position:v(S.contactPos,w.element),buttons:$.buttons,isTouchEvent:S.type==="touch",originalEvent:T.originalEvent,userData:w.userData}):$.contacts===2&&w.pinchHandler&&S.type==="touch"&&(j.pinchGPoints=$.asArray(),j.lastPinchDist=j.currentPinchDist=j.pinchGPoints[0].currentPos.distanceTo(j.pinchGPoints[1].currentPos),j.lastPinchCenter=j.currentPinchCenter=x(j.pinchGPoints[0].currentPos,j.pinchGPoints[1].currentPos))):(T.shouldCapture=!1,T.shouldReleaseCapture=!1)}function Me(w,T,S,P){var j=i[w.hash],$=w.getActivePointersListByType(S.type),pe,Fe,ve,Dt=!1,pt;if(typeof T.originalEvent.buttons<"u"?$.buttons=T.originalEvent.buttons:P===0?$.buttons^=-2:P===1?$.buttons^=-5:P===2?$.buttons^=-3:P===3?$.buttons^=-9:P===4?$.buttons^=-17:P===5&&($.buttons^=-33),T.shouldCapture=!1,P!==0){T.shouldReleaseCapture=!1,w.nonPrimaryReleaseHandler&&!T.preventGesture&&!T.defaultPrevented&&(T.preventDefault=!0,w.nonPrimaryReleaseHandler({eventSource:w,pointerType:S.type,position:v(S.currentPos,w.element),button:P,buttons:$.buttons,isTouchEvent:S.type==="touch",originalEvent:T.originalEvent,userData:w.userData}));return}ve=$.getById(S.id),ve?($.removeContact(),ve.captured&&(Dt=!0),ve.lastPos=ve.currentPos,ve.lastTime=ve.currentTime,ve.currentPos=S.currentPos,ve.currentTime=S.currentTime,ve.insideElement||tt(w,$,ve),pe=ve.currentPos,Fe=ve.currentTime):(S.captured=!1,S.insideElementPressed=!1,S.insideElement=!0,ot($,S),ve=S),!T.preventGesture&&!T.defaultPrevented&&(Dt?(T.shouldReleaseCapture=!0,T.preventDefault=!0,(w.dragHandler||w.dragEndHandler||w.pinchHandler)&&t.MouseTracker.gesturePointVelocityTracker.removePoint(w,ve),$.contacts===0?(w.releaseHandler&&pe&&w.releaseHandler({eventSource:w,pointerType:ve.type,position:v(pe,w.element),buttons:$.buttons,insideElementPressed:ve.insideElementPressed,insideElementReleased:ve.insideElement,isTouchEvent:ve.type==="touch",originalEvent:T.originalEvent,userData:w.userData}),w.dragEndHandler&&j.sentDragEvent&&w.dragEndHandler({eventSource:w,pointerType:ve.type,position:v(ve.currentPos,w.element),speed:ve.speed,direction:ve.direction,shift:T.originalEvent.shiftKey,isTouchEvent:ve.type==="touch",originalEvent:T.originalEvent,userData:w.userData}),j.sentDragEvent=!1,(w.clickHandler||w.dblClickHandler)&&ve.insideElement&&(pt=Fe-ve.contactTime<=w.clickTimeThreshold&&ve.contactPos.distanceTo(pe)<=w.clickDistThreshold,w.clickHandler&&w.clickHandler({eventSource:w,pointerType:ve.type,position:v(ve.currentPos,w.element),quick:pt,shift:T.originalEvent.shiftKey,isTouchEvent:ve.type==="touch",originalEvent:T.originalEvent,originalTarget:ve.originalTarget,userData:w.userData}),w.dblClickHandler&&pt&&($.clicks++,$.clicks===1?(j.lastClickPos=pe,j.dblClickTimeOut=setTimeout(function(){$.clicks=0},w.dblClickTimeThreshold)):$.clicks===2&&(clearTimeout(j.dblClickTimeOut),$.clicks=0,j.lastClickPos.distanceTo(pe)<=w.dblClickDistThreshold&&w.dblClickHandler({eventSource:w,pointerType:ve.type,position:v(ve.currentPos,w.element),shift:T.originalEvent.shiftKey,isTouchEvent:ve.type==="touch",originalEvent:T.originalEvent,userData:w.userData}),j.lastClickPos=null)))):$.contacts===2&&w.pinchHandler&&ve.type==="touch"&&(j.pinchGPoints=$.asArray(),j.lastPinchDist=j.currentPinchDist=j.pinchGPoints[0].currentPos.distanceTo(j.pinchGPoints[1].currentPos),j.lastPinchCenter=j.currentPinchCenter=x(j.pinchGPoints[0].currentPos,j.pinchGPoints[1].currentPos))):(T.shouldReleaseCapture=!1,w.releaseHandler&&pe&&(w.releaseHandler({eventSource:w,pointerType:ve.type,position:v(pe,w.element),buttons:$.buttons,insideElementPressed:ve.insideElementPressed,insideElementReleased:ve.insideElement,isTouchEvent:ve.type==="touch",originalEvent:T.originalEvent,userData:w.userData}),T.preventDefault=!0)))}function Ge(w,T,S){var P=i[w.hash],j=w.getActivePointersListByType(S.type),$,pe,Fe;if(typeof T.originalEvent.buttons<"u"&&(j.buttons=T.originalEvent.buttons),$=j.getById(S.id),$)$.lastPos=$.currentPos,$.lastTime=$.currentTime,$.currentPos=S.currentPos,$.currentTime=S.currentTime;else return;T.shouldCapture=!1,T.shouldReleaseCapture=!1,w.stopHandler&&S.type==="mouse"&&(clearTimeout(w.stopTimeOut),w.stopTimeOut=setTimeout(function(){it(w,T.originalEvent,S.type)},w.stopDelay)),j.contacts===0?w.moveHandler&&w.moveHandler({eventSource:w,pointerType:S.type,position:v(S.currentPos,w.element),buttons:j.buttons,isTouchEvent:S.type==="touch",originalEvent:T.originalEvent,userData:w.userData}):j.contacts===1?(w.moveHandler&&($=j.asArray()[0],w.moveHandler({eventSource:w,pointerType:$.type,position:v($.currentPos,w.element),buttons:j.buttons,isTouchEvent:$.type==="touch",originalEvent:T.originalEvent,userData:w.userData})),w.dragHandler&&!T.preventGesture&&!T.defaultPrevented&&($=j.asArray()[0],Fe=$.currentPos.minus($.lastPos),w.dragHandler({eventSource:w,pointerType:$.type,position:v($.currentPos,w.element),buttons:j.buttons,delta:Fe,speed:$.speed,direction:$.direction,shift:T.originalEvent.shiftKey,isTouchEvent:$.type==="touch",originalEvent:T.originalEvent,userData:w.userData}),T.preventDefault=!0,P.sentDragEvent=!0)):j.contacts===2&&(w.moveHandler&&(pe=j.asArray(),w.moveHandler({eventSource:w,pointerType:pe[0].type,position:v(x(pe[0].currentPos,pe[1].currentPos),w.element),buttons:j.buttons,isTouchEvent:pe[0].type==="touch",originalEvent:T.originalEvent,userData:w.userData})),w.pinchHandler&&S.type==="touch"&&!T.preventGesture&&!T.defaultPrevented&&(Fe=P.pinchGPoints[0].currentPos.distanceTo(P.pinchGPoints[1].currentPos),Fe!==P.currentPinchDist&&(P.lastPinchDist=P.currentPinchDist,P.currentPinchDist=Fe,P.lastPinchCenter=P.currentPinchCenter,P.currentPinchCenter=x(P.pinchGPoints[0].currentPos,P.pinchGPoints[1].currentPos),w.pinchHandler({eventSource:w,pointerType:"touch",gesturePoints:P.pinchGPoints,lastCenter:v(P.lastPinchCenter,w.element),center:v(P.currentPinchCenter,w.element),lastDistance:P.lastPinchDist,distance:P.currentPinchDist,shift:T.originalEvent.shiftKey,originalEvent:T.originalEvent,userData:w.userData}),T.preventDefault=!0)))}function Te(w,T,S){var P=w.getActivePointersListByType(S.type),j;j=P.getById(S.id),j&&tt(w,P,j)}function it(w,T,S){w.stopHandler&&w.stopHandler({eventSource:w,pointerType:S,position:g(T,w.element),buttons:w.getActivePointersListByType(S).buttons,isTouchEvent:S==="touch",originalEvent:T,userData:w.userData})}}(e),function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(i,r,n){var o=i.parentNode;typeof r=="number"&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),r={anchor:r}),r.attachToViewer=typeof r.attachToViewer>"u"?!0:r.attachToViewer,this.autoFade=typeof r.autoFade>"u"?!0:r.autoFade,this.element=i,this.anchor=r.anchor,this.container=n,this.anchor===t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof r.top=="number"?r.top+"px":r.top,this.wrapper.style.left=typeof r.left=="number"?r.left+"px":r.left,this.wrapper.style.height=typeof r.height=="number"?r.height+"px":r.height,this.wrapper.style.width=typeof r.width=="number"?r.width+"px":r.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),r.attachToViewer?this.anchor===t.ControlAnchor.TOP_RIGHT||this.anchor===t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):o.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==t.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!=="none"},setVisible:function(i){this.wrapper.style.display=i?this.anchor===t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(i){t.setElementOpacity(this.wrapper,i,!0)}}}(e),function(t){t.ControlDock=function(r){var n=["topleft","topright","bottomright","bottomleft"],o,a;for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(Math.random()*1e6),container:t.makeNeutralElement("div"),controls:[]},r),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),t.getElementStyle(this.element).position==="static"&&(this.element.style.position="relative"),this.container.style.width="100%",this.container.style.height="100%"),a=0;a<n.length;a++)o=n[a],this.controls[o]=t.makeNeutralElement("div"),this.controls[o].style.position="absolute",o.match("left")&&(this.controls[o].style.left="0px"),o.match("right")&&(this.controls[o].style.right="0px"),o.match("top")&&(this.controls[o].style.top="0px"),o.match("bottom")&&(this.controls[o].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(r,n){r=t.getElement(r);var o=null;if(!(i(this,r)>=0)){switch(n.anchor){case t.ControlAnchor.TOP_RIGHT:o=this.controls.topright,r.style.position="relative",r.style.paddingRight="0px",r.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:o=this.controls.bottomright,r.style.position="relative",r.style.paddingRight="0px",r.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:o=this.controls.bottomleft,r.style.position="relative",r.style.paddingLeft="0px",r.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:o=this.controls.topleft,r.style.position="relative",r.style.paddingLeft="0px",r.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:o=this.container,r.style.margin="0px",r.style.padding="0px";break;default:case t.ControlAnchor.NONE:o=this.container,r.style.margin="0px",r.style.padding="0px";break}this.controls.push(new t.Control(r,n,o)),r.style.display="inline-block"}},removeControl:function(r){r=t.getElement(r);var n=i(this,r);return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var r;for(r=this.controls.length-1;r>=0;r--)if(this.controls[r].isVisible())return!0;return!1},setControlsEnabled:function(r){var n;for(n=this.controls.length-1;n>=0;n--)this.controls[n].setVisible(r);return this}};function i(r,n){var o=r.controls,a;for(a=o.length-1;a>=0;a--)if(o[a].element===n)return a;return-1}}(e),function(t){t.Placement=t.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(e),function(t){var i={},r=1;t.Viewer=function(y){var A=arguments,H=this,X;t.isPlainObject(y)||(y={id:A[0],xmlPath:A.length>1?A[1]:void 0,prefixUrl:A.length>2?A[2]:void 0,controls:A.length>3?A[3]:void 0,overlays:A.length>4?A[4]:void 0}),y.config&&(t.extend(!0,y,y.config),delete y.config);let z=["useCanvas"];if(y.drawerOptions=Object.assign({},z.reduce((J,xe)=>(J[xe]=y[xe],delete y[xe],J),{}),y.drawerOptions),t.extend(!0,this,{id:y.id,hash:y.hash||r++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttonGroup:null,profiler:null},t.DEFAULT_SETTINGS,y),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");typeof i[this.hash]<"u"&&t.console.warn("Hash "+this.hash+" has already been used."),i[this.hash]={fsBoundsDelta:new t.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,needsResize:!1,forceResize:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null,lastClickTime:null,draggingToZoom:!1},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=t.now(),t.EventSource.call(this),this.addHandler("open-failed",function(J){var xe=t.getString("Errors.OpenFailed",J.eventSource,J.message);H._showMessage(xe)}),t.ControlDock.call(this,y),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=t.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(J){J.width="100%",J.height="100%",J.overflow="hidden",J.position="absolute",J.top="0px",J.left="0px"}(this.canvas.style),t.setElementTouchActionNone(this.canvas),y.tabIndex!==""&&(this.canvas.tabIndex=y.tabIndex===void 0?0:y.tabIndex),this.container.className="openseadragon-container",function(J){J.width="100%",J.height="100%",J.position="relative",J.overflow="hidden",J.left="0px",J.top="0px",J.textAlign="left"}(this.container.style),t.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new t.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:t.delegate(this,g),keyDownHandler:t.delegate(this,v),keyHandler:t.delegate(this,x),clickHandler:t.delegate(this,_),dblClickHandler:t.delegate(this,E),dragHandler:t.delegate(this,R),dragEndHandler:t.delegate(this,M),enterHandler:t.delegate(this,O),leaveHandler:t.delegate(this,N),pressHandler:t.delegate(this,B),releaseHandler:t.delegate(this,G),nonPrimaryPressHandler:t.delegate(this,K),nonPrimaryReleaseHandler:t.delegate(this,D),scrollHandler:t.delegate(this,W),pinchHandler:t.delegate(this,C),focusHandler:t.delegate(this,I),blurHandler:t.delegate(this,L)}),this.outerTracker=new t.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:t.delegate(this,U),leaveHandler:t.delegate(this,V)}),this.toolbar&&(this.toolbar=new t.ControlDock({element:this.toolbar})),this.bindStandardControls(),i[this.hash].prevContainerSize=n(this.container),window.ResizeObserver?(this._autoResizePolling=!1,this._resizeObserver=new ResizeObserver(function(){i[H.hash].needsResize=!0}),this._resizeObserver.observe(this.container,{})):this._autoResizePolling=!0,this.world=new t.World({viewer:this}),this.world.addHandler("add-item",function(J){H.source=H.world.getItemAt(0).source,i[H.hash].forceRedraw=!0,H._updateRequestId||(H._updateRequestId=h(H,ie))}),this.world.addHandler("remove-item",function(J){H.world.getItemCount()?H.source=H.world.getItemAt(0).source:H.source=null,i[H.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(J){H.viewport&&H.viewport._setContentBounds(H.world.getHomeBounds(),H.world.getContentFactor())}),this.world.addHandler("item-index-change",function(J){H.source=H.world.getItemAt(0).source}),this.viewport=new t.Viewport({containerSize:i[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,overlayPreserveContentDirection:this.overlayPreserveContentDirection,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new t.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:y.timeout,tileRetryMax:this.tileRetryMax,tileRetryDelay:this.tileRetryDelay}),this.tileCache=new t.TileCache({maxImageCacheCount:this.maxImageCacheCount}),Object.prototype.hasOwnProperty.call(this.drawerOptions,"useCanvas")&&(t.console.error('useCanvas is deprecated, use the "drawer" option to indicate preferred drawer(s)'),this.drawerOptions.useCanvas||(this.drawer=t.HTMLDrawer),delete this.drawerOptions.useCanvas);let oe=Array.isArray(this.drawer)?this.drawer:[this.drawer];oe.length===0&&(oe=[t.DEFAULT_SETTINGS.drawer].flat(),t.console.warn("No valid drawers were selected. Using the default value.")),this.drawer=null;for(const J of oe)if(this.requestDrawer(J,{mainDrawer:!0,redrawImmediately:!1}))break;if(!this.drawer)throw t.console.error("No drawer could be created!"),"Error with creating the selected drawer(s)";for(this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),this.overlaysContainer=t.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(X=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(X,1),this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(X=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(X,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new t.Navigator({element:this.navigatorElement,id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy,animationTime:this.animationTime,drawer:this.drawer.getType(),loadTilesWithAjax:this.loadTilesWithAjax,ajaxHeaders:this.ajaxHeaders,ajaxWithCredentials:this.ajaxWithCredentials})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),X=0;X<this.customControls.length;X++)this.addControl(this.customControls[X].id,{anchor:this.customControls[X].anchor});t.requestAnimationFrame(function(){c(H)}),t._viewers.set(this.element,this)},t.extend(t.Viewer.prototype,t.EventSource.prototype,t.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(y){return t.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(y)},openTileSource:function(y){return t.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(y)},get buttons(){return t.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(y,A){var H=this;if(this.close(),!y)return this;if(this.sequenceMode&&t.isArray(y))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof A<"u"&&!isNaN(A)&&(this.initialPage=A),this.tileSources=y,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(t.isArray(y)||(y=[y]),!y.length)return this;this._opening=!0;for(var X=y.length,z=0,oe=0,J,xe=function(){if(z+oe===X)if(z){(H._firstOpen||!H.preserveViewport)&&(H.viewport.goHome(!0),H.viewport.update()),H._firstOpen=!1;var Te=y[0];if(Te.tileSource&&(Te=Te.tileSource),H.overlays&&!H.preserveOverlays)for(var it=0;it<H.overlays.length;it++)H.currentOverlays[it]=a(H,H.overlays[it]);H._drawOverlays(),H._opening=!1,H.raiseEvent("open",{source:Te})}else H._opening=!1,H.raiseEvent("open-failed",J)},Me=function(Te){(!t.isPlainObject(Te)||!Te.tileSource)&&(Te={tileSource:Te}),Te.index!==void 0&&(t.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete Te.index),Te.collectionImmediately===void 0&&(Te.collectionImmediately=!0);var it=Te.success;Te.success=function(T){if(z++,Te.tileSource.overlays)for(var S=0;S<Te.tileSource.overlays.length;S++)H.addOverlay(Te.tileSource.overlays[S]);it&&it(T),xe()};var w=Te.error;Te.error=function(T){oe++,J||(J=T),w&&w(T),xe()},H.addTiledImage(Te)},Ge=0;Ge<y.length;Ge++)Me(y[Ge]);return this},close:function(){return i[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),i[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(i[this.hash]){if(this.raiseEvent("before-destroy"),this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this._resizeObserver&&this._resizeObserver.disconnect(),this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(t.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),i[this.navigator.hash]=null,delete i[this.navigator.hash],this.navigator=null),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),i[this.hash]=null,delete i[this.hash],this.canvas=null,this.container=null,t._viewers.delete(this.element),this.element=null,this.raiseEvent("destroy"),this.removeAllHandlers()}},requestDrawer(y,A){const H={mainDrawer:!0,redrawImmediately:!0,drawerOptions:null};A=t.extend(!0,H,A);const X=A.mainDrawer,z=A.redrawImmediately,oe=A.drawerOptions,J=this.drawer;let xe=null;if(y&&y.prototype instanceof t.DrawerBase?(xe=y,y="custom"):typeof y=="string"&&(xe=t.determineDrawer(y)),xe||t.console.warn("Unsupported drawer! Drawer must be an existing string type, or a class that extends OpenSeadragon.DrawerBase."),xe&&xe.isSupported()){J&&X&&J.destroy();const Me=new xe({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor,options:oe||this.drawerOptions[y]});return X&&(this.drawer=Me,z&&this.forceRedraw()),Me}return!1},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(y){return this.innerTracker.setTracking(y),this.outerTracker.setTracking(y),this.raiseEvent("mouse-enabled",{enabled:y}),this},areControlsEnabled:function(){var y=this.controls.length,A;for(A=0;A<this.controls.length;A++)y=y&&this.controls[A].isVisible();return y},setControlsEnabled:function(y){return y?f(this):c(this),this.raiseEvent("controls-enabled",{enabled:y}),this},setDebugMode:function(y){for(var A=0;A<this.world.getItemCount();A++)this.world.getItemAt(A).debugMode=y;this.debugMode=y,this.forceRedraw()},setAjaxHeaders:function(y,A){if(y===null&&(y={}),!t.isPlainObject(y)){console.error("[Viewer.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}if(A===void 0&&(A=!0),this.ajaxHeaders=y,A){for(var H=0;H<this.world.getItemCount();H++)this.world.getItemAt(H)._updateAjaxHeaders(!0);if(this.navigator&&this.navigator.setAjaxHeaders(this.ajaxHeaders,!0),this.referenceStrip&&this.referenceStrip.miniViewers)for(var X in this.referenceStrip.miniViewers)this.referenceStrip.miniViewers[X].setAjaxHeaders(this.ajaxHeaders,!0)}},addButton:function(y){this.buttonGroup.addButton(y)},isFullPage:function(){return i[this.hash]&&i[this.hash].fullPage},setFullPage:function(y){var A=document.body,H=A.style,X=document.documentElement.style,z=this,oe,J;if(y===this.isFullPage())return this;var xe={fullPage:y,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",xe),xe.preventDefaultAction)return this;if(y&&this.element){for(this.elementSize=t.getElementSize(this.element),this.pageScroll=t.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=H.margin,this.docMargin=X.margin,H.margin="0",X.margin="0",this.bodyPadding=H.padding,this.docPadding=X.padding,H.padding="0",X.padding="0",this.bodyWidth=H.width,this.docWidth=X.width,H.width="100%",X.width="100%",this.bodyHeight=H.height,this.docHeight=X.height,H.height="100%",X.height="100%",this.bodyDisplay=H.display,H.display="block",this.previousBody=[],i[this.hash].prevElementParent=this.element.parentNode,i[this.hash].prevNextSibling=this.element.nextSibling,i[this.hash].prevElementWidth=this.element.style.width,i[this.hash].prevElementHeight=this.element.style.height,oe=A.childNodes.length,J=0;J<oe;J++)this.previousBody.push(A.childNodes[0]),A.removeChild(A.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,A.appendChild(this.toolbar.element),t.addClass(this.toolbar.element,"fullpage")),t.addClass(this.element,"fullpage"),A.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=t.getElementSize(this.element).y-t.getElementSize(this.toolbar.element).y+"px"),i[this.hash].fullPage=!0,t.delegate(this,U)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,H.margin=this.bodyMargin,X.margin=this.docMargin,H.padding=this.bodyPadding,X.padding=this.docPadding,H.width=this.bodyWidth,X.width=this.docWidth,H.height=this.bodyHeight,X.height=this.docHeight,H.display=this.bodyDisplay,A.removeChild(this.element),oe=this.previousBody.length,J=0;J<oe;J++)A.appendChild(this.previousBody.shift());t.removeClass(this.element,"fullpage"),i[this.hash].prevElementParent.insertBefore(this.element,i[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(A.removeChild(this.toolbar.element),t.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=i[this.hash].prevElementWidth,this.element.style.height=i[this.hash].prevElementHeight;var Me=0,Ge=function(){t.setPageScroll(z.pageScroll);var Te=t.getPageScroll();Me++,Me<10&&(Te.x!==z.pageScroll.x||Te.y!==z.pageScroll.y)&&t.requestAnimationFrame(Ge)};t.requestAnimationFrame(Ge),i[this.hash].fullPage=!1,t.delegate(this,V)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:y}),this},setFullScreen:function(y){var A=this;if(!t.supportsFullScreen)return this.setFullPage(y);if(t.isFullScreen()===y)return this;var H={fullScreen:y,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",H),H.preventDefaultAction)return this;if(y){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var X=function(){var z=t.isFullScreen();z||(t.removeEvent(document,t.fullScreenEventName,X),t.removeEvent(document,t.fullScreenErrorEventName,X),A.setFullPage(!1),A.isFullPage()&&(A.element.style.width=A.fullPageStyleWidth,A.element.style.height=A.fullPageStyleHeight)),A.navigator&&A.viewport&&setTimeout(function(){A.navigator.update(A.viewport)}),A.raiseEvent("full-screen",{fullScreen:z})};t.addEvent(document,t.fullScreenEventName,X),t.addEvent(document,t.fullScreenErrorEventName,X),t.requestFullScreen(document.body)}else t.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!=="hidden"},isFullScreen:function(){return t.isFullScreen()&&this.isFullPage()},setVisible:function(y){return this.container.style.visibility=y?"":"hidden",this.raiseEvent("visible",{visible:y}),this},addTiledImage:function(y){t.console.assert(y,"[Viewer.addTiledImage] options is required"),t.console.assert(y.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),t.console.assert(!y.replace||y.index>-1&&y.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var A=this;y.replace&&(y.replaceItem=A.world.getItemAt(y.index)),this._hideMessage(),y.placeholderFillStyle===void 0&&(y.placeholderFillStyle=this.placeholderFillStyle),y.opacity===void 0&&(y.opacity=this.opacity),y.preload===void 0&&(y.preload=this.preload),y.compositeOperation===void 0&&(y.compositeOperation=this.compositeOperation),y.crossOriginPolicy===void 0&&(y.crossOriginPolicy=y.tileSource.crossOriginPolicy!==void 0?y.tileSource.crossOriginPolicy:this.crossOriginPolicy),y.ajaxWithCredentials===void 0&&(y.ajaxWithCredentials=this.ajaxWithCredentials),y.loadTilesWithAjax===void 0&&(y.loadTilesWithAjax=this.loadTilesWithAjax),t.isPlainObject(y.ajaxHeaders)||(y.ajaxHeaders={});var H={options:y};function X(J){for(var xe=0;xe<A._loadQueue.length;xe++)if(A._loadQueue[xe]===H){A._loadQueue.splice(xe,1);break}A._loadQueue.length===0&&z(H),A.raiseEvent("add-item-failed",J),y.error&&y.error(J)}function z(J){A.collectionMode&&(A.world.arrange({immediately:J.options.collectionImmediately,rows:A.collectionRows,columns:A.collectionColumns,layout:A.collectionLayout,tileSize:A.collectionTileSize,tileMargin:A.collectionTileMargin}),A.world.setAutoRefigureSizes(!0))}if(t.isArray(y.tileSource)){setTimeout(function(){X({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:y.tileSource,options:y})});return}this._loadQueue.push(H);function oe(){for(var J,xe,Me;A._loadQueue.length&&(J=A._loadQueue[0],!!J.tileSource);){if(A._loadQueue.splice(0,1),J.options.replace){var Ge=A.world.getIndexOfItem(J.options.replaceItem);Ge!==-1&&(J.options.index=Ge),A.world.removeItem(J.options.replaceItem)}xe=new t.TiledImage({viewer:A,source:J.tileSource,viewport:A.viewport,drawer:A.drawer,tileCache:A.tileCache,imageLoader:A.imageLoader,x:J.options.x,y:J.options.y,width:J.options.width,height:J.options.height,fitBounds:J.options.fitBounds,fitBoundsPlacement:J.options.fitBoundsPlacement,clip:J.options.clip,placeholderFillStyle:J.options.placeholderFillStyle,opacity:J.options.opacity,preload:J.options.preload,degrees:J.options.degrees,flipped:J.options.flipped,compositeOperation:J.options.compositeOperation,springStiffness:A.springStiffness,animationTime:A.animationTime,minZoomImageRatio:A.minZoomImageRatio,wrapHorizontal:A.wrapHorizontal,wrapVertical:A.wrapVertical,maxTilesPerFrame:A.maxTilesPerFrame,immediateRender:A.immediateRender,blendTime:A.blendTime,alwaysBlend:A.alwaysBlend,minPixelRatio:A.minPixelRatio,smoothTileEdgesMinZoom:A.smoothTileEdgesMinZoom,iOSDevice:A.iOSDevice,crossOriginPolicy:J.options.crossOriginPolicy,ajaxWithCredentials:J.options.ajaxWithCredentials,loadTilesWithAjax:J.options.loadTilesWithAjax,ajaxHeaders:J.options.ajaxHeaders,debugMode:A.debugMode,subPixelRoundingForTransparency:A.subPixelRoundingForTransparency}),A.collectionMode&&A.world.setAutoRefigureSizes(!1),A.navigator&&(Me=t.extend({},J.options,{replace:!1,originalTiledImage:xe,tileSource:J.tileSource}),A.navigator.addTiledImage(Me)),A.world.addItem(xe,{index:J.options.index}),A._loadQueue.length===0&&z(J),A.world.getItemCount()===1&&!A.preserveViewport&&A.viewport.goHome(!0),J.options.success&&J.options.success({item:xe})}}o(this,y.tileSource,y,function(J){H.tileSource=J,oe()},function(J){J.options=y,X(J),oe()})},addSimpleImage:function(y){t.console.assert(y,"[Viewer.addSimpleImage] options is required"),t.console.assert(y.url,"[Viewer.addSimpleImage] options.url is required");var A=t.extend({},y,{tileSource:{type:"image",url:y.url}});delete A.url,this.addTiledImage(A)},addLayer:function(y){var A=this;t.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var H=t.extend({},y,{success:function(X){A.raiseEvent("add-layer",{options:y,drawer:X.item})},error:function(X){A.raiseEvent("add-layer-failed",X)}});return this.addTiledImage(H),this},getLayerAtLevel:function(y){return t.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(y)},getLevelOfLayer:function(y){return t.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(y)},getLayersCount:function(){return t.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(y,A){return t.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(y,A)},removeLayer:function(y){return t.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(y)},forceRedraw:function(){return i[this.hash].forceRedraw=!0,this},forceResize:function(){i[this.hash].needsResize=!0,i[this.hash].forceResize=!0},bindSequenceControls:function(){var y=t.delegate(this,p),A=t.delegate(this,m),H=t.delegate(this,this.goToNextPage),X=t.delegate(this,this.goToPreviousPage),z=this.navImages,oe=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(oe=!1),this.previousButton=new t.Button({element:this.previousButton?t.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.PreviousPage"),srcRest:Q(this.prefixUrl,z.previous.REST),srcGroup:Q(this.prefixUrl,z.previous.GROUP),srcHover:Q(this.prefixUrl,z.previous.HOVER),srcDown:Q(this.prefixUrl,z.previous.DOWN),onRelease:X,onFocus:y,onBlur:A}),this.nextButton=new t.Button({element:this.nextButton?t.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.NextPage"),srcRest:Q(this.prefixUrl,z.next.REST),srcGroup:Q(this.prefixUrl,z.next.GROUP),srcHover:Q(this.prefixUrl,z.next.HOVER),srcDown:Q(this.prefixUrl,z.next.DOWN),onRelease:H,onFocus:y,onBlur:A}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),oe&&(this.paging=new t.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:t.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||t.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var y=t.delegate(this,ae),A=t.delegate(this,be),H=t.delegate(this,Ye),X=t.delegate(this,de),z=t.delegate(this,Ce),oe=t.delegate(this,Oe),J=t.delegate(this,He),xe=t.delegate(this,qe),Me=t.delegate(this,ot),Ge=t.delegate(this,tt),Te=t.delegate(this,p),it=t.delegate(this,m),w=this.navImages,T=[],S=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(S=!1),this.showZoomControl&&(T.push(this.zoomInButton=new t.Button({element:this.zoomInButton?t.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomIn"),srcRest:Q(this.prefixUrl,w.zoomIn.REST),srcGroup:Q(this.prefixUrl,w.zoomIn.GROUP),srcHover:Q(this.prefixUrl,w.zoomIn.HOVER),srcDown:Q(this.prefixUrl,w.zoomIn.DOWN),onPress:y,onRelease:A,onClick:H,onEnter:y,onExit:A,onFocus:Te,onBlur:it})),T.push(this.zoomOutButton=new t.Button({element:this.zoomOutButton?t.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.ZoomOut"),srcRest:Q(this.prefixUrl,w.zoomOut.REST),srcGroup:Q(this.prefixUrl,w.zoomOut.GROUP),srcHover:Q(this.prefixUrl,w.zoomOut.HOVER),srcDown:Q(this.prefixUrl,w.zoomOut.DOWN),onPress:X,onRelease:A,onClick:z,onEnter:X,onExit:A,onFocus:Te,onBlur:it}))),this.showHomeControl&&T.push(this.homeButton=new t.Button({element:this.homeButton?t.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Home"),srcRest:Q(this.prefixUrl,w.home.REST),srcGroup:Q(this.prefixUrl,w.home.GROUP),srcHover:Q(this.prefixUrl,w.home.HOVER),srcDown:Q(this.prefixUrl,w.home.DOWN),onRelease:oe,onFocus:Te,onBlur:it})),this.showFullPageControl&&T.push(this.fullPageButton=new t.Button({element:this.fullPageButton?t.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.FullPage"),srcRest:Q(this.prefixUrl,w.fullpage.REST),srcGroup:Q(this.prefixUrl,w.fullpage.GROUP),srcHover:Q(this.prefixUrl,w.fullpage.HOVER),srcDown:Q(this.prefixUrl,w.fullpage.DOWN),onRelease:J,onFocus:Te,onBlur:it})),this.showRotationControl&&(T.push(this.rotateLeftButton=new t.Button({element:this.rotateLeftButton?t.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateLeft"),srcRest:Q(this.prefixUrl,w.rotateleft.REST),srcGroup:Q(this.prefixUrl,w.rotateleft.GROUP),srcHover:Q(this.prefixUrl,w.rotateleft.HOVER),srcDown:Q(this.prefixUrl,w.rotateleft.DOWN),onRelease:xe,onFocus:Te,onBlur:it})),T.push(this.rotateRightButton=new t.Button({element:this.rotateRightButton?t.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.RotateRight"),srcRest:Q(this.prefixUrl,w.rotateright.REST),srcGroup:Q(this.prefixUrl,w.rotateright.GROUP),srcHover:Q(this.prefixUrl,w.rotateright.HOVER),srcDown:Q(this.prefixUrl,w.rotateright.DOWN),onRelease:Me,onFocus:Te,onBlur:it}))),this.showFlipControl&&T.push(this.flipButton=new t.Button({element:this.flipButton?t.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:t.getString("Tooltips.Flip"),srcRest:Q(this.prefixUrl,w.flip.REST),srcGroup:Q(this.prefixUrl,w.flip.GROUP),srcHover:Q(this.prefixUrl,w.flip.HOVER),srcDown:Q(this.prefixUrl,w.flip.DOWN),onRelease:Ge,onFocus:Te,onBlur:it})),S?(this.buttonGroup=new t.ButtonGroup({buttons:T,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",t.delegate(this,Pe)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||t.ControlAnchor.TOP_LEFT})):this.customButtons=T),this},currentPage:function(){return this._sequenceIndex},goToPage:function(y){return this.tileSources&&y>=0&&y<this.tileSources.length&&(this._sequenceIndex=y,this._updateSequenceButtons(y),this.open(this.tileSources[y]),this.referenceStrip&&this.referenceStrip.setFocus(y),this.raiseEvent("page",{page:y})),this},addOverlay:function(y,A,H,X){var z;if(t.isPlainObject(y)?z=y:z={element:y,location:A,placement:H,onDraw:X},y=t.getElement(z.element),l(this.currentOverlays,y)>=0)return this;var oe=a(this,z);return this.currentOverlays.push(oe),oe.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:y,location:z.location,placement:z.placement}),this},updateOverlay:function(y,A,H){var X;return y=t.getElement(y),X=l(this.currentOverlays,y),X>=0&&(this.currentOverlays[X].update(A,H),i[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:y,location:A,placement:H})),this},removeOverlay:function(y){var A;return y=t.getElement(y),A=l(this.currentOverlays,y),A>=0&&(this.currentOverlays[A].destroy(),this.currentOverlays.splice(A,1),i[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:y})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return i[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(y){var A;return y=t.getElement(y),A=l(this.currentOverlays,y),A>=0?this.currentOverlays[A]:null},_updateSequenceButtons:function(y){this.nextButton&&(!this.tileSources||this.tileSources.length-1===y?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(y>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(y){this._hideMessage();var A=t.makeNeutralElement("div");A.appendChild(document.createTextNode(y)),this.messageDiv=t.makeCenteredNode(A),t.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var y=this.messageDiv;y&&(y.parentNode.removeChild(y),delete this.messageDiv)},gestureSettingsByDeviceType:function(y){switch(y){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var y,A=this.currentOverlays.length;for(y=0;y<A;y++)this.currentOverlays[y].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new t.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else t.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),t.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){t.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var y=t.pixelDensityRatio,A=t.getCurrentPixelDensityRatio();y!==A&&(t.pixelDensityRatio=A,this.forceResize())},goToPreviousPage:function(){var y=this._sequenceIndex-1;this.navPrevNextWrap&&y<0&&(y+=this.tileSources.length),this.goToPage(y)},goToNextPage:function(){var y=this._sequenceIndex+1;this.navPrevNextWrap&&y>=this.tileSources.length&&(y=0),this.goToPage(y)},isAnimating:function(){return i[this.hash].animating}});function n(y){return y=t.getElement(y),new t.Point(y.clientWidth===0?1:y.clientWidth,y.clientHeight===0?1:y.clientHeight)}function o(y,A,H,X,z){var oe=y;if(t.type(A)==="string"){if(A.match(/^\s*<.*>\s*$/))A=t.parseXml(A);else if(A.match(/^\s*[{[].*[}\]]\s*$/))try{var J=t.parseJSON(A);A=J}catch{}}function xe(Me,Ge){Me.ready?X(Me):(Me.addHandler("ready",function(){X(Me)}),Me.addHandler("open-failed",function(Te){z({message:Te.message,source:Ge})}))}setTimeout(function(){if(t.type(A)==="string")A=new t.TileSource({url:A,crossOriginPolicy:H.crossOriginPolicy!==void 0?H.crossOriginPolicy:y.crossOriginPolicy,ajaxWithCredentials:y.ajaxWithCredentials,ajaxHeaders:H.ajaxHeaders?H.ajaxHeaders:y.ajaxHeaders,splitHashDataForPost:y.splitHashDataForPost,success:function(it){X(it.tileSource)}}),A.addHandler("open-failed",function(it){z(it)});else if(t.isPlainObject(A)||A.nodeType)if(A.crossOriginPolicy===void 0&&(H.crossOriginPolicy!==void 0||y.crossOriginPolicy!==void 0)&&(A.crossOriginPolicy=H.crossOriginPolicy!==void 0?H.crossOriginPolicy:y.crossOriginPolicy),A.ajaxWithCredentials===void 0&&(A.ajaxWithCredentials=y.ajaxWithCredentials),t.isFunction(A.getTileUrl)){var Me=new t.TileSource(A);Me.getTileUrl=A.getTileUrl,X(Me)}else{var Ge=t.TileSource.determineType(oe,A);if(!Ge){z({message:"Unable to load TileSource",source:A});return}var Te=Ge.prototype.configure.apply(oe,[A]);xe(new Ge(Te),A)}else xe(A,A)})}function a(y,A){if(A instanceof t.Overlay)return A;var H=null;if(A.element)H=t.getElement(A.element);else{var X=A.id?A.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);H=t.getElement(A.id),H||(H=document.createElement("a"),H.href="#/overlay/"+X),H.id=X,t.addClass(H,A.className?A.className:"openseadragon-overlay")}var z=A.location,oe=A.width,J=A.height;if(!z){var xe=A.x,Me=A.y;if(A.px!==void 0){var Ge=y.viewport.imageToViewportRectangle(new t.Rect(A.px,A.py,oe||0,J||0));xe=Ge.x,Me=Ge.y,oe=oe!==void 0?Ge.width:void 0,J=J!==void 0?Ge.height:void 0}z=new t.Point(xe,Me)}var Te=A.placement;return Te&&t.type(Te)==="string"&&(Te=t.Placement[A.placement.toUpperCase()]),new t.Overlay({element:H,location:z,placement:Te,onDraw:A.onDraw,checkResize:A.checkResize,width:oe,height:J,rotationMode:A.rotationMode})}function l(y,A){var H;for(H=y.length-1;H>=0;H--)if(y[H].element===A)return H;return-1}function h(y,A){return t.requestAnimationFrame(function(){A(y)})}function u(y){t.requestAnimationFrame(function(){d(y)})}function c(y){y.autoHideControls&&(y.controlsShouldFade=!0,y.controlsFadeBeginTime=t.now()+y.controlsFadeDelay,window.setTimeout(function(){u(y)},y.controlsFadeDelay))}function d(y){var A,H,X,z;if(y.controlsShouldFade){for(A=t.now(),H=A-y.controlsFadeBeginTime,X=1-H/y.controlsFadeLength,X=Math.min(1,X),X=Math.max(0,X),z=y.controls.length-1;z>=0;z--)y.controls[z].autoFade&&y.controls[z].setOpacity(X);X>0&&u(y)}}function f(y){var A;for(y.controlsShouldFade=!1,A=y.controls.length-1;A>=0;A--)y.controls[A].setOpacity(1)}function p(){f(this)}function m(){c(this)}function g(y){var A={tracker:y.eventSource,position:y.position,originalEvent:y.originalEvent,preventDefault:y.preventDefault};this.raiseEvent("canvas-contextmenu",A),y.preventDefault=A.preventDefault}function v(y){var A={originalEvent:y.originalEvent,preventDefaultAction:!1,preventVerticalPan:y.preventVerticalPan||!this.panVertical,preventHorizontalPan:y.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",A),!A.preventDefaultAction&&!y.ctrl&&!y.alt&&!y.meta)switch(y.keyCode){case 38:A.preventVerticalPan||(y.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 40:A.preventVerticalPan||(y.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 37:A.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 39:A.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 187:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 189:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 87:A.preventVerticalPan||(y.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,-40))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 83:A.preventVerticalPan||(y.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(0,40))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 65:A.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(-40,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 68:A.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new t.Point(40,0))),this.viewport.applyConstraints()),y.preventDefault=!0;break;case 82:y.shift?this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.flipped?this.viewport.setRotation(this.viewport.getRotation()-this.rotationIncrement):this.viewport.setRotation(this.viewport.getRotation()+this.rotationIncrement),this.viewport.applyConstraints(),y.preventDefault=!0;break;case 70:this.viewport.toggleFlip(),y.preventDefault=!0;break;case 74:this.goToPreviousPage();break;case 75:this.goToNextPage();break;default:y.preventDefault=!1;break}else y.preventDefault=!1}function x(y){var A={originalEvent:y.originalEvent};this.raiseEvent("canvas-key-press",A)}function _(y){var A,H=document.activeElement===this.canvas;H||this.canvas.focus(),this.viewport.flipped&&(y.position.x=this.viewport.getContainerSize().x-y.position.x);var X={tracker:y.eventSource,position:y.position,quick:y.quick,shift:y.shift,originalEvent:y.originalEvent,originalTarget:y.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",X),!X.preventDefaultAction&&this.viewport&&y.quick&&(A=this.gestureSettingsByDeviceType(y.pointerType),A.clickToZoom===!0&&(this.viewport.zoomBy(y.shift?1/this.zoomPerClick:this.zoomPerClick,A.zoomToRefPoint?this.viewport.pointFromPixel(y.position,!0):null),this.viewport.applyConstraints()),A.dblClickDragToZoom&&(i[this.hash].draggingToZoom===!0?(i[this.hash].lastClickTime=null,i[this.hash].draggingToZoom=!1):i[this.hash].lastClickTime=t.now()))}function E(y){var A,H={tracker:y.eventSource,position:y.position,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",H),!H.preventDefaultAction&&this.viewport&&(A=this.gestureSettingsByDeviceType(y.pointerType),A.dblClickToZoom&&(this.viewport.zoomBy(y.shift?1/this.zoomPerClick:this.zoomPerClick,A.zoomToRefPoint?this.viewport.pointFromPixel(y.position,!0):null),this.viewport.applyConstraints()))}function R(y){var A,H={tracker:y.eventSource,pointerType:y.pointerType,position:y.position,delta:y.delta,speed:y.speed,direction:y.direction,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",H),A=this.gestureSettingsByDeviceType(y.pointerType),!H.preventDefaultAction&&this.viewport){if(A.dblClickDragToZoom&&i[this.hash].draggingToZoom){var X=Math.pow(this.zoomPerDblClickDrag,y.delta.y/50);this.viewport.zoomBy(X)}else if(A.dragToPan&&!i[this.hash].draggingToZoom){if(this.panHorizontal||(y.delta.x=0),this.panVertical||(y.delta.y=0),this.viewport.flipped&&(y.delta.x=-y.delta.x),this.constrainDuringPan){var z=this.viewport.deltaPointsFromPixels(y.delta.negate());this.viewport.centerSpringX.target.value+=z.x,this.viewport.centerSpringY.target.value+=z.y;var oe=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=z.x,this.viewport.centerSpringY.target.value-=z.y,oe.xConstrained&&(y.delta.x=0),oe.yConstrained&&(y.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(y.delta.negate()),A.flickEnabled&&!this.constrainDuringPan)}}}function M(y){var A,H={tracker:y.eventSource,pointerType:y.pointerType,position:y.position,speed:y.speed,direction:y.direction,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",H),A=this.gestureSettingsByDeviceType(y.pointerType),!H.preventDefaultAction&&this.viewport){if(!i[this.hash].draggingToZoom&&A.dragToPan&&A.flickEnabled&&y.speed>=A.flickMinSpeed){var X=0;this.panHorizontal&&(X=A.flickMomentum*y.speed*Math.cos(y.direction));var z=0;this.panVertical&&(z=A.flickMomentum*y.speed*Math.sin(y.direction));var oe=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),J=this.viewport.pointFromPixel(new t.Point(oe.x-X,oe.y-z));this.viewport.panTo(J,!1)}this.viewport.applyConstraints()}A.dblClickDragToZoom&&i[this.hash].draggingToZoom===!0&&(i[this.hash].draggingToZoom=!1)}function O(y){this.raiseEvent("canvas-enter",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function N(y){this.raiseEvent("canvas-exit",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function B(y){var A;if(this.raiseEvent("canvas-press",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,insideElementPressed:y.insideElementPressed,insideElementReleased:y.insideElementReleased,originalEvent:y.originalEvent}),A=this.gestureSettingsByDeviceType(y.pointerType),A.dblClickDragToZoom){var H=i[this.hash].lastClickTime,X=t.now();if(H===null)return;X-H<this.dblClickTimeThreshold&&(i[this.hash].draggingToZoom=!0),i[this.hash].lastClickTime=null}}function G(y){this.raiseEvent("canvas-release",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,insideElementPressed:y.insideElementPressed,insideElementReleased:y.insideElementReleased,originalEvent:y.originalEvent})}function K(y){this.raiseEvent("canvas-nonprimary-press",{tracker:y.eventSource,position:y.position,pointerType:y.pointerType,button:y.button,buttons:y.buttons,originalEvent:y.originalEvent})}function D(y){this.raiseEvent("canvas-nonprimary-release",{tracker:y.eventSource,position:y.position,pointerType:y.pointerType,button:y.button,buttons:y.buttons,originalEvent:y.originalEvent})}function C(y){var A,H,X,z,oe={tracker:y.eventSource,pointerType:y.pointerType,gesturePoints:y.gesturePoints,lastCenter:y.lastCenter,center:y.center,lastDistance:y.lastDistance,distance:y.distance,shift:y.shift,originalEvent:y.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};if(this.raiseEvent("canvas-pinch",oe),this.viewport&&(A=this.gestureSettingsByDeviceType(y.pointerType),A.pinchToZoom&&(!oe.preventDefaultPanAction||!oe.preventDefaultZoomAction)&&(H=this.viewport.pointFromPixel(y.center,!0),A.zoomToRefPoint&&!oe.preventDefaultPanAction&&(X=this.viewport.pointFromPixel(y.lastCenter,!0),z=X.minus(H),this.panHorizontal||(z.x=0),this.panVertical||(z.y=0),this.viewport.panBy(z,!0)),oe.preventDefaultZoomAction||this.viewport.zoomBy(y.distance/y.lastDistance,H,!0),this.viewport.applyConstraints()),A.pinchRotate&&!oe.preventDefaultRotateAction)){var J=Math.atan2(y.gesturePoints[0].currentPos.y-y.gesturePoints[1].currentPos.y,y.gesturePoints[0].currentPos.x-y.gesturePoints[1].currentPos.x),xe=Math.atan2(y.gesturePoints[0].lastPos.y-y.gesturePoints[1].lastPos.y,y.gesturePoints[0].lastPos.x-y.gesturePoints[1].lastPos.x);H=this.viewport.pointFromPixel(y.center,!0),this.viewport.rotateTo(this.viewport.getRotation(!0)+(J-xe)*(180/Math.PI),H,!0)}}function I(y){this.raiseEvent("canvas-focus",{tracker:y.eventSource,originalEvent:y.originalEvent})}function L(y){this.raiseEvent("canvas-blur",{tracker:y.eventSource,originalEvent:y.originalEvent})}function W(y){var A,H,X,z,oe;z=t.now(),oe=z-this._lastScrollTime,oe>this.minScrollDeltaTime?(this._lastScrollTime=z,A={tracker:y.eventSource,position:y.position,scroll:y.scroll,shift:y.shift,originalEvent:y.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",A),!A.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(y.position.x=this.viewport.getContainerSize().x-y.position.x),H=this.gestureSettingsByDeviceType(y.pointerType),H.scrollToZoom&&(X=Math.pow(this.zoomPerScroll,y.scroll),this.viewport.zoomBy(X,H.zoomToRefPoint?this.viewport.pointFromPixel(y.position,!0):null),this.viewport.applyConstraints())),y.preventDefault=A.preventDefault):y.preventDefault=!0}function U(y){i[this.hash].mouseInside=!0,f(this),this.raiseEvent("container-enter",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function V(y){y.pointers<1&&(i[this.hash].mouseInside=!1,i[this.hash].animating||c(this)),this.raiseEvent("container-exit",{tracker:y.eventSource,pointerType:y.pointerType,position:y.position,buttons:y.buttons,pointers:y.pointers,insideElementPressed:y.insideElementPressed,buttonDownAny:y.buttonDownAny,originalEvent:y.originalEvent})}function ie(y){F(y),y.isOpen()?y._updateRequestId=h(y,ie):y._updateRequestId=!1}function k(y,A){var H=y.viewport,X=H.getZoom(),z=H.getCenter();H.resize(A,y.preserveImageSizeOnResize),H.panTo(z,!0);var oe;if(y.preserveImageSizeOnResize)oe=i[y.hash].prevContainerSize.x/A.x;else{var J=new t.Point(0,0),xe=new t.Point(i[y.hash].prevContainerSize.x,i[y.hash].prevContainerSize.y).distanceTo(J),Me=new t.Point(A.x,A.y).distanceTo(J);oe=Me/xe*i[y.hash].prevContainerSize.x/A.x}H.zoomTo(X*oe,null,!0),i[y.hash].prevContainerSize=A,i[y.hash].forceRedraw=!0,i[y.hash].needsResize=!1,i[y.hash].forceResize=!1}function F(y){if(!(y._opening||!i[y.hash])){if(y.autoResize||i[y.hash].forceResize){var A;if(y._autoResizePolling){A=n(y.container);var H=i[y.hash].prevContainerSize;A.equals(H)||(i[y.hash].needsResize=!0)}i[y.hash].needsResize&&k(y,A||n(y.container))}var X=y.viewport.update(),z=y.world.update(X)||X;X&&y.raiseEvent("viewport-change"),y.referenceStrip&&(z=y.referenceStrip.update(y.viewport)||z);var oe=i[y.hash].animating;!oe&&z&&(y.raiseEvent("animation-start"),f(y));var J=oe&&!z;J&&(i[y.hash].animating=!1),(z||J||i[y.hash].forceRedraw||y.world.needsDraw())&&(Z(y),y._drawOverlays(),y.navigator&&y.navigator.update(y.viewport),i[y.hash].forceRedraw=!1,z&&y.raiseEvent("animation")),J&&(y.raiseEvent("animation-finish"),i[y.hash].mouseInside||c(y)),i[y.hash].animating=z}}function Z(y){y.imageLoader.clear(),y.world.draw(),y.raiseEvent("update-viewport",{})}function Q(y,A){return y?y+A:A}function ae(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=this.zoomPerSecond,i[this.hash].zooming=!0,De(this)}function de(){i[this.hash].lastZoomTime=t.now(),i[this.hash].zoomFactor=1/this.zoomPerSecond,i[this.hash].zooming=!0,De(this)}function be(){i[this.hash].zooming=!1}function De(y){t.requestAnimationFrame(t.delegate(y,Be))}function Be(){var y,A,H;i[this.hash].zooming&&this.viewport&&(y=t.now(),A=y-i[this.hash].lastZoomTime,H=Math.pow(i[this.hash].zoomFactor,A/1e3),this.viewport.zoomBy(H),this.viewport.applyConstraints(),i[this.hash].lastZoomTime=y,De(this))}function Ye(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Ce(){this.viewport&&(i[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function Pe(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function Oe(){this.viewport&&this.viewport.goHome()}function He(){this.isFullPage()&&!t.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function qe(){if(this.viewport){var y=this.viewport.getRotation();this.viewport.flipped?y+=this.rotationIncrement:y-=this.rotationIncrement,this.viewport.setRotation(y)}}function ot(){if(this.viewport){var y=this.viewport.getRotation();this.viewport.flipped?y-=this.rotationIncrement:y+=this.rotationIncrement,this.viewport.setRotation(y)}}function tt(){this.viewport.toggleFlip()}t.determineDrawer=function(y){for(let A in e){const H=e[A],X=H.prototype;if(X&&X instanceof e.DrawerBase&&t.isFunction(X.getType)&&X.getType.call(H)===y)return H}return null}}(e),function(t){t.Navigator=function(h){var u=h.viewer,c=this,d,f;h.element||h.id?(h.element?(h.id&&t.console.warn("Given option.id for Navigator was ignored since option.element was provided and is being used instead."),h.element.id?h.id=h.element.id:h.id="navigator-"+t.now(),this.element=h.element):this.element=document.getElementById(h.id),h.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(h.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),h.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:h.autoFade},h.position&&(h.position==="BOTTOM_RIGHT"?h.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:h.position==="BOTTOM_LEFT"?h.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:h.position==="TOP_RIGHT"?h.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:h.position==="TOP_LEFT"?h.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:h.position==="ABSOLUTE"&&(h.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,h.controlOptions.top=h.top,h.controlOptions.left=h.left,h.controlOptions.height=h.height,h.controlOptions.width=h.width))),this.element.id=h.id,this.element.className+=" navigator",h=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},h,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:h.animationTime,autoResize:!1,minZoomImageRatio:1,background:h.background,opacity:h.opacity,borderColor:h.borderColor,displayRegionColor:h.displayRegionColor}),h.minPixelRatio=this.minPixelRatio=u.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),h.controlOptions.anchor!==t.ControlAnchor.NONE&&function(g,v){g.margin="0px",g.border=v+"px solid "+h.borderColor,g.padding="0px",g.background=h.background,g.opacity=h.opacity,g.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(g,v){g.position="relative",g.top="0px",g.left="0px",g.fontSize="0px",g.overflow="hidden",g.border=v+"px solid "+h.displayRegionColor,g.margin="0px",g.padding="0px",g.background="transparent",g.float="left",g.cssFloat="left",g.zIndex=999999999,g.cursor="default",g.boxSizing="content-box"}(this.displayRegion.style,this.borderWidth),t.setElementPointerEventsNone(this.displayRegion),t.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",t.setElementPointerEventsNone(this.displayRegionContainer),t.setElementTouchActionNone(this.displayRegionContainer),u.addControl(this.element,h.controlOptions),this._resizeWithViewer=h.controlOptions.anchor!==t.ControlAnchor.ABSOLUTE&&h.controlOptions.anchor!==t.ControlAnchor.NONE,h.width&&h.height?(this.setWidth(h.width),this.setHeight(h.height)):this._resizeWithViewer&&(d=t.getElementSize(u.element),this.element.style.height=Math.round(d.y*h.sizeRatio)+"px",this.element.style.width=Math.round(d.x*h.sizeRatio)+"px",this.oldViewerSize=d,f=t.getElementSize(this.element),this.elementArea=f.x*f.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[h]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function p(g,v){a(c.displayRegionContainer,g),a(c.displayRegion,-g),c.viewport.setRotation(g,v)}if(h.navigatorRotate){var m=h.viewer.viewport?h.viewer.viewport.getRotation():h.viewer.degrees||0;p(m,!0),h.viewer.addHandler("rotate",function(g){p(g.degrees,g.immediately)})}this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:t.delegate(this,r),clickHandler:t.delegate(this,i),releaseHandler:t.delegate(this,n),scrollHandler:t.delegate(this,o),preProcessEventHandler:function(g){g.eventType==="wheel"&&(g.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",t.setElementPointerEventsNone(this.canvas),t.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){c.viewport&&c.viewport.goHome(!0)}),u.world.addHandler("item-index-change",function(g){window.setTimeout(function(){var v=c.world.getItemAt(g.previousIndex);c.world.setItemIndex(v,g.newIndex)},1)}),u.world.addHandler("remove-item",function(g){var v=g.item,x=c._getMatchingItem(v);x&&c.world.removeItem(x)}),this.update(u.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var h=new t.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);h.equals(this.oldContainerSize)||(this.viewport.resize(h,!0),this.viewport.goHome(!0),this.oldContainerSize=h,this.world.update(),this.world.draw(),this.update(this.viewer.viewport))}},setWidth:function(h){this.width=h,this.element.style.width=typeof h=="number"?h+"px":h,this._resizeWithViewer=!1,this.updateSize()},setHeight:function(h){this.height=h,this.element.style.height=typeof h=="number"?h+"px":h,this._resizeWithViewer=!1,this.updateSize()},setFlip:function(h){return this.viewport.setFlip(h),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(h){l(this.canvas,h),l(this.element,h)},update:function(h){var u,c,d,f,p,m;if(h||(h=this.viewer.viewport),u=t.getElementSize(this.viewer.element),this._resizeWithViewer&&u.x&&u.y&&!u.equals(this.oldViewerSize)&&(this.oldViewerSize=u,this.maintainSizeRatio||!this.elementArea?(c=u.x*this.sizeRatio,d=u.y*this.sizeRatio):(c=Math.sqrt(this.elementArea*(u.x/u.y)),d=this.elementArea/c),this.element.style.width=Math.round(c)+"px",this.element.style.height=Math.round(d)+"px",this.elementArea||(this.elementArea=c*d),this.updateSize()),h&&this.viewport){if(f=h.getBoundsNoRotate(!0),p=this.viewport.pixelFromPointNoRotate(f.getTopLeft(),!1),m=this.viewport.pixelFromPointNoRotate(f.getBottomRight(),!1).minus(this.totalBorderWidths),!this.navigatorRotate){var g=h.getRotation(!0);a(this.displayRegion,-g)}var v=this.displayRegion.style;v.display=this.world.getItemCount()?"block":"none",v.top=p.y.toFixed(2)+"px",v.left=p.x.toFixed(2)+"px";var x=m.x-p.x,_=m.y-p.y;v.width=Math.round(Math.max(x,0))+"px",v.height=Math.round(Math.max(_,0))+"px"}},addTiledImage:function(h){var u=this,c=h.originalTiledImage;delete h.original;var d=t.extend({},h,{success:function(f){var p=f.item;p._originalForNavigator=c,u._matchBounds(p,c,!0),u._matchOpacity(p,c),u._matchCompositeOperation(p,c);function m(){u._matchBounds(p,c)}function g(){u._matchOpacity(p,c)}function v(){u._matchCompositeOperation(p,c)}c.addHandler("bounds-change",m),c.addHandler("clip-change",m),c.addHandler("opacity-change",g),c.addHandler("composite-operation-change",v)}});return t.Viewer.prototype.addTiledImage.apply(this,[d])},destroy:function(){return t.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(h){for(var u=this.world.getItemCount(),c,d=0;d<u;d++)if(c=this.world.getItemAt(d),c._originalForNavigator===h)return c;return null},_matchBounds:function(h,u,c){var d=u.getBoundsNoRotate();h.setPosition(d.getTopLeft(),c),h.setWidth(d.width,c),h.setRotation(u.getRotation(),c),h.setClip(u.getClip()),h.setFlip(u.getFlip())},_matchOpacity:function(h,u){h.setOpacity(u.opacity)},_matchCompositeOperation:function(h,u){h.setCompositeOperation(u.compositeOperation)}});function i(h){var u={tracker:h.eventSource,position:h.position,quick:h.quick,shift:h.shift,originalEvent:h.originalEvent,preventDefaultAction:!1};if(this.viewer.raiseEvent("navigator-click",u),!u.preventDefaultAction&&h.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(h.position.x=this.viewport.getContainerSize().x-h.position.x);var c=this.viewport.pointFromPixel(h.position);this.panVertical?this.panHorizontal||(c.x=this.viewer.viewport.getCenter(!0).x):c.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(c),this.viewer.viewport.applyConstraints()}}function r(h){var u={tracker:h.eventSource,position:h.position,delta:h.delta,speed:h.speed,direction:h.direction,shift:h.shift,originalEvent:h.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",u),!u.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(h.delta.x=0),this.panVertical||(h.delta.y=0),this.viewer.viewport.flipped&&(h.delta.x=-h.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(h.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(h){h.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function o(h){var u={tracker:h.eventSource,position:h.position,scroll:h.scroll,shift:h.shift,originalEvent:h.originalEvent,preventDefault:h.preventDefault};this.viewer.raiseEvent("navigator-scroll",u),h.preventDefault=u.preventDefault}function a(h,u){l(h,"rotate("+u+"deg)")}function l(h,u){h.style.webkitTransform=u,h.style.mozTransform=u,h.style.msTransform=u,h.style.oTransform=u,h.style.transform=u}}(e),function(t){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};t.extend(t,{getString:function(r){var n=r.split("."),o=null,a=arguments,l=i,h;for(h=0;h<n.length-1;h++)l=l[n[h]]||{};return o=l[n[h]],typeof o!="string"&&(t.console.error("Untranslated source string:",r),o=""),o.replace(/\{\d+\}/g,function(u){var c=parseInt(u.match(/\d+/),10)+1;return c<a.length?a[c]:""})},setString:function(r,n){var o=r.split("."),a=i,l;for(l=0;l<o.length-1;l++)a[o[l]]||(a[o[l]]={}),a=a[o[l]];a[o[l]]=n}})}(e),function(t){t.Point=function(i,r){this.x=typeof i=="number"?i:0,this.y=typeof r=="number"?r:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(i){return new t.Point(this.x+i.x,this.y+i.y)},minus:function(i){return new t.Point(this.x-i.x,this.y-i.y)},times:function(i){return new t.Point(this.x*i,this.y*i)},divide:function(i){return new t.Point(this.x/i,this.y/i)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(i){return Math.sqrt(Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2))},squaredDistanceTo:function(i){return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)},apply:function(i){return new t.Point(i(this.x),i(this.y))},equals:function(i){return i instanceof t.Point&&this.x===i.x&&this.y===i.y},rotate:function(i,r){r=r||new t.Point(0,0);var n,o;if(i%90===0){var a=t.positiveModulo(i,360);switch(a){case 0:n=1,o=0;break;case 90:n=0,o=1;break;case 180:n=-1,o=0;break;case 270:n=0,o=-1;break}}else{var l=i*Math.PI/180;n=Math.cos(l),o=Math.sin(l)}var h=n*(this.x-r.x)-o*(this.y-r.y)+r.x,u=o*(this.x-r.x)+n*(this.y-r.y)+r.y;return new t.Point(h,u)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(e),function(t){t.TileSource=function(r,n,o,a,l,h){var u=this,c=arguments,d,f;if(t.isPlainObject(r)?d=r:d={width:c[0],height:c[1],tileSize:c[2],tileOverlap:c[3],minLevel:c[4],maxLevel:c[5]},t.EventSource.call(this),t.extend(!0,this,d),!this.success){for(f=0;f<arguments.length;f++)if(t.isFunction(arguments[f])){this.success=arguments[f];break}}this.success&&this.addHandler("ready",function(p){u.success(p)}),t.type(arguments[0])==="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=d.width&&d.height?d.width/d.height:1,this.dimensions=new t.Point(d.width,d.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=d.tileOverlap?d.tileOverlap:0,this.minLevel=d.minLevel?d.minLevel:0,this.maxLevel=d.maxLevel!==void 0&&d.maxLevel!==null?d.maxLevel:d.width&&d.height?Math.ceil(Math.log(Math.max(d.width,d.height))/Math.log(2)):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(r){return t.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(r){return this._tileWidth?this._tileWidth:this.getTileSize(r)},getTileHeight:function(r){return this._tileHeight?this._tileHeight:this.getTileSize(r)},setMaxLevel:function(r){this.maxLevel=r,this._memoizeLevelScale()},getLevelScale:function(r){return this._memoizeLevelScale(),this.getLevelScale(r)},_memoizeLevelScale:function(){var r={},n;for(n=0;n<=this.maxLevel;n++)r[n]=1/Math.pow(2,this.maxLevel-n);this.getLevelScale=function(o){return r[o]}},getNumTiles:function(r){var n=this.getLevelScale(r),o=Math.ceil(n*this.dimensions.x/this.getTileWidth(r)),a=Math.ceil(n*this.dimensions.y/this.getTileHeight(r));return new t.Point(o,a)},getPixelRatio:function(r){var n=this.dimensions.times(this.getLevelScale(r)),o=1/n.x*t.pixelDensityRatio,a=1/n.y*t.pixelDensityRatio;return new t.Point(o,a)},getClosestLevel:function(){var r,n;for(r=this.minLevel+1;r<=this.maxLevel&&(n=this.getNumTiles(r),!(n.x>1||n.y>1));r++);return r-1},getTileAtPoint:function(r,n){var o=n.x>=0&&n.x<=1&&n.y>=0&&n.y<=1/this.aspectRatio;t.console.assert(o,"[TileSource.getTileAtPoint] must be called with a valid point.");var a=this.dimensions.x*this.getLevelScale(r),l=n.x*a,h=n.y*a,u=Math.floor(l/this.getTileWidth(r)),c=Math.floor(h/this.getTileHeight(r));n.x>=1&&(u=this.getNumTiles(r).x-1);var d=1e-15;return n.y>=1/this.aspectRatio-d&&(c=this.getNumTiles(r).y-1),new t.Point(u,c)},getTileBounds:function(r,n,o,a){var l=this.dimensions.times(this.getLevelScale(r)),h=this.getTileWidth(r),u=this.getTileHeight(r),c=n===0?0:h*n-this.tileOverlap,d=o===0?0:u*o-this.tileOverlap,f=h+(n===0?1:2)*this.tileOverlap,p=u+(o===0?1:2)*this.tileOverlap,m=1/l.x;return f=Math.min(f,l.x-c),p=Math.min(p,l.y-d),a?new t.Rect(0,0,f,p):new t.Rect(c*m,d*m,f*m,p*m)},getImageInfo:function(r){var n=this,o,a,l,h,u,c,d;r&&(u=r.split("/"),c=u[u.length-1],d=c.lastIndexOf("."),d>-1&&(u[u.length-1]=c.slice(0,d)));var f=null;if(this.splitHashDataForPost){var p=r.indexOf("#");p!==-1&&(f=r.substring(p+1),r=r.substr(0,p))}a=function(m){typeof m=="string"&&(m=t.parseXml(m));var g=t.TileSource.determineType(n,m,r);if(!g){n.raiseEvent("open-failed",{message:"Unable to load TileSource",source:r});return}h=g.prototype.configure.apply(n,[m,r,f]),h.ajaxWithCredentials===void 0&&(h.ajaxWithCredentials=n.ajaxWithCredentials),l=new g(h),n.ready=!0,n.raiseEvent("ready",{tileSource:l})},r.match(/\.js$/)?(o=r.split("/").pop().replace(".js",""),t.jsonp({url:r,async:!1,callbackName:o,callback:a})):t.makeAjaxRequest({url:r,postData:f,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(m){var g=i(m);a(g)},error:function(m,g){var v;try{v="HTTP "+m.status+" attempting to load TileSource: "+r}catch{var x;typeof g>"u"||!g.toString?x="Unknown error":x=g.toString(),v=x+" attempting to load TileSource: "+r}t.console.error(v),n.raiseEvent("open-failed",{message:v,source:r,postData:f})}})},supports:function(r,n){return!1},configure:function(r,n,o){throw new Error("Method not implemented.")},getTileUrl:function(r,n,o){throw new Error("Method not implemented.")},getTilePostData:function(r,n,o){return null},getTileAjaxHeaders:function(r,n,o){return{}},getTileHashKey:function(r,n,o,a,l,h){function u(c){return l?c+"+"+JSON.stringify(l):c}return u(typeof a!="string"?r+"/"+n+"_"+o:a)},tileExists:function(r,n,o){var a=this.getNumTiles(r);return r>=this.minLevel&&r<=this.maxLevel&&n>=0&&o>=0&&n<a.x&&o<a.y},hasTransparency:function(r,n,o,a){return!!r||n.match(".png")},downloadTileStart:function(r){var n=r.userData,o=new Image;n.image=o,n.request=null;var a=function(l){if(!o){r.finish(null,n.request,"Image load failed: undefined Image instance.");return}o.onload=o.onerror=o.onabort=null,r.finish(l?null:o,n.request,l)};o.onload=function(){a()},o.onabort=o.onerror=function(){a("Image load aborted.")},r.loadWithAjax?n.request=t.makeAjaxRequest({url:r.src,withCredentials:r.ajaxWithCredentials,headers:r.ajaxHeaders,responseType:"arraybuffer",postData:r.postData,success:function(l){var h;try{h=new window.Blob([l.response])}catch(d){var u=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(d.name==="TypeError"&&u){var c=new u;c.append(l.response),h=c.getBlob()}}h.size===0?a("Empty image response."):o.src=(window.URL||window.webkitURL).createObjectURL(h)},error:function(l){a("Image load aborted - XHR error")}}):(r.crossOriginPolicy!==!1&&(o.crossOrigin=r.crossOriginPolicy),o.src=r.src)},downloadTileAbort:function(r){r.userData.request&&r.userData.request.abort();var n=r.userData.image;r.userData.image&&(n.onload=n.onerror=n.onabort=null)},createTileCache:function(r,n,o){r._data=n},destroyTileCache:function(r){r._data=null,r._renderedContext=null},getTileCacheData:function(r){return r._data},getTileCacheDataAsImage:function(r){return r._data},getTileCacheDataAsContext2D:function(r){if(!r._renderedContext){var n=document.createElement("canvas");n.width=r._data.width,n.height=r._data.height,r._renderedContext=n.getContext("2d"),r._renderedContext.drawImage(r._data,0,0),r._data=null}return r._renderedContext}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype);function i(r){var n=r.responseText,o=r.status,a,l;if(r){if(r.status!==200&&r.status!==0)throw o=r.status,a=o===404?"Not Found":r.statusText,new Error(t.getString("Errors.Status",o,a))}else throw new Error(t.getString("Errors.Security"));if(n.match(/^\s*<.*/))try{l=r.responseXML&&r.responseXML.documentElement?r.responseXML:t.parseXml(n)}catch{l=r.responseText}else if(n.match(/\s*[{[].*/))try{l=t.parseJSON(n)}catch{l=n}else l=n;return l}t.TileSource.determineType=function(r,n,o){var a;for(a in e)if(a.match(/.+TileSource$/)&&t.isFunction(e[a])&&t.isFunction(e[a].prototype.supports)&&e[a].prototype.supports.call(r,n,o))return e[a];return t.console.error("No TileSource was able to open %s %s",o,n),null}}(e),function(t){t.DziTileSource=function(n,o,a,l,h,u,c,d,f){var p,m,g,v;if(t.isPlainObject(n)?v=n:v={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=v.tilesUrl,this.fileFormat=v.fileFormat,this.displayRects=v.displayRects,this.displayRects)for(p=this.displayRects.length-1;p>=0;p--)for(m=this.displayRects[p],g=m.minLevel;g<=m.maxLevel;g++)this._levelRects[g]||(this._levelRects[g]=[]),this._levelRects[g].push(m);t.TileSource.apply(this,[v])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(n,o){var a;return n.Image?a=n.Image.xmlns:n.documentElement&&(n.documentElement.localName==="Image"||n.documentElement.tagName==="Image")&&(a=n.documentElement.namespaceURI),a=(a||"").toLowerCase(),a.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||a.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(n,o,a){var l;return t.isPlainObject(n)?l=r(this,n):l=i(this,n),o&&!l.tilesUrl&&(l.tilesUrl=o.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),o.search(/\.(dzi|xml|js)\?/)!==-1?l.queryParams=o.match(/\?.*/):l.queryParams=""),l},getTileUrl:function(n,o,a){return[this.tilesUrl,n,"/",o,"_",a,".",this.fileFormat,this.queryParams].join("")},tileExists:function(n,o,a){var l=this._levelRects[n],h,u,c,d,f,p,m;if(this.minLevel&&n<this.minLevel||this.maxLevel&&n>this.maxLevel)return!1;if(!l||!l.length)return!0;for(m=l.length-1;m>=0;m--)if(h=l[m],!(n<h.minLevel||n>h.maxLevel)&&(u=this.getLevelScale(n),c=h.x*u,d=h.y*u,f=c+h.width*u,p=d+h.height*u,c=Math.floor(c/this._tileWidth),d=Math.floor(d/this._tileWidth),f=Math.ceil(f/this._tileWidth),p=Math.ceil(p/this._tileWidth),c<=o&&o<f&&d<=a&&a<p))return!0;return!1}});function i(n,o){if(!o||!o.documentElement)throw new Error(t.getString("Errors.Xml"));var a=o.documentElement,l=a.localName||a.tagName,h=o.documentElement.namespaceURI,u=null,c=[],d,f,p,m,g;if(l==="Image")try{if(m=a.getElementsByTagName("Size")[0],m===void 0&&(m=a.getElementsByTagNameNS(h,"Size")[0]),u={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:a.getAttribute("Url"),Format:a.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(a.getAttribute("Overlap"),10),TileSize:parseInt(a.getAttribute("TileSize"),10),Size:{Height:parseInt(m.getAttribute("Height"),10),Width:parseInt(m.getAttribute("Width"),10)}}},!t.imageFormatSupported(u.Image.Format))throw new Error(t.getString("Errors.ImageFormat",u.Image.Format.toUpperCase()));for(d=a.getElementsByTagName("DisplayRect"),d===void 0&&(d=a.getElementsByTagNameNS(h,"DisplayRect")[0]),g=0;g<d.length;g++)f=d[g],p=f.getElementsByTagName("Rect")[0],p===void 0&&(p=f.getElementsByTagNameNS(h,"Rect")[0]),c.push({Rect:{X:parseInt(p.getAttribute("X"),10),Y:parseInt(p.getAttribute("Y"),10),Width:parseInt(p.getAttribute("Width"),10),Height:parseInt(p.getAttribute("Height"),10),MinLevel:parseInt(f.getAttribute("MinLevel"),10),MaxLevel:parseInt(f.getAttribute("MaxLevel"),10)}});return c.length&&(u.Image.DisplayRect=c),r(n,u)}catch(_){throw _ instanceof Error?_:new Error(t.getString("Errors.Dzi"))}else{if(l==="Collection")throw new Error(t.getString("Errors.Dzc"));if(l==="Error"){var v=a.getElementsByTagName("Message")[0],x=v.firstChild.nodeValue;throw new Error(x)}}throw new Error(t.getString("Errors.Dzi"))}function r(n,o){var a=o.Image,l=a.Url,h=a.Format,u=a.Size,c=a.DisplayRect||[],d=parseInt(u.Width,10),f=parseInt(u.Height,10),p=parseInt(a.TileSize,10),m=parseInt(a.Overlap,10),g=[],v,x;for(x=0;x<c.length;x++)v=c[x].Rect,g.push(new t.DisplayRect(parseInt(v.X,10),parseInt(v.Y,10),parseInt(v.Width,10),parseInt(v.Height,10),parseInt(v.MinLevel,10),parseInt(v.MaxLevel,10)));return t.extend(!0,{width:d,height:f,tileSize:p,tileOverlap:m,minLevel:null,maxLevel:null,tilesUrl:l,fileFormat:h,displayRects:g},o)}}(e),function(t){t.IIIFTileSource=function(a){if(t.extend(!0,this,a),this._id=this["@id"]||this.id||this.identifier||null,!(this.height&&this.width&&this._id))throw new Error("IIIF required parameters (width, height, or id) not provided.");if(a.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=a.version,this.tile_width&&this.tile_height)a.tileWidth=this.tile_width,a.tileHeight=this.tile_height;else if(this.tile_width)a.tileSize=this.tile_width;else if(this.tile_height)a.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length===1)a.tileWidth=this.tiles[0].width,a.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var l=0;l<this.tiles.length;l++)for(var h=0;h<this.tiles[l].scaleFactors.length;h++){var u=this.tiles[l].scaleFactors[h];this.scale_factors.push(u),a.tileSizePerScaleFactor[u]={width:this.tiles[l].width,height:this.tiles[l].height||this.tiles[l].width}}}else if(i(a)){for(var c=Math.min(this.height,this.width),d=[256,512,1024],f=[],p=0;p<d.length;p++)d[p]<=c&&f.push(d[p]);f.length>0?a.tileSize=Math.max.apply(null,f):a.tileSize=c}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,a.levels=r(this),t.extend(!0,a,{width:a.levels[a.levels.length-1].width,height:a.levels[a.levels.length-1].height,tileSize:Math.max(a.height,a.width),tileOverlap:0,minLevel:0,maxLevel:a.levels.length-1}),this.levels=a.levels):t.console.error("Nothing in the info.json to construct image pyramids from");if(!a.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)a.maxLevel=Number(Math.round(Math.log(Math.max(this.width,this.height),2)));else{var m=Math.max.apply(null,this.scale_factors);a.maxLevel=Math.round(Math.log(m)*Math.LOG2E)}if(this.sizes){var g=this.sizes.length;(g===a.maxLevel||g===a.maxLevel+1)&&(this.levelSizes=this.sizes.slice().sort((v,x)=>v.width-x.width),g===a.maxLevel&&this.levelSizes.push({width:this.width,height:this.height}))}t.TileSource.apply(this,[a])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(a,l){return a.protocol&&a.protocol==="http://iiif.io/api/image"||a["@context"]&&(a["@context"]==="http://library.stanford.edu/iiif/image-api/1.1/context.json"||a["@context"]==="http://iiif.io/api/image/1/context.json")||a.profile&&a.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||a.identifier&&a.width&&a.height?!0:!!(a.documentElement&&a.documentElement.tagName==="info"&&a.documentElement.namespaceURI==="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(a,l,h){if(t.isPlainObject(a)){if(!a["@context"])a["@context"]="http://iiif.io/api/image/1.0/context.json",a["@id"]=l.replace("/info.json",""),a.version=1;else{var c=a["@context"];if(Array.isArray(c)){for(var d=0;d<c.length;d++)if(typeof c[d]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(c[d])||c[d]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){c=c[d];break}}switch(c){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":a.version=1;break;case"http://iiif.io/api/image/2/context.json":a.version=2;break;case"http://iiif.io/api/image/3/context.json":a.version=3;break;default:t.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(a.preferredFormats){for(var f=0;f<a.preferredFormats.length;f++)if(e.imageFormatSupported(a.preferredFormats[f])){a.tileFormat=a.preferredFormats[f];break}}return a}else{var u=n(a);return u["@context"]="http://iiif.io/api/image/1.0/context.json",u["@id"]=l.replace("/info.xml",""),u.version=1,u}},getTileWidth:function(a){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,a);var l=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[l]?this.tileSizePerScaleFactor[l].width:this._tileWidth},getTileHeight:function(a){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,a);var l=Math.pow(2,this.maxLevel-a);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[l]?this.tileSizePerScaleFactor[l].height:this._tileHeight},getLevelScale:function(a){if(this.emulateLegacyImagePyramid){var l=NaN;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(l=this.levels[a].width/this.levels[this.maxLevel].width),l}return t.TileSource.prototype.getLevelScale.call(this,a)},getNumTiles:function(a){if(this.emulateLegacyImagePyramid){var l=this.getLevelScale(a);return l?new t.Point(1,1):new t.Point(0,0)}if(this.levelSizes){var h=this.levelSizes[a],u=Math.ceil(h.width/this.getTileWidth(a)),c=Math.ceil(h.height/this.getTileHeight(a));return new t.Point(u,c)}else return t.TileSource.prototype.getNumTiles.call(this,a)},getTileAtPoint:function(a,l){if(this.emulateLegacyImagePyramid)return new t.Point(0,0);if(this.levelSizes){var h=l.x>=0&&l.x<=1&&l.y>=0&&l.y<=1/this.aspectRatio;t.console.assert(h,"[TileSource.getTileAtPoint] must be called with a valid point.");var u=this.levelSizes[a].width,c=l.x*u,d=l.y*u,f=Math.floor(c/this.getTileWidth(a)),p=Math.floor(d/this.getTileHeight(a));l.x>=1&&(f=this.getNumTiles(a).x-1);var m=1e-15;return l.y>=1/this.aspectRatio-m&&(p=this.getNumTiles(a).y-1),new t.Point(f,p)}return t.TileSource.prototype.getTileAtPoint.call(this,a,l)},getTileUrl:function(a,l,h){if(this.emulateLegacyImagePyramid){var u=null;return this.levels.length>0&&a>=this.minLevel&&a<=this.maxLevel&&(u=this.levels[a].url),u}var c="0",d=Math.pow(.5,this.maxLevel-a),f,p,m,g,v,x,_,E,R,M,O,N,B,G,K,D;return this.levelSizes?(f=this.levelSizes[a].width,p=this.levelSizes[a].height):(f=Math.ceil(this.width*d),p=Math.ceil(this.height*d)),m=this.getTileWidth(a),g=this.getTileHeight(a),v=Math.round(m/d),x=Math.round(g/d),this.version===1?K="native."+this.tileFormat:K="default."+this.tileFormat,f<m&&p<g?(this.version===2&&f===this.width?N="full":this.version===3&&f===this.width&&p===this.height?N="max":this.version===3?N=f+","+p:N=f+",",_="full"):(E=l*v,R=h*x,M=Math.min(v,this.width-E),O=Math.min(x,this.height-R),l===0&&h===0&&M===this.width&&O===this.height?_="full":_=[E,R,M,O].join(","),B=Math.min(m,f-l*m),G=Math.min(g,p-h*g),this.version===2&&B===this.width?N="full":this.version===3&&B===this.width&&G===this.height?N="max":this.version===3?N=B+","+G:N=B+","),D=[this._id,_,N,c,K].join("/"),D},__testonly__:{canBeTiled:i,constructLevels:r}});function i(a){var l=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],h=Array.isArray(a.profile)?a.profile[0]:a.profile,u=l.indexOf(h)!==-1,c=!1;return a.version===2&&a.profile.length>1&&a.profile[1].supports&&(c=a.profile[1].supports.indexOf("sizeByW")!==-1),a.version===3&&a.extraFeatures&&(c=a.extraFeatures.indexOf("sizeByWh")!==-1),!u||c}function r(a){for(var l=[],h=0;h<a.sizes.length;h++)l.push({url:a._id+"/full/"+a.sizes[h].width+","+(a.version===3?a.sizes[h].height:"")+"/0/default."+a.tileFormat,width:a.sizes[h].width,height:a.sizes[h].height});return l.sort(function(u,c){return u.width-c.width})}function n(a){if(!a||!a.documentElement)throw new Error(t.getString("Errors.Xml"));var l=a.documentElement,h=l.tagName,u=null;if(h==="info")try{return u={},o(l,u),u}catch(c){throw c instanceof Error?c:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}function o(a,l,h){var u,c;if(a.nodeType===3&&h)c=a.nodeValue.trim(),c.match(/^\d*$/)&&(c=Number(c)),l[h]?(t.isArray(l[h])||(l[h]=[l[h]]),l[h].push(c)):l[h]=c;else if(a.nodeType===1)for(u=0;u<a.childNodes.length;u++)o(a.childNodes[u],l,a.nodeName)}}(e),function(t){t.OsmTileSource=function(i,r,n,o,a){var l;t.isPlainObject(i)?l=i:l={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!l.width||!l.height)&&(l.width=65572864,l.height=65572864),l.tileSize||(l.tileSize=256,l.tileOverlap=0),l.tilesUrl||(l.tilesUrl="http://tile.openstreetmap.org/"),l.minLevel=8,t.TileSource.apply(this,[l])},t.extend(t.OsmTileSource.prototype,t.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="openstreetmaps"},configure:function(i,r,n){return i},getTileUrl:function(i,r,n){return this.tilesUrl+(i-8)+"/"+r+"/"+n+".png"}})}(e),function(t){t.TmsTileSource=function(i,r,n,o,a){var l;t.isPlainObject(i)?l=i:l={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var h=Math.ceil(l.width/256)*256,u=Math.ceil(l.height/256)*256,c;h>u?c=h/256:c=u/256,l.maxLevel=Math.ceil(Math.log(c)/Math.log(2))-1,l.tileSize=256,l.width=h,l.height=u,t.TileSource.apply(this,[l])},t.extend(t.TmsTileSource.prototype,t.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="tiledmapservice"},configure:function(i,r,n){return i},getTileUrl:function(i,r,n){var o=this.getNumTiles(i).y-1;return this.tilesUrl+i+"/"+r+"/"+(o-n)+".png"}})}(e),function(t){t.ZoomifyTileSource=function(i){typeof i.tileSize>"u"&&(i.tileSize=256),typeof i.fileFormat>"u"&&(i.fileFormat="jpg",this.fileFormat=i.fileFormat);var r={x:i.width,y:i.height};for(i.imageSizes=[{x:i.width,y:i.height}],i.gridSize=[this._getGridSize(i.width,i.height,i.tileSize)];parseInt(r.x,10)>i.tileSize||parseInt(r.y,10)>i.tileSize;)r.x=Math.floor(r.x/2),r.y=Math.floor(r.y/2),i.imageSizes.push({x:r.x,y:r.y}),i.gridSize.push(this._getGridSize(r.x,r.y,i.tileSize));i.imageSizes.reverse(),i.gridSize.reverse(),i.minLevel=0,i.maxLevel=i.gridSize.length-1,e.TileSource.apply(this,[i])},t.extend(t.ZoomifyTileSource.prototype,t.TileSource.prototype,{_getGridSize:function(i,r,n){return{x:Math.ceil(i/n),y:Math.ceil(r/n)}},_calculateAbsoluteTileNumber:function(i,r,n){for(var o=0,a={},l=0;l<i;l++)a=this.gridSize[l],o+=a.x*a.y;return a=this.gridSize[i],o+=a.x*n+r,o},supports:function(i,r){return i.type&&i.type==="zoomifytileservice"},configure:function(i,r,n){return i},getTileUrl:function(i,r,n){var o=0,a=this._calculateAbsoluteTileNumber(i,r,n);return o=Math.floor(a/256),this.tilesUrl+"TileGroup"+o+"/"+i+"-"+r+"-"+n+"."+this.fileFormat}})}(e),function(t){t.LegacyTileSource=function(o){var a,l,h;t.isArray(o)&&(a={type:"legacy-image-pyramid",levels:o}),a.levels=i(a.levels),a.levels.length>0?(l=a.levels[a.levels.length-1].width,h=a.levels[a.levels.length-1].height):(l=0,h=0,t.console.error("No supported image formats found")),t.extend(!0,a,{width:l,height:h,tileSize:Math.max(h,l),tileOverlap:0,minLevel:0,maxLevel:a.levels.length>0?a.levels.length-1:0}),t.TileSource.apply(this,[a]),this.levels=a.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(o,a){return o.type&&o.type==="legacy-image-pyramid"||o.documentElement&&o.documentElement.getAttribute("type")==="legacy-image-pyramid"},configure:function(o,a,l){var h;return t.isPlainObject(o)?h=n(this,o):h=r(this,o),h},getLevelScale:function(o){var a=NaN;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(a=this.levels[o].width/this.levels[this.maxLevel].width),a},getNumTiles:function(o){var a=this.getLevelScale(o);return a?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(o,a,l){var h=null;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(h=this.levels[o].url),h}});function i(o){var a=[],l,h;for(h=0;h<o.length;h++)l=o[h],l.height&&l.width&&l.url?a.push({url:l.url,width:Number(l.width),height:Number(l.height)}):t.console.error("Unsupported image format: %s",l.url?l.url:"<no URL>");return a.sort(function(u,c){return u.height-c.height})}function r(o,a){if(!a||!a.documentElement)throw new Error(t.getString("Errors.Xml"));var l=a.documentElement,h=l.tagName,u=null,c=[],d,f;if(h==="image")try{for(u={type:l.getAttribute("type"),levels:[]},c=l.getElementsByTagName("level"),f=0;f<c.length;f++)d=c[f],u.levels.push({url:d.getAttribute("url"),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10)});return n(o,u)}catch(p){throw p instanceof Error?p:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(h==="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(h==="error")throw new Error("Error: "+a)}throw new Error("Unknown element "+h)}function n(o,a){return a.levels}}(e),function(t){t.ImageTileSource=function(i){i=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1},i),t.TileSource.apply(this,[i])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(i,r){return i.type&&i.type==="image"},configure:function(i,r,n){return i},getImageInfo:function(i){var r=this._image=new Image,n=this;this.crossOriginPolicy&&(r.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(r.useCredentials=this.ajaxWithCredentials),t.addEvent(r,"load",function(){n.width=r.naturalWidth,n.height=r.naturalHeight,n.aspectRatio=n.width/n.height,n.dimensions=new t.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),t.addEvent(r,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+i,source:i})}),r.src=i},getLevelScale:function(i){var r=NaN;return i>=this.minLevel&&i<=this.maxLevel&&(r=this.levels[i].width/this.levels[this.maxLevel].width),r},getNumTiles:function(i){var r=this.getLevelScale(i);return r?new t.Point(1,1):new t.Point(0,0)},getTileUrl:function(i,r,n){var o=null;return i>=this.minLevel&&i<=this.maxLevel&&(o=this.levels[i].url),o},getContext2D:function(i,r,n){var o=null;return i>=this.minLevel&&i<=this.maxLevel&&(o=this.levels[i].context2D),o},destroy:function(i){this._freeupCanvasMemory(i)},_buildLevels:function(){var i=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!t.supportsCanvas)return delete this._image,i;var r=this._image.naturalWidth,n=this._image.naturalHeight,o=document.createElement("canvas"),a=o.getContext("2d");if(o.width=r,o.height=n,a.drawImage(this._image,0,0,r,n),i[0].context2D=a,delete this._image,t.isCanvasTainted(o))return i;for(;r>=2&&n>=2;){r=Math.floor(r/2),n=Math.floor(n/2);var l=document.createElement("canvas"),h=l.getContext("2d");l.width=r,l.height=n,h.drawImage(o,0,0,r,n),i.splice(0,0,{context2D:h,width:r,height:n}),o=l,a=h}return i},_freeupCanvasMemory:function(i){for(var r=0;r<this.levels.length;r++)this.levels[r].context2D&&(this.levels[r].context2D.canvas.height=0,this.levels[r].context2D.canvas.width=0,i&&i.raiseEvent("image-unloaded",{context2D:this.levels[r].context2D}))}})}(e),function(t){t.TileSourceCollection=function(i,r,n,o){t.console.error("TileSourceCollection is deprecated; use World instead")}}(e),function(t){t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(h){var u=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},h),this.element=h.element||t.makeNeutralElement("div"),h.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,t.setElementPointerEventsNone(this.imgRest),t.setElementPointerEventsNone(this.imgGroup),t.setElementPointerEventsNone(this.imgHover),t.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({userData:"Button.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(c){c.insideElementPressed?(a(u,t.ButtonState.DOWN),u.raiseEvent("enter",{originalEvent:c.originalEvent})):c.buttonDownAny||a(u,t.ButtonState.HOVER)},focusHandler:function(c){u.tracker.enterHandler(c),u.raiseEvent("focus",{originalEvent:c.originalEvent})},leaveHandler:function(c){l(u,t.ButtonState.GROUP),c.insideElementPressed&&u.raiseEvent("exit",{originalEvent:c.originalEvent})},blurHandler:function(c){u.tracker.leaveHandler(c),u.raiseEvent("blur",{originalEvent:c.originalEvent})},pressHandler:function(c){a(u,t.ButtonState.DOWN),u.raiseEvent("press",{originalEvent:c.originalEvent})},releaseHandler:function(c){c.insideElementPressed&&c.insideElementReleased?(l(u,t.ButtonState.HOVER),u.raiseEvent("release",{originalEvent:c.originalEvent})):c.insideElementPressed?l(u,t.ButtonState.GROUP):a(u,t.ButtonState.HOVER)},clickHandler:function(c){c.quick&&u.raiseEvent("click",{originalEvent:c.originalEvent})},keyHandler:function(c){c.keyCode===13?(u.raiseEvent("click",{originalEvent:c.originalEvent}),u.raiseEvent("release",{originalEvent:c.originalEvent}),c.preventDefault=!0):c.preventDefault=!1}}),l(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){a(this,t.ButtonState.GROUP)},notifyGroupExit:function(){l(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,this.tracker.setTracking(!1),t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,this.tracker.setTracking(!0),t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}});function i(h){t.requestAnimationFrame(function(){r(h)})}function r(h){var u,c,d;h.shouldFade&&(u=t.now(),c=u-h.fadeBeginTime,d=1-c/h.fadeLength,d=Math.min(1,d),d=Math.max(0,d),h.imgGroup&&t.setElementOpacity(h.imgGroup,d,!0),d>0&&i(h))}function n(h){h.shouldFade=!0,h.fadeBeginTime=t.now()+h.fadeDelay,window.setTimeout(function(){i(h)},h.fadeDelay)}function o(h){h.shouldFade=!1,h.imgGroup&&t.setElementOpacity(h.imgGroup,1,!0)}function a(h,u){h.element.disabled||(u>=t.ButtonState.GROUP&&h.currentState===t.ButtonState.REST&&(o(h),h.currentState=t.ButtonState.GROUP),u>=t.ButtonState.HOVER&&h.currentState===t.ButtonState.GROUP&&(h.imgHover&&(h.imgHover.style.visibility=""),h.currentState=t.ButtonState.HOVER),u>=t.ButtonState.DOWN&&h.currentState===t.ButtonState.HOVER&&(h.imgDown&&(h.imgDown.style.visibility=""),h.currentState=t.ButtonState.DOWN))}function l(h,u){h.element.disabled||(u<=t.ButtonState.HOVER&&h.currentState===t.ButtonState.DOWN&&(h.imgDown&&(h.imgDown.style.visibility="hidden"),h.currentState=t.ButtonState.HOVER),u<=t.ButtonState.GROUP&&h.currentState===t.ButtonState.HOVER&&(h.imgHover&&(h.imgHover.style.visibility="hidden"),h.currentState=t.ButtonState.GROUP),u<=t.ButtonState.REST&&h.currentState===t.ButtonState.GROUP&&(n(h),h.currentState=t.ButtonState.REST))}}(e),function(t){t.ButtonGroup=function(i){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var r=this.buttons.concat([]),n=this,o;if(this.element=i.element||t.makeNeutralElement("div"),!i.group)for(this.element.style.display="inline-block",o=0;o<r.length;o++)this.element.appendChild(r[o].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(a){var l;for(l=0;l<n.buttons.length;l++)n.buttons[l].notifyGroupEnter()},leaveHandler:function(a){var l;if(!a.insideElementPressed)for(l=0;l<n.buttons.length;l++)n.buttons[l].notifyGroupExit()}})},t.ButtonGroup.prototype={addButton:function(i){this.buttons.push(i),this.element.appendChild(i.element)},emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var i=this.buttons.pop();this.element.removeChild(i.element),i.destroy()}this.tracker.destroy(),this.element=null}}}(e),function(t){t.Rect=function(i,r,n,o,a){this.x=typeof i=="number"?i:0,this.y=typeof r=="number"?r:0,this.width=typeof n=="number"?n:0,this.height=typeof o=="number"?o:0,this.degrees=typeof a=="number"?a:0,this.degrees=t.positiveModulo(this.degrees,360);var l,h;this.degrees>=270?(l=this.getTopRight(),this.x=l.x,this.y=l.y,h=this.height,this.height=this.width,this.width=h,this.degrees-=270):this.degrees>=180?(l=this.getBottomRight(),this.x=l.x,this.y=l.y,this.degrees-=180):this.degrees>=90&&(l=this.getBottomLeft(),this.x=l.x,this.y=l.y,h=this.height,this.height=this.width,this.width=h,this.degrees-=90)},t.Rect.fromSummits=function(i,r,n){var o=i.distanceTo(r),a=i.distanceTo(n),l=r.minus(i),h=Math.atan(l.y/l.x);return l.x<0?h+=Math.PI:l.y<0&&(h+=2*Math.PI),new t.Rect(i.x,i.y,o,a,h/Math.PI*180)},t.Rect.prototype={clone:function(){return new t.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new t.Point(this.x,this.y)},getBottomRight:function(){return new t.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new t.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new t.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new t.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new t.Point(this.width,this.height)},equals:function(i){return i instanceof t.Rect&&this.x===i.x&&this.y===i.y&&this.width===i.width&&this.height===i.height&&this.degrees===i.degrees},times:function(i){return new t.Rect(this.x*i,this.y*i,this.width*i,this.height*i,this.degrees)},translate:function(i){return new t.Rect(this.x+i.x,this.y+i.y,this.width,this.height,this.degrees)},union:function(i){var r=this.getBoundingBox(),n=i.getBoundingBox(),o=Math.min(r.x,n.x),a=Math.min(r.y,n.y),l=Math.max(r.x+r.width,n.x+n.width),h=Math.max(r.y+r.height,n.y+n.height);return new t.Rect(o,a,l-o,h-a)},intersection:function(i){var r=1e-10,n=[],o=this.getTopLeft();i.containsPoint(o,r)&&n.push(o);var a=this.getTopRight();i.containsPoint(a,r)&&n.push(a);var l=this.getBottomLeft();i.containsPoint(l,r)&&n.push(l);var h=this.getBottomRight();i.containsPoint(h,r)&&n.push(h);var u=i.getTopLeft();this.containsPoint(u,r)&&n.push(u);var c=i.getTopRight();this.containsPoint(c,r)&&n.push(c);var d=i.getBottomLeft();this.containsPoint(d,r)&&n.push(d);var f=i.getBottomRight();this.containsPoint(f,r)&&n.push(f);for(var p=this._getSegments(),m=i._getSegments(),g=0;g<p.length;g++)for(var v=p[g],x=0;x<m.length;x++){var _=m[x],E=R(v[0],v[1],_[0],_[1]);E&&n.push(E)}function R(D,C,I,L){var W=C.minus(D),U=L.minus(I),V=-U.x*W.y+W.x*U.y;if(V===0)return null;var ie=(W.x*(D.y-I.y)-W.y*(D.x-I.x))/V,k=(U.x*(D.y-I.y)-U.y*(D.x-I.x))/V;return-1e-10<=ie&&ie<=1-r&&-1e-10<=k&&k<=1-r?new t.Point(D.x+k*W.x,D.y+k*W.y):null}if(n.length===0)return null;for(var M=n[0].x,O=n[0].x,N=n[0].y,B=n[0].y,G=1;G<n.length;G++){var K=n[G];K.x<M&&(M=K.x),K.x>O&&(O=K.x),K.y<N&&(N=K.y),K.y>B&&(B=K.y)}return new t.Rect(M,N,O-M,B-N)},_getSegments:function(){var i=this.getTopLeft(),r=this.getTopRight(),n=this.getBottomLeft(),o=this.getBottomRight();return[[i,r],[r,o],[o,n],[n,i]]},rotate:function(i,r){if(i=t.positiveModulo(i,360),i===0)return this.clone();r=r||this.getCenter();var n=this.getTopLeft().rotate(i,r),o=this.getTopRight().rotate(i,r),a=o.minus(n);a=a.apply(function(h){var u=1e-15;return Math.abs(h)<u?0:h});var l=Math.atan(a.y/a.x);return a.x<0?l+=Math.PI:a.y<0&&(l+=2*Math.PI),new t.Rect(n.x,n.y,this.width,this.height,l/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var i=this.getTopLeft(),r=this.getTopRight(),n=this.getBottomLeft(),o=this.getBottomRight(),a=Math.min(i.x,r.x,n.x,o.x),l=Math.max(i.x,r.x,n.x,o.x),h=Math.min(i.y,r.y,n.y,o.y),u=Math.max(i.y,r.y,n.y,o.y);return new t.Rect(a,h,l-a,u-h)},getIntegerBoundingBox:function(){var i=this.getBoundingBox(),r=Math.floor(i.x),n=Math.floor(i.y),o=Math.ceil(i.width+i.x-r),a=Math.ceil(i.height+i.y-n);return new t.Rect(r,n,o,a)},containsPoint:function(i,r){r=r||0;var n=this.getTopLeft(),o=this.getTopRight(),a=this.getBottomLeft(),l=o.minus(n),h=a.minus(n);return(i.x-n.x)*l.x+(i.y-n.y)*l.y>=-r&&(i.x-o.x)*l.x+(i.y-o.y)*l.y<=r&&(i.x-n.x)*h.x+(i.y-n.y)*h.y>=-r&&(i.x-a.x)*h.x+(i.y-a.y)*h.y<=r},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(e),function(t){var i={};t.ReferenceStrip=function(d){var f=this,p=d.viewer,m=t.getElementSize(p.element),g,v,x;for(d.id||(d.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=d.id,this.element.className="referencestrip"),d=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},d,{element:this.element}),t.extend(this,d),i[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,v=this.element.style,v.marginTop="0px",v.marginRight="0px",v.marginBottom="0px",v.marginLeft="0px",v.left="0px",v.bottom="0px",v.border="0px",v.background="#000",v.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=p,this.tracker=new t.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:t.delegate(this,r),dragHandler:t.delegate(this,n),scrollHandler:t.delegate(this,o),enterHandler:t.delegate(this,l),leaveHandler:t.delegate(this,h),keyDownHandler:t.delegate(this,u),keyHandler:t.delegate(this,c),preProcessEventHandler:function(_){_.eventType==="wheel"&&(_.preventDefault=!0)}}),d.width&&d.height?(this.element.style.width=d.width+"px",this.element.style.height=d.height+"px",p.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):d.scroll==="horizontal"?(this.element.style.width=m.x*d.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=m.y*d.sizeRatio+"px",p.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=m.y*d.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=m.x*d.sizeRatio+"px",p.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=m.x*this.sizeRatio+8,this.panelHeight=m.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},x=0;x<p.tileSources.length;x++)g=t.makeNeutralElement("div"),g.id=this.element.id+"-"+x,g.style.width=f.panelWidth+"px",g.style.height=f.panelHeight+"px",g.style.display="inline",g.style.float="left",g.style.cssFloat="left",g.style.padding="2px",t.setElementTouchActionNone(g),t.setElementPointerEventsNone(g),this.element.appendChild(g),g.activePanel=!1,this.panels.push(g);a(this,this.scroll==="vertical"?m.y:m.x,0),this.setFocus(0)},t.ReferenceStrip.prototype={setFocus:function(d){var f=this.element.querySelector("#"+this.element.id+"-"+d),p=t.getElementSize(this.viewer.canvas),m=Number(this.element.style.width.replace("px","")),g=Number(this.element.style.height.replace("px","")),v=-Number(this.element.style.marginLeft.replace("px","")),x=-Number(this.element.style.marginTop.replace("px","")),_;this.currentSelected!==f&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=f,this.currentSelected.style.background="#999",this.scroll==="horizontal"?(_=Number(d)*(this.panelWidth+3),_>v+p.x-this.panelWidth?(_=Math.min(_,m-p.x),this.element.style.marginLeft=-_+"px",a(this,p.x,-_)):_<v&&(_=Math.max(0,_-p.x/2),this.element.style.marginLeft=-_+"px",a(this,p.x,-_))):(_=Number(d)*(this.panelHeight+3),_>x+p.y-this.panelHeight?(_=Math.min(_,g-p.y),this.element.style.marginTop=-_+"px",a(this,p.y,-_)):_<x&&(_=Math.max(0,_-p.y/2),this.element.style.marginTop=-_+"px",a(this,p.y,-_))),this.currentPage=d,l.call(this,{eventSource:this.tracker}))},update:function(){return!!i[this.id].animating},destroy:function(){if(this.miniViewers)for(var d in this.miniViewers)this.miniViewers[d].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}};function r(d){if(d.quick){var f;this.scroll==="horizontal"?f=Math.floor(d.position.x/(this.panelWidth+4)):f=Math.floor(d.position.y/this.panelHeight),this.viewer.goToPage(f)}this.element.focus()}function n(d){if(this.dragging=!0,this.element){var f=Number(this.element.style.marginLeft.replace("px","")),p=Number(this.element.style.marginTop.replace("px","")),m=Number(this.element.style.width.replace("px","")),g=Number(this.element.style.height.replace("px","")),v=t.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?-d.delta.x>0?f>-(m-v.x)&&(this.element.style.marginLeft=f+d.delta.x*2+"px",a(this,v.x,f+d.delta.x*2)):-d.delta.x<0&&f<0&&(this.element.style.marginLeft=f+d.delta.x*2+"px",a(this,v.x,f+d.delta.x*2)):-d.delta.y>0?p>-(g-v.y)&&(this.element.style.marginTop=p+d.delta.y*2+"px",a(this,v.y,p+d.delta.y*2)):-d.delta.y<0&&p<0&&(this.element.style.marginTop=p+d.delta.y*2+"px",a(this,v.y,p+d.delta.y*2))}}function o(d){if(this.element){var f=Number(this.element.style.marginLeft.replace("px","")),p=Number(this.element.style.marginTop.replace("px","")),m=Number(this.element.style.width.replace("px","")),g=Number(this.element.style.height.replace("px","")),v=t.getElementSize(this.viewer.canvas);this.scroll==="horizontal"?d.scroll>0?f>-(m-v.x)&&(this.element.style.marginLeft=f-d.scroll*60+"px",a(this,v.x,f-d.scroll*60)):d.scroll<0&&f<0&&(this.element.style.marginLeft=f-d.scroll*60+"px",a(this,v.x,f-d.scroll*60)):d.scroll<0?p>v.y-g&&(this.element.style.marginTop=p+d.scroll*60+"px",a(this,v.y,p+d.scroll*60)):d.scroll>0&&p<0&&(this.element.style.marginTop=p+d.scroll*60+"px",a(this,v.y,p+d.scroll*60)),d.preventDefault=!0}}function a(d,f,p){var m,g,v,x,_,E;for(d.scroll==="horizontal"?m=d.panelWidth:m=d.panelHeight,g=Math.ceil(f/m)+5,v=Math.ceil((Math.abs(p)+f)/m)+1,g=v-g,g=g<0?0:g,_=g;_<v&&_<d.panels.length;_++)if(E=d.panels[_],!E.activePanel){var R,M=d.viewer.tileSources[_];M.referenceStripThumbnailUrl?R={type:"image",url:M.referenceStripThumbnailUrl}:R=M,x=new t.Viewer({id:E.id,tileSources:[R],element:E,navigatorSizeRatio:d.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:d.viewer.loadTilesWithAjax,ajaxHeaders:d.viewer.ajaxHeaders,drawer:"canvas"}),t.setElementPointerEventsNone(x.canvas),t.setElementPointerEventsNone(x.container),x.innerTracker.setTracking(!1),x.outerTracker.setTracking(!1),d.miniViewers[E.id]=x,E.activePanel=!0}}function l(d){var f=d.eventSource.element;this.scroll==="horizontal"?f.style.marginBottom="0px":f.style.marginLeft="0px"}function h(d){var f=d.eventSource.element;this.scroll==="horizontal"?f.style.marginBottom="-"+t.getElementSize(f).y/2+"px":f.style.marginLeft="-"+t.getElementSize(f).x/2+"px"}function u(d){if(!d.ctrl&&!d.alt&&!d.meta)switch(d.keyCode){case 38:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 40:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 37:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 39:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1;break}else d.preventDefault=!1}function c(d){if(!d.ctrl&&!d.alt&&!d.meta)switch(d.keyCode){case 61:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 45:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 48:case 119:case 87:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;case 115:case 83:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 97:o.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),d.preventDefault=!0;break;case 100:o.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),d.preventDefault=!0;break;default:d.preventDefault=!1;break}else d.preventDefault=!1}}(e),function(t){t.DisplayRect=function(i,r,n,o,a,l){t.Rect.apply(this,[i,r,n,o]),this.minLevel=a,this.maxLevel=l},t.extend(t.DisplayRect.prototype,t.Rect.prototype)}(e),function(t){t.Spring=function(r){var n=arguments;typeof r!="object"&&(r={initial:n.length&&typeof n[0]=="number"?n[0]:void 0,springStiffness:n.length>1?n[1].springStiffness:5,animationTime:n.length>1?n[1].animationTime:1.5}),t.console.assert(typeof r.springStiffness=="number"&&r.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert(typeof r.animationTime=="number"&&r.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),r.exponential&&(this._exponential=!0,delete r.exponential),t.extend(!0,this,r),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},t.Spring.prototype={resetTo:function(r){t.console.assert(!this._exponential||r!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=r,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(r){t.console.assert(!this._exponential||r!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=r,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(r){this.start.value+=r,this.target.value+=r,this._exponential&&(t.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(r){this._exponential=r,this._exponential&&(t.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=t.now();let r,n;if(this._exponential?(r=this.start._logValue,n=this.target._logValue):(r=this.start.value,n=this.target.value),this.current.time>=this.target.time)this.current.value=this.target.value;else{let o=r+(n-r)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time));this._exponential?this.current.value=Math.exp(o):this.current.value=o}return this.current.value!==this.target.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function i(r,n){return(1-Math.exp(r*-n))/(1-Math.exp(-r))}}(e),function(t){t.ImageJob=function(r){t.extend(!0,this,{timeout:t.DEFAULT_SETTINGS.timeout,jobId:null,tries:0},r),this.data=null,this.userData={},this.errorMsg=null},t.ImageJob.prototype={start:function(){this.tries++;var r=this,n=this.abort;this.jobId=window.setTimeout(function(){r.finish(null,null,"Image load exceeded timeout ("+r.timeout+" ms)")},this.timeout),this.abort=function(){r.source.downloadTileAbort(r),typeof n=="function"&&n()},this.source.downloadTileStart(this)},finish:function(r,n,o){this.data=r,this.request=n,this.errorMsg=o,this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},t.ImageLoader=function(r){t.extend(!0,this,{jobLimit:t.DEFAULT_SETTINGS.imageLoaderLimit,timeout:t.DEFAULT_SETTINGS.timeout,jobQueue:[],failedTiles:[],jobsInProgress:0},r)},t.ImageLoader.prototype={addJob:function(r){if(!r.source){t.console.error("ImageLoader.prototype.addJob() requires [options.source]. TileSource since new API defines how images are fetched. Creating a dummy TileSource.");var n=t.TileSource.prototype;r.source={downloadTileStart:n.downloadTileStart,downloadTileAbort:n.downloadTileAbort}}var o=this,a=function(u){i(o,u,r.callback)},l={src:r.src,tile:r.tile||{},source:r.source,loadWithAjax:r.loadWithAjax,ajaxHeaders:r.loadWithAjax?r.ajaxHeaders:null,crossOriginPolicy:r.crossOriginPolicy,ajaxWithCredentials:r.ajaxWithCredentials,postData:r.postData,callback:a,abort:r.abort,timeout:this.timeout},h=new t.ImageJob(l);!this.jobLimit||this.jobsInProgress<this.jobLimit?(h.start(),this.jobsInProgress++):this.jobQueue.push(h)},clear:function(){for(var r=0;r<this.jobQueue.length;r++){var n=this.jobQueue[r];typeof n.abort=="function"&&n.abort()}this.jobQueue=[]}};function i(r,n,o){n.errorMsg!==""&&(n.data===null||n.data===void 0)&&n.tries<1+r.tileRetryMax&&r.failedTiles.push(n);var a;r.jobsInProgress--,(!r.jobLimit||r.jobsInProgress<r.jobLimit)&&r.jobQueue.length>0&&(a=r.jobQueue.shift(),a.start(),r.jobsInProgress++),r.tileRetryMax>0&&r.jobQueue.length===0&&(!r.jobLimit||r.jobsInProgress<r.jobLimit)&&r.failedTiles.length>0&&(a=r.failedTiles.shift(),setTimeout(function(){a.start()},r.tileRetryDelay),r.jobsInProgress++),o(n.data,n.errorMsg,n.request)}}(e),function(t){t.Tile=function(i,r,n,o,a,l,h,u,c,d,f,p){this.level=i,this.x=r,this.y=n,this.bounds=o,this.positionedBounds=new e.Rect(o.x,o.y,o.width,o.height),this.sourceBounds=d,this.exists=a,this._url=l,this.postData=f,this.context2D=h,this.loadWithAjax=u,this.ajaxHeaders=c,p===void 0&&(t.console.warn("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),p=t.TileSource.prototype.getTileHashKey(i,r,n,l,c,f)),this.cacheKey=p,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.hasTransparency=!1,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return console.warn("Tile.prototype._hasTransparencyChannel() has been deprecated and will be removed in the future. Use TileSource.prototype.hasTransparency() instead."),!!this.context2D||this.getUrl().match(".png")},get image(){return t.console.error("[Tile.image] property has been deprecated. Use [Tile.prototype.getImage] instead."),this.getImage()},get url(){return t.console.error("[Tile.url] property has been deprecated. Use [Tile.prototype.getUrl] instead."),this.getUrl()},getImage:function(){return this.cacheImageRecord.getImage()},getUrl:function(){return typeof this._url=="function"?this._url():this._url},getCanvasContext:function(){return this.context2D||this.cacheImageRecord&&this.cacheImageRecord.getRenderedContext()},getScaleForEdgeSmoothing:function(){var i;if(this.cacheImageRecord)i=this.cacheImageRecord.getRenderedContext();else if(this.context2D)i=this.context2D;else return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return i.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(i,r,n){var o=Math.max(1,Math.ceil((n.x-r.x)/2)),a=Math.max(1,Math.ceil((n.y-r.y)/2));return new t.Point(o,a).minus(this.position.times(t.pixelDensityRatio).times(i||1).apply(function(l){return l%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(e),function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(i,r,n){var o;t.isPlainObject(i)?o=i:o={element:i,location:r,placement:n},this.elementWrapper=document.createElement("div"),this.element=o.element,this.elementWrapper.appendChild(this.element),this.element.id?this.elementWrapper.id="overlay-wrapper-"+this.element.id:this.elementWrapper.id="overlay-wrapper",this.style=this.elementWrapper.style,this._init(o)},t.Overlay.prototype={_init:function(i){this.location=i.location,this.placement=i.placement===void 0?t.Placement.TOP_LEFT:i.placement,this.onDraw=i.onDraw,this.checkResize=i.checkResize===void 0?!0:i.checkResize,this.width=i.width===void 0?null:i.width,this.height=i.height===void 0?null:i.height,this.rotationMode=i.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(i,r){var n=t.Placement.properties[this.placement];n&&(n.isHorizontallyCentered?i.x-=r.x/2:n.isRight&&(i.x-=r.x),n.isVerticallyCentered?i.y-=r.y/2:n.isBottom&&(i.y-=r.y))},destroy:function(){var i=this.elementWrapper,r=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(r.display="none",document.body.appendChild(i))),this.onDraw=null,r.top="",r.left="",r.position="",this.width!==null&&(r.width=""),this.height!==null&&(r.height="");var n=t.getCssPropertyWithVendorPrefix("transformOrigin"),o=t.getCssPropertyWithVendorPrefix("transform");n&&o&&(r[n]="",r[o]="")},drawHTML:function(i,r){var n=this.elementWrapper;n.parentNode!==i&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,i.appendChild(n),this.style.position="absolute",this.size=t.getElementSize(this.elementWrapper));var o=this._getOverlayPositionAndSize(r),a=o.position,l=this.size=o.size,h="";r.overlayPreserveContentDirection&&(h=r.flipped?" scaleX(-1)":" scaleX(1)");var u=r.flipped?-o.rotate:o.rotate,c=r.flipped?" scaleX(-1)":"";if(this.onDraw)this.onDraw(a,l,this.element);else{var d=this.style,f=this.element.style;f.display="block",d.left=a.x+"px",d.top=a.y+"px",this.width!==null&&(f.width=l.x+"px"),this.height!==null&&(f.height=l.y+"px");var p=t.getCssPropertyWithVendorPrefix("transformOrigin"),m=t.getCssPropertyWithVendorPrefix("transform");p&&m&&(u&&!r.flipped?(f[m]="",d[p]=this._getTransformOrigin(),d[m]="rotate("+u+"deg)"):!u&&r.flipped?(f[m]=h,d[p]=this._getTransformOrigin(),d[m]=c):u&&r.flipped?(f[m]=h,d[p]=this._getTransformOrigin(),d[m]="rotate("+u+"deg)"+c):(f[m]="",d[p]="",d[m]="")),d.display="flex"}},_getOverlayPositionAndSize:function(i){var r=i.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(i);this.adjust(r,n);var o=0;if(i.getRotation(!0)&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var a=new t.Rect(r.x,r.y,n.x,n.y),l=this._getBoundingBox(a,i.getRotation(!0));r=l.getTopLeft(),n=l.getSize()}else o=i.getRotation(!0);return i.flipped&&(r.x=i.getContainerSize().x-r.x),{position:r,size:n,rotate:o}},_getSizeInPixels:function(i){var r=this.size.x,n=this.size.y;if(this.width!==null||this.height!==null){var o=i.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);this.width!==null&&(r=o.x),this.height!==null&&(n=o.y)}if(this.checkResize&&(this.width===null||this.height===null)){var a=this.size=t.getElementSize(this.elementWrapper);this.width===null&&(r=a.x),this.height===null&&(n=a.y)}return new t.Point(r,n)},_getBoundingBox:function(i,r){var n=this._getPlacementPoint(i);return i.rotate(r,n).getBoundingBox()},_getPlacementPoint:function(i){var r=new t.Point(i.x,i.y),n=t.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?r.x+=i.width/2:n.isRight&&(r.x+=i.width),n.isVerticallyCentered?r.y+=i.height/2:n.isBottom&&(r.y+=i.height)),r},_getTransformOrigin:function(){var i="",r=t.Placement.properties[this.placement];return r&&(r.isLeft?i="left":r.isRight&&(i="right"),r.isTop?i+=" top":r.isBottom&&(i+=" bottom")),i},update:function(i,r){var n=t.isPlainObject(i)?i:{location:i,placement:r};this._init({location:n.location||this.location,placement:n.placement!==void 0?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:n.width!==void 0?n.width:this.width,height:n.height!==void 0?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(i){t.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var r=this.width,n=this.height;if(r===null||n===null){var o=i.deltaPointsFromPixelsNoRotate(this.size,!0);r===null&&(r=o.x),n===null&&(n=o.y)}var a=this.location.clone();return this.adjust(a,new t.Point(r,n)),this._adjustBoundsForRotation(i,new t.Rect(a.x,a.y,r,n))},_adjustBoundsForRotation:function(i,r){if(!i||i.getRotation(!0)===0||this.rotationMode===t.OverlayRotationMode.EXACT)return r;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return r;var n=this._getOverlayPositionAndSize(i);return i.viewerElementToViewportRectangle(new t.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return r.rotate(-i.getRotation(!0),this._getPlacementPoint(r))}}}(e),function(t){const i=t;i.DrawerBase=class{constructor(n){t.console.assert(n.viewer,"[Drawer] options.viewer is required"),t.console.assert(n.viewport,"[Drawer] options.viewport is required"),t.console.assert(n.element,"[Drawer] options.element is required"),this.viewer=n.viewer,this.viewport=n.viewport,this.debugGridColor=typeof n.debugGridColor=="string"?[n.debugGridColor]:n.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,this.options=n.options||{},this.container=t.getElement(n.element),this._renderingTarget=this._createDrawingElement(),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",this.canvas.style.left="0",t.setElementOpacity(this.canvas,this.viewer.opacity,!0),t.setElementPointerEventsNone(this.canvas),t.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._checkForAPIOverrides()}get canvas(){return this._renderingTarget}get element(){return t.console.error("Drawer.element is deprecated. Use Drawer.container instead."),this.container}getType(){t.console.error("Drawer.getType must be implemented by child class")}static isSupported(){t.console.error("Drawer.isSupported must be implemented by child class")}_createDrawingElement(){return t.console.error("Drawer._createDrawingElement must be implemented by child class"),null}draw(n){t.console.error("Drawer.draw must be implemented by child class")}canRotate(){t.console.error("Drawer.canRotate must be implemented by child class")}destroy(){t.console.error("Drawer.destroy must be implemented by child class")}minimumOverlapRequired(n){return!1}setImageSmoothingEnabled(n){t.console.error("Drawer.setImageSmoothingEnabled must be implemented by child class")}drawDebuggingRect(n){t.console.warn("[drawer].drawDebuggingRect is not implemented by this drawer")}clear(){t.console.warn("[drawer].clear() is deprecated. The drawer is responsible for clearing itself as needed before drawing tiles.")}_checkForAPIOverrides(){if(this._createDrawingElement===t.DrawerBase.prototype._createDrawingElement)throw new Error("[drawer]._createDrawingElement must be implemented by child class");if(this.draw===t.DrawerBase.prototype.draw)throw new Error("[drawer].draw must be implemented by child class");if(this.canRotate===t.DrawerBase.prototype.canRotate)throw new Error("[drawer].canRotate must be implemented by child class");if(this.destroy===t.DrawerBase.prototype.destroy)throw new Error("[drawer].destroy must be implemented by child class");if(this.setImageSmoothingEnabled===t.DrawerBase.prototype.setImageSmoothingEnabled)throw new Error("[drawer].setImageSmoothingEnabled must be implemented by child class")}viewportToDrawerRectangle(n){var o=this.viewport.pixelFromPointNoRotate(n.getTopLeft(),!0),a=this.viewport.deltaPixelsFromPointsNoRotate(n.getSize(),!0);return new t.Rect(o.x*t.pixelDensityRatio,o.y*t.pixelDensityRatio,a.x*t.pixelDensityRatio,a.y*t.pixelDensityRatio)}viewportCoordToDrawerCoord(n){var o=this.viewport.pixelFromPointNoRotate(n,!0);return new t.Point(o.x*t.pixelDensityRatio,o.y*t.pixelDensityRatio)}_calculateCanvasSize(){var n=t.pixelDensityRatio,o=this.viewport.getContainerSize();return new i.Point(Math.round(o.x*n),Math.round(o.y*n))}_raiseTiledImageDrawnEvent(n,o){this.viewer&&this.viewer.raiseEvent("tiled-image-drawn",{tiledImage:n,tiles:o})}_raiseDrawerErrorEvent(n,o){this.viewer&&this.viewer.raiseEvent("drawer-error",{tiledImage:n,drawer:this,error:o})}}}(e),function(t){const i=t;class r extends i.DrawerBase{constructor(o){super(o),this.viewer.rejectEventHandler("tile-drawing","The HTMLDrawer does not raise the tile-drawing event"),this.viewer.allowEventHandler("tile-drawn")}static isSupported(){return!0}getType(){return"html"}minimumOverlapRequired(o){return!0}_createDrawingElement(){return t.makeNeutralElement("div")}draw(o){var a=this;this._prepareNewFrame(),o.forEach(function(l){l.opacity!==0&&a._drawTiles(l)})}canRotate(){return!1}destroy(){this.container.removeChild(this.canvas)}setImageSmoothingEnabled(){}_prepareNewFrame(){this.canvas.innerHTML=""}_drawTiles(o){var a=o.getTilesToDraw().map(u=>u.tile);if(!(o.opacity===0||a.length===0&&!o.placeholderFillStyle))for(var l=a.length-1;l>=0;l--){var h=a[l];this._drawTile(h),this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:o,tile:h})}}_drawTile(o){t.console.assert(o,"[Drawer._drawTile] tile is required");let a=this.canvas;if(!o.cacheImageRecord){t.console.warn("[Drawer._drawTileToHTML] attempting to draw tile %s when it's not cached",o.toString());return}if(!o.loaded){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",o.toString());return}if(!o.element){var l=o.getImage();if(!l)return;o.element=t.makeNeutralElement("div"),o.imgElement=l.cloneNode(),o.imgElement.style.msInterpolationMode="nearest-neighbor",o.imgElement.style.width="100%",o.imgElement.style.height="100%",o.style=o.element.style,o.style.position="absolute"}o.element.parentNode!==a&&a.appendChild(o.element),o.imgElement.parentNode!==o.element&&o.element.appendChild(o.imgElement),o.style.top=o.position.y+"px",o.style.left=o.position.x+"px",o.style.height=o.size.y+"px",o.style.width=o.size.x+"px",o.flipped&&(o.style.transform="scaleX(-1)"),t.setElementOpacity(o.element,o.opacity)}}t.HTMLDrawer=r}(e),function(t){const i=t;class r extends i.DrawerBase{constructor(u){super(u),this.context=this.canvas.getContext("2d"),this.sketchCanvas=null,this.sketchContext=null,this._imageSmoothingEnabled=!0,this.viewer.allowEventHandler("tile-drawn"),this.viewer.allowEventHandler("tile-drawing")}static isSupported(){return t.supportsCanvas}getType(){return"canvas"}_createDrawingElement(){let u=t.makeNeutralElement("canvas"),c=this._calculateCanvasSize();return u.width=c.x,u.height=c.y,u}draw(u){this._prepareNewFrame(),this.viewer.viewport.getFlip()!==this._viewportFlipped&&this._flip();for(const c of u)c.opacity!==0&&this._drawTiles(c)}canRotate(){return!0}destroy(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null,this.container.removeChild(this.canvas)}minimumOverlapRequired(u){return!0}setImageSmoothingEnabled(u){this._imageSmoothingEnabled=!!u,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw()}drawDebuggingRect(u){var c=this.context;c.save(),c.lineWidth=2*t.pixelDensityRatio,c.strokeStyle=this.debugGridColor[0],c.fillStyle=this.debugGridColor[0],c.strokeRect(u.x*t.pixelDensityRatio,u.y*t.pixelDensityRatio,u.width*t.pixelDensityRatio,u.height*t.pixelDensityRatio),c.restore()}get _viewportFlipped(){return this.context.getTransform().a<0}_raiseTileDrawingEvent(u,c,d,f){this.viewer.raiseEvent("tile-drawing",{tiledImage:u,context:c,tile:d,rendered:f})}_prepareNewFrame(){var u=this._calculateCanvasSize();if((this.canvas.width!==u.x||this.canvas.height!==u.y)&&(this.canvas.width=u.x,this.canvas.height=u.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var c=this._calculateSketchCanvasSize();this.sketchCanvas.width=c.x,this.sketchCanvas.height=c.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}_clear(u,c){var d=this._getContext(u);if(c)d.clearRect(c.x,c.y,c.width,c.height);else{var f=d.canvas;d.clearRect(0,0,f.width,f.height)}}_drawTiles(u){var c=u.getTilesToDraw().map(D=>D.tile);if(!(u.opacity===0||c.length===0&&!u.placeholderFillStyle)){var d=c[0],f;d&&(f=u.opacity<1||u.compositeOperation&&u.compositeOperation!=="source-over"||!u._isBottomItem()&&u.source.hasTransparency(d.context2D,d.getUrl(),d.ajaxHeaders,d.postData));var p,m,g=this.viewport.getZoom(!0),v=u.viewportToImageZoom(g);c.length>1&&v>u.smoothTileEdgesMinZoom&&!u.iOSDevice&&u.getRotation(!0)%360===0&&(f=!0,p=d.getScaleForEdgeSmoothing(),m=d.getTranslationForEdgeSmoothing(p,this._getCanvasSize(!1),this._getCanvasSize(!0)));var x;f&&(p||(x=this.viewport.viewportToViewerElementRectangle(u.getClippedBounds(!0)).getIntegerBoundingBox(),x=x.times(t.pixelDensityRatio)),this._clear(!0,x)),p||this._setRotations(u,f);var _=!1;if(u._clip){this._saveContext(f);var E=u.imageToViewportRectangle(u._clip,!0);E=E.rotate(-u.getRotation(!0),u._getRotationPoint(!0));var R=this.viewportToDrawerRectangle(E);p&&(R=R.times(p)),m&&(R=R.translate(m)),this._setClip(R,f),_=!0}if(u._croppingPolygons){var M=this;_||this._saveContext(f);try{var O=u._croppingPolygons.map(function(D){return D.map(function(C){var I=u.imageToViewportCoordinates(C.x,C.y,!0).rotate(-u.getRotation(!0),u._getRotationPoint(!0)),L=M.viewportCoordToDrawerCoord(I);return p&&(L=L.times(p)),m&&(L=L.plus(m)),L})});this._clipWithPolygons(O,f)}catch(D){t.console.error(D)}_=!0}if(u._hasOpaqueTile=!1,u.placeholderFillStyle&&u._hasOpaqueTile===!1){let D=this.viewportToDrawerRectangle(u.getBoundsNoRotate(!0));p&&(D=D.times(p)),m&&(D=D.translate(m));let C=null;typeof u.placeholderFillStyle=="function"?C=u.placeholderFillStyle(u,this.context):C=u.placeholderFillStyle,this._drawRectangle(D,C,f)}var N=l(u.subPixelRoundingForTransparency),B=!1;if(N===t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS)B=!0;else if(N===t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST){var G=this.viewer&&this.viewer.isAnimating();B=!G}for(var K=0;K<c.length;K++)d=c[K],this._drawTile(d,u,f,p,m,B,u.source),this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:u,tile:d});_&&this._restoreContext(f),p||(u.getRotation(!0)%360!==0&&this._restoreRotationChanges(f),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(f)),f&&(p&&this._setRotations(u),this.blendSketch({opacity:u.opacity,scale:p,translate:m,compositeOperation:u.compositeOperation,bounds:x}),p&&(u.getRotation(!0)%360!==0&&this._restoreRotationChanges(!1),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(!1))),this._drawDebugInfo(u,c),this._raiseTiledImageDrawnEvent(u,c)}}_drawDebugInfo(u,c){if(u.debugMode)for(var d=c.length-1;d>=0;d--){var f=c[d];try{this._drawDebugInfoOnTile(f,c.length,d,u)}catch(p){t.console.error(p)}}}_clipWithPolygons(u,c){var d=this._getContext(c);d.beginPath();for(const f of u)for(const[p,m]of f.entries())d[p===0?"moveTo":"lineTo"](m.x,m.y);d.clip()}_drawTile(u,c,d,f,p,m,g){t.console.assert(u,"[Drawer._drawTile] tile is required"),t.console.assert(c,"[Drawer._drawTile] drawingHandler is required");var v=this._getContext(d);f=f||1,this._drawTileToCanvas(u,v,c,f,p,m,g)}_drawTileToCanvas(u,c,d,f,p,m,g){var v=u.position.times(t.pixelDensityRatio),x=u.size.times(t.pixelDensityRatio),_;if(!u.context2D&&!u.cacheImageRecord){t.console.warn("[Drawer._drawTileToCanvas] attempting to draw tile %s when it's not cached",u.toString());return}if(_=u.getCanvasContext(),!u.loaded||!_){t.console.warn("Attempting to draw tile %s when it's not yet loaded.",u.toString());return}c.save(),typeof f=="number"&&f!==1&&(v=v.times(f),x=x.times(f)),p instanceof t.Point&&(v=v.plus(p)),c.globalAlpha===1&&u.hasTransparency&&(m&&(v.x=Math.round(v.x),v.y=Math.round(v.y),x.x=Math.round(x.x),x.y=Math.round(x.y)),c.clearRect(v.x,v.y,x.x,x.y)),this._raiseTileDrawingEvent(d,c,u,_);var E,R;u.sourceBounds?(E=Math.min(u.sourceBounds.width,_.canvas.width),R=Math.min(u.sourceBounds.height,_.canvas.height)):(E=_.canvas.width,R=_.canvas.height),c.translate(v.x+x.x/2,0),u.flipped&&c.scale(-1,1),c.drawImage(_.canvas,0,0,E,R,-x.x/2,v.y,x.x,x.y),c.restore()}_getContext(u){var c=this.context;if(u){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var d=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=d.x,this.sketchCanvas.height=d.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var f=this;this.viewer.addHandler("rotate",function p(){if(f.viewport.getRotation()!==0){f.viewer.removeHandler("rotate",p);var m=f._calculateSketchCanvasSize();f.sketchCanvas.width=m.x,f.sketchCanvas.height=m.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}c=this.sketchContext}return c}_saveContext(u){this._getContext(u).save()}_restoreContext(u){this._getContext(u).restore()}_setClip(u,c){var d=this._getContext(c);d.beginPath(),d.rect(u.x,u.y,u.width,u.height),d.clip()}_drawRectangle(u,c,d){var f=this._getContext(d);f.save(),f.fillStyle=c,f.fillRect(u.x,u.y,u.width,u.height),f.restore()}blendSketch(u,c,d,f){var p=u;t.isPlainObject(p)||(p={opacity:u,scale:c,translate:d,compositeOperation:f}),u=p.opacity,f=p.compositeOperation;var m=p.bounds;if(this.context.save(),this.context.globalAlpha=u,f&&(this.context.globalCompositeOperation=f),m)m.x<0&&(m.width+=m.x,m.x=0),m.x+m.width>this.canvas.width&&(m.width=this.canvas.width-m.x),m.y<0&&(m.height+=m.y,m.y=0),m.y+m.height>this.canvas.height&&(m.height=this.canvas.height-m.y),this.context.drawImage(this.sketchCanvas,m.x,m.y,m.width,m.height,m.x,m.y,m.width,m.height);else{c=p.scale||1,d=p.translate;var g=d instanceof t.Point?d:new t.Point(0,0),v=0,x=0;if(d){var _=this.sketchCanvas.width-this.canvas.width,E=this.sketchCanvas.height-this.canvas.height;v=Math.round(_/2),x=Math.round(E/2)}this.context.drawImage(this.sketchCanvas,g.x-v*c,g.y-x*c,(this.canvas.width+2*v)*c,(this.canvas.height+2*x)*c,-v,-x,this.canvas.width+2*v,this.canvas.height+2*x)}this.context.restore()}_drawDebugInfoOnTile(u,c,d,f){var p=this.viewer.world.getIndexOfItem(f)%this.debugGridColor.length,m=this.context;m.save(),m.lineWidth=2*t.pixelDensityRatio,m.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",m.strokeStyle=this.debugGridColor[p],m.fillStyle=this.debugGridColor[p],this._setRotations(f),this._viewportFlipped&&this._flip({point:u.position.plus(u.size.divide(2))}),m.strokeRect(u.position.x*t.pixelDensityRatio,u.position.y*t.pixelDensityRatio,u.size.x*t.pixelDensityRatio,u.size.y*t.pixelDensityRatio);var g=(u.position.x+u.size.x/2)*t.pixelDensityRatio,v=(u.position.y+u.size.y/2)*t.pixelDensityRatio;m.translate(g,v);const x=this.viewport.getRotation(!0);m.rotate(Math.PI/180*-x),m.translate(-g,-v),u.x===0&&u.y===0&&(m.fillText("Zoom: "+this.viewport.getZoom(),u.position.x*t.pixelDensityRatio,(u.position.y-30)*t.pixelDensityRatio),m.fillText("Pan: "+this.viewport.getBounds().toString(),u.position.x*t.pixelDensityRatio,(u.position.y-20)*t.pixelDensityRatio)),m.fillText("Level: "+u.level,(u.position.x+10)*t.pixelDensityRatio,(u.position.y+20)*t.pixelDensityRatio),m.fillText("Column: "+u.x,(u.position.x+10)*t.pixelDensityRatio,(u.position.y+30)*t.pixelDensityRatio),m.fillText("Row: "+u.y,(u.position.x+10)*t.pixelDensityRatio,(u.position.y+40)*t.pixelDensityRatio),m.fillText("Order: "+d+" of "+c,(u.position.x+10)*t.pixelDensityRatio,(u.position.y+50)*t.pixelDensityRatio),m.fillText("Size: "+u.size.toString(),(u.position.x+10)*t.pixelDensityRatio,(u.position.y+60)*t.pixelDensityRatio),m.fillText("Position: "+u.position.toString(),(u.position.x+10)*t.pixelDensityRatio,(u.position.y+70)*t.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),f.getRotation(!0)%360!==0&&this._restoreRotationChanges(),m.restore()}_updateImageSmoothingEnabled(u){u.msImageSmoothingEnabled=this._imageSmoothingEnabled,u.imageSmoothingEnabled=this._imageSmoothingEnabled}_getCanvasSize(u){var c=this._getContext(u).canvas;return new t.Point(c.width,c.height)}_getCanvasCenter(){return new t.Point(this.canvas.width/2,this.canvas.height/2)}_setRotations(u,c=!1){var d=!1;this.viewport.getRotation(!0)%360!==0&&(this._offsetForRotation({degrees:this.viewport.getRotation(!0),useSketch:c,saveContext:d}),d=!1),u.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:u.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(u._getRotationPoint(!0),!0),useSketch:c,saveContext:d})}_offsetForRotation(u){var c=u.point?u.point.times(t.pixelDensityRatio):this._getCanvasCenter(),d=this._getContext(u.useSketch);d.save(),d.translate(c.x,c.y),d.rotate(Math.PI/180*u.degrees),d.translate(-c.x,-c.y)}_flip(u){u=u||{};var c=u.point?u.point.times(t.pixelDensityRatio):this._getCanvasCenter(),d=this._getContext(u.useSketch);d.translate(c.x,0),d.scale(-1,1),d.translate(-c.x,0)}_restoreRotationChanges(u){var c=this._getContext(u);c.restore()}_calculateCanvasSize(){var u=t.pixelDensityRatio,c=this.viewport.getContainerSize();return{x:Math.round(c.x*u),y:Math.round(c.y*u)}}_calculateSketchCanvasSize(){var u=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return u;var c=Math.ceil(Math.sqrt(u.x*u.x+u.y*u.y));return{x:c,y:c}}}t.CanvasDrawer=r;var n=t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER;function o(h){return h!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&h!==t.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&h!==t.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function a(h){return o(h)?n:h}function l(h){if(typeof h=="number")return a(h);if(!h||!t.Browser)return n;var u=h[t.Browser.vendor];return o(u)&&(u=h["*"]),a(u)}}(e),function(t){const i=t;i.WebGLDrawer=class extends i.DrawerBase{constructor(n){super(n),this._destroyed=!1,this._TextureMap=new Map,this._TileMap=new Map,this._gl=null,this._firstPass=null,this._secondPass=null,this._glFrameBuffer=null,this._renderToTexture=null,this._glFramebufferToCanvasTransform=null,this._outputCanvas=null,this._outputContext=null,this._clippingCanvas=null,this._clippingContext=null,this._renderingCanvas=null,this._backupCanvasDrawer=null,this._imageSmoothingEnabled=!0,this._boundToTileReady=o=>this._tileReadyHandler(o),this._boundToImageUnloaded=o=>this._imageUnloadedHandler(o),this.viewer.addHandler("tile-ready",this._boundToTileReady),this.viewer.addHandler("image-unloaded",this._boundToImageUnloaded),this.viewer.rejectEventHandler("tile-drawn","The WebGLDrawer does not raise the tile-drawn event"),this.viewer.rejectEventHandler("tile-drawing","The WebGLDrawer does not raise the tile-drawing event"),this._setupCanvases(),this._setupRenderer(),this.context=this._outputContext}destroy(){if(this._destroyed)return;let n=this._gl;var o=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);for(let l=0;l<o;++l)n.activeTexture(n.TEXTURE0+l),n.bindTexture(n.TEXTURE_2D,null),n.bindTexture(n.TEXTURE_CUBE_MAP,null);n.bindBuffer(n.ARRAY_BUFFER,null),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindFramebuffer(n.FRAMEBUFFER,null),this._unloadTextures(),n.deleteBuffer(this._secondPass.bufferOutputPosition),n.deleteFramebuffer(this._glFrameBuffer),this._renderingCanvas.width=this._renderingCanvas.height=1,this._clippingCanvas.width=this._clippingCanvas.height=1,this._outputCanvas.width=this._outputCanvas.height=1,this._renderingCanvas=null,this._clippingCanvas=this._clippingContext=null,this._outputCanvas=this._outputContext=null;let a=n.getExtension("WEBGL_lose_context");a&&a.loseContext(),this.viewer.removeHandler("tile-ready",this._boundToTileReady),this.viewer.removeHandler("image-unloaded",this._boundToImageUnloaded),this.viewer.removeHandler("resize",this._resizeHandler),this._gl=null,this._backupCanvasDrawer&&(this._backupCanvasDrawer.destroy(),this._backupCanvasDrawer=null),this.container.removeChild(this.canvas),this.viewer.drawer===this&&(this.viewer.drawer=null),this._destroyed=!0}canRotate(){return!0}static isSupported(){let n=document.createElement("canvas"),o=t.isFunction(n.getContext)&&n.getContext("webgl"),a=o&&o.getExtension("WEBGL_lose_context");return a&&a.loseContext(),!!o}getType(){return"webgl"}minimumOverlapRequired(n){return n.isTainted()}_createDrawingElement(){let n=t.makeNeutralElement("canvas"),o=this._calculateCanvasSize();return n.width=o.x,n.height=o.y,n}_getBackupCanvasDrawer(){return this._backupCanvasDrawer||(this._backupCanvasDrawer=this.viewer.requestDrawer("canvas",{mainDrawer:!1}),this._backupCanvasDrawer.canvas.style.setProperty("visibility","hidden")),this._backupCanvasDrawer}draw(n){let o=this._gl;const a=this.viewport.getBoundsNoRotateWithMargins(!0);let l={bounds:a,center:new i.Point(a.x+a.width/2,a.y+a.height/2),rotation:this.viewport.getRotation(!0)*Math.PI/180},h=this.viewport.flipped?-1:1,u=t.Mat3.makeTranslation(-l.center.x,-l.center.y),c=t.Mat3.makeScaling(2/l.bounds.width*h,-2/l.bounds.height),d=t.Mat3.makeRotation(-l.rotation),f=c.multiply(d).multiply(u);o.bindFramebuffer(o.FRAMEBUFFER,null),o.clear(o.COLOR_BUFFER_BIT),this._outputContext.clearRect(0,0,this._outputCanvas.width,this._outputCanvas.height);let p=!1;n.forEach((m,g)=>{if(m.isTainted()){p&&(this._outputContext.drawImage(this._renderingCanvas,0,0),o.bindFramebuffer(o.FRAMEBUFFER,null),o.clear(o.COLOR_BUFFER_BIT),p=!1);const v=this._getBackupCanvasDrawer();v.draw([m]),this._outputContext.drawImage(v.canvas,0,0)}else{let v=m.getTilesToDraw();if(m.placeholderFillStyle&&m._hasOpaqueTile===!1&&this._drawPlaceholder(m),v.length===0||m.getOpacity()===0)return;let x=v[0],_=m.compositeOperation||this.viewer.compositeOperation||m._clip||m._croppingPolygons||m.debugMode,E=_||m.opacity<1||x.hasTransparency;_&&(p&&this._outputContext.drawImage(this._renderingCanvas,0,0),o.bindFramebuffer(o.FRAMEBUFFER,null),o.clear(o.COLOR_BUFFER_BIT)),o.useProgram(this._firstPass.shaderProgram),E?(o.bindFramebuffer(o.FRAMEBUFFER,this._glFrameBuffer),o.clear(o.COLOR_BUFFER_BIT)):o.bindFramebuffer(o.FRAMEBUFFER,null);let R=f,M=m.getRotation(!0);if(M%360!==0){let D=t.Mat3.makeRotation(-M*Math.PI/180),C=m.getBoundsNoRotate(!0).getCenter(),I=t.Mat3.makeTranslation(C.x,C.y),L=t.Mat3.makeTranslation(-C.x,-C.y),W=I.multiply(D).multiply(L);R=f.multiply(W)}let O=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS);if(O<=0)throw new Error(`WegGL error: bad value for gl parameter MAX_TEXTURE_IMAGE_UNITS (${O}). This could happen
                        if too many contexts have been created and not released, or there is another problem with the graphics card.`);let N=new Float32Array(O*12),B=new Array(O),G=new Array(O),K=new Array(O);for(let D=0;D<v.length;D++){let C=v[D].tile,I=D%O,L=I+1,W=C.getCanvasContext(),U=W?this._TextureMap.get(W.canvas):null;if(U||(this._tileReadyHandler({tile:C,tiledImage:m}),U=W?this._TextureMap.get(W.canvas):null),U&&this._getTileData(C,m,U,R,I,N,B,G,K),L===O||D===v.length-1){for(let V=0;V<=L;V++)o.activeTexture(o.TEXTURE0+V),o.bindTexture(o.TEXTURE_2D,B[V]);o.bindBuffer(o.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),o.bufferData(o.ARRAY_BUFFER,N,o.DYNAMIC_DRAW),G.forEach((V,ie)=>{o.uniformMatrix3fv(this._firstPass.uTransformMatrices[ie],!1,V)}),o.uniform1fv(this._firstPass.uOpacities,new Float32Array(K)),o.bindBuffer(o.ARRAY_BUFFER,this._firstPass.bufferOutputPosition),o.vertexAttribPointer(this._firstPass.aOutputPosition,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),o.vertexAttribPointer(this._firstPass.aTexturePosition,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._firstPass.bufferIndex),o.vertexAttribPointer(this._firstPass.aIndex,1,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,6*L)}}E&&(o.useProgram(this._secondPass.shaderProgram),o.bindFramebuffer(o.FRAMEBUFFER,null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this._renderToTexture),this._gl.uniform1f(this._secondPass.uOpacityMultiplier,m.opacity),o.bindBuffer(o.ARRAY_BUFFER,this._secondPass.bufferTexturePosition),o.vertexAttribPointer(this._secondPass.aTexturePosition,2,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._secondPass.bufferOutputPosition),o.vertexAttribPointer(this._secondPass.aOutputPosition,2,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,6)),p=!0,_&&(this._applyContext2dPipeline(m,v,g),p=!1,o.bindFramebuffer(o.FRAMEBUFFER,null),o.clear(o.COLOR_BUFFER_BIT)),g===0&&this._raiseTiledImageDrawnEvent(m,v.map(D=>D.tile))}}),p&&this._outputContext.drawImage(this._renderingCanvas,0,0)}setImageSmoothingEnabled(n){this._imageSmoothingEnabled!==n&&(this._imageSmoothingEnabled=n,this._unloadTextures(),this.viewer.world.draw())}drawDebuggingRect(n){let o=this._outputContext;o.save(),o.lineWidth=2*t.pixelDensityRatio,o.strokeStyle=this.debugGridColor[0],o.fillStyle=this.debugGridColor[0],o.strokeRect(n.x*t.pixelDensityRatio,n.y*t.pixelDensityRatio,n.width*t.pixelDensityRatio,n.height*t.pixelDensityRatio),o.restore()}_getTextureDataFromTile(n){return n.getCanvasContext().canvas}_applyContext2dPipeline(n,o,a){if(this._outputContext.save(),this._outputContext.globalCompositeOperation=a===0?null:n.compositeOperation||this.viewer.compositeOperation,n._croppingPolygons||n._clip?(this._renderToClippingCanvas(n),this._outputContext.drawImage(this._clippingCanvas,0,0)):this._outputContext.drawImage(this._renderingCanvas,0,0),this._outputContext.restore(),n.debugMode){const l=this.viewer.viewport.getFlip();l&&this._flip(),this._drawDebugInfo(o,n,l),l&&this._flip()}}_getTileData(n,o,a,l,h,u,c,d,f){let p=a.texture,m=a.position;u.set(m,h*12);let g=this._calculateOverlapFraction(n,o),v=n.positionedBounds.width*g.x,x=n.positionedBounds.height*g.y,_=n.positionedBounds.x+(n.x===0?0:v),E=n.positionedBounds.y+(n.y===0?0:x),R=n.positionedBounds.x+n.positionedBounds.width-(n.isRightMost?0:v),M=n.positionedBounds.y+n.positionedBounds.height-(n.isBottomMost?0:x),O=R-_,N=M-E,B=new t.Mat3([O,0,0,0,N,0,_,E,1]);if(n.flipped){let K=t.Mat3.makeTranslation(.5,0),D=t.Mat3.makeTranslation(-.5,0),C=K.multiply(t.Mat3.makeScaling(-1,1)).multiply(D);B=B.multiply(C)}let G=l.multiply(B);f[h]=n.opacity,c[h]=p,d[h]=G.values}_textureFilter(){return this._imageSmoothingEnabled?this._gl.LINEAR:this._gl.NEAREST}_setupRenderer(){let n=this._gl;n||t.console.error("_setupCanvases must be called before _setupRenderer"),this._unitQuad=this._makeQuadVertexBuffer(0,1,0,1),this._makeFirstPassShaderProgram(),this._makeSecondPassShaderProgram(),this._renderToTexture=n.createTexture(),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this._renderToTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this._renderingCanvas.width,this._renderingCanvas.height,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this._textureFilter()),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this._glFrameBuffer=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,this._glFrameBuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this._renderToTexture,0),n.enable(n.BLEND),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA)}_makeFirstPassShaderProgram(){let n=this._glNumTextures=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),o=()=>[...Array(n).keys()].map(p=>`uniform mat3 u_matrix_${p};`).join(`
`),a=()=>[...Array(n).keys()].map(p=>`${p>0?"else ":""}if(int(a_index) == ${p}) { transform_matrix = u_matrix_${p}; }`).join(`
`);const l=`
            attribute vec2 a_output_position;
            attribute vec2 a_texture_position;
            attribute float a_index;

            ${o()} // create a uniform mat3 for each potential tile to draw

            varying vec2 v_texture_position;
            varying float v_image_index;

            void main() {

                mat3 transform_matrix; // value will be set by the if/elses in makeConditional()

                ${a()}

                gl_Position = vec4(transform_matrix * vec3(a_output_position, 1), 1);

                v_texture_position = a_texture_position;
                v_image_index = a_index;
            }
            `,h=`
            precision mediump float;

            // our textures
            uniform sampler2D u_images[${n}];
            // our opacities
            uniform float u_opacities[${n}];

            // the varyings passed in from the vertex shader.
            varying vec2 v_texture_position;
            varying float v_image_index;

            void main() {
                // can't index directly with a variable, need to use a loop iterator hack
                for(int i = 0; i < ${n}; ++i){
                    if(i == int(v_image_index)){
                        gl_FragColor = texture2D(u_images[i], v_texture_position) * u_opacities[i];
                    }
                }
            }
            `;let u=this._gl,c=this.constructor.initShaderProgram(u,l,h);u.useProgram(c),this._firstPass={shaderProgram:c,aOutputPosition:u.getAttribLocation(c,"a_output_position"),aTexturePosition:u.getAttribLocation(c,"a_texture_position"),aIndex:u.getAttribLocation(c,"a_index"),uTransformMatrices:[...Array(this._glNumTextures).keys()].map(p=>u.getUniformLocation(c,`u_matrix_${p}`)),uImages:u.getUniformLocation(c,"u_images"),uOpacities:u.getUniformLocation(c,"u_opacities"),bufferOutputPosition:u.createBuffer(),bufferTexturePosition:u.createBuffer(),bufferIndex:u.createBuffer()},u.uniform1iv(this._firstPass.uImages,[...Array(n).keys()]);let d=new Float32Array(n*12);for(let p=0;p<n;++p)d.set(Float32Array.from(this._unitQuad),p*12);u.bindBuffer(u.ARRAY_BUFFER,this._firstPass.bufferOutputPosition),u.bufferData(u.ARRAY_BUFFER,d,u.STATIC_DRAW),u.enableVertexAttribArray(this._firstPass.aOutputPosition),u.bindBuffer(u.ARRAY_BUFFER,this._firstPass.bufferTexturePosition),u.enableVertexAttribArray(this._firstPass.aTexturePosition),u.bindBuffer(u.ARRAY_BUFFER,this._firstPass.bufferIndex);let f=[...Array(this._glNumTextures).keys()].map(p=>Array(6).fill(p)).flat();u.bufferData(u.ARRAY_BUFFER,new Float32Array(f),u.STATIC_DRAW),u.enableVertexAttribArray(this._firstPass.aIndex)}_makeSecondPassShaderProgram(){const n=`
            attribute vec2 a_output_position;
            attribute vec2 a_texture_position;

            uniform mat3 u_matrix;

            varying vec2 v_texture_position;

            void main() {
                gl_Position = vec4(u_matrix * vec3(a_output_position, 1), 1);

                v_texture_position = a_texture_position;
            }
            `,o=`
            precision mediump float;

            // our texture
            uniform sampler2D u_image;

            // the texCoords passed in from the vertex shader.
            varying vec2 v_texture_position;

            // the opacity multiplier for the image
            uniform float u_opacity_multiplier;

            void main() {
                gl_FragColor = texture2D(u_image, v_texture_position);
                gl_FragColor *= u_opacity_multiplier;
            }
            `;let a=this._gl,l=this.constructor.initShaderProgram(a,n,o);a.useProgram(l),this._secondPass={shaderProgram:l,aOutputPosition:a.getAttribLocation(l,"a_output_position"),aTexturePosition:a.getAttribLocation(l,"a_texture_position"),uMatrix:a.getUniformLocation(l,"u_matrix"),uImage:a.getUniformLocation(l,"u_image"),uOpacityMultiplier:a.getUniformLocation(l,"u_opacity_multiplier"),bufferOutputPosition:a.createBuffer(),bufferTexturePosition:a.createBuffer()},a.bindBuffer(a.ARRAY_BUFFER,this._secondPass.bufferOutputPosition),a.bufferData(a.ARRAY_BUFFER,this._unitQuad,a.STATIC_DRAW),a.enableVertexAttribArray(this._secondPass.aOutputPosition),a.bindBuffer(a.ARRAY_BUFFER,this._secondPass.bufferTexturePosition),a.bufferData(a.ARRAY_BUFFER,this._unitQuad,a.DYNAMIC_DRAW),a.enableVertexAttribArray(this._secondPass.aTexturePosition);let h=t.Mat3.makeScaling(2,2).multiply(t.Mat3.makeTranslation(-.5,-.5));a.uniformMatrix3fv(this._secondPass.uMatrix,!1,h.values)}_resizeRenderer(){let n=this._gl,o=this._renderingCanvas.width,a=this._renderingCanvas.height;n.viewport(0,0,o,a),n.deleteTexture(this._renderToTexture),this._renderToTexture=n.createTexture(),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this._renderToTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,o,a,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this._textureFilter()),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindFramebuffer(n.FRAMEBUFFER,this._glFrameBuffer),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this._renderToTexture,0)}_setupCanvases(){let n=this;this._outputCanvas=this.canvas,this._outputContext=this._outputCanvas.getContext("2d"),this._renderingCanvas=document.createElement("canvas"),this._clippingCanvas=document.createElement("canvas"),this._clippingContext=this._clippingCanvas.getContext("2d"),this._renderingCanvas.width=this._clippingCanvas.width=this._outputCanvas.width,this._renderingCanvas.height=this._clippingCanvas.height=this._outputCanvas.height,this._gl=this._renderingCanvas.getContext("webgl"),this._resizeHandler=function(){n._outputCanvas!==n.viewer.drawer.canvas&&(n._outputCanvas.style.width=n.viewer.drawer.canvas.clientWidth+"px",n._outputCanvas.style.height=n.viewer.drawer.canvas.clientHeight+"px");let o=n._calculateCanvasSize();(n._outputCanvas.width!==o.x||n._outputCanvas.height!==o.y)&&(n._outputCanvas.width=o.x,n._outputCanvas.height=o.y),n._renderingCanvas.style.width=n._outputCanvas.clientWidth+"px",n._renderingCanvas.style.height=n._outputCanvas.clientHeight+"px",n._renderingCanvas.width=n._clippingCanvas.width=n._outputCanvas.width,n._renderingCanvas.height=n._clippingCanvas.height=n._outputCanvas.height,n._resizeRenderer()},this.viewer.addHandler("resize",this._resizeHandler)}_makeQuadVertexBuffer(n,o,a,l){return new Float32Array([n,l,o,l,n,a,n,a,o,l,o,a])}_tileReadyHandler(n){let o=n.tile,a=n.tiledImage;if(a.isTainted())return;let l=o.getCanvasContext(),h=l&&l.canvas;if(!h||t.isCanvasTainted(h)){a.isTainted()||(a.setTainted(!0),t.console.warn("WebGL cannot be used to draw this TiledImage because it has tainted data. Does crossOriginPolicy need to be set?"),this._raiseDrawerErrorEvent(a,"Tainted data cannot be used by the WebGLDrawer. Falling back to CanvasDrawer for this TiledImage."));return}if(!this._TextureMap.get(h)){let c=this._gl,d=c.createTexture(),f,p=a.source.tileOverlap,m,g;if(o.sourceBounds?(m=Math.min(o.sourceBounds.width,h.width)/h.width,g=Math.min(o.sourceBounds.height,h.height)/h.height):(m=1,g=1),p>0){let x=this._calculateOverlapFraction(o,a),_=(o.x===0?0:x.x)*m,E=(o.y===0?0:x.y)*g,R=(o.isRightMost?1:1-x.x)*m,M=(o.isBottomMost?1:1-x.y)*g;f=this._makeQuadVertexBuffer(_,R,E,M)}else m===1&&g===1?f=this._unitQuad:f=this._makeQuadVertexBuffer(0,m,0,g);let v={texture:d,position:f};this._TextureMap.set(h,v),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,d),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this._textureFilter()),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,this._textureFilter()),this._uploadImageData(l)}}_calculateOverlapFraction(n,o){let a=o.source.tileOverlap,l=n.sourceBounds.width,h=n.sourceBounds.height,u=(n.x===0?0:a)+(n.isRightMost?0:a),c=(n.y===0?0:a)+(n.isBottomMost?0:a),d=a/(l+u),f=a/(h+c);return{x:d,y:f}}_unloadTextures(){Array.from(this._TextureMap.keys()).forEach(o=>{this._cleanupImageData(o)})}_uploadImageData(n){let o=this._gl,a=n.canvas;try{if(!a)throw n;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a)}catch(l){t.console.error("Error uploading image data to WebGL",l)}}_imageUnloadedHandler(n){let o=n.context2D.canvas;this._cleanupImageData(o)}_cleanupImageData(n){let o=this._TextureMap.get(n);this._TextureMap.delete(n),o&&this._gl.deleteTexture(o.texture)}_setClip(){}_renderToClippingCanvas(n){if(this._clippingContext.clearRect(0,0,this._clippingCanvas.width,this._clippingCanvas.height),this._clippingContext.save(),this.viewer.viewport.getFlip()){const o=new t.Point(this.canvas.width/2,this.canvas.height/2);this._clippingContext.translate(o.x,0),this._clippingContext.scale(-1,1),this._clippingContext.translate(-o.x,0)}if(n._clip){let a=[{x:n._clip.x,y:n._clip.y},{x:n._clip.x+n._clip.width,y:n._clip.y},{x:n._clip.x+n._clip.width,y:n._clip.y+n._clip.height},{x:n._clip.x,y:n._clip.y+n._clip.height}].map(l=>{let h=n.imageToViewportCoordinates(l.x,l.y,!0).rotate(this.viewer.viewport.getRotation(!0),this.viewer.viewport.getCenter(!0));return this.viewportCoordToDrawerCoord(h)});this._clippingContext.beginPath(),a.forEach((l,h)=>{this._clippingContext[h===0?"moveTo":"lineTo"](l.x,l.y)}),this._clippingContext.clip(),this._setClip()}if(n._croppingPolygons){let o=n._croppingPolygons.map(a=>a.map(l=>{let h=n.imageToViewportCoordinates(l.x,l.y,!0).rotate(this.viewer.viewport.getRotation(!0),this.viewer.viewport.getCenter(!0));return this.viewportCoordToDrawerCoord(h)}));this._clippingContext.beginPath(),o.forEach(a=>{a.forEach((l,h)=>{this._clippingContext[h===0?"moveTo":"lineTo"](l.x,l.y)})}),this._clippingContext.clip()}if(this.viewer.viewport.getFlip()){const o=new t.Point(this.canvas.width/2,this.canvas.height/2);this._clippingContext.translate(o.x,0),this._clippingContext.scale(-1,1),this._clippingContext.translate(-o.x,0)}this._clippingContext.drawImage(this._renderingCanvas,0,0),this._clippingContext.restore()}_setRotations(n){var o=!1;this.viewport.getRotation(!0)%360!==0&&(this._offsetForRotation({degrees:this.viewport.getRotation(!0),saveContext:o}),o=!1),n.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:n.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(n._getRotationPoint(!0),!0),saveContext:o})}_offsetForRotation(n){var o=n.point?n.point.times(t.pixelDensityRatio):this._getCanvasCenter(),a=this._outputContext;a.save(),a.translate(o.x,o.y),a.rotate(Math.PI/180*n.degrees),a.translate(-o.x,-o.y)}_flip(n){n=n||{};var o=n.point?n.point.times(t.pixelDensityRatio):this._getCanvasCenter(),a=this._outputContext;a.translate(o.x,0),a.scale(-1,1),a.translate(-o.x,0)}_drawDebugInfo(n,o,a){for(var l=n.length-1;l>=0;l--){var h=n[l].tile;try{this._drawDebugInfoOnTile(h,n.length,l,o,a)}catch(u){t.console.error(u)}}}_drawDebugInfoOnTile(n,o,a,l,h){var u=this.viewer.world.getIndexOfItem(l)%this.debugGridColor.length,c=this.context;c.save(),c.lineWidth=2*t.pixelDensityRatio,c.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",c.strokeStyle=this.debugGridColor[u],c.fillStyle=this.debugGridColor[u],this._setRotations(l),h&&this._flip({point:n.position.plus(n.size.divide(2))}),c.strokeRect(n.position.x*t.pixelDensityRatio,n.position.y*t.pixelDensityRatio,n.size.x*t.pixelDensityRatio,n.size.y*t.pixelDensityRatio);var d=(n.position.x+n.size.x/2)*t.pixelDensityRatio,f=(n.position.y+n.size.y/2)*t.pixelDensityRatio;c.translate(d,f);const p=this.viewport.getRotation(!0);c.rotate(Math.PI/180*-p),c.translate(-d,-f),n.x===0&&n.y===0&&(c.fillText("Zoom: "+this.viewport.getZoom(),n.position.x*t.pixelDensityRatio,(n.position.y-30)*t.pixelDensityRatio),c.fillText("Pan: "+this.viewport.getBounds().toString(),n.position.x*t.pixelDensityRatio,(n.position.y-20)*t.pixelDensityRatio)),c.fillText("Level: "+n.level,(n.position.x+10)*t.pixelDensityRatio,(n.position.y+20)*t.pixelDensityRatio),c.fillText("Column: "+n.x,(n.position.x+10)*t.pixelDensityRatio,(n.position.y+30)*t.pixelDensityRatio),c.fillText("Row: "+n.y,(n.position.x+10)*t.pixelDensityRatio,(n.position.y+40)*t.pixelDensityRatio),c.fillText("Order: "+a+" of "+o,(n.position.x+10)*t.pixelDensityRatio,(n.position.y+50)*t.pixelDensityRatio),c.fillText("Size: "+n.size.toString(),(n.position.x+10)*t.pixelDensityRatio,(n.position.y+60)*t.pixelDensityRatio),c.fillText("Position: "+n.position.toString(),(n.position.x+10)*t.pixelDensityRatio,(n.position.y+70)*t.pixelDensityRatio),this.viewport.getRotation(!0)%360!==0&&this._restoreRotationChanges(),l.getRotation(!0)%360!==0&&this._restoreRotationChanges(),c.restore()}_drawPlaceholder(n){const o=n.getBounds(!0),a=this.viewportToDrawerRectangle(n.getBounds(!0)),l=this._outputContext;let h;typeof n.placeholderFillStyle=="function"?h=n.placeholderFillStyle(n,l):h=n.placeholderFillStyle,this._offsetForRotation({degrees:this.viewer.viewport.getRotation(!0)}),l.fillStyle=h,l.translate(a.x,a.y),l.rotate(Math.PI/180*o.degrees),l.translate(-a.x,-a.y),l.fillRect(a.x,a.y,a.width,a.height),this._restoreRotationChanges()}_getCanvasCenter(){return new t.Point(this.canvas.width/2,this.canvas.height/2)}_restoreRotationChanges(){var n=this._outputContext;n.restore()}static initShaderProgram(n,o,a){function l(d,f,p){const m=d.createShader(f);return d.shaderSource(m,p),d.compileShader(m),d.getShaderParameter(m,d.COMPILE_STATUS)?m:(t.console.error(`An error occurred compiling the shaders: ${d.getShaderInfoLog(m)}`),d.deleteShader(m),null)}const h=l(n,n.VERTEX_SHADER,o),u=l(n,n.FRAGMENT_SHADER,a),c=n.createProgram();return n.attachShader(c,h),n.attachShader(c,u),n.linkProgram(c),n.getProgramParameter(c,n.LINK_STATUS)?c:(t.console.error(`Unable to initialize the shader program: ${n.getProgramInfoLog(c)}`),null)}}}(e),function(t){t.Viewport=function(i){var r=arguments;r.length&&r[0]instanceof t.Point&&(i={containerSize:r[0],contentSize:r[1],config:r[2]}),i.config&&(t.extend(!0,i,i.config),delete i.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i.margins||{}),delete i.margins,i.initialDegrees=i.degrees,delete i.degrees,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,rotationPivot:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,initialDegrees:t.DEFAULT_SETTINGS.degrees,flipped:t.DEFAULT_SETTINGS.flipped,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:t.DEFAULT_SETTINGS.silenceMultiImageWarnings},i),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.degreesSpring=new t.Spring({initial:i.initialDegrees,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={get degrees(){return t.console.warn("Accessing [Viewport.degrees] is deprecated. Use viewport.getRotation instead."),this.getRotation()},set degrees(i){t.console.warn("Setting [Viewport.degrees] is deprecated. Use viewport.rotateTo, viewport.rotateBy, or viewport.setRotation instead."),this.rotateTo(i)},resetContentSize:function(i){return t.console.assert(i,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(i instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(i.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(i.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,i.y/i.x),i.x),this},setHomeBounds:function(i,r){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(i,r)},_setContentBounds:function(i,r){t.console.assert(i,"[Viewport._setContentBounds] bounds is required"),t.console.assert(i instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(i.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(i.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=i.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(r),this._contentBounds=i.rotate(this.getRotation()).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(r),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:r,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var i=this._contentAspectRatio/this.getAspectRatio(),r;return this.homeFillsViewer?r=i>=1?i:1:r=i>=1?1:i,r/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var i=this._contentBounds.getCenter(),r=1/this.getHomeZoom(),n=r/this.getAspectRatio();return new t.Rect(i.x-r/2,i.y-n/2,r,n)},goHome:function(i){return this.viewer&&this.viewer.raiseEvent("home",{immediately:i}),this.fitBounds(this.getHomeBounds(),i)},getMinZoom:function(){var i=this.getHomeZoom(),r=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*i;return r},getMaxZoom:function(){var i=this.maxZoomLevel;return i||(i=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,i/=this._contentBounds.width),Math.max(i,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(i){t.console.assert(t.type(i)==="object","[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},i),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(-this.getRotation(i))},getBoundsNoRotate:function(i){var r=this.getCenter(i),n=1/this.getZoom(i),o=n/this.getAspectRatio();return new t.Rect(r.x-n/2,r.y-o/2,n,o)},getBoundsWithMargins:function(i){return this.getBoundsNoRotateWithMargins(i).rotate(-this.getRotation(i),this.getCenter(i))},getBoundsNoRotateWithMargins:function(i){var r=this.getBoundsNoRotate(i),n=this._containerInnerSize.x*this.getZoom(i);return r.x-=this._margins.left/n,r.y-=this._margins.top/n,r.width+=(this._margins.left+this._margins.right)/n,r.height+=(this._margins.top+this._margins.bottom)/n,r},getCenter:function(i){var r=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),n=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),o,a,l,h,u,c,d,f;return i?r:this.zoomPoint?(o=this.pixelFromPoint(this.zoomPoint,!0),a=this.getZoom(),l=1/a,h=l/this.getAspectRatio(),u=new t.Rect(r.x-l/2,r.y-h/2,l,h),c=this._pixelFromPoint(this.zoomPoint,u),d=c.minus(o).rotate(-this.getRotation(!0)),f=d.divide(this._containerInnerSize.x*a),n.plus(f)):n},getZoom:function(i){return i?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(i){return Math.max(Math.min(i,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(i){var r=this.viewportToViewerElementRectangle(i).getBoundingBox(),n=this.viewportToViewerElementRectangle(this._contentBoundsNoRotate).getBoundingBox(),o=!1,a=!1;if(!this.wrapHorizontal){var l=r.x+r.width,h=n.x+n.width,u,c,d;r.width>n.width?u=this.visibilityRatio*n.width:u=this.visibilityRatio*r.width,c=n.x-l+u,d=h-r.x-u,u>n.width?(r.x+=(c+d)/2,o=!0):d<0?(r.x+=d,o=!0):c>0&&(r.x+=c,o=!0)}if(!this.wrapVertical){var f=r.y+r.height,p=n.y+n.height,m,g,v;r.height>n.height?m=this.visibilityRatio*n.height:m=this.visibilityRatio*r.height,g=n.y-f+m,v=p-r.y-m,m>n.height?(r.y+=(g+v)/2,a=!0):v<0?(r.y+=v,a=!0):g>0&&(r.y+=g,a=!0)}var x=o||a,_=x?this.viewerElementToViewportRectangle(r):i.clone();return _.xConstrained=o,_.yConstrained=a,_.constraintApplied=x,_},_raiseConstraintsEvent:function(i){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:i})},applyConstraints:function(i){var r=this.getZoom(),n=this._applyZoomConstraints(r);r!==n&&this.zoomTo(n,this.zoomPoint,i);var o=this.getConstrainedBounds(!1);return o.constraintApplied&&(this.fitBounds(o,i),this._raiseConstraintsEvent(i)),this},ensureVisible:function(i){return this.applyConstraints(i)},_fitBounds:function(i,r){r=r||{};var n=r.immediately||!1,o=r.constraints||!1,a=this.getAspectRatio(),l=i.getCenter(),h=new t.Rect(i.x,i.y,i.width,i.height,i.degrees+this.getRotation()).getBoundingBox();h.getAspectRatio()>=a?h.height=h.width/a:h.width=h.height*a,h.x=l.x-h.width/2,h.y=l.y-h.height/2;var u=1/h.width;if(n)return this.panTo(l,!0),this.zoomTo(u,null,!0),o&&this.applyConstraints(!0),this;var c=this.getCenter(!0),d=this.getZoom(!0);this.panTo(c,!0),this.zoomTo(d,null,!0);var f=this.getBounds(),p=this.getZoom();if(p===0||Math.abs(u/p-1)<1e-8)return this.zoomTo(u,null,!0),this.panTo(l,n),o&&this.applyConstraints(!1),this;if(o){this.panTo(l,!1),u=this._applyZoomConstraints(u),this.zoomTo(u,null,!1);var m=this.getConstrainedBounds();this.panTo(c,!0),this.zoomTo(d,null,!0),this.fitBounds(m)}else{var g=h.rotate(-this.getRotation()),v=g.getTopLeft().times(u).minus(f.getTopLeft().times(p)).divide(u-p);this.zoomTo(u,v,n)}return this},fitBounds:function(i,r){return this._fitBounds(i,{immediately:r,constraints:!1})},fitBoundsWithConstraints:function(i,r){return this._fitBounds(i,{immediately:r,constraints:!0})},fitVertically:function(i){var r=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(r,i)},fitHorizontally:function(i){var r=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(r,i)},getConstrainedBounds:function(i){var r,n;return r=this.getBounds(i),n=this._applyBoundaryConstraints(r),n},panBy:function(i,r){var n=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(i),r)},panTo:function(i,r){return r?(this.centerSpringX.resetTo(i.x),this.centerSpringY.resetTo(i.y)):(this.centerSpringX.springTo(i.x),this.centerSpringY.springTo(i.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:i,immediately:r}),this},zoomBy:function(i,r,n){return this.zoomTo(this.zoomSpring.target.value*i,r,n)},zoomTo:function(i,r,n){var o=this;return this.zoomPoint=r instanceof t.Point&&!isNaN(r.x)&&!isNaN(r.y)?r:null,n?this._adjustCenterSpringsForZoomPoint(function(){o.zoomSpring.resetTo(i)}):this.zoomSpring.springTo(i),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:i,refPoint:r,immediately:n}),this},setRotation:function(i,r){return this.rotateTo(i,null,r)},getRotation:function(i){return i?this.degreesSpring.current.value:this.degreesSpring.target.value},setRotationWithPivot:function(i,r,n){return this.rotateTo(i,r,n)},rotateTo:function(i,r,n){if(!this.viewer||!this.viewer.drawer.canRotate())return this;if(this.degreesSpring.target.value===i&&this.degreesSpring.isAtTargetValue())return this;if(this.rotationPivot=r instanceof t.Point&&!isNaN(r.x)&&!isNaN(r.y)?r:null,n)if(this.rotationPivot){var o=i-this._oldDegrees;if(!o)return this.rotationPivot=null,this;this._rotateAboutPivot(i)}else this.degreesSpring.resetTo(i);else{var a=t.positiveModulo(this.degreesSpring.current.value,360),l=t.positiveModulo(i,360),h=l-a;h>180?l-=360:h<-180&&(l+=360);var u=a-l;this.degreesSpring.resetTo(i+u),this.degreesSpring.springTo(i)}return this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:i,immediately:!!n,pivot:this.rotationPivot||this.getCenter()}),this},rotateBy:function(i,r,n){return this.rotateTo(this.degreesSpring.target.value+i,r,n)},resize:function(i,r){var n=this.getBoundsNoRotate(),o=n,a;this.containerSize.x=i.x,this.containerSize.y=i.y,this._updateContainerInnerSize(),r&&(a=i.x/this.containerSize.x,o.width=n.width*a,o.height=o.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:i,maintain:r});var l=this.fitBounds(o,!0);return this.viewer&&this.viewer.raiseEvent("after-resize",{newContainerSize:i,maintain:r}),l},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var i=this;this._adjustCenterSpringsForZoomPoint(function(){i.zoomSpring.update()}),this.degreesSpring.isAtTargetValue()&&(this.rotationPivot=null),this.centerSpringX.update(),this.centerSpringY.update(),this.rotationPivot?this._rotateAboutPivot(!0):this.degreesSpring.update();var r=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom||this.degreesSpring.current.value!==this._oldDegrees;this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._oldDegrees=this.degreesSpring.current.value;var n=r||!this.zoomSpring.isAtTargetValue()||!this.centerSpringX.isAtTargetValue()||!this.centerSpringY.isAtTargetValue()||!this.degreesSpring.isAtTargetValue();return n},_rotateAboutPivot:function(i){var r=i===!0,n=this.rotationPivot.minus(this.getCenter());this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y),r?this.degreesSpring.update():this.degreesSpring.resetTo(i);var o=this.degreesSpring.current.value-this._oldDegrees,a=n.rotate(o*-1).times(-1);this.centerSpringX.shiftBy(a.x),this.centerSpringY.shiftBy(a.y)},_adjustCenterSpringsForZoomPoint:function(i){if(this.zoomPoint){var r=this.pixelFromPoint(this.zoomPoint,!0);i();var n=this.pixelFromPoint(this.zoomPoint,!0),o=n.minus(r),a=this.deltaPointsFromPixels(o,!0);this.centerSpringX.shiftBy(a.x),this.centerSpringY.shiftBy(a.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else i()},deltaPixelsFromPointsNoRotate:function(i,r){return i.times(this._containerInnerSize.x*this.getZoom(r))},deltaPixelsFromPoints:function(i,r){return this.deltaPixelsFromPointsNoRotate(i.rotate(this.getRotation(r)),r)},deltaPointsFromPixelsNoRotate:function(i,r){return i.divide(this._containerInnerSize.x*this.getZoom(r))},deltaPointsFromPixels:function(i,r){return this.deltaPointsFromPixelsNoRotate(i,r).rotate(-this.getRotation(r))},pixelFromPointNoRotate:function(i,r){return this._pixelFromPointNoRotate(i,this.getBoundsNoRotate(r))},pixelFromPoint:function(i,r){return this._pixelFromPoint(i,this.getBoundsNoRotate(r))},_pixelFromPointNoRotate:function(i,r){return i.minus(r.getTopLeft()).times(this._containerInnerSize.x/r.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(i,r){return this._pixelFromPointNoRotate(i.rotate(this.getRotation(!0),this.getCenter(!0)),r)},pointFromPixelNoRotate:function(i,r){var n=this.getBoundsNoRotate(r);return i.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(i,r){return this.pointFromPixelNoRotate(i,r).rotate(-this.getRotation(r),this.getCenter(r))},_viewportToImageDelta:function(i,r){var n=this._contentBoundsNoRotate.width;return new t.Point(i*this._contentSizeNoRotate.x/n,r*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(i,r){if(i instanceof t.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(n===1){var o=this.viewer.world.getItemAt(0);return o.viewportToImageCoordinates(i,r,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,r-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(i,r){var n=this._contentBoundsNoRotate.width;return new t.Point(i/this._contentSizeNoRotate.x*n,r/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(i,r){if(i instanceof t.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(n===1){var o=this.viewer.world.getItemAt(0);return o.imageToViewportCoordinates(i,r,!0)}}var a=this._imageToViewportDelta(i,r);return a.x+=this._contentBoundsNoRotate.x,a.y+=this._contentBoundsNoRotate.y,a},imageToViewportRectangle:function(i,r,n,o){var a=i;if(a instanceof t.Rect||(a=new t.Rect(i,r,n,o)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(l===1){var h=this.viewer.world.getItemAt(0);return h.imageToViewportRectangle(i,r,n,o,!0)}}var u=this.imageToViewportCoordinates(a.x,a.y),c=this._imageToViewportDelta(a.width,a.height);return new t.Rect(u.x,u.y,c.x,c.y,a.degrees)},viewportToImageRectangle:function(i,r,n,o){var a=i;if(a instanceof t.Rect||(a=new t.Rect(i,r,n,o)),this.viewer){var l=this.viewer.world.getItemCount();if(l>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(l===1){var h=this.viewer.world.getItemAt(0);return h.viewportToImageRectangle(i,r,n,o,!0)}}var u=this.viewportToImageCoordinates(a.x,a.y),c=this._viewportToImageDelta(a.width,a.height);return new t.Rect(u.x,u.y,c.x,c.y,a.degrees)},viewerElementToImageCoordinates:function(i){var r=this.pointFromPixel(i,!0);return this.viewportToImageCoordinates(r)},imageToViewerElementCoordinates:function(i){var r=this.imageToViewportCoordinates(i);return this.pixelFromPoint(r,!0)},windowToImageCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var r=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(r)},imageToWindowCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var r=this.imageToViewerElementCoordinates(i);return r.plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(i){return this.pointFromPixel(i,!0)},viewportToViewerElementCoordinates:function(i){return this.pixelFromPoint(i,!0)},viewerElementToViewportRectangle:function(i){return t.Rect.fromSummits(this.pointFromPixel(i.getTopLeft(),!0),this.pointFromPixel(i.getTopRight(),!0),this.pointFromPixel(i.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(i){return t.Rect.fromSummits(this.pixelFromPoint(i.getTopLeft(),!0),this.pixelFromPoint(i.getTopRight(),!0),this.pixelFromPoint(i.getBottomLeft(),!0))},windowToViewportCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var r=i.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(r)},viewportToWindowCoordinates:function(i){t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var r=this.viewportToViewerElementCoordinates(i);return r.plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(r===1){var n=this.viewer.world.getItemAt(0);return n.viewportToImageZoom(i)}}var o=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,l=this._contentBoundsNoRotate.width,h=a/o*l;return i*h},imageToViewportZoom:function(i){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)this.silenceMultiImageWarnings||t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image. Instead, use [TiledImage.imageToViewportZoom] for the specific image of interest");else if(r===1){var n=this.viewer.world.getItemAt(0);return n.imageToViewportZoom(i)}}var o=this._contentSizeNoRotate.x,a=this._containerInnerSize.x,l=this._contentBoundsNoRotate.width,h=o/a/l;return i*h},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(i){return this.flipped===i?this:(this.flipped=i,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:i}),this)},getMaxZoomPixelRatio:function(){return this.maxZoomPixelRatio},setMaxZoomPixelRatio:function(i,r=!0,n=!1){t.console.assert(!isNaN(i),"[Viewport.setMaxZoomPixelRatio] ratio must be a number"),!isNaN(i)&&(this.maxZoomPixelRatio=i,r&&this.getZoom()>this.getMaxZoom()&&this.applyConstraints(n))}}}(e),function(t){t.TiledImage=function(i){this._initialized=!1,t.console.assert(i.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(i.drawer,"[TiledImage] options.drawer is required"),t.console.assert(i.viewer,"[TiledImage] options.viewer is required"),t.console.assert(i.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(i.source,"[TiledImage] options.source is required"),t.console.assert(!i.clip||i.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=i.tileCache,delete i.tileCache,this._drawer=i.drawer,delete i.drawer,this._imageLoader=i.imageLoader,delete i.imageLoader,i.clip instanceof t.Rect&&(this._clip=i.clip.clone()),delete i.clip;var r=i.x||0;delete i.x;var n=i.y||0;delete i.y,this.normHeight=i.source.dimensions.y/i.source.dimensions.x,this.contentAspectX=i.source.dimensions.x/i.source.dimensions.y;var o=1;i.width?(o=i.width,delete i.width,i.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete i.height)):i.height&&(o=i.height/this.normHeight,delete i.height);var a=i.fitBounds;delete i.fitBounds;var l=i.fitBoundsPlacement||e.Placement.CENTER;delete i.fitBoundsPlacement;var h=i.degrees||0;delete i.degrees;var u=i.ajaxHeaders;delete i.ajaxHeaders,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_needsDraw:!0,_needsUpdate:!0,_hasOpaqueTile:!1,_tilesLoading:0,_tilesToDraw:[],_lastDrawn:[],_isBlending:!1,_wasBlending:!1,_isTainted:!1,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:t.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,preload:t.DEFAULT_SETTINGS.preload,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:t.DEFAULT_SETTINGS.subPixelRoundingForTransparency,maxTilesPerFrame:t.DEFAULT_SETTINGS.maxTilesPerFrame},i),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new t.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new t.Spring({initial:h,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),a&&this.fitBounds(a,l,!0),this._ownAjaxHeaders={},this.setAjaxHeaders(u,!1),this._initialized=!0},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},redraw:function(){this._needsDraw=!0},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(i){i!==this._fullyLoaded&&(this._fullyLoaded=i,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(i){let r=this._xSpring.update(),n=this._ySpring.update(),o=this._scaleSpring.update(),a=this._degreesSpring.update(),l=r||n||o||a||this._needsUpdate;if(l||i||!this._fullyLoaded){let h=this._updateLevelsForViewport();this._setFullyLoaded(h)}return this._needsUpdate=!1,l?(this._updateForScale(),this._raiseBoundsChange(),this._needsDraw=!0,!0):!1},setDrawn:function(){return this._needsDraw=this._isBlending||this._wasBlending,this._needsDraw},setTainted(i){this._isTainted=i},isTainted(){return this._isTainted},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy(this.viewer)},getBounds:function(i){return this.getBoundsNoRotate(i).rotate(this.getRotation(i),this._getRotationPoint(i))},getBoundsNoRotate:function(i){return i?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(i){var r=this.getBoundsNoRotate(i);if(this._clip){var n=i?this._worldWidthCurrent:this._worldWidthTarget,o=n/this.source.dimensions.x,a=this._clip.times(o);r=new t.Rect(r.x+a.x,r.y+a.y,a.width,a.height)}return r.rotate(this.getRotation(i),this._getRotationPoint(i))},getTileBounds:function(i,r,n){var o=this.source.getNumTiles(i),a=(o.x+r%o.x)%o.x,l=(o.y+n%o.y)%o.y,h=this.source.getTileBounds(i,a,l);return this.getFlip()&&(h.x=Math.max(0,1-h.x-h.width)),h.x+=(r-a)/o.x,h.y+=this._worldHeightCurrent/this._worldWidthCurrent*((n-l)/o.y),h},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var i=this.imageToWindowCoordinates(new t.Point(0,0)),r=this.imageToWindowCoordinates(this.getContentSize());return new t.Point(r.x-i.x,r.y-i.y)},_viewportToImageDelta:function(i,r,n){var o=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(i*(this.source.dimensions.x/o),r*(this.source.dimensions.y*this.contentAspectX/o))},viewportToImageCoordinates:function(i,r,n){var o;return i instanceof t.Point?(n=r,o=i):o=new t.Point(i,r),o=o.rotate(-this.getRotation(n),this._getRotationPoint(n)),n?this._viewportToImageDelta(o.x-this._xSpring.current.value,o.y-this._ySpring.current.value):this._viewportToImageDelta(o.x-this._xSpring.target.value,o.y-this._ySpring.target.value)},_imageToViewportDelta:function(i,r,n){var o=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(i/this.source.dimensions.x*o,r/this.source.dimensions.y/this.contentAspectX*o)},imageToViewportCoordinates:function(i,r,n){i instanceof t.Point&&(n=r,r=i.y,i=i.x);var o=this._imageToViewportDelta(i,r,n);return n?(o.x+=this._xSpring.current.value,o.y+=this._ySpring.current.value):(o.x+=this._xSpring.target.value,o.y+=this._ySpring.target.value),o.rotate(this.getRotation(n),this._getRotationPoint(n))},imageToViewportRectangle:function(i,r,n,o,a){var l=i;l instanceof t.Rect?a=r:l=new t.Rect(i,r,n,o);var h=this.imageToViewportCoordinates(l.getTopLeft(),a),u=this._imageToViewportDelta(l.width,l.height,a);return new t.Rect(h.x,h.y,u.x,u.y,l.degrees+this.getRotation(a))},viewportToImageRectangle:function(i,r,n,o,a){var l=i;i instanceof t.Rect?a=r:l=new t.Rect(i,r,n,o);var h=this.viewportToImageCoordinates(l.getTopLeft(),a),u=this._viewportToImageDelta(l.width,l.height,a);return new t.Rect(h.x,h.y,u.x,u.y,l.degrees-this.getRotation(a))},viewerElementToImageCoordinates:function(i){var r=this.viewport.pointFromPixel(i,!0);return this.viewportToImageCoordinates(r)},imageToViewerElementCoordinates:function(i){var r=this.imageToViewportCoordinates(i);return this.viewport.pixelFromPoint(r,!0)},windowToImageCoordinates:function(i){var r=i.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(r)},imageToWindowCoordinates:function(i){var r=this.imageToViewerElementCoordinates(i);return r.plus(e.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(i){var r=this._scaleSpring.current.value;return i=i.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new t.Rect((i.x-this._xSpring.current.value)/r,(i.y-this._ySpring.current.value)/r,i.width/r,i.height/r,i.degrees)},viewportToImageZoom:function(i){var r=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return r*i},imageToViewportZoom:function(i){var r=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return i/r},setPosition:function(i,r){var n=this._xSpring.target.value===i.x&&this._ySpring.target.value===i.y;if(r){if(n&&this._xSpring.current.value===i.x&&this._ySpring.current.value===i.y)return;this._xSpring.resetTo(i.x),this._ySpring.resetTo(i.y),this._needsDraw=!0,this._needsUpdate=!0}else{if(n)return;this._xSpring.springTo(i.x),this._ySpring.springTo(i.y),this._needsDraw=!0,this._needsUpdate=!0}n||this._raiseBoundsChange()},setWidth:function(i,r){this._setScale(i,r)},setHeight:function(i,r){this._setScale(i/this.normHeight,r)},setCroppingPolygons:function(i){var r=function(o){return o instanceof t.Point||typeof o.x=="number"&&typeof o.y=="number"},n=function(o){return o.map(function(a){try{if(r(a))return{x:a.x,y:a.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!t.isArray(i))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=i.map(function(o){return n(o)}),this._needsDraw=!0}catch(o){t.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),t.console.error(o),this.resetCroppingPolygons()}},resetCroppingPolygons:function(){this._croppingPolygons=null,this._needsDraw=!0},fitBounds:function(i,r,n){r=r||t.Placement.CENTER;var o=t.Placement.properties[r],a=this.contentAspectX,l=0,h=0,u=1,c=1;if(this._clip&&(a=this._clip.getAspectRatio(),u=this._clip.width/this.source.dimensions.x,c=this._clip.height/this.source.dimensions.y,i.getAspectRatio()>a?(l=this._clip.x/this._clip.height*i.height,h=this._clip.y/this._clip.height*i.height):(l=this._clip.x/this._clip.width*i.width,h=this._clip.y/this._clip.width*i.width)),i.getAspectRatio()>a){var d=i.height/c,f=0;o.isHorizontallyCentered?f=(i.width-i.height*a)/2:o.isRight&&(f=i.width-i.height*a),this.setPosition(new t.Point(i.x-l+f,i.y-h),n),this.setHeight(d,n)}else{var p=i.width/u,m=0;o.isVerticallyCentered?m=(i.height-i.width/a)/2:o.isBottom&&(m=i.height-i.width/a),this.setPosition(new t.Point(i.x-l,i.y-h+m),n),this.setWidth(p,n)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(i){t.console.assert(!i||i instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),i instanceof t.Rect?this._clip=i.clone():this._clip=null,this._needsUpdate=!0,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return this.flipped},setFlip:function(i){this.flipped=i},get flipped(){return this._flipped},set flipped(i){let r=this._flipped!==!!i;this._flipped=!!i,r&&(this.update(!0),this._needsDraw=!0,this._raiseBoundsChange())},get wrapHorizontal(){return this._wrapHorizontal},set wrapHorizontal(i){let r=this._wrapHorizontal!==!!i;this._wrapHorizontal=!!i,this._initialized&&r&&(this.update(!0),this._needsDraw=!0)},get wrapVertical(){return this._wrapVertical},set wrapVertical(i){let r=this._wrapVertical!==!!i;this._wrapVertical=!!i,this._initialized&&r&&(this.update(!0),this._needsDraw=!0)},get debugMode(){return this._debugMode},set debugMode(i){this._debugMode=!!i,this._needsDraw=!0},getOpacity:function(){return this.opacity},setOpacity:function(i){this.opacity=i},get opacity(){return this._opacity},set opacity(i){i!==this.opacity&&(this._opacity=i,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(i){this._preload=!!i,this._needsDraw=!0},getRotation:function(i){return i?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(i,r){this._degreesSpring.target.value===i&&this._degreesSpring.isAtTargetValue()||(r?this._degreesSpring.resetTo(i):this._degreesSpring.springTo(i),this._needsDraw=!0,this._needsUpdate=!0,this._raiseBoundsChange())},getDrawArea:function(){if(this._opacity===0&&!this._preload)return!1;var i=this._viewportToTiledImageRectangle(this.viewport.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var r=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));i=i.intersection(r)}return i},getTilesToDraw:function(){let i=this._tilesToDraw.flat();return this._updateTilesInViewport(i),i=this._tilesToDraw.flat(),i.forEach(r=>{r.tile.beingDrawn=!0}),this._lastDrawn=i,i},_getRotationPoint:function(i){return this.getBoundsNoRotate(i).getCenter()},get compositeOperation(){return this._compositeOperation},set compositeOperation(i){i!==this._compositeOperation&&(this._compositeOperation=i,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this._compositeOperation}))},getCompositeOperation:function(){return this._compositeOperation},setCompositeOperation:function(i){this.compositeOperation=i},setAjaxHeaders:function(i,r){if(i===null&&(i={}),!t.isPlainObject(i)){console.error("[TiledImage.setAjaxHeaders] Ignoring invalid headers, must be a plain object");return}this._ownAjaxHeaders=i,this._updateAjaxHeaders(r)},_updateAjaxHeaders:function(i){if(i===void 0&&(i=!0),t.isPlainObject(this.viewer.ajaxHeaders)?this.ajaxHeaders=t.extend({},this.viewer.ajaxHeaders,this._ownAjaxHeaders):this.ajaxHeaders=this._ownAjaxHeaders,i){var r,n,o,a;for(var l in this.tilesMatrix){r=this.source.getNumTiles(l);for(var h in this.tilesMatrix[l]){n=(r.x+h%r.x)%r.x;for(var u in this.tilesMatrix[l][h])if(o=(r.y+u%r.y)%r.y,a=this.tilesMatrix[l][h][u],a.loadWithAjax=this.loadTilesWithAjax,a.loadWithAjax){var c=this.source.getTileAjaxHeaders(l,n,o);a.ajaxHeaders=t.extend({},this.ajaxHeaders,c)}else a.ajaxHeaders=null}}for(var d=0;d<this._imageLoader.jobQueue.length;d++){var f=this._imageLoader.jobQueue[d];f.loadWithAjax=f.tile.loadWithAjax,f.ajaxHeaders=f.tile.loadWithAjax?f.tile.ajaxHeaders:null}}},_setScale:function(i,r){var n=this._scaleSpring.target.value===i;if(r){if(n&&this._scaleSpring.current.value===i)return;this._scaleSpring.resetTo(i),this._updateForScale(),this._needsDraw=!0,this._needsUpdate=!0}else{if(n)return;this._scaleSpring.springTo(i),this._updateForScale(),this._needsDraw=!0,this._needsUpdate=!0}n||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var i=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),r=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,n=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(r/this.minPixelRatio)/Math.log(2))));return n=Math.max(n,this.source.minLevel||0),i=Math.min(i,n),{lowestLevel:i,highestLevel:n}},_updateLevelsForViewport:function(){var i=this._getLevelsInterval(),r=i.lowestLevel,n=i.highestLevel,o=[],a=this.getDrawArea(),l=t.now();if(this._lastDrawn.forEach(R=>{R.tile.beingDrawn=!1}),this._tilesToDraw=[],this._tilesLoading=0,this.loadingCoverage={},!a)return this._needsDraw=!1,this._fullyLoaded;var h=new Array(n-r+1);for(let R=0,M=n;M>=r;M--,R++)h[R]=M;for(let R=n+1;R<=this.source.maxLevel;R++){var u=this.tilesMatrix[R]&&this.tilesMatrix[R][0]&&this.tilesMatrix[R][0][0];if(u&&u.isBottomMost&&u.isRightMost&&u.loaded){h.push(R);break}}let c=!1;for(let R=0;R<h.length;R++){let M=h[R];var d=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(M),!0).x*this._scaleSpring.current.value;if(R===h.length-1||d>=this.minPixelRatio)c=!0;else if(!c)continue;var f=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(M),!1).x*this._scaleSpring.current.value,p=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,m=this.immediateRender?1:p,g=Math.min(1,(d-.5)/.5),v=m/Math.abs(m-f),x=this._updateLevel(M,g,v,a,l,o);o=x.bestTiles;var _=x.updatedTiles.filter(O=>O.loaded),E=function(O,N,B){return function(G){return{tile:G,level:O,levelOpacity:N,currentTime:B}}}(M,g,l);if(this._tilesToDraw[M]=_.map(E),this._providesCoverage(this.coverage,M))break}return o&&o.length>0?(o.forEach(function(R){R&&!R.context2D&&this._loadTile(R,l)},this),this._needsDraw=!0,!1):this._tilesLoading===0},_updateTilesInViewport:function(i){let r=t.now(),n=this;this._tilesLoading=0,this._wasBlending=this._isBlending,this._isBlending=!1,this.loadingCoverage={};let o=i.length?i[0].level:0;if(!this.getDrawArea())return;function l(u){let c=u.tile;if(c&&c.loaded){let d=n._blendTile(c,c.x,c.y,u.level,u.levelOpacity,r,o);n._isBlending=n._isBlending||d,n._needsDraw=n._needsDraw||d||n._wasBlending}}let h=0;for(let u=0;u<i.length;u++){let c=i[u];l(c),this._providesCoverage(this.coverage,c.level)&&(h=Math.max(h,c.level))}if(h>0)for(let u in this._tilesToDraw)u<h&&delete this._tilesToDraw[u]},_blendTile:function(i,r,n,o,a,l,h){let u=1e3*this.blendTime,c,d;return i.blendStart||(i.blendStart=l),c=l-i.blendStart,d=u?Math.min(1,c/u):1,o===h&&(d=1,c=u),this.alwaysBlend&&(d*=a),i.opacity=d,d===1&&(this._setCoverage(this.coverage,o,r,n,!0),this._hasOpaqueTile=!0),c<u},_updateLevel:function(i,r,n,o,a,l){var h=o.getBoundingBox().getTopLeft(),u=o.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:!0,level:i,opacity:r,visibility:n,drawArea:o,topleft:h,bottomright:u,currenttime:a,best:l}),this._resetCoverage(this.coverage,i),this._resetCoverage(this.loadingCoverage,i);var c=this._getCornerTiles(i,h,u),d=c.topLeft,f=c.bottomRight,p=this.source.getNumTiles(i),m=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(f.x+=1,this.wrapHorizontal||(f.x=Math.min(f.x,p.x-1)));for(var g=Math.max(0,(f.x-d.x)*(f.y-d.y)),v=new Array(g),x=0,_=d.x;_<=f.x;_++)for(var E=d.y;E<=f.y;E++){var R;if(this.getFlip()){var M=(p.x+_%p.x)%p.x;R=_+p.x-M-M-1}else R=_;if(o.intersection(this.getTileBounds(i,R,E))!==null){var O=this._updateTile(R,E,i,n,m,p,a,l);l=O.bestTiles,v[x]=O.tile,x+=1}}return{bestTiles:l,updatedTiles:v}},_positionTile:function(i,r,n,o,a){var l=i.bounds.getTopLeft();l.x*=this._scaleSpring.current.value,l.y*=this._scaleSpring.current.value,l.x+=this._xSpring.current.value,l.y+=this._ySpring.current.value;var h=i.bounds.getSize();h.x*=this._scaleSpring.current.value,h.y*=this._scaleSpring.current.value,i.positionedBounds.x=l.x,i.positionedBounds.y=l.y,i.positionedBounds.width=h.x,i.positionedBounds.height=h.y;var u=n.pixelFromPointNoRotate(l,!0),c=n.pixelFromPointNoRotate(l,!1),d=n.deltaPixelsFromPointsNoRotate(h,!0),f=n.deltaPixelsFromPointsNoRotate(h,!1),p=c.plus(f.divide(2)),m=o.squaredDistanceTo(p);this.viewer.drawer.minimumOverlapRequired(this)&&(r||(d=d.plus(new t.Point(1,1))),i.isRightMost&&this.wrapHorizontal&&(d.x+=.75),i.isBottomMost&&this.wrapVertical&&(d.y+=.75)),i.position=u,i.size=d,i.squaredDistance=m,i.visibility=a},_updateTile:function(i,r,n,o,a,l,h,u){var c=this._getTile(i,r,n,h,l);this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:c}),this._setCoverage(this.coverage,n,i,r,!1);var d=c.loaded||c.loading||this._isCovered(this.loadingCoverage,n,i,r);if(this._setCoverage(this.loadingCoverage,n,i,r,d),!c.exists)return{bestTiles:u,tile:c};if(c.loaded&&c.opacity===1&&this._setCoverage(this.coverage,n,i,r,!0),this._positionTile(c,this.source.tileOverlap,this.viewport,a,o),!c.loaded)if(c.context2D)this._setTileLoaded(c);else{var f=this._tileCache.getImageRecord(c.cacheKey);f&&this._setTileLoaded(c,f.getData())}return c.loading?this._tilesLoading++:d||(u=this._compareTiles(u,c,this.maxTilesPerFrame)),{bestTiles:u,tile:c}},_getCornerTiles:function(i,r,n){var o,a;this.wrapHorizontal?(o=t.positiveModulo(r.x,1),a=t.positiveModulo(n.x,1)):(o=Math.max(0,r.x),a=Math.min(1,n.x));var l,h,u=1/this.source.aspectRatio;this.wrapVertical?(l=t.positiveModulo(r.y,u),h=t.positiveModulo(n.y,u)):(l=Math.max(0,r.y),h=Math.min(u,n.y));var c=this.source.getTileAtPoint(i,new t.Point(o,l)),d=this.source.getTileAtPoint(i,new t.Point(a,h)),f=this.source.getNumTiles(i);return this.wrapHorizontal&&(c.x+=f.x*Math.floor(r.x),d.x+=f.x*Math.floor(n.x)),this.wrapVertical&&(c.y+=f.y*Math.floor(r.y/u),d.y+=f.y*Math.floor(n.y/u)),{topLeft:c,bottomRight:d}},_getTile:function(i,r,n,o,a){var l,h,u,c,d,f,p,m,g,v,x=this.tilesMatrix,_=this.source;return x[n]||(x[n]={}),x[n][i]||(x[n][i]={}),(!x[n][i][r]||!x[n][i][r].flipped!=!this.flipped)&&(l=(a.x+i%a.x)%a.x,h=(a.y+r%a.y)%a.y,u=this.getTileBounds(n,i,r),c=_.getTileBounds(n,l,h,!0),d=_.tileExists(n,l,h),f=_.getTileUrl(n,l,h),p=_.getTilePostData(n,l,h),this.loadTilesWithAjax?(m=_.getTileAjaxHeaders(n,l,h),t.isPlainObject(this.ajaxHeaders)&&(m=t.extend({},this.ajaxHeaders,m))):m=null,g=_.getContext2D?_.getContext2D(n,l,h):void 0,v=new t.Tile(n,i,r,u,d,f,g,this.loadTilesWithAjax,m,c,p,_.getTileHashKey(n,l,h,f,m,p)),this.getFlip()?l===0&&(v.isRightMost=!0):l===a.x-1&&(v.isRightMost=!0),h===a.y-1&&(v.isBottomMost=!0),v.flipped=this.flipped,x[n][i][r]=v),v=x[n][i][r],v.lastTouchTime=o,v},_loadTile:function(i,r){var n=this;i.loading=!0,this._imageLoader.addJob({src:i.getUrl(),tile:i,source:this.source,postData:i.postData,loadWithAjax:i.loadWithAjax,ajaxHeaders:i.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(o,a,l){n._onTileLoad(i,r,o,a,l)},abort:function(){i.loading=!1}})},_onTileLoad:function(i,r,n,o,a){if(n)i.exists=!0;else{t.console.error("Tile %s failed to load: %s - error: %s",i,i.getUrl(),o),this.viewer.raiseEvent("tile-load-failed",{tile:i,tiledImage:this,time:r,message:o,tileRequest:a}),i.loading=!1,i.exists=!1;return}if(r<this.lastResetTime){t.console.warn("Ignoring tile %s loaded before reset: %s",i,i.getUrl()),i.loading=!1;return}var l=this,h=function(){var u=l.source,c=u.getClosestLevel();l._setTileLoaded(i,n,c,a)};h()},_setTileLoaded:function(i,r,n,o){var a=0,l=!1,h=this;function u(){return l&&t.console.error("Event 'tile-loaded' argument getCompletionCallback must be called synchronously. Its return value should be called asynchronously."),a++,c}function c(){a--,a===0&&(i.loading=!1,i.loaded=!0,i.hasTransparency=h.source.hasTransparency(i.context2D,i.getUrl(),i.ajaxHeaders,i.postData),i.context2D||h._tileCache.cacheTile({data:r,tile:i,cutoff:n,tiledImage:h}),h.viewer.raiseEvent("tile-ready",{tile:i,tiledImage:h,tileRequest:o}),h._needsDraw=!0)}var d=u();this.viewer.raiseEvent("tile-loaded",{tile:i,tiledImage:this,tileRequest:o,get image(){return t.console.error("[tile-loaded] event 'image' has been deprecated. Use 'data' property instead."),r},data:r,getCompletionCallback:u}),l=!0,d()},_compareTiles:function(i,r,n){return i?(i.push(r),this._sortTiles(i),i.length>n&&i.pop(),i):[r]},_sortTiles:function(i){i.sort(function(r,n){return r===null?1:n===null?-1:r.visibility===n.visibility?r.squaredDistance-n.squaredDistance:n.visibility-r.visibility})},_providesCoverage:function(i,r,n,o){var a,l,h,u;if(!i[r])return!1;if(n===void 0||o===void 0){a=i[r];for(h in a)if(Object.prototype.hasOwnProperty.call(a,h)){l=a[h];for(u in l)if(Object.prototype.hasOwnProperty.call(l,u)&&!l[u])return!1}return!0}return i[r][n]===void 0||i[r][n][o]===void 0||i[r][n][o]===!0},_isCovered:function(i,r,n,o){return n===void 0||o===void 0?this._providesCoverage(i,r+1):this._providesCoverage(i,r+1,2*n,2*o)&&this._providesCoverage(i,r+1,2*n,2*o+1)&&this._providesCoverage(i,r+1,2*n+1,2*o)&&this._providesCoverage(i,r+1,2*n+1,2*o+1)},_setCoverage:function(i,r,n,o,a){if(!i[r]){t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",r);return}i[r][n]||(i[r][n]={}),i[r][n][o]=a},_resetCoverage:function(i,r){i[r]={}}})}(e),function(t){var i=function(n){t.console.assert(n,"[TileCache.cacheTile] options is required"),t.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=n.tile,this.tiledImage=n.tiledImage},r=function(n){t.console.assert(n,"[ImageRecord] options is required"),t.console.assert(n.data,"[ImageRecord] options.data is required"),this._tiles=[],n.create.apply(null,[this,n.data,n.ownerTile]),this._destroyImplementation=n.destroy.bind(null,this),this.getImage=n.getImage.bind(null,this),this.getData=n.getData.bind(null,this),this.getRenderedContext=n.getRenderedContext.bind(null,this)};r.prototype={destroy:function(){this._destroyImplementation(),this._tiles=null},addTile:function(n){t.console.assert(n,"[ImageRecord.addTile] tile is required"),this._tiles.push(n)},removeTile:function(n){for(var o=0;o<this._tiles.length;o++)if(this._tiles[o]===n){this._tiles.splice(o,1);return}t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",n)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(n){n=n||{},this._maxImageCacheCount=n.maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(n){t.console.assert(n,"[TileCache.cacheTile] options is required"),t.console.assert(n.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(n.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),t.console.assert(n.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var o=n.cutoff||0,a=this._tilesLoaded.length,l=this._imagesLoaded[n.tile.cacheKey];if(l||(n.data||(t.console.error("[TileCache.cacheTile] options.image was renamed to options.data. '.image' attribute has been deprecated and will be removed in the future."),n.data=n.image),t.console.assert(n.data,"[TileCache.cacheTile] options.data is required to create an ImageRecord"),l=this._imagesLoaded[n.tile.cacheKey]=new r({data:n.data,ownerTile:n.tile,create:n.tiledImage.source.createTileCache,destroy:n.tiledImage.source.destroyTileCache,getImage:n.tiledImage.source.getTileCacheDataAsImage,getData:n.tiledImage.source.getTileCacheData,getRenderedContext:n.tiledImage.source.getTileCacheDataAsContext2D}),this._imagesLoadedCount++),l.addTile(n.tile),n.tile.cacheImageRecord=l,this._imagesLoadedCount>this._maxImageCacheCount){for(var h=null,u=-1,c=null,d,f,p,m,g,v,x=this._tilesLoaded.length-1;x>=0;x--)if(v=this._tilesLoaded[x],d=v.tile,!(d.level<=o||d.beingDrawn)){if(!h){h=d,u=x,c=v;continue}m=d.lastTouchTime,f=h.lastTouchTime,g=d.level,p=h.level,(m<f||m===f&&g>p)&&(h=d,u=x,c=v)}h&&u>=0&&(this._unloadTile(c),a=u)}this._tilesLoaded[a]=new i({tile:n.tile,tiledImage:n.tiledImage})},clearTilesFor:function(n){t.console.assert(n,"[TileCache.clearTilesFor] tiledImage is required");for(var o,a=0;a<this._tilesLoaded.length;++a)o=this._tilesLoaded[a],o.tiledImage===n&&(this._unloadTile(o),this._tilesLoaded.splice(a,1),a--)},getImageRecord:function(n){return t.console.assert(n,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[n]},_unloadTile:function(n){t.console.assert(n,"[TileCache._unloadTile] tileRecord is required");var o=n.tile,a=n.tiledImage;let l=o.getCanvasContext&&o.getCanvasContext();o.unload(),o.cacheImageRecord=null;var h=this._imagesLoaded[o.cacheKey];h&&(h.removeTile(o),h.getTileCount()||(h.destroy(),delete this._imagesLoaded[o.cacheKey],this._imagesLoadedCount--,l&&(l.canvas.width=0,l.canvas.height=0,a.viewer.raiseEvent("image-unloaded",{context2D:l,tile:o}))),a.viewer.raiseEvent("tile-unloaded",{tile:o,tiledImage:a}))}}}(e),function(t){t.World=function(i){var r=this;t.console.assert(i.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=i.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(n){r._autoRefigureSizes?r._figureSizes():r._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(i,r){if(t.console.assert(i,"[World.addItem] item is required"),t.console.assert(i instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),r=r||{},r.index!==void 0){var n=Math.max(0,Math.min(this._items.length,r.index));this._items.splice(n,0,i)}else this._items.push(i);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,i.addHandler("bounds-change",this._delegatedFigureSizes),i.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:i})},getItemAt:function(i){return t.console.assert(i!==void 0,"[World.getItemAt] index is required"),this._items[i]},getIndexOfItem:function(i){return t.console.assert(i,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,i)},getItemCount:function(){return this._items.length},setItemIndex:function(i,r){t.console.assert(i,"[World.setItemIndex] item is required"),t.console.assert(r!==void 0,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(i);if(r>=this._items.length)throw new Error("Index bigger than number of layers.");r===n||n===-1||(this._items.splice(n,1),this._items.splice(r,0,i),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:i,previousIndex:n,newIndex:r}))},removeItem:function(i){t.console.assert(i,"[World.removeItem] item is required");var r=t.indexOf(this._items,i);r!==-1&&(i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy(),this._items.splice(r,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(i))},removeAll:function(){this.viewer._cancelPendingImages();var i,r;for(r=0;r<this._items.length;r++)i=this._items[r],i.removeHandler("bounds-change",this._delegatedFigureSizes),i.removeHandler("clip-change",this._delegatedFigureSizes),i.destroy();var n=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,r=0;r<n.length;r++)i=n[r],this._raiseRemoveItem(i)},resetItems:function(){for(var i=0;i<this._items.length;i++)this._items[i].reset()},update:function(i){for(var r=!1,n=0;n<this._items.length;n++)r=this._items[n].update(i)||r;return r},draw:function(){this.viewer.drawer.draw(this._items),this._needsDraw=!1,this._items.forEach(i=>{this._needsDraw=i.setDrawn()||this._needsDraw})},needsDraw:function(){for(var i=0;i<this._items.length;i++)if(this._items[i].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(i){this._autoRefigureSizes=i,i&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(i){i=i||{};var r=i.immediately||!1,n=i.layout||t.DEFAULT_SETTINGS.collectionLayout,o=i.rows||t.DEFAULT_SETTINGS.collectionRows,a=i.columns||t.DEFAULT_SETTINGS.collectionColumns,l=i.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,h=i.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin,u=l+h,c;!i.rows&&a?c=a:c=Math.ceil(this._items.length/o);var d=0,f=0,p,m,g,v,x;this.setAutoRefigureSizes(!1);for(var _=0;_<this._items.length;_++)_&&_%c===0&&(n==="horizontal"?(f+=u,d=0):(d+=u,f=0)),p=this._items[_],m=p.getBounds(),m.width>m.height?g=l:g=l*(m.width/m.height),v=g*(m.height/m.width),x=new t.Point(d+(l-g)/2,f+(l-v)/2),p.setPosition(x,r),p.setWidth(g,r),n==="horizontal"?d+=u:f+=u;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var i=this._homeBounds?this._homeBounds.clone():null,r=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(!this._items.length)this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;else{var o=this._items[0],a=o.getBounds();this._contentFactor=o.getContentSize().x/a.width;for(var l=o.getClippedBounds().getBoundingBox(),h=l.x,u=l.y,c=l.x+l.width,d=l.y+l.height,f=1;f<this._items.length;f++)o=this._items[f],a=o.getBounds(),this._contentFactor=Math.max(this._contentFactor,o.getContentSize().x/a.width),l=o.getClippedBounds().getBoundingBox(),h=Math.min(h,l.x),u=Math.min(u,l.y),c=Math.max(c,l.x+l.width),d=Math.max(d,l.y+l.height);this._homeBounds=new t.Rect(h,u,c-h,d-u),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==n||!this._homeBounds.equals(i)||!this._contentSize.equals(r))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(i){this.raiseEvent("remove-item",{item:i})}})}(e)}(_n)),_n.exports}var ap=op();const Nn=rp(ap);var lp=Object.defineProperty,hp=(s,e,t)=>e in s?lp(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ke=(s,e,t)=>hp(s,typeof e!="symbol"?e+"":e,t),$l=Object.prototype.hasOwnProperty;function fs(s,e){var t,i;if(s===e)return!0;if(s&&e&&(t=s.constructor)===e.constructor){if(t===Date)return s.getTime()===e.getTime();if(t===RegExp)return s.toString()===e.toString();if(t===Array){if((i=s.length)===e.length)for(;i--&&fs(s[i],e[i]););return i===-1}if(!t||typeof s=="object"){i=0;for(t in s)if($l.call(s,t)&&++i&&!$l.call(e,t)||!(t in e)||!fs(s[t],e[t]))return!1;return Object.keys(e).length===i}}return s!==s&&e!==e}var kc=(s=>(s.EDIT="EDIT",s.SELECT="SELECT",s.NONE="NONE",s))(kc||{});const up=[];for(let s=0;s<256;++s)up.push((s+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const To=s=>{const e=t=>{const i={...t};return t.created&&typeof t.created=="string"&&(i.created=new Date(t.created)),t.updated&&typeof t.updated=="string"&&(i.updated=new Date(t.updated)),i};return{...s,bodies:(s.bodies||[]).map(e),target:e(s.target)}},cp=(s,e)=>{const t=new Set(s.bodies.map(i=>i.id));return e.bodies.filter(i=>!t.has(i.id))},dp=(s,e)=>{const t=new Set(e.bodies.map(i=>i.id));return s.bodies.filter(i=>!t.has(i.id))},fp=(s,e)=>e.bodies.map(t=>{const i=s.bodies.find(r=>r.id===t.id);return{newBody:t,oldBody:i&&!fs(i,t)?i:void 0}}).filter(({oldBody:t})=>t).map(({oldBody:t,newBody:i})=>({oldBody:t,newBody:i})),pp=(s,e)=>!fs(s.target,e.target),mp=(s,e)=>{const t=cp(s,e),i=dp(s,e),r=fp(s,e);return{oldValue:s,newValue:e,bodiesCreated:t.length>0?t:void 0,bodiesDeleted:i.length>0?i:void 0,bodiesUpdated:r.length>0?r:void 0,targetUpdated:pp(s,e)?{oldTarget:s.target,newTarget:e.target}:void 0}};var ki=(s=>(s.LOCAL="LOCAL",s.REMOTE="REMOTE",s.SILENT="SILENT",s))(ki||{});const gp=(s,e)=>{const t=new Set((s.created||[]).map(c=>c.id)),i=new Set((s.updated||[]).map(({newValue:c})=>c.id)),r=new Set((e.created||[]).map(c=>c.id)),n=new Set((e.deleted||[]).map(c=>c.id)),o=new Set((e.updated||[]).map(({oldValue:c})=>c.id)),a=new Set((e.updated||[]).filter(({oldValue:c})=>t.has(c.id)||i.has(c.id)).map(({oldValue:c})=>c.id)),l=[...(s.created||[]).filter(c=>!n.has(c.id)).map(c=>o.has(c.id)?e.updated.find(({oldValue:d})=>d.id===c.id).newValue:c),...e.created||[]],h=[...(s.deleted||[]).filter(c=>!r.has(c.id)),...(e.deleted||[]).filter(c=>!t.has(c.id))],u=[...(s.updated||[]).filter(({newValue:c})=>!n.has(c.id)).map(c=>{const{oldValue:d,newValue:f}=c;if(o.has(f.id)){const p=e.updated.find(m=>m.oldValue.id===f.id).newValue;return mp(d,p)}else return c}),...(e.updated||[]).filter(({oldValue:c})=>!a.has(c.id))];return{created:l,deleted:h,updated:u}};let vp=()=>({emit(s,...e){for(let t=this.events[s]||[],i=0,r=t.length;i<r;i++)t[i](...e)},events:{},on(s,e){var t;return((t=this.events)[s]||(t[s]=[])).push(e),()=>{var i;this.events[s]=(i=this.events[s])==null?void 0:i.filter(r=>e!==r)}}});const yp=250,xp=(s,e)=>{const t=vp(),i=(e==null?void 0:e.changes)||[];let r=e?e.pointer:-1,n=!1,o=0;const a=p=>{if(!n){const{changes:m}=p,g=performance.now();if(g-o>yp)i.splice(r+1),i.push(m),r=i.length-1;else{const v=i.length-1;i[v]=gp(i[v],m)}o=g}n=!1};s.observe(a,{origin:ki.LOCAL});const l=p=>p&&p.length>0&&s.bulkDeleteAnnotations(p),h=p=>p&&p.length>0&&s.bulkAddAnnotations(p,!1),u=p=>p&&p.length>0&&s.bulkUpdateAnnotations(p.map(({oldValue:m})=>m)),c=p=>p&&p.length>0&&s.bulkUpdateAnnotations(p.map(({newValue:m})=>m)),d=p=>p&&p.length>0&&s.bulkAddAnnotations(p,!1),f=p=>p&&p.length>0&&s.bulkDeleteAnnotations(p);return{canRedo:()=>i.length-1>r,canUndo:()=>r>-1,destroy:()=>s.unobserve(a),getHistory:()=>({changes:[...i],pointer:r}),on:(p,m)=>t.on(p,m),redo:()=>{if(i.length-1>r){n=!0;const{created:p,updated:m,deleted:g}=i[r+1];h(p),c(m),f(g),t.emit("redo",i[r+1]),r+=1}},undo:()=>{if(r>-1){n=!0;const{created:p,updated:m,deleted:g}=i[r];l(p),u(m),d(g),t.emit("undo",i[r]),r-=1}}}},_p=(s,e,t,i)=>{const{hover:r,selection:n,store:o,viewport:a}=s,l=new Map;let h=[],u,c;const d=(v,x)=>{l.has(v)?l.get(v).push(x):l.set(v,[x])},f=(v,x)=>{const _=l.get(v);if(_){const E=_.indexOf(x);E!==-1&&_.splice(E,1)}},p=(v,x,_)=>{l.has(v)&&setTimeout(()=>{l.get(v).forEach(E=>{if(t){const R=Array.isArray(x)?x.map(O=>t.serialize(O)):t.serialize(x),M=_?_ instanceof PointerEvent?_:t.serialize(_):void 0;E(R,M)}else E(x,_)})},1)},m=()=>{const{selected:v}=n,x=(v||[]).map(({id:_})=>o.getAnnotation(_));x.forEach(_=>{const E=h.find(R=>R.id===_.id);(!E||!fs(E,_))&&p("updateAnnotation",_,E)}),h=h.map(_=>x.find(({id:E})=>E===_.id)||_)};n.subscribe(({selected:v})=>{if(!(h.length===0&&v.length===0)){if(h.length===0&&v.length>0)h=v.map(({id:x})=>o.getAnnotation(x));else if(h.length>0&&v.length===0)h.forEach(x=>{const _=o.getAnnotation(x.id);_&&!fs(_,x)&&p("updateAnnotation",_,x)}),h=[];else{const x=new Set(h.map(E=>E.id)),_=new Set(v.map(({id:E})=>E));h.filter(E=>!_.has(E.id)).forEach(E=>{const R=o.getAnnotation(E.id);R&&!fs(R,E)&&p("updateAnnotation",R,E)}),h=[...h.filter(E=>_.has(E.id)),...v.filter(({id:E})=>!x.has(E)).map(({id:E})=>o.getAnnotation(E))]}p("selectionChanged",h)}}),r.subscribe(v=>{!u&&v?p("mouseEnterAnnotation",o.getAnnotation(v)):u&&!v?p("mouseLeaveAnnotation",o.getAnnotation(u)):u&&v&&(p("mouseLeaveAnnotation",o.getAnnotation(u)),p("mouseEnterAnnotation",o.getAnnotation(v))),u=v}),a==null||a.subscribe(v=>p("viewportIntersect",v.map(x=>o.getAnnotation(x)))),o.observe(v=>{i&&(c&&clearTimeout(c),c=setTimeout(m,1e3));const{created:x,deleted:_}=v.changes;(x||[]).forEach(E=>p("createAnnotation",E)),(_||[]).forEach(E=>p("deleteAnnotation",E)),(v.changes.updated||[]).filter(E=>[...E.bodiesCreated||[],...E.bodiesDeleted||[],...E.bodiesUpdated||[]].length>0).forEach(({oldValue:E,newValue:R})=>{const M=h.find(O=>O.id===E.id)||E;h=h.map(O=>O.id===E.id?R:O),p("updateAnnotation",R,M)})},{origin:ki.LOCAL}),o.observe(v=>{if(h){const x=new Set(h.map(E=>E.id)),_=(v.changes.updated||[]).filter(({newValue:E})=>x.has(E.id)).map(({newValue:E})=>E);_.length>0&&(h=h.map(E=>_.find(R=>R.id===E.id)||E))}},{origin:ki.REMOTE});const g=v=>x=>{const{updated:_}=x;v?(_||[]).forEach(E=>p("updateAnnotation",E.oldValue,E.newValue)):(_||[]).forEach(E=>p("updateAnnotation",E.newValue,E.oldValue))};return e.on("undo",g(!0)),e.on("redo",g(!1)),{on:d,off:f,emit:p}},Tp=s=>e=>e.reduce((t,i)=>{const{parsed:r,error:n}=s.parse(i);return n?{parsed:t.parsed,failed:[...t.failed,i]}:r?{parsed:[...t.parsed,r],failed:t.failed}:{...t}},{parsed:[],failed:[]}),wp=(s,e,t)=>{const{store:i,selection:r}=s,n=v=>{if(t){const{parsed:x,error:_}=t.parse(v);x?i.addAnnotation(x,ki.REMOTE):console.error(_)}else i.addAnnotation(To(v),ki.REMOTE)},o=()=>r.clear(),a=()=>i.clear(),l=v=>{const x=i.getAnnotation(v);return t&&x?t.serialize(x):x},h=()=>t?i.all().map(t.serialize):i.all(),u=()=>{var v;const x=(((v=r.selected)==null?void 0:v.map(_=>_.id))||[]).map(_=>i.getAnnotation(_)).filter(Boolean);return t?x.map(t.serialize):x},c=(v,x=!0)=>fetch(v).then(_=>_.json()).then(_=>(f(_,x),_)),d=v=>{if(typeof v=="string"){const x=i.getAnnotation(v);if(i.deleteAnnotation(v),x)return t?t.serialize(x):x}else{const x=t?t.parse(v).parsed:v;if(x)return i.deleteAnnotation(x),v}},f=(v,x=!0)=>{if(t){const _=t.parseAll||Tp(t),{parsed:E,failed:R}=_(v);R.length>0&&console.warn(`Discarded ${R.length} invalid annotations`,R),i.bulkAddAnnotations(E,x,ki.REMOTE)}else i.bulkAddAnnotations(v.map(To),x,ki.REMOTE)},p=(v,x)=>{v?r.setSelected(v,x):r.clear()},m=v=>{r.clear(),r.setUserSelectAction(v)},g=v=>{if(t){const x=t.parse(v).parsed,_=t.serialize(i.getAnnotation(x.id));return i.updateAnnotation(x),_}else{const x=i.getAnnotation(v.id);return i.updateAnnotation(To(v)),x}};return{addAnnotation:n,cancelSelected:o,canRedo:e.canRedo,canUndo:e.canUndo,clearAnnotations:a,getAnnotationById:l,getAnnotations:h,getHistory:e.getHistory,getSelected:u,loadAnnotations:c,redo:e.redo,removeAnnotation:d,setAnnotations:f,setSelected:p,setUserSelectAction:m,undo:e.undo,updateAnnotation:g}},Ep="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let bp=s=>crypto.getRandomValues(new Uint8Array(s)),Sp=(s,e,t)=>{let i=(2<<Math.log2(s.length-1))-1,r=-~(1.6*i*e/s.length);return(n=e)=>{let o="";for(;;){let a=t(r),l=r|0;for(;l--;)if(o+=s[a[l]&i]||"",o.length>=n)return o}}},Ap=(s,e=21)=>Sp(s,e|0,bp),Rp=(s=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(s|=0));for(;s--;)e+=Ep[t[s]&63];return e};const Cp=()=>({isGuest:!0,id:Ap("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",20)()});Rp();var Pp=Object.defineProperty,Mp=(s,e,t)=>e in s?Pp(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Qe=(s,e,t)=>Mp(s,typeof e!="symbol"?e+"":e,t);function ei(){}function ba(s,e){for(const t in e)s[t]=e[t];return s}function Uc(s){return s()}function eh(){return Object.create(null)}function zt(s){s.forEach(Uc)}function ct(s){return typeof s=="function"}function qi(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}function Ip(s){return Object.keys(s).length===0}function Op(s,e,t,i){if(s){const r=Hc(s,e,t,i);return s[0](r)}}function Hc(s,e,t,i){return s[1]&&i?ba(t.ctx.slice(),s[1](i(e))):t.ctx}function Dp(s,e,t,i){if(s[2]&&i){const r=s[2](i(t));if(e.dirty===void 0)return r;if(typeof r=="object"){const n=[],o=Math.max(e.dirty.length,r.length);for(let a=0;a<o;a+=1)n[a]=e.dirty[a]|r[a];return n}return e.dirty|r}return e.dirty}function Np(s,e,t,i,r,n){if(r){const o=Hc(e,t,i,n);s.p(o,r)}}function Lp(s){if(s.ctx.length>32){const e=[],t=s.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function th(s){const e={};for(const t in s)t[0]!=="$"&&(e[t]=s[t]);return e}function Vr(s){return s??""}function Le(s,e){s.appendChild(e)}function ge(s,e,t){s.insertBefore(e,t||null)}function me(s){s.parentNode&&s.parentNode.removeChild(s)}function eo(s,e){for(let t=0;t<s.length;t+=1)s[t]&&s[t].d(e)}function ce(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Gc(s){return document.createTextNode(s)}function At(){return Gc(" ")}function ir(){return Gc("")}function ke(s,e,t,i){return s.addEventListener(e,t,i),()=>s.removeEventListener(e,t,i)}function b(s,e,t){t==null?s.removeAttribute(e):s.getAttribute(e)!==t&&s.setAttribute(e,t)}function Bp(s){return Array.from(s.childNodes)}function ih(s,e,t){s.classList.toggle(e,!!t)}function Fp(s,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(s,{detail:e,bubbles:t,cancelable:i})}let br;function _r(s){br=s}function zc(){if(!br)throw new Error("Function called outside component initialization");return br}function to(s){zc().$$.on_mount.push(s)}function Lr(){const s=zc();return(e,t,{cancelable:i=!1}={})=>{const r=s.$$.callbacks[e];if(r){const n=Fp(e,t,{cancelable:i});return r.slice().forEach(o=>{o.call(s,n)}),!n.defaultPrevented}return!0}}function bt(s,e){const t=s.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const Ms=[],sh=[];let Vs=[];const rh=[],Vc=Promise.resolve();let Sa=!1;function Xc(){Sa||(Sa=!0,Vc.then(jc))}function Wc(){return Xc(),Vc}function Aa(s){Vs.push(s)}const wo=new Set;let Es=0;function jc(){if(Es!==0)return;const s=br;do{try{for(;Es<Ms.length;){const e=Ms[Es];Es++,_r(e),kp(e.$$)}}catch(e){throw Ms.length=0,Es=0,e}for(_r(null),Ms.length=0,Es=0;sh.length;)sh.pop()();for(let e=0;e<Vs.length;e+=1){const t=Vs[e];wo.has(t)||(wo.add(t),t())}Vs.length=0}while(Ms.length);for(;rh.length;)rh.pop()();Sa=!1,wo.clear(),_r(s)}function kp(s){if(s.fragment!==null){s.update(),zt(s.before_update);const e=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,e),s.after_update.forEach(Aa)}}function Up(s){const e=[],t=[];Vs.forEach(i=>s.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Vs=e}const Tn=new Set;let cs;function Js(){cs={r:0,c:[],p:cs}}function $s(){cs.r||zt(cs.c),cs=cs.p}function Ne(s,e){s&&s.i&&(Tn.delete(s),s.i(e))}function We(s,e,t,i){if(s&&s.o){if(Tn.has(s))return;Tn.add(s),cs.c.push(()=>{Tn.delete(s),i&&(t&&s.d(1),i())}),s.o(e)}else i&&i()}function Xi(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function Kt(s){s&&s.c()}function kt(s,e,t){const{fragment:i,after_update:r}=s.$$;i&&i.m(e,t),Aa(()=>{const n=s.$$.on_mount.map(Uc).filter(ct);s.$$.on_destroy?s.$$.on_destroy.push(...n):zt(n),s.$$.on_mount=[]}),r.forEach(Aa)}function Ut(s,e){const t=s.$$;t.fragment!==null&&(Up(t.after_update),zt(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Hp(s,e){s.$$.dirty[0]===-1&&(Ms.push(s),Xc(),s.$$.dirty.fill(0)),s.$$.dirty[e/31|0]|=1<<e%31}function Zi(s,e,t,i,r,n,o=null,a=[-1]){const l=br;_r(s);const h=s.$$={fragment:null,ctx:[],props:n,update:ei,not_equal:r,bound:eh(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:eh(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(h.root);let u=!1;if(h.ctx=t?t(s,e.props||{},(c,d,...f)=>{const p=f.length?f[0]:d;return h.ctx&&r(h.ctx[c],h.ctx[c]=p)&&(!h.skip_bound&&h.bound[c]&&h.bound[c](p),u&&Hp(s,c)),d}):[],h.update(),u=!0,zt(h.before_update),h.fragment=i?i(h.ctx):!1,e.target){if(e.hydrate){const c=Bp(e.target);h.fragment&&h.fragment.l(c),c.forEach(me)}else h.fragment&&h.fragment.c();e.intro&&Ne(s.$$.fragment),kt(s,e.target,e.anchor),jc()}_r(l)}class Ki{constructor(){Qe(this,"$$"),Qe(this,"$$set")}$destroy(){Ut(this,1),this.$destroy=ei}$on(e,t){if(!ct(t))return ei;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!Ip(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Gp="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Gp);var je=(s=>(s.ELLIPSE="ELLIPSE",s.MULTIPOLYGLON="MULTIPOLYGON",s.POLYGON="POLYGON",s.RECTANGLE="RECTANGLE",s))(je||{}),zp={exports:{}};(function(s){(function(){function e(a,l){var h=a.x-l.x,u=a.y-l.y;return h*h+u*u}function t(a,l,h){var u=l.x,c=l.y,d=h.x-u,f=h.y-c;if(d!==0||f!==0){var p=((a.x-u)*d+(a.y-c)*f)/(d*d+f*f);p>1?(u=h.x,c=h.y):p>0&&(u+=d*p,c+=f*p)}return d=a.x-u,f=a.y-c,d*d+f*f}function i(a,l){for(var h=a[0],u=[h],c,d=1,f=a.length;d<f;d++)c=a[d],e(c,h)>l&&(u.push(c),h=c);return h!==c&&u.push(c),u}function r(a,l,h,u,c){for(var d=u,f,p=l+1;p<h;p++){var m=t(a[p],a[l],a[h]);m>d&&(f=p,d=m)}d>u&&(f-l>1&&r(a,l,f,u,c),c.push(a[f]),h-f>1&&r(a,f,h,u,c))}function n(a,l){var h=a.length-1,u=[a[0]];return r(a,0,h,l,u),u.push(a[h]),u}function o(a,l,h){if(a.length<=2)return a;var u=l!==void 0?l*l:1;return a=h?a:i(a,u),a=n(a,u),a}s.exports=o,s.exports.default=o})()})(zp);const Al={},io=(s,e)=>Al[s]=e,Ra=s=>Al[s.type].area(s),Vp=(s,e,t)=>Al[s.type].intersects(s,e,t),Qt=s=>{let e=1/0,t=1/0,i=-1/0,r=-1/0;return s.forEach(([n,o])=>{e=Math.min(e,n),t=Math.min(t,o),i=Math.max(i,n),r=Math.max(r,o)}),{minX:e,minY:t,maxX:i,maxY:r}},Ca=s=>{let e=0,t=s.length-1;for(let i=0;i<s.length;i++)e+=(s[t][0]+s[i][0])*(s[t][1]-s[i][1]),t=i;return Math.abs(.5*e)},Pa=(s,e,t)=>{let i=!1;for(let r=0,n=s.length-1;r<s.length;n=r++){const o=s[r][0],a=s[r][1],l=s[n][0],h=s[n][1];a>t!=h>t&&e<(l-o)*(t-a)/(h-a)+o&&(i=!i)}return i},Xp=(s,e=!0)=>{let t="M ";return s.forEach(([i,r],n)=>{n===0?t+=`${i},${r}`:t+=` L ${i},${r}`}),e&&(t+=" Z"),t},Wp={area:s=>Math.PI*s.geometry.rx*s.geometry.ry,intersects:(s,e,t)=>{const{cx:i,cy:r,rx:n,ry:o}=s.geometry,a=0,l=Math.cos(a),h=Math.sin(a),u=e-i,c=t-r,d=l*u+h*c,f=h*u-l*c;return d*d/(n*n)+f*f/(o*o)<=1}};io(je.ELLIPSE,Wp);const jp={area:s=>{const{polygons:e}=s.geometry;return e.reduce((t,i)=>{const[r,...n]=i.rings,o=Ca(r.points),a=n.reduce((l,h)=>l+Ca(h.points),0);return t+o-a},0)},intersects:(s,e,t)=>{const{polygons:i}=s.geometry;for(const r of i){const[n,...o]=r.rings;if(Pa(n.points,e,t)){let a=!1;for(const l of o)if(Pa(l.points,e,t)){a=!0;break}if(!a)return!0}}return!1}},Eo=s=>{const e=s.reduce((t,i)=>[...t,...i.rings[0].points],[]);return Qt(e)},Oi=s=>s.rings.map(e=>Xp(e.points)).join(" "),Yp=s=>s.polygons.reduce((e,t)=>[...e,...t.rings.reduce((i,r)=>[...i,...r.points],[])],[]);io(je.MULTIPOLYGLON,jp);const qp={area:s=>{const e=s.geometry.points;return Ca(e)},intersects:(s,e,t)=>{const i=s.geometry.points;return Pa(i,e,t)}};io(je.POLYGON,qp);const Zp={area:s=>s.geometry.w*s.geometry.h,intersects:(s,e,t)=>e>=s.geometry.x&&e<=s.geometry.x+s.geometry.w&&t>=s.geometry.y&&t<=s.geometry.y+s.geometry.h};io(je.RECTANGLE,Zp);const Ui=s=>wn(s.target),wn=s=>{var e,t;return(s==null?void 0:s.annotation)!==void 0&&((t=(e=s==null?void 0:s.selector)==null?void 0:e.geometry)==null?void 0:t.bounds)!==void 0},at=" ";function Kp(s){let e="";Array.isArray(s)||(s=[s]);for(let t=0;t<s.length;t++){const i=s[t];if(i.type===Y.CLOSE_PATH)e+="z";else if(i.type===Y.HORIZ_LINE_TO)e+=(i.relative?"h":"H")+i.x;else if(i.type===Y.VERT_LINE_TO)e+=(i.relative?"v":"V")+i.y;else if(i.type===Y.MOVE_TO)e+=(i.relative?"m":"M")+i.x+at+i.y;else if(i.type===Y.LINE_TO)e+=(i.relative?"l":"L")+i.x+at+i.y;else if(i.type===Y.CURVE_TO)e+=(i.relative?"c":"C")+i.x1+at+i.y1+at+i.x2+at+i.y2+at+i.x+at+i.y;else if(i.type===Y.SMOOTH_CURVE_TO)e+=(i.relative?"s":"S")+i.x2+at+i.y2+at+i.x+at+i.y;else if(i.type===Y.QUAD_TO)e+=(i.relative?"q":"Q")+i.x1+at+i.y1+at+i.x+at+i.y;else if(i.type===Y.SMOOTH_QUAD_TO)e+=(i.relative?"t":"T")+i.x+at+i.y;else if(i.type===Y.ARC)e+=(i.relative?"a":"A")+i.rX+at+i.rY+at+i.xRot+at+ +i.lArcFlag+at+ +i.sweepFlag+at+i.x+at+i.y;else throw new Error(`Unexpected command type "${i==null?void 0:i.type}" at index ${t}.`)}return e}function Ma([s,e],t){return[s*Math.cos(t)-e*Math.sin(t),s*Math.sin(t)+e*Math.cos(t)]}function ii(...s){for(let e=0;e<s.length;e++)if(typeof s[e]!="number")throw new Error(`assertNumbers arguments[${e}] is not a number. ${typeof s[e]} == typeof ${s[e]}`);return!0}const Ni=Math.PI;function Rl(s,e,t){s.lArcFlag=s.lArcFlag===0?0:1,s.sweepFlag=s.sweepFlag===0?0:1;let{rX:i,rY:r}=s;const{x:n,y:o}=s;if(Math.abs(i)<1e-10||Math.abs(r)<1e-10){s.rX=0,s.rY=0,s.cX=(e+n)/2,s.cY=(t+o)/2,s.phi1=0,s.phi2=0;return}i=Math.abs(s.rX),r=Math.abs(s.rY);const a=s.xRot/180*Ni,[l,h]=Ma([(e-n)/2,(t-o)/2],-a),u=Math.pow(l,2)/Math.pow(i,2)+Math.pow(h,2)/Math.pow(r,2);1<u&&(i*=Math.sqrt(u),r*=Math.sqrt(u)),s.rX=i,s.rY=r;const c=Math.pow(i,2)*Math.pow(h,2)+Math.pow(r,2)*Math.pow(l,2),d=(s.lArcFlag!==s.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(i,2)*Math.pow(r,2)-c)/c)),f=i*h/r*d,p=-r*l/i*d,m=Ma([f,p],a);s.cX=m[0]+(e+n)/2,s.cY=m[1]+(t+o)/2,s.phi1=Math.atan2((h-p)/r,(l-f)/i),s.phi2=Math.atan2((-h-p)/r,(-l-f)/i),s.sweepFlag===0&&s.phi2>s.phi1&&(s.phi2-=2*Ni),s.sweepFlag===1&&s.phi2<s.phi1&&(s.phi2+=2*Ni),s.phi1*=180/Ni,s.phi2*=180/Ni}function nh(s,e,t){ii(s,e,t);const i=s*s+e*e-t*t;if(0>i)return[];if(i===0)return[[s*t/(s*s+e*e),e*t/(s*s+e*e)]];const r=Math.sqrt(i);return[[(s*t+e*r)/(s*s+e*e),(e*t-s*r)/(s*s+e*e)],[(s*t-e*r)/(s*s+e*e),(e*t+s*r)/(s*s+e*e)]]}const es=Math.PI/180;function oh(s,e,t){return(1-t)*s+t*e}function ah(s,e,t,i){return s+Math.cos(i/180*Ni)*e+Math.sin(i/180*Ni)*t}function lh(s,e,t,i){const r=e-s,n=t-e,o=i-t,a=3*r+3*o-6*n,l=(n-r)*6,h=3*r;return Math.abs(a)<1e-6?Math.abs(l)<1e-6?[]:[-h/l]:Qp(l/a,h/a,1e-6)}function hh(s,e,t,i,r){const n=1-r,o=n*n*n,a=3*n*n*r,l=3*n*r*r,h=r*r*r;return s*o+e*a+t*l+i*h}function Qp(s,e,t=1e-6){const i=s*s/4-e;if(i<-t)return[];if(i<=t)return[-s/2];const r=Math.sqrt(i);return[-(s/2)-r,-(s/2)+r]}function Jp(s,e,t){s.cX||Rl(s,e,t);const i=s.xRot/180*Ni;if(Math.abs(s.rX)<1e-10||Math.abs(s.rY)<1e-10)return[{relative:s.relative,type:Y.CURVE_TO,x1:e+(s.x-e)/3,y1:t+(s.y-t)/3,x2:e+2*(s.x-e)/3,y2:t+2*(s.y-t)/3,x:s.x,y:s.y}];const r=Math.min(s.phi1,s.phi2),n=Math.max(s.phi1,s.phi2),o=n-r,a=Math.ceil(o/90),l=new Array(a);let h=e,u=t;const c=(d,f)=>{const[p,m]=Ma([d*s.rX,f*s.rY],i);return[s.cX+p,s.cY+m]};for(let d=0;d<a;d++){const f=oh(s.phi1,s.phi2,d/a),p=oh(s.phi1,s.phi2,(d+1)/a),m=p-f,g=4/3*Math.tan(m*es/4),v=Math.cos(f*es)-g*Math.sin(f*es),x=Math.sin(f*es)+g*Math.cos(f*es),_=Math.cos(p*es),E=Math.sin(p*es),R=_+g*E,M=E-g*_,O=c(v,x),N=c(R,M),B=c(_,E),G={relative:s.relative,type:Y.CURVE_TO,x:B[0],y:B[1],x1:O[0],y1:O[1],x2:N[0],y2:N[1]};s.relative&&(G.x1-=h,G.y1-=u,G.x2-=h,G.y2-=u,G.x-=h,G.y-=u),h=B[0],u=B[1],l[d]=G}return l}function bo(s,e,t){const i=e[0]-s[0],r=e[1]-s[1],n=t[0]-s[0],o=t[1]-s[1],a=i*o-r*n;if(!(Math.abs(a)<1e-10))return!1;const l=i*n+r*o,h=i*i+r*r,u=n*n+o*o;return 0<=l&&l<=u&&h<=u}function $p(s,e=!0){if(s.length<2)return s;const t=ht.INFO((n,o,a)=>({...n,x:n.x??o,y:n.y??a,relative:n.relative??!1})),i=[];let r=[];for(const n of s){const o=t(n);o.type===Y.MOVE_TO&&r.length>0&&(e?i.push(...Xr(r)):i.unshift(...Xr(r)),r=[]),r.push(o)}return r.length>0&&(e?i.push(...Xr(r)):i.unshift(...Xr(r))),i}function Xr(s){var e;const t=((e=s[s.length-1])==null?void 0:e.type)===Y.CLOSE_PATH,i=t?s.length-2:s.length-1,r=[{type:Y.MOVE_TO,relative:!1,x:s[i].x,y:s[i].y}];for(let n=i;n>0;n--){const o=s[n],a=s[n-1];if(o.relative)throw new Error("Relative command are not supported convert first with `toAbs()`");switch(o.type){case Y.HORIZ_LINE_TO:r.push({type:Y.HORIZ_LINE_TO,relative:!1,x:a.x});break;case Y.VERT_LINE_TO:r.push({type:Y.VERT_LINE_TO,relative:!1,y:a.y});break;case Y.LINE_TO:case Y.MOVE_TO:r.push({type:Y.LINE_TO,relative:!1,x:a.x,y:a.y});break;case Y.CURVE_TO:r.push({type:Y.CURVE_TO,relative:!1,x:a.x,y:a.y,x1:o.x2,y1:o.y2,x2:o.x1,y2:o.y1});break;case Y.SMOOTH_CURVE_TO:throw new Error("Unsupported command: S (smooth cubic bezier)");case Y.SMOOTH_QUAD_TO:throw new Error("Unsupported command: T (smooth quadratic bezier)");case Y.ARC:throw new Error("Unsupported command: A (arc)");case Y.QUAD_TO:throw new Error("Unsupported command: Q (quadratic bezier)")}}return t&&r.push({type:Y.CLOSE_PATH}),r}function em(s=1e13){ii(s);function e(t){return Math.round(t*s)/s}return function(t){return"x1"in t&&typeof t.x1<"u"&&(t.x1=e(t.x1)),"y1"in t&&typeof t.y1<"u"&&(t.y1=e(t.y1)),"x2"in t&&typeof t.x2<"u"&&(t.x2=e(t.x2)),"y2"in t&&typeof t.y2<"u"&&(t.y2=e(t.y2)),"x"in t&&typeof t.x<"u"&&(t.x=e(t.x)),"y"in t&&typeof t.y<"u"&&(t.y=e(t.y)),"rX"in t&&typeof t.rX<"u"&&(t.rX=e(t.rX)),"rY"in t&&typeof t.rY<"u"&&(t.rY=e(t.rY)),t}}function Yc(){return si((s,e,t)=>(s.relative&&(typeof s.x1<"u"&&(s.x1+=e),typeof s.y1<"u"&&(s.y1+=t),typeof s.x2<"u"&&(s.x2+=e),typeof s.y2<"u"&&(s.y2+=t),typeof s.x<"u"&&(s.x+=e),typeof s.y<"u"&&(s.y+=t),s.relative=!1),s))}function tm(){return si((s,e,t)=>(s.relative||(typeof s.x1<"u"&&(s.x1-=e),typeof s.y1<"u"&&(s.y1-=t),typeof s.x2<"u"&&(s.x2-=e),typeof s.y2<"u"&&(s.y2-=t),typeof s.x<"u"&&(s.x-=e),typeof s.y<"u"&&(s.y-=t),s.relative=!0),s))}function im(s=!0,e=!0,t=!0,i=!0){return si((r,n,o,a,l)=>{if(isNaN(a)&&!(r.type&Y.MOVE_TO))throw new Error("path must start with moveto");if(e&&r.type&Y.HORIZ_LINE_TO&&(r.type=Y.LINE_TO,r.y=r.relative?0:o),t&&r.type&Y.VERT_LINE_TO&&(r.type=Y.LINE_TO,r.x=r.relative?0:n),s&&r.type&Y.CLOSE_PATH&&(r.type=Y.LINE_TO,r.x=r.relative?a-n:a,r.y=r.relative?l-o:l),r.type&Y.ARC&&(r.rX===0||r.rY===0)&&(r.type=Y.LINE_TO,delete r.rX,delete r.rY,delete r.xRot,delete r.lArcFlag,delete r.sweepFlag),i&&r.type&Y.QUAD_TO){const h=[n,o],u=r.relative?[n+r.x1,o+r.y1]:[r.x1,r.y1],c=r.relative?[n+r.x,o+r.y]:[r.x,r.y];bo(h,u,c)&&(r.type=Y.LINE_TO,delete r.x1,delete r.y1)}if(i&&r.type&Y.CURVE_TO){const h=[n,o],u=r.relative?[n+r.x1,o+r.y1]:[r.x1,r.y1],c=r.relative?[n+r.x2,o+r.y2]:[r.x2,r.y2],d=r.relative?[n+r.x,o+r.y]:[r.x,r.y];bo(h,u,d)&&bo(h,c,d)&&(r.type=Y.LINE_TO,delete r.x1,delete r.y1,delete r.x2,delete r.y2)}return r})}function qc(){let s=NaN,e=NaN,t=NaN,i=NaN;return si((r,n,o)=>(r.type&Y.SMOOTH_CURVE_TO&&(r.type=Y.CURVE_TO,s=isNaN(s)?n:s,e=isNaN(e)?o:e,r.x1=r.relative?n-s:2*n-s,r.y1=r.relative?o-e:2*o-e),r.type&Y.CURVE_TO?(s=r.relative?n+r.x2:r.x2,e=r.relative?o+r.y2:r.y2):(s=NaN,e=NaN),r.type&Y.SMOOTH_QUAD_TO&&(r.type=Y.QUAD_TO,t=isNaN(t)?n:t,i=isNaN(i)?o:i,r.x1=r.relative?n-t:2*n-t,r.y1=r.relative?o-i:2*o-i),r.type&Y.QUAD_TO?(t=r.relative?n+r.x1:r.x1,i=r.relative?o+r.y1:r.y1):(t=NaN,i=NaN),r))}function Zc(){let s=NaN,e=NaN;return si((t,i,r)=>{if(t.type&Y.SMOOTH_QUAD_TO&&(t.type=Y.QUAD_TO,s=isNaN(s)?i:s,e=isNaN(e)?r:e,t.x1=t.relative?i-s:2*i-s,t.y1=t.relative?r-e:2*r-e),t.type&Y.QUAD_TO){s=t.relative?i+t.x1:t.x1,e=t.relative?r+t.y1:t.y1;const n=t.x1,o=t.y1;t.type=Y.CURVE_TO,t.x1=((t.relative?0:i)+n*2)/3,t.y1=((t.relative?0:r)+o*2)/3,t.x2=(t.x+n*2)/3,t.y2=(t.y+o*2)/3}else s=NaN,e=NaN;return t})}function si(s){let e=0,t=0,i=NaN,r=NaN;return function(n){if(isNaN(i)&&!(n.type&Y.MOVE_TO))throw new Error("path must start with moveto");const o=s(n,e,t,i,r);return n.type&Y.CLOSE_PATH&&(e=i,t=r),"x"in n&&typeof n.x<"u"&&(e=n.relative?e+n.x:n.x),"y"in n&&typeof n.y<"u"&&(t=n.relative?t+n.y:n.y),n.type&Y.MOVE_TO&&(i=e,r=t),o}}function sm(s=0){ii(s);let e=NaN,t=NaN,i=NaN,r=NaN;return si((n,o,a,l,h)=>{const u=Math.abs;let c=!1,d=0,f=0;if(n.type&Y.SMOOTH_CURVE_TO&&(d=isNaN(e)?0:o-e,f=isNaN(t)?0:a-t),n.type&(Y.CURVE_TO|Y.SMOOTH_CURVE_TO)?(e=n.relative?o+n.x2:n.x2,t=n.relative?a+n.y2:n.y2):(e=NaN,t=NaN),n.type&Y.SMOOTH_QUAD_TO?(i=isNaN(i)?o:2*o-i,r=isNaN(r)?a:2*a-r):n.type&Y.QUAD_TO?(i=n.relative?o+n.x1:n.x1,r=n.relative?a+n.y1:n.y2):(i=NaN,r=NaN),n.type&Y.LINE_COMMANDS||n.type&Y.ARC&&(n.rX===0||n.rY===0||!n.lArcFlag)||n.type&Y.CURVE_TO||n.type&Y.SMOOTH_CURVE_TO||n.type&Y.QUAD_TO||n.type&Y.SMOOTH_QUAD_TO){const p=typeof n.x>"u"?0:n.relative?n.x:n.x-o,m=typeof n.y>"u"?0:n.relative?n.y:n.y-a;d=isNaN(i)?typeof n.x1>"u"?d:n.relative?n.x:n.x1-o:i-o,f=isNaN(r)?typeof n.y1>"u"?f:n.relative?n.y:n.y1-a:r-a;const g=typeof n.x2>"u"?0:n.relative?n.x:n.x2-o,v=typeof n.y2>"u"?0:n.relative?n.y:n.y2-a;u(p)<=s&&u(m)<=s&&u(d)<=s&&u(f)<=s&&u(g)<=s&&u(v)<=s&&(c=!0)}return n.type&Y.CLOSE_PATH&&u(o-l)<=s&&u(a-h)<=s&&(c=!0),c?[]:n})}function Qi(s,e,t,i,r,n){return ii(s,e,t,i,r,n),si((o,a,l,h)=>{const u=o.x1,c=o.x2,d=o.relative&&!isNaN(h),f=typeof o.x<"u"?o.x:d?0:a,p=typeof o.y<"u"?o.y:d?0:l;o.type&Y.HORIZ_LINE_TO&&e!==0&&(o.type=Y.LINE_TO,o.y=o.relative?0:l),o.type&Y.VERT_LINE_TO&&t!==0&&(o.type=Y.LINE_TO,o.x=o.relative?0:a),typeof o.x<"u"&&(o.x=o.x*s+p*t+(d?0:r)),typeof o.y<"u"&&(o.y=f*e+o.y*i+(d?0:n)),typeof o.x1<"u"&&(o.x1=o.x1*s+o.y1*t+(d?0:r)),typeof o.y1<"u"&&(o.y1=u*e+o.y1*i+(d?0:n)),typeof o.x2<"u"&&(o.x2=o.x2*s+o.y2*t+(d?0:r)),typeof o.y2<"u"&&(o.y2=c*e+o.y2*i+(d?0:n));function m(v){return v*v}const g=s*i-e*t;if(typeof o.xRot<"u"&&(s!==1||e!==0||t!==0||i!==1))if(g===0)delete o.rX,delete o.rY,delete o.xRot,delete o.lArcFlag,delete o.sweepFlag,o.type=Y.LINE_TO;else{const v=o.xRot*Math.PI/180,x=Math.sin(v),_=Math.cos(v),E=1/m(o.rX),R=1/m(o.rY),M=m(_)*E+m(x)*R,O=2*x*_*(E-R),N=m(x)*E+m(_)*R,B=M*i*i-O*e*i+N*e*e,G=O*(s*i+e*t)-2*(M*t*i+N*s*e),K=M*t*t-O*s*t+N*s*s,D=(Math.atan2(G,B-K)+Math.PI)%Math.PI/2,C=Math.sin(D),I=Math.cos(D);o.rX=Math.abs(g)/Math.sqrt(B*m(I)+G*C*I+K*m(C)),o.rY=Math.abs(g)/Math.sqrt(B*m(C)-G*C*I+K*m(I)),o.xRot=D*180/Math.PI}return typeof o.sweepFlag<"u"&&0>g&&(o.sweepFlag=+!o.sweepFlag),o})}function rm(s,e=0,t=0){ii(s,e,t);const i=Math.sin(s),r=Math.cos(s);return Qi(r,i,-i,r,e-e*r+t*i,t-e*i-t*r)}function nm(s,e=0){return ii(s,e),Qi(1,0,0,1,s,e)}function om(s,e=s){return ii(s,e),Qi(s,0,0,e,0,0)}function am(s){return ii(s),Qi(1,0,Math.tan(s),1,0,0)}function lm(s){return ii(s),Qi(1,Math.tan(s),0,1,0,0)}function hm(s=0){return ii(s),Qi(-1,0,0,1,s,0)}function um(s=0){return ii(s),Qi(1,0,0,-1,0,s)}function cm(){return si((s,e,t)=>Y.ARC===s.type?Jp(s,s.relative?0:e,s.relative?0:t):s)}function dm(){return si((s,e,t)=>(s.relative&&(e=0,t=0),Y.ARC===s.type&&Rl(s,e,t),s))}function Kc(){return s=>({...s})}function fm(){const s=Kc(),e=Yc(),t=Zc(),i=qc(),r=si((n,o,a)=>{const l=i(t(e(s(n))));function h(c){c>r.maxX&&(r.maxX=c),c<r.minX&&(r.minX=c)}function u(c){c>r.maxY&&(r.maxY=c),c<r.minY&&(r.minY=c)}if(l.type&Y.DRAWING_COMMANDS&&(h(o),u(a)),l.type&Y.HORIZ_LINE_TO&&h(l.x),l.type&Y.VERT_LINE_TO&&u(l.y),l.type&Y.LINE_TO&&(h(l.x),u(l.y)),l.type&Y.CURVE_TO){h(l.x),u(l.y);const c=lh(o,l.x1,l.x2,l.x);for(const f of c)0<f&&1>f&&h(hh(o,l.x1,l.x2,l.x,f));const d=lh(a,l.y1,l.y2,l.y);for(const f of d)0<f&&1>f&&u(hh(a,l.y1,l.y2,l.y,f))}if(l.type&Y.ARC){h(l.x),u(l.y),Rl(l,o,a);const c=l.xRot/180*Math.PI,d=Math.cos(c)*l.rX,f=Math.sin(c)*l.rX,p=-Math.sin(c)*l.rY,m=Math.cos(c)*l.rY,[g,v]=l.phi1<l.phi2?[l.phi1,l.phi2]:-180>l.phi2?[l.phi2+360,l.phi1+360]:[l.phi2,l.phi1],x=([R,M])=>{const O=Math.atan2(M,R)*180/Math.PI;return O<g?O+360:O},_=nh(p,-d,0).map(x);for(const R of _)R>g&&R<v&&h(ah(l.cX,d,p,R));const E=nh(m,-f,0).map(x);for(const R of E)R>g&&R<v&&u(ah(l.cY,f,m,R))}return n});return r.minX=1/0,r.maxX=-1/0,r.minY=1/0,r.maxY=-1/0,r}const ht={ROUND:em,TO_ABS:Yc,TO_REL:tm,NORMALIZE_HVZ:im,NORMALIZE_ST:qc,QT_TO_C:Zc,INFO:si,SANITIZE:sm,MATRIX:Qi,ROTATE:rm,TRANSLATE:nm,SCALE:om,SKEW_X:am,SKEW_Y:lm,X_AXIS_SYMMETRY:hm,Y_AXIS_SYMMETRY:um,A_TO_C:cm,ANNOTATE_ARCS:dm,CLONE:Kc,CALCULATE_BOUNDS:fm,REVERSE_PATH:$p};class Qc{round(e){return this.transform(ht.ROUND(e))}toAbs(){return this.transform(ht.TO_ABS())}toRel(){return this.transform(ht.TO_REL())}normalizeHVZ(e,t,i){return this.transform(ht.NORMALIZE_HVZ(e,t,i))}normalizeST(){return this.transform(ht.NORMALIZE_ST())}qtToC(){return this.transform(ht.QT_TO_C())}aToC(){return this.transform(ht.A_TO_C())}sanitize(e){return this.transform(ht.SANITIZE(e))}translate(e,t){return this.transform(ht.TRANSLATE(e,t))}scale(e,t){return this.transform(ht.SCALE(e,t))}rotate(e,t,i){return this.transform(ht.ROTATE(e,t,i))}matrix(e,t,i,r,n,o){return this.transform(ht.MATRIX(e,t,i,r,n,o))}skewX(e){return this.transform(ht.SKEW_X(e))}skewY(e){return this.transform(ht.SKEW_Y(e))}xSymmetry(e){return this.transform(ht.X_AXIS_SYMMETRY(e))}ySymmetry(e){return this.transform(ht.Y_AXIS_SYMMETRY(e))}annotateArcs(){return this.transform(ht.ANNOTATE_ARCS())}}const pm=s=>s===" "||s==="	"||s==="\r"||s===`
`,uh=s=>48<=s.charCodeAt(0)&&s.charCodeAt(0)<=57;class mm extends Qc{constructor(){super(),Qe(this,"curNumber",""),Qe(this,"curCommandType",-1),Qe(this,"curCommandRelative",!1),Qe(this,"canParseCommandOrComma",!0),Qe(this,"curNumberHasExp",!1),Qe(this,"curNumberHasExpDigits",!1),Qe(this,"curNumberHasDecimal",!1),Qe(this,"curArgs",[])}finish(e=[]){if(this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e}parse(e,t=[]){const i=r=>{t.push(r),this.curArgs.length=0,this.canParseCommandOrComma=!0};for(let r=0;r<e.length;r++){const n=e[r],o=this.curCommandType===Y.ARC&&(this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber.length===1&&(this.curNumber==="0"||this.curNumber==="1"),a=uh(n)&&(this.curNumber==="0"&&n==="0"||o);if(uh(n)&&!a){this.curNumber+=n,this.curNumberHasExpDigits=this.curNumberHasExp;continue}if(n==="e"||n==="E"){this.curNumber+=n,this.curNumberHasExp=!0;continue}if((n==="-"||n==="+")&&this.curNumberHasExp&&!this.curNumberHasExpDigits){this.curNumber+=n;continue}if(n==="."&&!this.curNumberHasExp&&!this.curNumberHasDecimal&&!o){this.curNumber+=n,this.curNumberHasDecimal=!0;continue}if(this.curNumber&&this.curCommandType!==-1){const l=Number(this.curNumber);if(isNaN(l))throw new SyntaxError(`Invalid number ending at ${r}`);if(this.curCommandType===Y.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>l)throw new SyntaxError(`Expected positive number, got "${l}" at index "${r}"`)}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError(`Expected a flag, got "${this.curNumber}" at index "${r}"`)}this.curArgs.push(l),this.curArgs.length===gm[this.curCommandType]&&(Y.HORIZ_LINE_TO===this.curCommandType?i({type:Y.HORIZ_LINE_TO,relative:this.curCommandRelative,x:l}):Y.VERT_LINE_TO===this.curCommandType?i({type:Y.VERT_LINE_TO,relative:this.curCommandRelative,y:l}):this.curCommandType===Y.MOVE_TO||this.curCommandType===Y.LINE_TO||this.curCommandType===Y.SMOOTH_QUAD_TO?(i({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),Y.MOVE_TO===this.curCommandType&&(this.curCommandType=Y.LINE_TO)):this.curCommandType===Y.CURVE_TO?i({type:Y.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===Y.SMOOTH_CURVE_TO?i({type:Y.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===Y.QUAD_TO?i({type:Y.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===Y.ARC&&i({type:Y.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!pm(n)){if(n===","&&this.canParseCommandOrComma){this.canParseCommandOrComma=!1;continue}if(n==="+"||n==="-"||n==="."){this.curNumber=n,this.curNumberHasDecimal=n===".";continue}if(a){this.curNumber=n,this.curNumberHasDecimal=!1;continue}if(this.curArgs.length!==0)throw new SyntaxError(`Unterminated command at index ${r}.`);if(!this.canParseCommandOrComma)throw new SyntaxError(`Unexpected character "${n}" at index ${r}. Command cannot follow comma`);if(this.canParseCommandOrComma=!1,n==="z"||n==="Z"){t.push({type:Y.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1;continue}else if(n==="h"||n==="H")this.curCommandType=Y.HORIZ_LINE_TO,this.curCommandRelative=n==="h";else if(n==="v"||n==="V")this.curCommandType=Y.VERT_LINE_TO,this.curCommandRelative=n==="v";else if(n==="m"||n==="M")this.curCommandType=Y.MOVE_TO,this.curCommandRelative=n==="m";else if(n==="l"||n==="L")this.curCommandType=Y.LINE_TO,this.curCommandRelative=n==="l";else if(n==="c"||n==="C")this.curCommandType=Y.CURVE_TO,this.curCommandRelative=n==="c";else if(n==="s"||n==="S")this.curCommandType=Y.SMOOTH_CURVE_TO,this.curCommandRelative=n==="s";else if(n==="q"||n==="Q")this.curCommandType=Y.QUAD_TO,this.curCommandRelative=n==="q";else if(n==="t"||n==="T")this.curCommandType=Y.SMOOTH_QUAD_TO,this.curCommandRelative=n==="t";else if(n==="a"||n==="A")this.curCommandType=Y.ARC,this.curCommandRelative=n==="a";else throw new SyntaxError(`Unexpected character "${n}" at index ${r}.`)}}return t}transform(e){return Object.create(this,{parse:{value(t,i=[]){const r=Object.getPrototypeOf(this).parse.call(this,t);for(const n of r){const o=e(n);Array.isArray(o)?i.push(...o):i.push(o)}return i}}})}}const Ve=class Ia extends Qc{constructor(e){super(),Qe(this,"commands"),typeof e=="string"?this.commands=Ia.parse(e):this.commands=e}encode(){return Ia.encode(this.commands)}getBounds(){const e=ht.CALCULATE_BOUNDS();return this.transform(e),e}transform(e){const t=[];for(const i of this.commands){const r=e(i);Array.isArray(r)?t.push(...r):t.push(r)}return this.commands=t,this}reverse(e=!0){return this.commands=ht.REVERSE_PATH(this.commands,e),this}static encode(e){return Kp(e)}static parse(e){const t=new mm,i=[];return t.parse(e,i),t.finish(i),i}};Qe(Ve,"CLOSE_PATH",1),Qe(Ve,"MOVE_TO",2),Qe(Ve,"HORIZ_LINE_TO",4),Qe(Ve,"VERT_LINE_TO",8),Qe(Ve,"LINE_TO",16),Qe(Ve,"CURVE_TO",32),Qe(Ve,"SMOOTH_CURVE_TO",64),Qe(Ve,"QUAD_TO",128),Qe(Ve,"SMOOTH_QUAD_TO",256),Qe(Ve,"ARC",512),Qe(Ve,"LINE_COMMANDS",Ve.LINE_TO|Ve.HORIZ_LINE_TO|Ve.VERT_LINE_TO),Qe(Ve,"DRAWING_COMMANDS",Ve.HORIZ_LINE_TO|Ve.VERT_LINE_TO|Ve.LINE_TO|Ve.CURVE_TO|Ve.SMOOTH_CURVE_TO|Ve.QUAD_TO|Ve.SMOOTH_QUAD_TO|Ve.ARC);let Y=Ve;const gm={[Y.MOVE_TO]:2,[Y.LINE_TO]:2,[Y.HORIZ_LINE_TO]:1,[Y.VERT_LINE_TO]:1,[Y.CLOSE_PATH]:0,[Y.QUAD_TO]:4,[Y.SMOOTH_QUAD_TO]:2,[Y.CURVE_TO]:6,[Y.SMOOTH_CURVE_TO]:4,[Y.ARC]:7},vm=[];for(let s=0;s<256;++s)vm.push((s+256).toString(16).slice(1));typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var ch=Object.prototype.hasOwnProperty;function Sr(s,e){var t,i;if(s===e)return!0;if(s&&e&&(t=s.constructor)===e.constructor){if(t===Date)return s.getTime()===e.getTime();if(t===RegExp)return s.toString()===e.toString();if(t===Array){if((i=s.length)===e.length)for(;i--&&Sr(s[i],e[i]););return i===-1}if(!t||typeof s=="object"){i=0;for(t in s)if(ch.call(s,t)&&++i&&!ch.call(e,t)||!(t in e)||!Sr(s[t],e[t]))return!1;return Object.keys(e).length===i}}return s!==s&&e!==e}function So(){}function ym(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}const bs=[];function Cl(s,e=So){let t;const i=new Set;function r(a){if(ym(s,a)&&(s=a,t)){const l=!bs.length;for(const h of i)h[1](),bs.push(h,s);if(l){for(let h=0;h<bs.length;h+=2)bs[h][0](bs[h+1]);bs.length=0}}}function n(a){r(a(s))}function o(a,l=So){const h=[a,l];return i.add(h),i.size===1&&(t=e(r,n)||So),a(s),()=>{i.delete(h),i.size===0&&t&&(t(),t=null)}}return{set:r,update:n,subscribe:o}}const xm=s=>{const{subscribe:e,set:t}=Cl();let i;return e(r=>i=r),s.observe(({changes:r})=>{if(i){(r.deleted||[]).some(o=>o.id===i)&&t(void 0);const n=(r.updated||[]).find(({oldValue:o})=>o.id===i);n&&t(n.newValue.id)}}),{get current(){return i},subscribe:e,set:t}},Wr={selected:[]},_m=(s,e,t)=>{const{subscribe:i,set:r}=Cl(Wr);let n=e,o=Wr;i(p=>o=p);const a=()=>{Sr(o,Wr)||r(Wr)},l=()=>{var p;return((p=o.selected)==null?void 0:p.length)===0},h=p=>{if(l())return!1;const m=typeof p=="string"?p:p.id;return o.selected.some(g=>g.id===m)},u=(p,m)=>{let g;if(Array.isArray(p)){if(g=p.map(x=>s.getAnnotation(x)).filter(Boolean),g.length<p.length){console.warn("Invalid selection: "+p.filter(x=>!g.some(_=>_.id===x)));return}}else{const x=s.getAnnotation(p);if(!x){console.warn("Invalid selection: "+p);return}g=[x]}const v=g.reduce((x,_)=>{const E=dh(_,n,t);return E==="EDIT"?[...x,{id:_.id,editable:!0}]:E==="SELECT"?[...x,{id:_.id}]:x},[]);r({selected:v,event:m})},c=(p,m)=>{const g=Array.isArray(p)?p:[p],v=g.map(x=>s.getAnnotation(x)).filter(x=>!!x);r({selected:v.map(x=>{const _=m===void 0?dh(x,n,t)==="EDIT":m;return{id:x.id,editable:_}})}),v.length!==g.length&&console.warn("Invalid selection",p)},d=p=>{if(l())return!1;const{selected:m}=o;m.some(({id:g})=>p.includes(g))&&r({selected:m.filter(({id:g})=>!p.includes(g))})},f=p=>{n=p,c(o.selected.map(({id:m})=>m))};return s.observe(({changes:p})=>d((p.deleted||[]).map(m=>m.id))),{get event(){return o?o.event:null},get selected(){return o?[...o.selected]:null},get userSelectAction(){return n},clear:a,isEmpty:l,isSelected:h,setSelected:c,setUserSelectAction:f,subscribe:i,userSelect:u}},dh=(s,e,t)=>{const i=t?t.serialize(s):s;return typeof e=="function"?e(i):e||"EDIT"},xt=[];for(let s=0;s<256;++s)xt.push((s+256).toString(16).slice(1));function Tm(s,e=0){return(xt[s[e+0]]+xt[s[e+1]]+xt[s[e+2]]+xt[s[e+3]]+"-"+xt[s[e+4]]+xt[s[e+5]]+"-"+xt[s[e+6]]+xt[s[e+7]]+"-"+xt[s[e+8]]+xt[s[e+9]]+"-"+xt[s[e+10]]+xt[s[e+11]]+xt[s[e+12]]+xt[s[e+13]]+xt[s[e+14]]+xt[s[e+15]]).toLowerCase()}let Ao;const wm=new Uint8Array(16);function Em(){if(!Ao){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ao=crypto.getRandomValues.bind(crypto)}return Ao(wm)}const bm=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),fh={randomUUID:bm};function Sm(s,e,t){var i;if(fh.randomUUID&&!s)return fh.randomUUID();s=s||{};const r=s.random??((i=s.rng)==null?void 0:i.call(s))??Em();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Tm(r)}const Am=(s,e)=>{const t=new Set(s.bodies.map(i=>i.id));return e.bodies.filter(i=>!t.has(i.id))},Rm=(s,e)=>{const t=new Set(e.bodies.map(i=>i.id));return s.bodies.filter(i=>!t.has(i.id))},Cm=(s,e)=>e.bodies.map(t=>{const i=s.bodies.find(r=>r.id===t.id);return{newBody:t,oldBody:i&&!Sr(i,t)?i:void 0}}).filter(({oldBody:t})=>t).map(({oldBody:t,newBody:i})=>({oldBody:t,newBody:i})),Pm=(s,e)=>!Sr(s.target,e.target),Mm=(s,e)=>{const t=Am(s,e),i=Rm(s,e),r=Cm(s,e);return{oldValue:s,newValue:e,bodiesCreated:t.length>0?t:void 0,bodiesDeleted:i.length>0?i:void 0,bodiesUpdated:r.length>0?r:void 0,targetUpdated:Pm(s,e)?{oldTarget:s.target,newTarget:e.target}:void 0}};var mt=(s=>(s.LOCAL="LOCAL",s.REMOTE="REMOTE",s.SILENT="SILENT",s))(mt||{});const Im=(s,e)=>{var t,i;const{changes:r,origin:n}=e;if(!(s.options.origin?s.options.origin===n:n!=="SILENT"))return!1;if(s.options.ignore){const{ignore:o}=s.options,a=l=>l&&l.length>0;if(!(a(r.created)||a(r.deleted))){const l=(t=r.updated)==null?void 0:t.some(u=>a(u.bodiesCreated)||a(u.bodiesDeleted)||a(u.bodiesUpdated)),h=(i=r.updated)==null?void 0:i.some(u=>u.targetUpdated);if(o==="BODY_ONLY"&&l&&!h||o==="TARGET_ONLY"&&h&&!l)return!1}}if(s.options.annotations){const o=new Set([...(r.created||[]).map(a=>a.id),...(r.deleted||[]).map(a=>a.id),...(r.updated||[]).map(({oldValue:a})=>a.id)]);return!!(Array.isArray(s.options.annotations)?s.options.annotations:[s.options.annotations]).find(a=>o.has(a))}else return!0},jr=s=>{const e=s.id===void 0?Sm():s.id;return{...s,id:e,bodies:s.bodies===void 0?[]:s.bodies.map(t=>({...t,annotation:e})),target:{...s.target,annotation:e}}},Om=s=>s.id!==void 0,Dm=()=>{const s=new Map,e=new Map,t=[],i=(D,C={})=>{t.push({onChange:D,options:C})},r=D=>{const C=t.findIndex(I=>I.onChange==D);C>-1&&t.splice(C,1)},n=(D,C)=>{const I={origin:D,changes:{created:C.created||[],updated:C.updated||[],deleted:C.deleted||[]},state:[...s.values()]};t.forEach(L=>{Im(L,I)&&L.onChange(I)})},o=(D,C=mt.LOCAL)=>{if(D.id&&s.get(D.id))throw Error(`Cannot add annotation ${D.id} - exists already`);{const I=jr(D);s.set(I.id,I),I.bodies.forEach(L=>e.set(L.id,I.id)),n(C,{created:[I]})}},a=(D,C)=>{const I=jr(typeof D=="string"?C:D),L=typeof D=="string"?D:D.id,W=L&&s.get(L);if(W){const U=Mm(W,I);return L===I.id?s.set(L,I):(s.delete(L),s.set(I.id,I)),W.bodies.forEach(V=>e.delete(V.id)),I.bodies.forEach(V=>e.set(V.id,I.id)),U}else console.warn(`Cannot update annotation ${L} - does not exist`)},l=(D,C=mt.LOCAL,I=mt.LOCAL)=>{const L=Om(C)?I:C,W=a(D,C);W&&n(L,{updated:[W]})},h=(D,C=mt.LOCAL)=>{s.get(D.id)?l(D,C):o(D,C)},u=(D,C=mt.LOCAL)=>{const I=D.reduce((L,W)=>{const U=a(W);return U?[...L,U]:L},[]);I.length>0&&n(C,{updated:I})},c=(D,C=mt.LOCAL)=>{const I=D.map(jr),{toAdd:L,toUpdate:W}=I.reduce((V,ie)=>s.get(ie.id)?{...V,toUpdate:[...V.toUpdate,ie]}:{...V,toAdd:[...V.toAdd,ie]},{toAdd:[],toUpdate:[]}),U=W.map(V=>a(V,C)).filter(Boolean);L.forEach(V=>{s.set(V.id,V),V.bodies.forEach(ie=>e.set(ie.id,V.id))}),n(C,{created:L,updated:U})},d=(D,C=mt.LOCAL)=>{const I=s.get(D.annotation);if(I){const L={...I,bodies:[...I.bodies,D]};s.set(I.id,L),e.set(D.id,L.id),n(C,{updated:[{oldValue:I,newValue:L,bodiesCreated:[D]}]})}else console.warn(`Attempt to add body to missing annotation: ${D.annotation}`)},f=()=>[...s.values()],p=(D=mt.LOCAL)=>{const C=[...s.values()];s.clear(),e.clear(),n(D,{deleted:C})},m=(D,C=!0,I=mt.LOCAL)=>{const L=D.map(jr);if(C){const W=[...s.values()];s.clear(),e.clear(),L.forEach(U=>{s.set(U.id,U),U.bodies.forEach(V=>e.set(V.id,U.id))}),n(I,{created:L,deleted:W})}else{const W=D.reduce((U,V)=>{const ie=V.id&&s.get(V.id);return ie?[...U,ie]:U},[]);if(W.length>0)throw Error(`Bulk insert would overwrite the following annotations: ${W.map(U=>U.id).join(", ")}`);L.forEach(U=>{s.set(U.id,U),U.bodies.forEach(V=>e.set(V.id,U.id))}),n(I,{created:L})}},g=D=>{const C=typeof D=="string"?D:D.id,I=s.get(C);if(I)return s.delete(C),I.bodies.forEach(L=>e.delete(L.id)),I;console.warn(`Attempt to delete missing annotation: ${C}`)},v=(D,C=mt.LOCAL)=>{const I=g(D);I&&n(C,{deleted:[I]})},x=(D,C=mt.LOCAL)=>{const I=D.reduce((L,W)=>{const U=g(W);return U?[...L,U]:L},[]);I.length>0&&n(C,{deleted:I})},_=D=>{const C=s.get(D.annotation);if(C){const I=C.bodies.find(L=>L.id===D.id);if(I){e.delete(I.id);const L={...C,bodies:C.bodies.filter(W=>W.id!==D.id)};return s.set(C.id,L),{oldValue:C,newValue:L,bodiesDeleted:[I]}}else console.warn(`Attempt to delete missing body ${D.id} from annotation ${D.annotation}`)}else console.warn(`Attempt to delete body from missing annotation ${D.annotation}`)},E=(D,C=mt.LOCAL)=>{const I=_(D);I&&n(C,{updated:[I]})},R=(D,C=mt.LOCAL)=>{const I=D.map(L=>_(L)).filter(Boolean);I.length>0&&n(C,{updated:I})},M=D=>{const C=s.get(D);return C?{...C}:void 0},O=D=>{const C=e.get(D);if(C){const I=M(C).bodies.find(L=>L.id===D);if(I)return I;console.error(`Store integrity error: body ${D} in index, but not in annotation`)}else console.warn(`Attempt to retrieve missing body: ${D}`)},N=(D,C)=>{if(D.annotation!==C.annotation)throw"Annotation integrity violation: annotation ID must be the same when updating bodies";const I=s.get(D.annotation);if(I){const L=I.bodies.find(U=>U.id===D.id),W={...I,bodies:I.bodies.map(U=>U.id===L.id?C:U)};return s.set(I.id,W),L.id!==C.id&&(e.delete(L.id),e.set(C.id,W.id)),{oldValue:I,newValue:W,bodiesUpdated:[{oldBody:L,newBody:C}]}}else console.warn(`Attempt to add body to missing annotation ${D.annotation}`)},B=(D,C,I=mt.LOCAL)=>{const L=N(D,C);L&&n(I,{updated:[L]})},G=(D,C=mt.LOCAL)=>{const I=D.map(L=>N({id:L.id,annotation:L.annotation},L)).filter(Boolean);n(C,{updated:I})},K=D=>{const C=s.get(D.annotation);if(C){const I={...C,target:{...C.target,...D}};return s.set(C.id,I),{oldValue:C,newValue:I,targetUpdated:{oldTarget:C.target,newTarget:D}}}else console.warn(`Attempt to update target on missing annotation: ${D.annotation}`)};return{addAnnotation:o,addBody:d,all:f,bulkAddAnnotations:m,bulkDeleteAnnotations:x,bulkDeleteBodies:R,bulkUpdateAnnotations:u,bulkUpdateBodies:G,bulkUpdateTargets:(D,C=mt.LOCAL)=>{const I=D.map(L=>K(L)).filter(Boolean);I.length>0&&n(C,{updated:I})},bulkUpsertAnnotations:c,clear:p,deleteAnnotation:v,deleteBody:E,getAnnotation:M,getBody:O,observe:i,unobserve:r,updateAnnotation:l,updateBody:B,updateTarget:(D,C=mt.LOCAL)=>{const I=K(D);I&&n(C,{updated:[I]})},upsertAnnotation:h}},Nm=()=>{const{subscribe:s,set:e}=Cl([]);return{subscribe:s,set:e}},Lm="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Bm=(s=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(s|=0));for(;s--;)e+=Lm[t[s]&63];return e};Bm();const Ro=(s,e)=>{const t=Math.abs(e[0]-s[0]),i=Math.abs(e[1]-s[1]);return Math.sqrt(Math.pow(t,2)+Math.pow(i,2))},so=(s,e=0)=>{const{minX:t,minY:i,maxX:r,maxY:n}=s;return{x:t-e,y:i-e,w:r-t+2*e,h:n-i+2*e}},Si=typeof window>"u"||typeof navigator>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,Fm=s=>({}),ph=s=>({grab:s[0]});function km(s){let e,t,i,r;const n=s[8].default,o=Op(n,s,s[7],ph);return{c(){e=ce("g"),o&&o.c(),b(e,"class","a9s-annotation selected")},m(a,l){ge(a,e,l),o&&o.m(e,null),t=!0,i||(r=[ke(e,"pointerup",s[2]),ke(e,"pointermove",s[1])],i=!0)},p(a,[l]){o&&o.p&&(!t||l&128)&&Np(o,n,a,a[7],t?Dp(n,a[7],l,Fm):Lp(a[7]),ph)},i(a){t||(Ne(o,a),t=!0)},o(a){We(o,a),t=!1},d(a){a&&me(e),o&&o.d(a),i=!1,zt(r)}}}function Um(s,e,t){let{$$slots:i={},$$scope:r}=e;const n=Lr();let{shape:o}=e,{editor:a}=e,{transform:l}=e,{svgEl:h}=e,u,c,d;const f=g=>v=>{if(u=g,h){const{left:x,top:_}=h.getBoundingClientRect(),E=v.clientX-x,R=v.clientY-_;c=l.elementToImage(E,R)}else{const{offsetX:x,offsetY:_}=v;c=l.elementToImage(x,_)}d=o,v.target.setPointerCapture(v.pointerId),n("grab",v)},p=g=>{if(u){const[v,x]=l.elementToImage(g.offsetX,g.offsetY),_=[v-c[0],x-c[1]];t(3,o=a(d,u,_)),n("change",o)}},m=g=>{g.target.releasePointerCapture(g.pointerId),u=void 0,d=o,n("release",g)};return s.$$set=g=>{"shape"in g&&t(3,o=g.shape),"editor"in g&&t(4,a=g.editor),"transform"in g&&t(5,l=g.transform),"svgEl"in g&&t(6,h=g.svgEl),"$$scope"in g&&t(7,r=g.$$scope)},[f,p,m,o,a,l,h,r,i]}class Pl extends Ki{constructor(e){super(),Zi(this,e,Um,km,qi,{shape:3,editor:4,transform:5,svgEl:6})}}function Hm(s){let e,t,i,r,n,o,a,l,h=s[3]&&mh(s);return{c(){e=ce("g"),t=ce("circle"),h&&h.c(),r=ce("circle"),b(t,"class","a9s-handle-buffer svelte-160z737"),b(t,"cx",s[0]),b(t,"cy",s[1]),b(t,"r",i=s[5]+6/s[2]),b(r,"class",n=Vr(`a9s-handle-dot${s[3]?" selected":""}`)+" svelte-160z737"),b(r,"cx",s[0]),b(r,"cy",s[1]),b(r,"r",s[5]),b(e,"class",o=Vr(`a9s-handle ${s[8].class||""}`.trim())+" svelte-160z737")},m(u,c){ge(u,e,c),Le(e,t),h&&h.m(e,null),Le(e,r),a||(l=[ke(t,"pointerenter",s[11]),ke(t,"pointerleave",s[12]),ke(t,"pointerdown",s[13]),ke(t,"pointerdown",s[6]),ke(t,"pointerup",s[14]),ke(t,"pointerup",s[7])],a=!0)},p(u,c){c&1&&b(t,"cx",u[0]),c&2&&b(t,"cy",u[1]),c&36&&i!==(i=u[5]+6/u[2])&&b(t,"r",i),u[3]?h?h.p(u,c):(h=mh(u),h.c(),h.m(e,r)):h&&(h.d(1),h=null),c&8&&n!==(n=Vr(`a9s-handle-dot${u[3]?" selected":""}`)+" svelte-160z737")&&b(r,"class",n),c&1&&b(r,"cx",u[0]),c&2&&b(r,"cy",u[1]),c&32&&b(r,"r",u[5]),c&256&&o!==(o=Vr(`a9s-handle ${u[8].class||""}`.trim())+" svelte-160z737")&&b(e,"class",o)},d(u){u&&me(e),h&&h.d(),a=!1,zt(l)}}}function Gm(s){let e,t,i,r,n,o,a,l,h;return{c(){e=ce("g"),t=ce("circle"),r=ce("circle"),o=ce("circle"),b(t,"cx",s[0]),b(t,"cy",s[1]),b(t,"r",i=s[5]*10),b(t,"class","a9s-touch-halo svelte-160z737"),ih(t,"touched",s[4]),b(r,"cx",s[0]),b(r,"cy",s[1]),b(r,"r",n=s[5]+10/s[2]),b(r,"class","a9s-handle-buffer svelte-160z737"),b(o,"class","a9s-handle-dot svelte-160z737"),b(o,"cx",s[0]),b(o,"cy",s[1]),b(o,"r",a=s[5]+2/s[2]),b(e,"class","a9s-touch-handle")},m(u,c){ge(u,e,c),Le(e,t),Le(e,r),Le(e,o),l||(h=[ke(r,"pointerdown",s[9]),ke(r,"pointerup",s[10]),ke(r,"pointerdown",s[6]),ke(r,"pointerup",s[7])],l=!0)},p(u,c){c&1&&b(t,"cx",u[0]),c&2&&b(t,"cy",u[1]),c&32&&i!==(i=u[5]*10)&&b(t,"r",i),c&16&&ih(t,"touched",u[4]),c&1&&b(r,"cx",u[0]),c&2&&b(r,"cy",u[1]),c&36&&n!==(n=u[5]+10/u[2])&&b(r,"r",n),c&1&&b(o,"cx",u[0]),c&2&&b(o,"cy",u[1]),c&36&&a!==(a=u[5]+2/u[2])&&b(o,"r",a)},d(u){u&&me(e),l=!1,zt(h)}}}function mh(s){let e,t;return{c(){e=ce("circle"),b(e,"class","a9s-handle-selected svelte-160z737"),b(e,"cx",s[0]),b(e,"cy",s[1]),b(e,"r",t=s[5]+8/s[2])},m(i,r){ge(i,e,r)},p(i,r){r&1&&b(e,"cx",i[0]),r&2&&b(e,"cy",i[1]),r&36&&t!==(t=i[5]+8/i[2])&&b(e,"r",t)},d(i){i&&me(e)}}}function zm(s){let e;function t(r,n){return Si?Gm:Hm}let i=t()(s);return{c(){i.c(),e=ir()},m(r,n){i.m(r,n),ge(r,e,n)},p(r,[n]){i.p(r,n)},i:ei,o:ei,d(r){r&&me(e),i.d(r)}}}function Vm(s,e,t){let i,{x:r}=e,{y:n}=e,{scale:o}=e,{selected:a=void 0}=e,l=!1;const h=v=>{v.pointerType==="touch"&&t(4,l=!0)},u=()=>t(4,l=!1);function c(v){bt.call(this,s,v)}function d(v){bt.call(this,s,v)}function f(v){bt.call(this,s,v)}function p(v){bt.call(this,s,v)}function m(v){bt.call(this,s,v)}function g(v){bt.call(this,s,v)}return s.$$set=v=>{t(8,e=ba(ba({},e),th(v))),"x"in v&&t(0,r=v.x),"y"in v&&t(1,n=v.y),"scale"in v&&t(2,o=v.scale),"selected"in v&&t(3,a=v.selected)},s.$$.update=()=>{s.$$.dirty&4&&t(5,i=4/o)},e=th(e),[r,n,o,a,l,i,h,u,e,c,d,f,p,m,g]}class Hs extends Ki{constructor(e){super(),Zi(this,e,Vm,zm,qi,{x:0,y:1,scale:2,selected:3})}}function Xm(s){let e,t,i,r,n,o,a;return{c(){e=ce("g"),t=ce("circle"),r=ce("circle"),n=ce("circle"),b(t,"class","a9s-polygon-midpoint-buffer svelte-12ykj76"),b(t,"cx",s[0]),b(t,"cy",s[1]),b(t,"r",i=1.75*s[2]),b(r,"class","a9s-polygon-midpoint-outer svelte-12ykj76"),b(r,"cx",s[0]),b(r,"cy",s[1]),b(r,"r",s[2]),b(n,"class","a9s-polygon-midpoint-inner svelte-12ykj76"),b(n,"cx",s[0]),b(n,"cy",s[1]),b(n,"r",s[2]),b(e,"class","a9s-polygon-midpoint svelte-12ykj76")},m(l,h){ge(l,e,h),Le(e,t),Le(e,r),Le(e,n),o||(a=[ke(t,"pointerdown",s[5]),ke(t,"pointerdown",s[3])],o=!0)},p(l,h){h&1&&b(t,"cx",l[0]),h&2&&b(t,"cy",l[1]),h&4&&i!==(i=1.75*l[2])&&b(t,"r",i),h&1&&b(r,"cx",l[0]),h&2&&b(r,"cy",l[1]),h&4&&b(r,"r",l[2]),h&1&&b(n,"cx",l[0]),h&2&&b(n,"cy",l[1]),h&4&&b(n,"r",l[2])},d(l){l&&me(e),o=!1,zt(a)}}}function Wm(s){let e;return{c(){e=ce("circle"),b(e,"cx",s[0]),b(e,"cy",s[1]),b(e,"r",s[2])},m(t,i){ge(t,e,i)},p(t,i){i&1&&b(e,"cx",t[0]),i&2&&b(e,"cy",t[1]),i&4&&b(e,"r",t[2])},d(t){t&&me(e)}}}function jm(s){let e;function t(r,n){return Si?Wm:Xm}let i=t()(s);return{c(){i.c(),e=ir()},m(r,n){i.m(r,n),ge(r,e,n)},p(r,[n]){i.p(r,n)},i:ei,o:ei,d(r){r&&me(e),i.d(r)}}}function Ym(s,e,t){let i,{x:r}=e,{y:n}=e,{scale:o}=e;const a=h=>{h.pointerType};function l(h){bt.call(this,s,h)}return s.$$set=h=>{"x"in h&&t(0,r=h.x),"y"in h&&t(1,n=h.y),"scale"in h&&t(4,o=h.scale)},s.$$.update=()=>{s.$$.dirty&16&&t(2,i=4/o)},[r,n,i,a,o,l]}class Jc extends Ki{constructor(e){super(),Zi(this,e,Ym,jm,qi,{x:0,y:1,scale:4})}}function Co(s){const e=s.slice(),t=e[10][e[6]];return e[28]=t.point,e}function gh(s,e,t){const i=s.slice();return i[28]=e[t],i[30]=t,i}function Po(s){const e=s.slice(),t=e[10][e[6]];return e[28]=t.point,e}function Mo(s){const e=s.slice(),t=e[10][e[6]];return e[28]=t.point,e}function vh(s){let e,t,i,r;return{c(){e=ce("circle"),b(e,"cx",t=s[28][0]),b(e,"cy",i=s[28][1]),b(e,"r",r=Ar/s[3]),b(e,"class","svelte-1h2slbm")},m(n,o){ge(n,e,o)},p(n,o){o[0]&1088&&t!==(t=n[28][0])&&b(e,"cx",t),o[0]&1088&&i!==(i=n[28][1])&&b(e,"cy",i),o[0]&8&&r!==(r=Ar/n[3])&&b(e,"r",r)},d(n){n&&me(e)}}}function yh(s){let e,t,i,r,n,o,a,l,h,u;return{c(){e=ce("mask"),t=ce("rect"),a=ce("circle"),b(t,"x",i=s[9].x),b(t,"y",r=s[9].y),b(t,"width",n=s[9].w),b(t,"height",o=s[9].h),b(t,"class","svelte-1h2slbm"),b(a,"cx",l=s[28][0]),b(a,"cy",h=s[28][1]),b(a,"r",u=Ar/s[3]),b(a,"class","svelte-1h2slbm"),b(e,"id",`${s[19]}-inner`),b(e,"class","a9s-polygon-editor-mask svelte-1h2slbm")},m(c,d){ge(c,e,d),Le(e,t),Le(e,a)},p(c,d){d[0]&512&&i!==(i=c[9].x)&&b(t,"x",i),d[0]&512&&r!==(r=c[9].y)&&b(t,"y",r),d[0]&512&&n!==(n=c[9].w)&&b(t,"width",n),d[0]&512&&o!==(o=c[9].h)&&b(t,"height",o),d[0]&1088&&l!==(l=c[28][0])&&b(a,"cx",l),d[0]&1088&&h!==(h=c[28][1])&&b(a,"cy",h),d[0]&8&&u!==(u=Ar/c[3])&&b(a,"r",u)},d(c){c&&me(e)}}}function xh(s){let e,t;return e=new Hs({props:{class:"a9s-corner-handle",x:s[28][0],y:s[28][1],scale:s[3],selected:s[8].includes(s[30])}}),e.$on("pointerenter",s[11]),e.$on("pointerleave",s[12]),e.$on("pointerdown",s[15]),e.$on("pointerdown",function(){ct(s[27](`HANDLE-${s[30]}`))&&s[27](`HANDLE-${s[30]}`).apply(this,arguments)}),e.$on("pointerup",s[16](s[30])),{c(){Kt(e.$$.fragment)},m(i,r){kt(e,i,r),t=!0},p(i,r){s=i;const n={};r[0]&32&&(n.x=s[28][0]),r[0]&32&&(n.y=s[28][1]),r[0]&8&&(n.scale=s[3]),r[0]&256&&(n.selected=s[8].includes(s[30])),e.$set(n)},i(i){t||(Ne(e.$$.fragment,i),t=!0)},o(i){We(e.$$.fragment,i),t=!1},d(i){Ut(e,i)}}}function _h(s){let e,t;return e=new Jc({props:{x:s[28][0],y:s[28][1],scale:s[3]}}),e.$on("pointerdown",function(){ct(s[18](s[6]))&&s[18](s[6]).apply(this,arguments)}),{c(){Kt(e.$$.fragment)},m(i,r){kt(e,i,r),t=!0},p(i,r){s=i;const n={};r[0]&1088&&(n.x=s[28][0]),r[0]&1088&&(n.y=s[28][1]),r[0]&8&&(n.scale=s[3]),e.$set(n)},i(i){t||(Ne(e.$$.fragment,i),t=!0)},o(i){We(e.$$.fragment,i),t=!1},d(i){Ut(e,i)}}}function qm(s){let e,t,i,r,n,o,a,l,h,u,c,d,f,p,m,g,v,x,_,E,R,M=s[6]!==void 0&&!s[7]&&vh(Mo(s)),O=s[6]!==void 0&&!s[7]&&yh(Po(s)),N=Xi(s[5].points),B=[];for(let D=0;D<N.length;D+=1)B[D]=xh(gh(s,N,D));const G=D=>We(B[D],1,1,()=>{B[D]=null});let K=s[6]!==void 0&&!s[7]&&_h(Co(s));return{c(){e=ce("defs"),t=ce("mask"),i=ce("rect"),l=ce("polygon"),M&&M.c(),O&&O.c(),u=At(),c=ce("polygon"),f=At(),p=ce("polygon"),g=At();for(let D=0;D<B.length;D+=1)B[D].c();v=At(),K&&K.c(),x=ir(),b(i,"x",r=s[9].x),b(i,"y",n=s[9].y),b(i,"width",o=s[9].w),b(i,"height",a=s[9].h),b(i,"class","svelte-1h2slbm"),b(l,"points",h=s[5].points.map(Th).join(" ")),b(l,"class","svelte-1h2slbm"),b(t,"id",`${s[19]}-outer`),b(t,"class","a9s-polygon-editor-mask svelte-1h2slbm"),b(c,"class","a9s-outer"),b(c,"mask",`url(#${s[19]}-outer)`),b(c,"points",d=s[5].points.map(wh).join(" ")),b(p,"class","a9s-inner a9s-shape-handle"),b(p,"mask",`url(#${s[19]}-inner)`),b(p,"style",s[1]),b(p,"points",m=s[5].points.map(Eh).join(" "))},m(D,C){ge(D,e,C),Le(e,t),Le(t,i),Le(t,l),M&&M.m(t,null),O&&O.m(e,null),ge(D,u,C),ge(D,c,C),ge(D,f,C),ge(D,p,C),ge(D,g,C);for(let I=0;I<B.length;I+=1)B[I]&&B[I].m(D,C);ge(D,v,C),K&&K.m(D,C),ge(D,x,C),_=!0,E||(R=[ke(c,"pointerup",s[14]),ke(c,"pointerdown",function(){ct(s[27]("SHAPE"))&&s[27]("SHAPE").apply(this,arguments)}),ke(p,"pointermove",s[13]),ke(p,"pointerup",s[14]),ke(p,"pointerdown",function(){ct(s[27]("SHAPE"))&&s[27]("SHAPE").apply(this,arguments)})],E=!0)},p(D,C){if(s=D,(!_||C[0]&512&&r!==(r=s[9].x))&&b(i,"x",r),(!_||C[0]&512&&n!==(n=s[9].y))&&b(i,"y",n),(!_||C[0]&512&&o!==(o=s[9].w))&&b(i,"width",o),(!_||C[0]&512&&a!==(a=s[9].h))&&b(i,"height",a),(!_||C[0]&32&&h!==(h=s[5].points.map(Th).join(" ")))&&b(l,"points",h),s[6]!==void 0&&!s[7]?M?M.p(Mo(s),C):(M=vh(Mo(s)),M.c(),M.m(t,null)):M&&(M.d(1),M=null),s[6]!==void 0&&!s[7]?O?O.p(Po(s),C):(O=yh(Po(s)),O.c(),O.m(e,null)):O&&(O.d(1),O=null),(!_||C[0]&32&&d!==(d=s[5].points.map(wh).join(" ")))&&b(c,"points",d),(!_||C[0]&2)&&b(p,"style",s[1]),(!_||C[0]&32&&m!==(m=s[5].points.map(Eh).join(" ")))&&b(p,"points",m),C[0]&134322472){N=Xi(s[5].points);let I;for(I=0;I<N.length;I+=1){const L=gh(s,N,I);B[I]?(B[I].p(L,C),Ne(B[I],1)):(B[I]=xh(L),B[I].c(),Ne(B[I],1),B[I].m(v.parentNode,v))}for(Js(),I=N.length;I<B.length;I+=1)G(I);$s()}s[6]!==void 0&&!s[7]?K?(K.p(Co(s),C),C[0]&192&&Ne(K,1)):(K=_h(Co(s)),K.c(),Ne(K,1),K.m(x.parentNode,x)):K&&(Js(),We(K,1,1,()=>{K=null}),$s())},i(D){if(!_){for(let C=0;C<N.length;C+=1)Ne(B[C]);Ne(K),_=!0}},o(D){B=B.filter(Boolean);for(let C=0;C<B.length;C+=1)We(B[C]);We(K),_=!1},d(D){D&&(me(e),me(u),me(c),me(f),me(p),me(g),me(v),me(x)),M&&M.d(),O&&O.d(),eo(B,D),K&&K.d(D),E=!1,zt(R)}}}function Zm(s){let e,t;return e=new Pl({props:{shape:s[0],transform:s[2],editor:s[17],svgEl:s[4],$$slots:{default:[qm,({grab:i})=>({27:i}),({grab:i})=>[i?134217728:0]]},$$scope:{ctx:s}}}),e.$on("change",s[20]),e.$on("grab",s[21]),e.$on("release",s[22]),{c(){Kt(e.$$.fragment)},m(i,r){kt(e,i,r),t=!0},p(i,r){const n={};r[0]&1&&(n.shape=i[0]),r[0]&4&&(n.transform=i[2]),r[0]&16&&(n.svgEl=i[4]),r[0]&134219754|r[1]&1&&(n.$$scope={dirty:r,ctx:i}),e.$set(n)},i(i){t||(Ne(e.$$.fragment,i),t=!0)},o(i){We(e.$$.fragment,i),t=!1},d(i){Ut(e,i)}}}const Km=250,Qm=1e3,Jm=12,Ar=4.5,Th=s=>s.join(","),wh=s=>s.join(","),Eh=s=>s.join(",");function $m(s,e,t){let i,r,n;const o=Lr();let{shape:a}=e,{computedStyle:l}=e,{transform:h}=e,{viewportScale:u=1}=e,{svgEl:c}=e,d,f=!1,p,m=[];const g=()=>t(7,f=!0),v=()=>t(7,f=!1),x=I=>{if(m.length>0||!r.some(F=>F.visible)){t(6,d=void 0);return}const[L,W]=h.elementToImage(I.offsetX,I.offsetY),U=F=>Math.pow(F[0]-L,2)+Math.pow(F[1]-W,2),V=i.points.reduce((F,Z)=>U(Z)<U(F)?Z:F),ie=r.filter(F=>F.visible).reduce((F,Z)=>U(Z.point)<U(F.point)?Z:F),k=Math.pow(Qm/u,2);U(V)<k||U(ie.point)<k?t(6,d=r.indexOf(ie)):t(6,d=void 0)},_=()=>{document.activeElement!==c&&c.focus()},E=()=>{t(8,m=[]),_()},R=I=>{t(7,f=!0),I.preventDefault(),I.stopPropagation(),p=performance.now()},M=I=>L=>{if(!p||Si||performance.now()-p>Km)return;const W=m.includes(I);L.metaKey||L.ctrlKey||L.shiftKey?W?t(8,m=m.filter(U=>U!==I)):t(8,m=[...m,I]):W&&m.length>1?t(8,m=[I]):W?t(8,m=[]):t(8,m=[I]),_()},O=(I,L,W)=>{_();let U;const V=I.geometry;m.length>1?U=V.points.map(([k,F],Z)=>m.includes(Z)?[k+W[0],F+W[1]]:[k,F]):L==="SHAPE"?U=V.points.map(([k,F])=>[k+W[0],F+W[1]]):U=V.points.map(([k,F],Z)=>L===`HANDLE-${Z}`?[k+W[0],F+W[1]]:[k,F]);const ie=Qt(U);return{...I,geometry:{points:U,bounds:ie}}},N=I=>async L=>{L.stopPropagation();const W=[...i.points.slice(0,I+1),r[I].point,...i.points.slice(I+1)],U=Qt(W);o("change",{...a,geometry:{points:W,bounds:U}}),await Wc();const V=[...document.querySelectorAll(".a9s-handle")][I+1];if(V!=null&&V.firstChild){const ie=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:L.clientX,clientY:L.clientY,pointerId:L.pointerId,pointerType:L.pointerType,isPrimary:L.isPrimary,buttons:L.buttons});V.firstChild.dispatchEvent(ie)}},B=()=>{if(i.points.length<4)return;const I=i.points.filter((W,U)=>!m.includes(U)),L=Qt(I);o("change",{...a,geometry:{points:I,bounds:L}}),t(8,m=[])};to(()=>{if(Si)return;const I=L=>{(L.key==="Delete"||L.key==="Backspace")&&(L.preventDefault(),B())};return c.addEventListener("pointermove",x),c.addEventListener("keydown",I),()=>{c.removeEventListener("pointermove",x),c.removeEventListener("keydown",I)}});const G=`polygon-mask-${Math.random().toString(36).substring(2,12)}`;function K(I){bt.call(this,s,I)}function D(I){bt.call(this,s,I)}function C(I){bt.call(this,s,I)}return s.$$set=I=>{"shape"in I&&t(0,a=I.shape),"computedStyle"in I&&t(1,l=I.computedStyle),"transform"in I&&t(2,h=I.transform),"viewportScale"in I&&t(3,u=I.viewportScale),"svgEl"in I&&t(4,c=I.svgEl)},s.$$.update=()=>{s.$$.dirty[0]&1&&t(5,i=a.geometry),s.$$.dirty[0]&40&&t(10,r=Si?[]:i.points.map((I,L)=>{const W=L===i.points.length-1?i.points[0]:i.points[L+1],U=(I[0]+W[0])/2,V=(I[1]+W[1])/2,ie=Math.sqrt(Math.pow(W[0]-U,2)+Math.pow(W[1]-V,2))>Jm/u;return{point:[U,V],visible:ie}})),s.$$.dirty[0]&40&&t(9,n=so(i.bounds,Ar/u))},[a,l,h,u,c,i,d,f,m,n,r,g,v,x,E,R,M,O,N,G,K,D,C]}class eg extends Ki{constructor(e){super(),Zi(this,e,$m,Zm,qi,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}function tg(s){let e,t,i,r,n,o,a,l,h,u,c,d,f,p,m,g,v,x,_,E,R,M,O,N,B,G,K,D,C,I,L,W,U,V,ie,k,F,Z,Q,ae,de,be,De,Be,Ye,Ce,Pe,Oe,He,qe,ot,tt,y,A,H;return Ce=new Hs({props:{class:"a9s-corner-handle-topleft",x:s[5].x,y:s[5].y,scale:s[3]}}),Ce.$on("pointerdown",function(){ct(s[12]("TOP_LEFT"))&&s[12]("TOP_LEFT").apply(this,arguments)}),Oe=new Hs({props:{class:"a9s-corner-handle-topright",x:s[5].x+s[5].w,y:s[5].y,scale:s[3]}}),Oe.$on("pointerdown",function(){ct(s[12]("TOP_RIGHT"))&&s[12]("TOP_RIGHT").apply(this,arguments)}),qe=new Hs({props:{class:"a9s-corner-handle-bottomright",x:s[5].x+s[5].w,y:s[5].y+s[5].h,scale:s[3]}}),qe.$on("pointerdown",function(){ct(s[12]("BOTTOM_RIGHT"))&&s[12]("BOTTOM_RIGHT").apply(this,arguments)}),tt=new Hs({props:{class:"a9s-corner-handle-bottomleft",x:s[5].x,y:s[5].y+s[5].h,scale:s[3]}}),tt.$on("pointerdown",function(){ct(s[12]("BOTTOM_LEFT"))&&s[12]("BOTTOM_LEFT").apply(this,arguments)}),{c(){e=ce("defs"),t=ce("mask"),i=ce("rect"),l=ce("rect"),f=At(),p=ce("rect"),_=At(),E=ce("rect"),B=At(),G=ce("rect"),I=At(),L=ce("rect"),ie=At(),k=ce("rect"),ae=At(),de=ce("rect"),Ye=At(),Kt(Ce.$$.fragment),Pe=At(),Kt(Oe.$$.fragment),He=At(),Kt(qe.$$.fragment),ot=At(),Kt(tt.$$.fragment),b(i,"class","rect-mask-bg svelte-1njczvj"),b(i,"x",r=s[6].x),b(i,"y",n=s[6].y),b(i,"width",o=s[6].w),b(i,"height",a=s[6].h),b(l,"class","rect-mask-fg svelte-1njczvj"),b(l,"x",h=s[5].x),b(l,"y",u=s[5].y),b(l,"width",c=s[5].w),b(l,"height",d=s[5].h),b(t,"id",s[8]),b(t,"class","a9s-rectangle-editor-mask svelte-1njczvj"),b(p,"class","a9s-outer"),b(p,"mask",`url(#${s[8]})`),b(p,"x",m=s[5].x),b(p,"y",g=s[5].y),b(p,"width",v=s[5].w),b(p,"height",x=s[5].h),b(E,"class","a9s-inner a9s-shape-handle"),b(E,"style",s[1]),b(E,"x",R=s[5].x),b(E,"y",M=s[5].y),b(E,"width",O=s[5].w),b(E,"height",N=s[5].h),b(G,"class","a9s-edge-handle a9s-edge-handle-top"),b(G,"x",K=s[5].x),b(G,"y",D=s[5].y),b(G,"height",1),b(G,"width",C=s[5].w),b(L,"class","a9s-edge-handle a9s-edge-handle-right"),b(L,"x",W=s[5].x+s[5].w),b(L,"y",U=s[5].y),b(L,"height",V=s[5].h),b(L,"width",1),b(k,"class","a9s-edge-handle a9s-edge-handle-bottom"),b(k,"x",F=s[5].x),b(k,"y",Z=s[5].y+s[5].h),b(k,"height",1),b(k,"width",Q=s[5].w),b(de,"class","a9s-edge-handle a9s-edge-handle-left"),b(de,"x",be=s[5].x),b(de,"y",De=s[5].y),b(de,"height",Be=s[5].h),b(de,"width",1)},m(X,z){ge(X,e,z),Le(e,t),Le(t,i),Le(t,l),ge(X,f,z),ge(X,p,z),ge(X,_,z),ge(X,E,z),ge(X,B,z),ge(X,G,z),ge(X,I,z),ge(X,L,z),ge(X,ie,z),ge(X,k,z),ge(X,ae,z),ge(X,de,z),ge(X,Ye,z),kt(Ce,X,z),ge(X,Pe,z),kt(Oe,X,z),ge(X,He,z),kt(qe,X,z),ge(X,ot,z),kt(tt,X,z),y=!0,A||(H=[ke(p,"pointerdown",function(){ct(s[12]("SHAPE"))&&s[12]("SHAPE").apply(this,arguments)}),ke(E,"pointerdown",function(){ct(s[12]("SHAPE"))&&s[12]("SHAPE").apply(this,arguments)}),ke(G,"pointerdown",function(){ct(s[12]("TOP"))&&s[12]("TOP").apply(this,arguments)}),ke(L,"pointerdown",function(){ct(s[12]("RIGHT"))&&s[12]("RIGHT").apply(this,arguments)}),ke(k,"pointerdown",function(){ct(s[12]("BOTTOM"))&&s[12]("BOTTOM").apply(this,arguments)}),ke(de,"pointerdown",function(){ct(s[12]("LEFT"))&&s[12]("LEFT").apply(this,arguments)})],A=!0)},p(X,z){s=X,(!y||z&64&&r!==(r=s[6].x))&&b(i,"x",r),(!y||z&64&&n!==(n=s[6].y))&&b(i,"y",n),(!y||z&64&&o!==(o=s[6].w))&&b(i,"width",o),(!y||z&64&&a!==(a=s[6].h))&&b(i,"height",a),(!y||z&32&&h!==(h=s[5].x))&&b(l,"x",h),(!y||z&32&&u!==(u=s[5].y))&&b(l,"y",u),(!y||z&32&&c!==(c=s[5].w))&&b(l,"width",c),(!y||z&32&&d!==(d=s[5].h))&&b(l,"height",d),(!y||z&32&&m!==(m=s[5].x))&&b(p,"x",m),(!y||z&32&&g!==(g=s[5].y))&&b(p,"y",g),(!y||z&32&&v!==(v=s[5].w))&&b(p,"width",v),(!y||z&32&&x!==(x=s[5].h))&&b(p,"height",x),(!y||z&2)&&b(E,"style",s[1]),(!y||z&32&&R!==(R=s[5].x))&&b(E,"x",R),(!y||z&32&&M!==(M=s[5].y))&&b(E,"y",M),(!y||z&32&&O!==(O=s[5].w))&&b(E,"width",O),(!y||z&32&&N!==(N=s[5].h))&&b(E,"height",N),(!y||z&32&&K!==(K=s[5].x))&&b(G,"x",K),(!y||z&32&&D!==(D=s[5].y))&&b(G,"y",D),(!y||z&32&&C!==(C=s[5].w))&&b(G,"width",C),(!y||z&32&&W!==(W=s[5].x+s[5].w))&&b(L,"x",W),(!y||z&32&&U!==(U=s[5].y))&&b(L,"y",U),(!y||z&32&&V!==(V=s[5].h))&&b(L,"height",V),(!y||z&32&&F!==(F=s[5].x))&&b(k,"x",F),(!y||z&32&&Z!==(Z=s[5].y+s[5].h))&&b(k,"y",Z),(!y||z&32&&Q!==(Q=s[5].w))&&b(k,"width",Q),(!y||z&32&&be!==(be=s[5].x))&&b(de,"x",be),(!y||z&32&&De!==(De=s[5].y))&&b(de,"y",De),(!y||z&32&&Be!==(Be=s[5].h))&&b(de,"height",Be);const oe={};z&32&&(oe.x=s[5].x),z&32&&(oe.y=s[5].y),z&8&&(oe.scale=s[3]),Ce.$set(oe);const J={};z&32&&(J.x=s[5].x+s[5].w),z&32&&(J.y=s[5].y),z&8&&(J.scale=s[3]),Oe.$set(J);const xe={};z&32&&(xe.x=s[5].x+s[5].w),z&32&&(xe.y=s[5].y+s[5].h),z&8&&(xe.scale=s[3]),qe.$set(xe);const Me={};z&32&&(Me.x=s[5].x),z&32&&(Me.y=s[5].y+s[5].h),z&8&&(Me.scale=s[3]),tt.$set(Me)},i(X){y||(Ne(Ce.$$.fragment,X),Ne(Oe.$$.fragment,X),Ne(qe.$$.fragment,X),Ne(tt.$$.fragment,X),y=!0)},o(X){We(Ce.$$.fragment,X),We(Oe.$$.fragment,X),We(qe.$$.fragment,X),We(tt.$$.fragment,X),y=!1},d(X){X&&(me(e),me(f),me(p),me(_),me(E),me(B),me(G),me(I),me(L),me(ie),me(k),me(ae),me(de),me(Ye),me(Pe),me(He),me(ot)),Ut(Ce,X),Ut(Oe,X),Ut(qe,X),Ut(tt,X),A=!1,zt(H)}}}function ig(s){let e,t;return e=new Pl({props:{shape:s[0],transform:s[2],editor:s[7],svgEl:s[4],$$slots:{default:[tg,({grab:i})=>({12:i}),({grab:i})=>i?4096:0]},$$scope:{ctx:s}}}),e.$on("grab",s[9]),e.$on("change",s[10]),e.$on("release",s[11]),{c(){Kt(e.$$.fragment)},m(i,r){kt(e,i,r),t=!0},p(i,[r]){const n={};r&1&&(n.shape=i[0]),r&4&&(n.transform=i[2]),r&16&&(n.svgEl=i[4]),r&12394&&(n.$$scope={dirty:r,ctx:i}),e.$set(n)},i(i){t||(Ne(e.$$.fragment,i),t=!0)},o(i){We(e.$$.fragment,i),t=!1},d(i){Ut(e,i)}}}function sg(s,e,t){let i,r,{shape:n}=e,{computedStyle:o}=e,{transform:a}=e,{viewportScale:l=1}=e,{svgEl:h}=e;const u=(m,g,v)=>{const x=m.geometry.bounds;let[_,E]=[x.minX,x.minY],[R,M]=[x.maxX,x.maxY];const[O,N]=v;if(g==="SHAPE")_+=O,R+=O,E+=N,M+=N;else{switch(g){case"TOP":case"TOP_LEFT":case"TOP_RIGHT":{E+=N;break}case"BOTTOM":case"BOTTOM_LEFT":case"BOTTOM_RIGHT":{M+=N;break}}switch(g){case"LEFT":case"TOP_LEFT":case"BOTTOM_LEFT":{_+=O;break}case"RIGHT":case"TOP_RIGHT":case"BOTTOM_RIGHT":{R+=O;break}}}const B=Math.min(_,R),G=Math.min(E,M),K=Math.abs(R-_),D=Math.abs(M-E);return{...m,geometry:{x:B,y:G,w:K,h:D,bounds:{minX:B,minY:G,maxX:B+K,maxY:G+D}}}},c=`rect-mask-${Math.random().toString(36).substring(2,12)}`;function d(m){bt.call(this,s,m)}function f(m){bt.call(this,s,m)}function p(m){bt.call(this,s,m)}return s.$$set=m=>{"shape"in m&&t(0,n=m.shape),"computedStyle"in m&&t(1,o=m.computedStyle),"transform"in m&&t(2,a=m.transform),"viewportScale"in m&&t(3,l=m.viewportScale),"svgEl"in m&&t(4,h=m.svgEl)},s.$$.update=()=>{s.$$.dirty&1&&t(5,i=n.geometry),s.$$.dirty&40&&t(6,r=so(i.bounds,2/l))},[n,o,a,l,h,i,r,u,c,d,f,p]}class rg extends Ki{constructor(e){super(),Zi(this,e,sg,ig,qi,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4})}}var bh=Object.prototype.hasOwnProperty;function Oa(s,e){var t,i;if(s===e)return!0;if(s&&e&&(t=s.constructor)===e.constructor){if(t===Date)return s.getTime()===e.getTime();if(t===RegExp)return s.toString()===e.toString();if(t===Array){if((i=s.length)===e.length)for(;i--&&Oa(s[i],e[i]););return i===-1}if(!t||typeof s=="object"){i=0;for(t in s)if(bh.call(s,t)&&++i&&!bh.call(e,t)||!(t in e)||!Oa(s[t],e[t]))return!1;return Object.keys(e).length===i}}return s!==s&&e!==e}const ng=12,og=(s,e)=>s.polygons.reduce((t,i,r)=>{const n=i.rings.reduce((o,a,l)=>{const h=a.points.map((u,c)=>{const d=c===a.points.length-1?a.points[0]:a.points[c+1],f=(u[0]+d[0])/2,p=(u[1]+d[1])/2,m=Math.sqrt(Math.pow(d[0]-f,2)+Math.pow(d[1]-p,2))>ng/e;return{point:[f,p],visible:m,elementIdx:r,ringIdx:l,pointIdx:c}});return[...o,...h]},[]);return[...t,...n]},[]);function Io(s){const e=s.slice(),t=e[10][e[6]];return e[29]=t.point,e}function Sh(s,e,t){const i=s.slice();return i[30]=e[t],i[32]=t,i}function Ah(s,e,t){const i=s.slice();return i[33]=e[t],i[35]=t,i}function Rh(s,e,t){const i=s.slice();return i[29]=e[t],i[37]=t,i}function Oo(s){const e=s.slice(),t=e[10][e[6]];return e[29]=t.point,e}function Do(s){const e=s.slice(),t=e[10][e[6]];return e[29]=t.point,e}function Ch(s){let e,t,i,r;return{c(){e=ce("circle"),b(e,"cx",t=s[29][0]),b(e,"cy",i=s[29][1]),b(e,"r",r=Rr/s[3]),b(e,"class","svelte-1vxo6dc")},m(n,o){ge(n,e,o)},p(n,o){o[0]&1088&&t!==(t=n[29][0])&&b(e,"cx",t),o[0]&1088&&i!==(i=n[29][1])&&b(e,"cy",i),o[0]&8&&r!==(r=Rr/n[3])&&b(e,"r",r)},d(n){n&&me(e)}}}function Ph(s){let e,t,i,r,n,o,a,l,h,u;return{c(){e=ce("mask"),t=ce("rect"),a=ce("circle"),b(t,"x",i=s[9].x),b(t,"y",r=s[9].y),b(t,"width",n=s[9].w),b(t,"height",o=s[9].h),b(t,"class","svelte-1vxo6dc"),b(a,"cx",l=s[29][0]),b(a,"cy",h=s[29][1]),b(a,"r",u=Rr/s[3]),b(a,"class","svelte-1vxo6dc"),b(e,"id",`${s[18]}-${s[32]}-inner`),b(e,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc")},m(c,d){ge(c,e,d),Le(e,t),Le(e,a)},p(c,d){d[0]&512&&i!==(i=c[9].x)&&b(t,"x",i),d[0]&512&&r!==(r=c[9].y)&&b(t,"y",r),d[0]&512&&n!==(n=c[9].w)&&b(t,"width",n),d[0]&512&&o!==(o=c[9].h)&&b(t,"height",o),d[0]&1088&&l!==(l=c[29][0])&&b(a,"cx",l),d[0]&1088&&h!==(h=c[29][1])&&b(a,"cy",h),d[0]&8&&u!==(u=Rr/c[3])&&b(a,"r",u)},d(c){c&&me(e)}}}function Mh(s){let e,t;function i(...r){return s[19](s[32],s[35],s[37],...r)}return e=new Hs({props:{class:"a9s-corner-handle",x:s[29][0],y:s[29][1],scale:s[3],selected:s[8].some(i)}}),e.$on("pointerenter",s[11]),e.$on("pointerleave",s[12]),e.$on("pointerdown",s[14]),e.$on("pointerdown",function(){ct(s[28](`HANDLE-${s[32]}-${s[35]}-${s[37]}`))&&s[28](`HANDLE-${s[32]}-${s[35]}-${s[37]}`).apply(this,arguments)}),e.$on("pointerup",s[15](s[32],s[35],s[37])),{c(){Kt(e.$$.fragment)},m(r,n){kt(e,r,n),t=!0},p(r,n){s=r;const o={};n[0]&32&&(o.x=s[29][0]),n[0]&32&&(o.y=s[29][1]),n[0]&8&&(o.scale=s[3]),n[0]&256&&(o.selected=s[8].some(i)),e.$set(o)},i(r){t||(Ne(e.$$.fragment,r),t=!0)},o(r){We(e.$$.fragment,r),t=!1},d(r){Ut(e,r)}}}function Ih(s){let e,t,i=Xi(s[33].points),r=[];for(let o=0;o<i.length;o+=1)r[o]=Mh(Rh(s,i,o));const n=o=>We(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=ir()},m(o,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(o,a);ge(o,e,a),t=!0},p(o,a){if(a[0]&268491048){i=Xi(o[33].points);let l;for(l=0;l<i.length;l+=1){const h=Rh(o,i,l);r[l]?(r[l].p(h,a),Ne(r[l],1)):(r[l]=Mh(h),r[l].c(),Ne(r[l],1),r[l].m(e.parentNode,e))}for(Js(),l=i.length;l<r.length;l+=1)n(l);$s()}},i(o){if(!t){for(let a=0;a<i.length;a+=1)Ne(r[a]);t=!0}},o(o){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)We(r[a]);t=!1},d(o){o&&me(e),eo(r,o)}}}function Oh(s){let e,t,i,r,n,o,a,l,h,u,c,d,f,p,m,g,v,x=s[6]!==void 0&&!s[7]&&Ch(Do(s)),_=s[6]!==void 0&&!s[7]&&Ph(Oo(s)),E=Xi(s[30].rings),R=[];for(let O=0;O<E.length;O+=1)R[O]=Ih(Ah(s,E,O));const M=O=>We(R[O],1,1,()=>{R[O]=null});return{c(){e=ce("g"),t=ce("defs"),i=ce("mask"),r=ce("rect"),h=ce("path"),x&&x.c(),_&&_.c(),c=ce("path"),f=ce("path");for(let O=0;O<R.length;O+=1)R[O].c();b(r,"x",n=s[9].x),b(r,"y",o=s[9].y),b(r,"width",a=s[9].w),b(r,"height",l=s[9].h),b(r,"class","svelte-1vxo6dc"),b(h,"d",u=Oi(s[30])),b(h,"class","svelte-1vxo6dc"),b(i,"id",`${s[18]}-${s[32]}-outer`),b(i,"class","a9s-multipolygon-editor-mask svelte-1vxo6dc"),b(c,"class","a9s-outer"),b(c,"mask",`url(#${s[18]}-${s[32]}-outer)`),b(c,"fill-rule","evenodd"),b(c,"d",d=Oi(s[30])),b(f,"class","a9s-inner"),b(f,"mask",`url(#${s[18]}-${s[32]}-inner)`),b(f,"style",s[1]),b(f,"fill-rule","evenodd"),b(f,"d",p=Oi(s[30]))},m(O,N){ge(O,e,N),Le(e,t),Le(t,i),Le(i,r),Le(i,h),x&&x.m(i,null),_&&_.m(t,null),Le(e,c),Le(e,f);for(let B=0;B<R.length;B+=1)R[B]&&R[B].m(e,null);m=!0,g||(v=[ke(c,"pointerup",s[13]),ke(c,"pointerdown",function(){ct(s[28]("SHAPE"))&&s[28]("SHAPE").apply(this,arguments)}),ke(f,"pointerup",s[13]),ke(f,"pointerdown",function(){ct(s[28]("SHAPE"))&&s[28]("SHAPE").apply(this,arguments)})],g=!0)},p(O,N){if(s=O,(!m||N[0]&512&&n!==(n=s[9].x))&&b(r,"x",n),(!m||N[0]&512&&o!==(o=s[9].y))&&b(r,"y",o),(!m||N[0]&512&&a!==(a=s[9].w))&&b(r,"width",a),(!m||N[0]&512&&l!==(l=s[9].h))&&b(r,"height",l),(!m||N[0]&32&&u!==(u=Oi(s[30])))&&b(h,"d",u),s[6]!==void 0&&!s[7]?x?x.p(Do(s),N):(x=Ch(Do(s)),x.c(),x.m(i,null)):x&&(x.d(1),x=null),s[6]!==void 0&&!s[7]?_?_.p(Oo(s),N):(_=Ph(Oo(s)),_.c(),_.m(t,null)):_&&(_.d(1),_=null),(!m||N[0]&32&&d!==(d=Oi(s[30])))&&b(c,"d",d),(!m||N[0]&2)&&b(f,"style",s[1]),(!m||N[0]&32&&p!==(p=Oi(s[30])))&&b(f,"d",p),N[0]&268491048){E=Xi(s[30].rings);let B;for(B=0;B<E.length;B+=1){const G=Ah(s,E,B);R[B]?(R[B].p(G,N),Ne(R[B],1)):(R[B]=Ih(G),R[B].c(),Ne(R[B],1),R[B].m(e,null))}for(Js(),B=E.length;B<R.length;B+=1)M(B);$s()}},i(O){if(!m){for(let N=0;N<E.length;N+=1)Ne(R[N]);m=!0}},o(O){R=R.filter(Boolean);for(let N=0;N<R.length;N+=1)We(R[N]);m=!1},d(O){O&&me(e),x&&x.d(),_&&_.d(),eo(R,O),g=!1,zt(v)}}}function Dh(s){let e,t;return e=new Jc({props:{x:s[29][0],y:s[29][1],scale:s[3]}}),e.$on("pointerdown",function(){ct(s[17](s[6]))&&s[17](s[6]).apply(this,arguments)}),{c(){Kt(e.$$.fragment)},m(i,r){kt(e,i,r),t=!0},p(i,r){s=i;const n={};r[0]&1088&&(n.x=s[29][0]),r[0]&1088&&(n.y=s[29][1]),r[0]&8&&(n.scale=s[3]),e.$set(n)},i(i){t||(Ne(e.$$.fragment,i),t=!0)},o(i){We(e.$$.fragment,i),t=!1},d(i){Ut(e,i)}}}function ag(s){let e,t,i,r=Xi(s[5].polygons),n=[];for(let l=0;l<r.length;l+=1)n[l]=Oh(Sh(s,r,l));const o=l=>We(n[l],1,1,()=>{n[l]=null});let a=s[6]!==void 0&&!s[7]&&Dh(Io(s));return{c(){for(let l=0;l<n.length;l+=1)n[l].c();e=At(),a&&a.c(),t=ir()},m(l,h){for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(l,h);ge(l,e,h),a&&a.m(l,h),ge(l,t,h),i=!0},p(l,h){if(h[0]&268763114){r=Xi(l[5].polygons);let u;for(u=0;u<r.length;u+=1){const c=Sh(l,r,u);n[u]?(n[u].p(c,h),Ne(n[u],1)):(n[u]=Oh(c),n[u].c(),Ne(n[u],1),n[u].m(e.parentNode,e))}for(Js(),u=r.length;u<n.length;u+=1)o(u);$s()}l[6]!==void 0&&!l[7]?a?(a.p(Io(l),h),h[0]&192&&Ne(a,1)):(a=Dh(Io(l)),a.c(),Ne(a,1),a.m(t.parentNode,t)):a&&(Js(),We(a,1,1,()=>{a=null}),$s())},i(l){if(!i){for(let h=0;h<r.length;h+=1)Ne(n[h]);Ne(a),i=!0}},o(l){n=n.filter(Boolean);for(let h=0;h<n.length;h+=1)We(n[h]);We(a),i=!1},d(l){l&&(me(e),me(t)),eo(n,l),a&&a.d(l)}}}function lg(s){let e,t;return e=new Pl({props:{shape:s[0],transform:s[2],editor:s[16],svgEl:s[4],$$slots:{default:[ag,({grab:i})=>({28:i}),({grab:i})=>[i?268435456:0]]},$$scope:{ctx:s}}}),e.$on("change",s[20]),e.$on("grab",s[21]),e.$on("release",s[22]),{c(){Kt(e.$$.fragment)},m(i,r){kt(e,i,r),t=!0},p(i,r){const n={};r[0]&1&&(n.shape=i[0]),r[0]&4&&(n.transform=i[2]),r[0]&16&&(n.svgEl=i[4]),r[0]&268437482|r[1]&128&&(n.$$scope={dirty:r,ctx:i}),e.$set(n)},i(i){t||(Ne(e.$$.fragment,i),t=!0)},o(i){We(e.$$.fragment,i),t=!1},d(i){Ut(e,i)}}}const hg=250,ug=1e3,Rr=4.5;function cg(s,e,t){let i,r,n;const o=Lr();let{shape:a}=e,{computedStyle:l}=e,{transform:h}=e,{viewportScale:u=1}=e,{svgEl:c}=e,d,f=!1,p,m=[];const g=()=>t(7,f=!0),v=()=>t(7,f=!1),x=L=>{if(m.length>0||!r.some(Z=>Z.visible)){t(6,d=void 0);return}const[W,U]=h.elementToImage(L.offsetX,L.offsetY),V=Z=>Math.pow(Z[0]-W,2)+Math.pow(Z[1]-U,2),ie=Yp(i).reduce((Z,Q)=>V(Q)<V(Z)?Q:Z),k=r.filter(Z=>Z.visible).reduce((Z,Q)=>V(Q.point)<V(Z.point)?Q:Z),F=Math.pow(ug/u,2);V(ie)<F||V(k.point)<F?t(6,d=r.indexOf(k)):t(6,d=void 0)},_=()=>{document.activeElement!==c&&c.focus()},E=()=>{t(8,m=[]),_()},R=L=>{t(7,f=!0),L.preventDefault(),L.stopPropagation(),p=performance.now()},M=(L,W,U)=>V=>{if(!p||Si||performance.now()-p>hg)return;const ie=F=>F.polygon===L&&F.ring===W&&F.point===U,k=m.some(ie);V.metaKey||V.ctrlKey||V.shiftKey?k?t(8,m=m.filter(F=>!ie(F))):t(8,m=[...m,{polygon:L,ring:W,point:U}]):k&&m.length>1?t(8,m=[{polygon:L,ring:W,point:U}]):k?t(8,m=[]):t(8,m=[{polygon:L,ring:W,point:U}]),_()},O=(L,W,U)=>{_();const V=L.geometry.polygons;let ie;if(W==="SHAPE")ie=V.map(k=>{const F=k.rings.map((Q,ae)=>({points:Q.points.map((de,be)=>[de[0]+U[0],de[1]+U[1]])})),Z=Qt(F[0].points);return{rings:F,bounds:Z}});else{const[k,F,Z,Q]=W.split("-").map(ae=>parseInt(ae));ie=V.map((ae,de)=>{if(de===F){const be=ae.rings.map((Be,Ye)=>Ye===Z?{points:Be.points.map((Ce,Pe)=>Pe===Q?[Ce[0]+U[0],Ce[1]+U[1]]:Ce)}:Be),De=Qt(be[0].points);return{rings:be,bounds:De}}else return ae})}return{...L,geometry:{polygons:ie,bounds:Eo(ie)}}},N=L=>async W=>{W.stopPropagation();const U=r[L],V=i.polygons.map((k,F)=>{if(F===U.elementIdx){const Z=k.rings.map((ae,de)=>de===U.ringIdx?{points:[...ae.points.slice(0,U.pointIdx+1),U.point,...ae.points.slice(U.pointIdx+1)]}:ae),Q=Qt(Z[0].points);return{rings:Z,bounds:Q}}else return k});o("change",{...a,geometry:{polygons:V,bounds:Eo(V)}}),await Wc();const ie=[...document.querySelectorAll(".a9s-handle")][L+1];if(ie!=null&&ie.firstChild){const k=new PointerEvent("pointerdown",{bubbles:!0,cancelable:!0,clientX:W.clientX,clientY:W.clientY,pointerId:W.pointerId,pointerType:W.pointerType,isPrimary:W.isPrimary,buttons:W.buttons});ie.firstChild.dispatchEvent(k)}},B=()=>{const L=i.polygons.map((W,U)=>{if(m.some(V=>V.polygon===U)){const V=W.rings.map((k,F)=>m.some(Z=>Z.polygon===U&&Z.ring===F)&&k.points.length>3?{points:k.points.filter((Z,Q)=>!m.some(ae=>ae.polygon===U&&ae.ring===F&&ae.point===Q))}:k),ie=Qt(V[0].points);return{rings:V,bounds:ie}}else return W});!Oa(i.polygons,L)&&(o("change",{...a,geometry:{polygons:L,bounds:Eo(L)}}),t(8,m=[]))};to(()=>{if(Si)return;const L=W=>{(W.key==="Delete"||W.key==="Backspace")&&(W.preventDefault(),B())};return c.addEventListener("pointermove",x),c.addEventListener("keydown",L),()=>{c.removeEventListener("pointermove",x),c.removeEventListener("keydown",L)}});const G=`polygon-mask-${Math.random().toString(36).substring(2,12)}`,K=(L,W,U,{polygon:V,ring:ie,point:k})=>V===L&&ie===W&&k===U;function D(L){bt.call(this,s,L)}function C(L){bt.call(this,s,L)}function I(L){bt.call(this,s,L)}return s.$$set=L=>{"shape"in L&&t(0,a=L.shape),"computedStyle"in L&&t(1,l=L.computedStyle),"transform"in L&&t(2,h=L.transform),"viewportScale"in L&&t(3,u=L.viewportScale),"svgEl"in L&&t(4,c=L.svgEl)},s.$$.update=()=>{s.$$.dirty[0]&1&&t(5,i=a.geometry),s.$$.dirty[0]&40&&t(10,r=Si?[]:og(i,u)),s.$$.dirty[0]&40&&t(9,n=so(i.bounds,Rr/u))},[a,l,h,u,c,i,d,f,m,n,r,g,v,E,R,M,O,N,G,K,D,C,I]}class dg extends Ki{constructor(e){super(),Zi(this,e,cg,lg,qi,{shape:0,computedStyle:1,transform:2,viewportScale:3,svgEl:4},null,[-1,-1])}}const $c=new Map([[je.RECTANGLE,rg],[je.POLYGON,eg],[je.MULTIPOLYGLON,dg]]),fg=s=>$c.get(s.type),pg=(s,e)=>$c.set(s,e);function Nh(s){let e,t,i,r,n,o,a,l,h,u;return{c(){e=ce("defs"),t=ce("mask"),i=ce("rect"),l=ce("rect"),h=ce("rect"),u=ce("rect"),b(i,"class","rect-mask-bg svelte-1a76qe7"),b(i,"x",r=s[1]-s[5]),b(i,"y",n=s[2]-s[5]),b(i,"width",o=s[3]+2*s[5]),b(i,"height",a=s[4]+2*s[5]),b(l,"class","rect-mask-fg svelte-1a76qe7"),b(l,"x",s[1]),b(l,"y",s[2]),b(l,"width",s[3]),b(l,"height",s[4]),b(t,"id",s[6]),b(t,"class","a9s-rubberband-rectangle-mask svelte-1a76qe7"),b(h,"class","a9s-outer"),b(h,"mask",`url(#${s[6]})`),b(h,"x",s[1]),b(h,"y",s[2]),b(h,"width",s[3]),b(h,"height",s[4]),b(u,"class","a9s-inner"),b(u,"x",s[1]),b(u,"y",s[2]),b(u,"width",s[3]),b(u,"height",s[4])},m(c,d){ge(c,e,d),Le(e,t),Le(t,i),Le(t,l),ge(c,h,d),ge(c,u,d)},p(c,d){d&34&&r!==(r=c[1]-c[5])&&b(i,"x",r),d&36&&n!==(n=c[2]-c[5])&&b(i,"y",n),d&40&&o!==(o=c[3]+2*c[5])&&b(i,"width",o),d&48&&a!==(a=c[4]+2*c[5])&&b(i,"height",a),d&2&&b(l,"x",c[1]),d&4&&b(l,"y",c[2]),d&8&&b(l,"width",c[3]),d&16&&b(l,"height",c[4]),d&2&&b(h,"x",c[1]),d&4&&b(h,"y",c[2]),d&8&&b(h,"width",c[3]),d&16&&b(h,"height",c[4]),d&2&&b(u,"x",c[1]),d&4&&b(u,"y",c[2]),d&8&&b(u,"width",c[3]),d&16&&b(u,"height",c[4])},d(c){c&&(me(e),me(h),me(u))}}}function mg(s){let e,t=s[0]&&Nh(s);return{c(){e=ce("g"),t&&t.c(),b(e,"class","a9s-annotation a9s-rubberband")},m(i,r){ge(i,e,r),t&&t.m(e,null)},p(i,[r]){i[0]?t?t.p(i,r):(t=Nh(i),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},i:ei,o:ei,d(i){i&&me(e),t&&t.d()}}}function gg(s,e,t){let i;const r=Lr();let{addEventListener:n}=e,{drawingMode:o}=e,{transform:a}=e,{viewportScale:l=1}=e,h,u,c,d,f,p,m;const g=R=>{const M=R;h=performance.now(),o==="drag"&&(t(0,u=a.elementToImage(M.offsetX,M.offsetY)),c=u,t(1,d=u[0]),t(2,f=u[1]),t(3,p=1),t(4,m=1))},v=R=>{const M=R;u&&(c=a.elementToImage(M.offsetX,M.offsetY),t(1,d=Math.min(c[0],u[0])),t(2,f=Math.min(c[1],u[1])),t(3,p=Math.abs(c[0]-u[0])),t(4,m=Math.abs(c[1]-u[1])))},x=R=>{const M=R,O=performance.now()-h;if(o==="click"){if(O>300)return;u?_():(t(0,u=a.elementToImage(M.offsetX,M.offsetY)),c=u,t(1,d=u[0]),t(2,f=u[1]),t(3,p=1),t(4,m=1))}else u&&(O>300||p*m>100?(M.stopPropagation(),_()):(t(0,u=void 0),c=void 0))},_=()=>{if(p*m>15){const R={type:je.RECTANGLE,geometry:{bounds:{minX:d,minY:f,maxX:d+p,maxY:f+m},x:d,y:f,w:p,h:m}};r("create",R)}t(0,u=void 0),c=void 0};to(()=>{n("pointerdown",g),n("pointermove",v),n("pointerup",x,!0)});const E=`rect-mask-${Math.random().toString(36).substring(2,12)}`;return s.$$set=R=>{"addEventListener"in R&&t(7,n=R.addEventListener),"drawingMode"in R&&t(8,o=R.drawingMode),"transform"in R&&t(9,a=R.transform),"viewportScale"in R&&t(10,l=R.viewportScale)},s.$$.update=()=>{s.$$.dirty&1024&&t(5,i=2/l)},[u,d,f,p,m,i,E,n,o,a,l]}class vg extends Ki{constructor(e){super(),Zi(this,e,gg,mg,qi,{addEventListener:7,drawingMode:8,transform:9,viewportScale:10})}}function No(s){const e=s.slice(),t=e[2].map(i=>i.join(",")).join(" ");return e[19]=t,e}function Lh(s){let e,t,i,r,n,o,a,l,h,u,c,d,f,p,m=s[1]&&Bh(s);return{c(){e=ce("defs"),t=ce("mask"),i=ce("rect"),l=ce("polygon"),u=ce("polygon"),d=ce("polygon"),m&&m.c(),p=ir(),b(i,"x",r=s[3].x),b(i,"y",n=s[3].y),b(i,"width",o=s[3].w),b(i,"height",a=s[3].h),b(i,"class","svelte-18wrg3t"),b(l,"points",h=s[19]),b(l,"class","svelte-18wrg3t"),b(t,"id",s[5]),b(t,"class","a9s-rubberband-polygon-mask svelte-18wrg3t"),b(u,"class","a9s-outer"),b(u,"mask",`url(#${s[5]})`),b(u,"points",c=s[19]),b(d,"class","a9s-inner"),b(d,"points",f=s[19])},m(g,v){ge(g,e,v),Le(e,t),Le(t,i),Le(t,l),ge(g,u,v),ge(g,d,v),m&&m.m(g,v),ge(g,p,v)},p(g,v){v&8&&r!==(r=g[3].x)&&b(i,"x",r),v&8&&n!==(n=g[3].y)&&b(i,"y",n),v&8&&o!==(o=g[3].w)&&b(i,"width",o),v&8&&a!==(a=g[3].h)&&b(i,"height",a),v&4&&h!==(h=g[19])&&b(l,"points",h),v&4&&c!==(c=g[19])&&b(u,"points",c),v&4&&f!==(f=g[19])&&b(d,"points",f),g[1]?m?m.p(g,v):(m=Bh(g),m.c(),m.m(p.parentNode,p)):m&&(m.d(1),m=null)},d(g){g&&(me(e),me(u),me(d),me(p)),m&&m.d(g)}}}function Bh(s){let e,t,i;return{c(){e=ce("circle"),b(e,"class","a9s-handle svelte-18wrg3t"),b(e,"cx",t=s[0][0][0]),b(e,"cy",i=s[0][0][1]),b(e,"r",s[4])},m(r,n){ge(r,e,n)},p(r,n){n&1&&t!==(t=r[0][0][0])&&b(e,"cx",t),n&1&&i!==(i=r[0][0][1])&&b(e,"cy",i),n&16&&b(e,"r",r[4])},d(r){r&&me(e)}}}function yg(s){let e,t=s[3]&&Lh(No(s));return{c(){e=ce("g"),t&&t.c(),b(e,"class","a9s-annotation a9s-rubberband")},m(i,r){ge(i,e,r),t&&t.m(e,null)},p(i,[r]){i[3]?t?t.p(No(i),r):(t=Lh(No(i)),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},i:ei,o:ei,d(i){i&&me(e),t&&t.d()}}}const xg=20,_g=1500;function Tg(s,e,t){let i,r,n;const o=Lr();let{addEventListener:a}=e,{drawingMode:l}=e,{transform:h}=e,{viewportScale:u=1}=e,c,d=[],f,p,m=!1;const g=M=>{const O=M,{timeStamp:N,offsetX:B,offsetY:G}=O;if(c={timeStamp:N,offsetX:B,offsetY:G},l==="drag"&&d.length===0){const K=h.elementToImage(O.offsetX,O.offsetY);d.push(K),t(10,f=K)}},v=M=>{const O=M;if(p&&clearTimeout(p),d.length>0){if(t(10,f=h.elementToImage(O.offsetX,O.offsetY)),d.length>2){const N=Ro(f,d[0])*u;t(1,m=N<xg)}O.pointerType==="touch"&&(p=setTimeout(()=>{_()},_g))}},x=M=>{const O=M;if(p&&clearTimeout(p),l==="click"){const N=O.timeStamp-c.timeStamp,B=Ro([c.offsetX,c.offsetY],[O.offsetX,O.offsetY]);if(N>300||B>15)return;if(m)E();else if(d.length===0){const G=h.elementToImage(O.offsetX,O.offsetY);d.push(G),t(10,f=G)}else d.push(f)}else{if(d.length===1&&Ro(d[0],f)<=4){t(0,d=[]),t(10,f=void 0);return}O.stopImmediatePropagation(),m?E():d.push(f)}},_=()=>{if(!f)return;const M=d.slice(0,-1);if(M.length<3)return;const O={type:je.POLYGON,geometry:{bounds:Qt(d),points:M}};Ra(O)>4&&(t(0,d=[]),t(10,f=void 0),o("create",O))},E=()=>{const M={type:je.POLYGON,geometry:{bounds:Qt(d),points:[...d]}};t(0,d=[]),t(10,f=void 0),o("create",M)};to(()=>{a("pointerdown",g,!0),a("pointermove",v),a("pointerup",x,!0),a("dblclick",_,!0)});const R=`polygon-mask-${Math.random().toString(36).substring(2,12)}`;return s.$$set=M=>{"addEventListener"in M&&t(6,a=M.addEventListener),"drawingMode"in M&&t(7,l=M.drawingMode),"transform"in M&&t(8,h=M.transform),"viewportScale"in M&&t(9,u=M.viewportScale)},s.$$.update=()=>{s.$$.dirty&512&&t(4,i=4/u),s.$$.dirty&1027&&t(2,r=f?m?d:[...d,f]:[]),s.$$.dirty&516&&t(3,n=r.length>0?so(Qt(r),2/u):void 0)},[d,m,r,n,i,R,a,l,h,u,f]}class wg extends Ki{constructor(e){super(),Zi(this,e,Tg,yg,qi,{addEventListener:6,drawingMode:7,transform:8,viewportScale:9})}}const Ml=new Map([["rectangle",{tool:vg}],["polygon",{tool:wg}]]),ed=()=>[...Ml.keys()],td=s=>Ml.get(s),Eg=(s,e,t={})=>Ml.set(s,{tool:e,opts:t});function id(s,e,t=0,i=s.length-1,r=bg){for(;i>t;){if(i-t>600){const l=i-t+1,h=e-t+1,u=Math.log(l),c=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*c*(l-c)/l)*(h-l/2<0?-1:1),f=Math.max(t,Math.floor(e-h*c/l+d)),p=Math.min(i,Math.floor(e+(l-h)*c/l+d));id(s,e,f,p,r)}const n=s[e];let o=t,a=i;for(nr(s,t,e),r(s[i],n)>0&&nr(s,t,i);o<a;){for(nr(s,o,a),o++,a--;r(s[o],n)<0;)o++;for(;r(s[a],n)>0;)a--}r(s[t],n)===0?nr(s,t,a):(a++,nr(s,a,i)),a<=e&&(t=a+1),e<=a&&(i=a-1)}}function nr(s,e,t){const i=s[e];s[e]=s[t],s[t]=i}function bg(s,e){return s<e?-1:s>e?1:0}class Sg{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!qr(e,t))return i;const r=this.toBBox,n=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],l=t.leaf?r(a):a;qr(e,l)&&(t.leaf?i.push(a):Bo(e,l)?this._all(a,i):n.push(a))}t=n.pop()}return i}collides(e){let t=this.data;if(!qr(e,t))return!1;const i=[];for(;t;){for(let r=0;r<t.children.length;r++){const n=t.children[r],o=t.leaf?this.toBBox(n):n;if(qr(e,o)){if(t.leaf||Bo(e,o))return!0;i.push(n)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=Is([]),this}remove(e,t){if(!e)return this;let i=this.data;const r=this.toBBox(e),n=[],o=[];let a,l,h;for(;i||n.length;){if(i||(i=n.pop(),l=n[n.length-1],a=o.pop(),h=!0),i.leaf){const u=Ag(e,i.children,t);if(u!==-1)return i.children.splice(u,1),n.push(i),this._condense(n),this}!h&&!i.leaf&&Bo(i,r)?(n.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,r){const n=i-t+1;let o=this._maxEntries,a;if(n<=o)return a=Is(e.slice(t,i+1)),Ss(a,this.toBBox),a;r||(r=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,r-1))),a=Is([]),a.leaf=!1,a.height=r;const l=Math.ceil(n/o),h=l*Math.ceil(Math.sqrt(o));Fh(e,t,i,h,this.compareMinX);for(let u=t;u<=i;u+=h){const c=Math.min(u+h-1,i);Fh(e,u,c,l,this.compareMinY);for(let d=u;d<=c;d+=l){const f=Math.min(d+l-1,c);a.children.push(this._build(e,d,f,r-1))}}return Ss(a,this.toBBox),a}_chooseSubtree(e,t,i,r){for(;r.push(t),!(t.leaf||r.length-1===i);){let n=1/0,o=1/0,a;for(let l=0;l<t.children.length;l++){const h=t.children[l],u=Lo(h),c=Pg(e,h)-u;c<o?(o=c,n=u<n?u:n,a=h):c===o&&u<n&&(n=u,a=h)}t=a||t.children[0]}return t}_insert(e,t,i){const r=i?e:this.toBBox(e),n=[],o=this._chooseSubtree(r,this.data,t,n);for(o.children.push(e),dr(o,r);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(r,n,t)}_split(e,t){const i=e[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);const o=this._chooseSplitIndex(i,n,r),a=Is(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,Ss(i,this.toBBox),Ss(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=Is([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Ss(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let r,n=1/0,o=1/0;for(let a=t;a<=i-t;a++){const l=cr(e,0,a,this.toBBox),h=cr(e,a,i,this.toBBox),u=Mg(l,h),c=Lo(l)+Lo(h);u<n?(n=u,r=a,o=c<o?c:o):u===n&&c<o&&(o=c,r=a)}return r||i-t}_chooseSplitAxis(e,t,i){const r=e.leaf?this.compareMinX:Rg,n=e.leaf?this.compareMinY:Cg,o=this._allDistMargin(e,t,i,r),a=this._allDistMargin(e,t,i,n);o<a&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);const n=this.toBBox,o=cr(e,0,t,n),a=cr(e,i-t,i,n);let l=Yr(o)+Yr(a);for(let h=t;h<i-t;h++){const u=e.children[h];dr(o,e.leaf?n(u):u),l+=Yr(o)}for(let h=i-t-1;h>=t;h--){const u=e.children[h];dr(a,e.leaf?n(u):u),l+=Yr(a)}return l}_adjustParentBBoxes(e,t,i){for(let r=i;r>=0;r--)dr(t[r],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():Ss(e[t],this.toBBox)}}function Ag(s,e,t){if(!t)return e.indexOf(s);for(let i=0;i<e.length;i++)if(t(s,e[i]))return i;return-1}function Ss(s,e){cr(s,0,s.children.length,e,s)}function cr(s,e,t,i,r){r||(r=Is(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let n=e;n<t;n++){const o=s.children[n];dr(r,s.leaf?i(o):o)}return r}function dr(s,e){return s.minX=Math.min(s.minX,e.minX),s.minY=Math.min(s.minY,e.minY),s.maxX=Math.max(s.maxX,e.maxX),s.maxY=Math.max(s.maxY,e.maxY),s}function Rg(s,e){return s.minX-e.minX}function Cg(s,e){return s.minY-e.minY}function Lo(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function Yr(s){return s.maxX-s.minX+(s.maxY-s.minY)}function Pg(s,e){return(Math.max(e.maxX,s.maxX)-Math.min(e.minX,s.minX))*(Math.max(e.maxY,s.maxY)-Math.min(e.minY,s.minY))}function Mg(s,e){const t=Math.max(s.minX,e.minX),i=Math.max(s.minY,e.minY),r=Math.min(s.maxX,e.maxX),n=Math.min(s.maxY,e.maxY);return Math.max(0,r-t)*Math.max(0,n-i)}function Bo(s,e){return s.minX<=e.minX&&s.minY<=e.minY&&e.maxX<=s.maxX&&e.maxY<=s.maxY}function qr(s,e){return e.minX<=s.maxX&&e.minY<=s.maxY&&e.maxX>=s.minX&&e.maxY>=s.minY}function Is(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Fh(s,e,t,i,r){const n=[e,t];for(;n.length;){if(t=n.pop(),e=n.pop(),t-e<=i)continue;const o=e+Math.ceil((t-e)/i/2)*i;id(s,o,e,t,r),n.push(e,o,o,t)}}const Ig=()=>{const s=new Sg,e=new Map,t=()=>[...e.values()],i=()=>{s.clear(),e.clear()},r=o=>{if(!wn(o))return;const{minX:a,minY:l,maxX:h,maxY:u}=o.selector.geometry.bounds,c={minX:a,minY:l,maxX:h,maxY:u,target:o};s.insert(c),e.set(o.annotation,c)},n=o=>{if(!wn(o))return;const a=e.get(o.annotation);a&&s.remove(a),e.delete(o.annotation)};return{all:t,clear:i,getAt:(o,a,l)=>{const h=s.search({minX:o,minY:a,maxX:o,maxY:a}).map(u=>u.target).filter(u=>u.selector.type===je.RECTANGLE||Vp(u.selector,o,a));return h.length>0?(h.sort((u,c)=>Ra(u.selector)-Ra(c.selector)),h):[]},getIntersecting:(o,a,l,h)=>s.search({minX:o,minY:a,maxX:o+l,maxY:a+h}).map(u=>u.target),insert:r,remove:n,set:(o,a=!0)=>{a&&i();const l=o.reduce((h,u)=>{if(wn(u)){const{minX:c,minY:d,maxX:f,maxY:p}=u.selector.geometry.bounds;return[...h,{minX:c,minY:d,maxX:f,maxY:p,target:u}]}else return h},[]);l.forEach(h=>e.set(h.target.annotation,h)),s.load(l)},size:()=>s.all().length,update:(o,a)=>{n(o),r(a)}}},Og=s=>{const e=Dm(),t=Ig(),i=_m(e,s.userSelectAction,s.adapter),r=xm(e),n=Nm();return e.observe(({changes:o})=>{t.set((o.created||[]).map(a=>a.target),!1),(o.deleted||[]).forEach(a=>t.remove(a.target)),(o.updated||[]).forEach(({oldValue:a,newValue:l})=>t.update(a.target,l.target))}),{store:{...e,getAt:(o,a,l)=>{const h=t.getAt(o,a,l);if(l)return h.map(u=>e.getAnnotation(u.annotation)).filter(Boolean).filter(l)[0];{const u=h[0];return u?e.getAnnotation(u.annotation):void 0}},getIntersecting:(o,a,l,h)=>t.getIntersecting(o,a,l,h).map(u=>e.getAnnotation(u.annotation))},selection:i,hover:r,viewport:n}},Dg=s=>{let e,t;if(s.nodeName==="CANVAS")e=s,t=e.getContext("2d",{willReadFrequently:!0});else{const r=s;e=document.createElement("canvas"),e.width=r.width,e.height=r.height,t=e.getContext("2d",{willReadFrequently:!0}),t.drawImage(r,0,0,r.width,r.height)}let i=0;for(let r=1;r<10;r++)for(let n=1;n<10;n++){const o=Math.round(n*e.width/10),a=Math.round(r*e.height/10),l=t.getImageData(o,a,1,1).data,h=(.299*l[0]+.587*l[1]+.114*l[2])/255;i+=h}return i/81},Ng=s=>{const e=Dg(s),t=e>.6?"dark":"light";return console.log(`[Annotorious] Image brightness: ${e.toFixed(1)}. Setting ${t} theme.`),t},Lg=(s,e)=>({...s,drawingEnabled:s.drawingEnabled===void 0?e.drawingEnabled:s.drawingEnabled,drawingMode:s.drawingMode||e.drawingMode,userSelectAction:s.userSelectAction||e.userSelectAction,theme:s.theme||e.theme}),kh=typeof navigator>"u"?!1:navigator.userAgent.indexOf("Mac OS X")!==-1,Bg=(s,e)=>{const t=e||document,i=o=>{const a=o;a.key==="z"&&a.ctrlKey?s.undo():a.key==="y"&&a.ctrlKey&&s.redo()},r=o=>{const a=o;a.key==="z"&&a.metaKey&&(a.shiftKey?s.redo():s.undo())},n=()=>{kh?t.removeEventListener("keydown",r):t.removeEventListener("keydown",i)};return kh?t.addEventListener("keydown",r):t.addEventListener("keydown",i),{destroy:n}};function Et(){}function Fg(s,e){for(const t in e)s[t]=e[t];return s}function sd(s){return s()}function Uh(){return Object.create(null)}function Br(s){s.forEach(sd)}function Il(s){return typeof s=="function"}function St(s,e){return s!=s?e==e:s!==e||s&&typeof s=="object"||typeof s=="function"}function kg(s){return Object.keys(s).length===0}function Ug(s,...e){if(s==null){for(const i of e)i(void 0);return Et}const t=s.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Ln(s,e,t){s.$$.on_destroy.push(Ug(e,t))}function Hg(s,e,t,i){if(s){const r=rd(s,e,t,i);return s[0](r)}}function rd(s,e,t,i){return s[1]&&i?Fg(t.ctx.slice(),s[1](i(e))):t.ctx}function Gg(s,e,t,i){if(s[2]&&i){const r=s[2](i(t));if(e.dirty===void 0)return r;if(typeof r=="object"){const n=[],o=Math.max(e.dirty.length,r.length);for(let a=0;a<o;a+=1)n[a]=e.dirty[a]|r[a];return n}return e.dirty|r}return e.dirty}function zg(s,e,t,i,r,n){if(r){const o=rd(e,t,i,n);s.p(o,r)}}function Vg(s){if(s.ctx.length>32){const e=[],t=s.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}const nd=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function pi(s,e){s.appendChild(e)}function nt(s,e,t){s.insertBefore(e,t||null)}function et(s){s.parentNode&&s.parentNode.removeChild(s)}function ro(s,e){for(let t=0;t<s.length;t+=1)s[t]&&s[t].d(e)}function rt(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function od(s){return document.createTextNode(s)}function Ci(){return od("")}function ee(s,e,t){t==null?s.removeAttribute(e):s.getAttribute(e)!==t&&s.setAttribute(e,t)}function Xg(s){return Array.from(s.childNodes)}function Wg(s,e){e=""+e,s.data!==e&&(s.data=e)}function Zr(s,e,t){s.classList.toggle(e,!!t)}function jg(s,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(s,{detail:e,bubbles:t,cancelable:i})}let Cr;function Tr(s){Cr=s}function Ol(){if(!Cr)throw new Error("Function called outside component initialization");return Cr}function no(s){Ol().$$.on_mount.push(s)}function Yg(s){Ol().$$.on_destroy.push(s)}function Dl(){const s=Ol();return(e,t,{cancelable:i=!1}={})=>{const r=s.$$.callbacks[e];if(r){const n=jg(e,t,{cancelable:i});return r.slice().forEach(o=>{o.call(s,n)}),!n.defaultPrevented}return!0}}const Os=[],Bn=[];let Xs=[];const Hh=[],qg=Promise.resolve();let Da=!1;function Zg(){Da||(Da=!0,qg.then(ad))}function Na(s){Xs.push(s)}const Fo=new Set;let As=0;function ad(){if(As!==0)return;const s=Cr;do{try{for(;As<Os.length;){const e=Os[As];As++,Tr(e),Kg(e.$$)}}catch(e){throw Os.length=0,As=0,e}for(Tr(null),Os.length=0,As=0;Bn.length;)Bn.pop()();for(let e=0;e<Xs.length;e+=1){const t=Xs[e];Fo.has(t)||(Fo.add(t),t())}Xs.length=0}while(Os.length);for(;Hh.length;)Hh.pop()();Da=!1,Fo.clear(),Tr(s)}function Kg(s){if(s.fragment!==null){s.update(),Br(s.before_update);const e=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,e),s.after_update.forEach(Na)}}function Qg(s){const e=[],t=[];Xs.forEach(i=>s.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Xs=e}const En=new Set;let ds;function Vt(){ds={r:0,c:[],p:ds}}function Xt(){ds.r||Br(ds.c),ds=ds.p}function _e(s,e){s&&s.i&&(En.delete(s),s.i(e))}function Se(s,e,t,i){if(s&&s.o){if(En.has(s))return;En.add(s),ds.c.push(()=>{En.delete(s),i&&(t&&s.d(1),i())}),s.o(e)}else i&&i()}function Wi(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function Bt(s){s&&s.c()}function Pt(s,e,t){const{fragment:i,after_update:r}=s.$$;i&&i.m(e,t),Na(()=>{const n=s.$$.on_mount.map(sd).filter(Il);s.$$.on_destroy?s.$$.on_destroy.push(...n):Br(n),s.$$.on_mount=[]}),r.forEach(Na)}function Mt(s,e){const t=s.$$;t.fragment!==null&&(Qg(t.after_update),Br(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Jg(s,e){s.$$.dirty[0]===-1&&(Os.push(s),Zg(),s.$$.dirty.fill(0)),s.$$.dirty[e/31|0]|=1<<e%31}function It(s,e,t,i,r,n,o=null,a=[-1]){const l=Cr;Tr(s);const h=s.$$={fragment:null,ctx:[],props:n,update:Et,not_equal:r,bound:Uh(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:Uh(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(h.root);let u=!1;if(h.ctx=t?t(s,e.props||{},(c,d,...f)=>{const p=f.length?f[0]:d;return h.ctx&&r(h.ctx[c],h.ctx[c]=p)&&(!h.skip_bound&&h.bound[c]&&h.bound[c](p),u&&Jg(s,c)),d}):[],h.update(),u=!0,Br(h.before_update),h.fragment=i?i(h.ctx):!1,e.target){if(e.hydrate){const c=Xg(e.target);h.fragment&&h.fragment.l(c),c.forEach(et)}else h.fragment&&h.fragment.c();e.intro&&_e(s.$$.fragment),Pt(s,e.target,e.anchor),ad()}Tr(l)}class Ot{constructor(){Ke(this,"$$"),Ke(this,"$$set")}$destroy(){Mt(this,1),this.$destroy=Et}$on(e,t){if(!Il(t))return Et;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const r=i.indexOf(t);r!==-1&&i.splice(r,1)}}$set(e){this.$$set&&!kg(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const $g="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add($g);var zi=(s=>(s.ELLIPSE="ELLIPSE",s.MULTIPOLYGLON="MULTIPOLYGON",s.POLYGON="POLYGON",s.RECTANGLE="RECTANGLE",s))(zi||{}),ko=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Nl(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function ev(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(i){var r=Object.getOwnPropertyDescriptor(s,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return s[i]}})}),t}var ld={exports:{}};(function(s){(function(){function e(a,l){var h=a.x-l.x,u=a.y-l.y;return h*h+u*u}function t(a,l,h){var u=l.x,c=l.y,d=h.x-u,f=h.y-c;if(d!==0||f!==0){var p=((a.x-u)*d+(a.y-c)*f)/(d*d+f*f);p>1?(u=h.x,c=h.y):p>0&&(u+=d*p,c+=f*p)}return d=a.x-u,f=a.y-c,d*d+f*f}function i(a,l){for(var h=a[0],u=[h],c,d=1,f=a.length;d<f;d++)c=a[d],e(c,h)>l&&(u.push(c),h=c);return h!==c&&u.push(c),u}function r(a,l,h,u,c){for(var d=u,f,p=l+1;p<h;p++){var m=t(a[p],a[l],a[h]);m>d&&(f=p,d=m)}d>u&&(f-l>1&&r(a,l,f,u,c),c.push(a[f]),h-f>1&&r(a,f,h,u,c))}function n(a,l){var h=a.length-1,u=[a[0]];return r(a,0,h,l,u),u.push(a[h]),u}function o(a,l,h){if(a.length<=2)return a;var u=l!==void 0?l*l:1;return a=h?a:i(a,u),a=n(a,u),a}s.exports=o,s.exports.default=o})()})(ld);var tv=ld.exports;const iv=Nl(tv),oo=(s,e)=>e,Ll=s=>{let e=1/0,t=1/0,i=-1/0,r=-1/0;return s.forEach(([n,o])=>{e=Math.min(e,n),t=Math.min(t,o),i=Math.max(i,n),r=Math.max(r,o)}),{minX:e,minY:t,maxX:i,maxY:r}},La=s=>{let e=0,t=s.length-1;for(let i=0;i<s.length;i++)e+=(s[t][0]+s[i][0])*(s[t][1]-s[i][1]),t=i;return Math.abs(.5*e)},Ba=(s,e,t)=>{let i=!1;for(let r=0,n=s.length-1;r<s.length;n=r++){const o=s[r][0],a=s[r][1],l=s[n][0],h=s[n][1];a>t!=h>t&&e<(l-o)*(t-a)/(h-a)+o&&(i=!i)}return i},hd=(s,e=1)=>{const t=s.map(([i,r])=>({x:i,y:r}));return iv(t,e,!0).map(i=>[i.x,i.y])},sv={area:s=>Math.PI*s.geometry.rx*s.geometry.ry,intersects:(s,e,t)=>{const{cx:i,cy:r,rx:n,ry:o}=s.geometry,a=0,l=Math.cos(a),h=Math.sin(a),u=e-i,c=t-r,d=l*u+h*c,f=h*u-l*c;return d*d/(n*n)+f*f/(o*o)<=1}};oo(zi.ELLIPSE,sv);const rv={area:s=>{const{polygons:e}=s.geometry;return e.reduce((t,i)=>{const[r,...n]=i.rings,o=La(r.points),a=n.reduce((l,h)=>l+La(h.points),0);return t+o-a},0)},intersects:(s,e,t)=>{const{polygons:i}=s.geometry;for(const r of i){const[n,...o]=r.rings;if(Ba(n.points,e,t)){let a=!1;for(const l of o)if(Ba(l.points,e,t)){a=!0;break}if(!a)return!0}}return!1}},nv=s=>{const e=s.reduce((t,i)=>[...t,...i.rings[0].points],[]);return Ll(e)},ov=(s,e=1)=>{const t=s.geometry.polygons.map(r=>{const n=r.rings.map(a=>{const l=hd(a.points,e);return{...a,points:l}}),o=Ll(n[0].points);return{...r,rings:n,bounds:o}}),i=nv(t);return{...s,geometry:{...s.geometry,polygons:t,bounds:i}}};oo(zi.MULTIPOLYGLON,rv);const av={area:s=>{const e=s.geometry.points;return La(e)},intersects:(s,e,t)=>{const i=s.geometry.points;return Ba(i,e,t)}},lv=(s,e=1)=>{const t=hd(s.geometry.points,e),i=Ll(t);return{...s,geometry:{...s.geometry,bounds:i,points:t}}};oo(zi.POLYGON,av);const hv={area:s=>s.geometry.w*s.geometry.h,intersects:(s,e,t)=>e>=s.geometry.x&&e<=s.geometry.x+s.geometry.w&&t>=s.geometry.y&&t<=s.geometry.y+s.geometry.h};oo(zi.RECTANGLE,hv);const lt=" ";function uv(s){let e="";Array.isArray(s)||(s=[s]);for(let t=0;t<s.length;t++){const i=s[t];if(i.type===q.CLOSE_PATH)e+="z";else if(i.type===q.HORIZ_LINE_TO)e+=(i.relative?"h":"H")+i.x;else if(i.type===q.VERT_LINE_TO)e+=(i.relative?"v":"V")+i.y;else if(i.type===q.MOVE_TO)e+=(i.relative?"m":"M")+i.x+lt+i.y;else if(i.type===q.LINE_TO)e+=(i.relative?"l":"L")+i.x+lt+i.y;else if(i.type===q.CURVE_TO)e+=(i.relative?"c":"C")+i.x1+lt+i.y1+lt+i.x2+lt+i.y2+lt+i.x+lt+i.y;else if(i.type===q.SMOOTH_CURVE_TO)e+=(i.relative?"s":"S")+i.x2+lt+i.y2+lt+i.x+lt+i.y;else if(i.type===q.QUAD_TO)e+=(i.relative?"q":"Q")+i.x1+lt+i.y1+lt+i.x+lt+i.y;else if(i.type===q.SMOOTH_QUAD_TO)e+=(i.relative?"t":"T")+i.x+lt+i.y;else if(i.type===q.ARC)e+=(i.relative?"a":"A")+i.rX+lt+i.rY+lt+i.xRot+lt+ +i.lArcFlag+lt+ +i.sweepFlag+lt+i.x+lt+i.y;else throw new Error(`Unexpected command type "${i==null?void 0:i.type}" at index ${t}.`)}return e}function Fa([s,e],t){return[s*Math.cos(t)-e*Math.sin(t),s*Math.sin(t)+e*Math.cos(t)]}function ri(...s){for(let e=0;e<s.length;e++)if(typeof s[e]!="number")throw new Error(`assertNumbers arguments[${e}] is not a number. ${typeof s[e]} == typeof ${s[e]}`);return!0}const Li=Math.PI;function Bl(s,e,t){s.lArcFlag=s.lArcFlag===0?0:1,s.sweepFlag=s.sweepFlag===0?0:1;let{rX:i,rY:r}=s;const{x:n,y:o}=s;if(Math.abs(i)<1e-10||Math.abs(r)<1e-10){s.rX=0,s.rY=0,s.cX=(e+n)/2,s.cY=(t+o)/2,s.phi1=0,s.phi2=0;return}i=Math.abs(s.rX),r=Math.abs(s.rY);const a=s.xRot/180*Li,[l,h]=Fa([(e-n)/2,(t-o)/2],-a),u=Math.pow(l,2)/Math.pow(i,2)+Math.pow(h,2)/Math.pow(r,2);1<u&&(i*=Math.sqrt(u),r*=Math.sqrt(u)),s.rX=i,s.rY=r;const c=Math.pow(i,2)*Math.pow(h,2)+Math.pow(r,2)*Math.pow(l,2),d=(s.lArcFlag!==s.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(i,2)*Math.pow(r,2)-c)/c)),f=i*h/r*d,p=-r*l/i*d,m=Fa([f,p],a);s.cX=m[0]+(e+n)/2,s.cY=m[1]+(t+o)/2,s.phi1=Math.atan2((h-p)/r,(l-f)/i),s.phi2=Math.atan2((-h-p)/r,(-l-f)/i),s.sweepFlag===0&&s.phi2>s.phi1&&(s.phi2-=2*Li),s.sweepFlag===1&&s.phi2<s.phi1&&(s.phi2+=2*Li),s.phi1*=180/Li,s.phi2*=180/Li}function Gh(s,e,t){ri(s,e,t);const i=s*s+e*e-t*t;if(0>i)return[];if(i===0)return[[s*t/(s*s+e*e),e*t/(s*s+e*e)]];const r=Math.sqrt(i);return[[(s*t+e*r)/(s*s+e*e),(e*t-s*r)/(s*s+e*e)],[(s*t-e*r)/(s*s+e*e),(e*t+s*r)/(s*s+e*e)]]}const ts=Math.PI/180;function zh(s,e,t){return(1-t)*s+t*e}function Vh(s,e,t,i){return s+Math.cos(i/180*Li)*e+Math.sin(i/180*Li)*t}function Xh(s,e,t,i){const r=e-s,n=t-e,o=i-t,a=3*r+3*o-6*n,l=(n-r)*6,h=3*r;return Math.abs(a)<1e-6?Math.abs(l)<1e-6?[]:[-h/l]:cv(l/a,h/a,1e-6)}function Wh(s,e,t,i,r){const n=1-r,o=n*n*n,a=3*n*n*r,l=3*n*r*r,h=r*r*r;return s*o+e*a+t*l+i*h}function cv(s,e,t=1e-6){const i=s*s/4-e;if(i<-t)return[];if(i<=t)return[-s/2];const r=Math.sqrt(i);return[-(s/2)-r,-(s/2)+r]}function dv(s,e,t){s.cX||Bl(s,e,t);const i=s.xRot/180*Li;if(Math.abs(s.rX)<1e-10||Math.abs(s.rY)<1e-10)return[{relative:s.relative,type:q.CURVE_TO,x1:e+(s.x-e)/3,y1:t+(s.y-t)/3,x2:e+2*(s.x-e)/3,y2:t+2*(s.y-t)/3,x:s.x,y:s.y}];const r=Math.min(s.phi1,s.phi2),n=Math.max(s.phi1,s.phi2),o=n-r,a=Math.ceil(o/90),l=new Array(a);let h=e,u=t;const c=(d,f)=>{const[p,m]=Fa([d*s.rX,f*s.rY],i);return[s.cX+p,s.cY+m]};for(let d=0;d<a;d++){const f=zh(s.phi1,s.phi2,d/a),p=zh(s.phi1,s.phi2,(d+1)/a),m=p-f,g=4/3*Math.tan(m*ts/4),v=Math.cos(f*ts)-g*Math.sin(f*ts),x=Math.sin(f*ts)+g*Math.cos(f*ts),_=Math.cos(p*ts),E=Math.sin(p*ts),R=_+g*E,M=E-g*_,O=c(v,x),N=c(R,M),B=c(_,E),G={relative:s.relative,type:q.CURVE_TO,x:B[0],y:B[1],x1:O[0],y1:O[1],x2:N[0],y2:N[1]};s.relative&&(G.x1-=h,G.y1-=u,G.x2-=h,G.y2-=u,G.x-=h,G.y-=u),h=B[0],u=B[1],l[d]=G}return l}function Uo(s,e,t){const i=e[0]-s[0],r=e[1]-s[1],n=t[0]-s[0],o=t[1]-s[1],a=i*o-r*n;if(!(Math.abs(a)<1e-10))return!1;const l=i*n+r*o,h=i*i+r*r,u=n*n+o*o;return 0<=l&&l<=u&&h<=u}function fv(s,e=!0){if(s.length<2)return s;const t=ut.INFO((n,o,a)=>({...n,x:n.x??o,y:n.y??a,relative:n.relative??!1})),i=[];let r=[];for(const n of s){const o=t(n);o.type===q.MOVE_TO&&r.length>0&&(e?i.push(...Kr(r)):i.unshift(...Kr(r)),r=[]),r.push(o)}return r.length>0&&(e?i.push(...Kr(r)):i.unshift(...Kr(r))),i}function Kr(s){var e;const t=((e=s[s.length-1])==null?void 0:e.type)===q.CLOSE_PATH,i=t?s.length-2:s.length-1,r=[{type:q.MOVE_TO,relative:!1,x:s[i].x,y:s[i].y}];for(let n=i;n>0;n--){const o=s[n],a=s[n-1];if(o.relative)throw new Error("Relative command are not supported convert first with `toAbs()`");switch(o.type){case q.HORIZ_LINE_TO:r.push({type:q.HORIZ_LINE_TO,relative:!1,x:a.x});break;case q.VERT_LINE_TO:r.push({type:q.VERT_LINE_TO,relative:!1,y:a.y});break;case q.LINE_TO:case q.MOVE_TO:r.push({type:q.LINE_TO,relative:!1,x:a.x,y:a.y});break;case q.CURVE_TO:r.push({type:q.CURVE_TO,relative:!1,x:a.x,y:a.y,x1:o.x2,y1:o.y2,x2:o.x1,y2:o.y1});break;case q.SMOOTH_CURVE_TO:throw new Error("Unsupported command: S (smooth cubic bezier)");case q.SMOOTH_QUAD_TO:throw new Error("Unsupported command: T (smooth quadratic bezier)");case q.ARC:throw new Error("Unsupported command: A (arc)");case q.QUAD_TO:throw new Error("Unsupported command: Q (quadratic bezier)")}}return t&&r.push({type:q.CLOSE_PATH}),r}function pv(s=1e13){ri(s);function e(t){return Math.round(t*s)/s}return function(t){return"x1"in t&&typeof t.x1<"u"&&(t.x1=e(t.x1)),"y1"in t&&typeof t.y1<"u"&&(t.y1=e(t.y1)),"x2"in t&&typeof t.x2<"u"&&(t.x2=e(t.x2)),"y2"in t&&typeof t.y2<"u"&&(t.y2=e(t.y2)),"x"in t&&typeof t.x<"u"&&(t.x=e(t.x)),"y"in t&&typeof t.y<"u"&&(t.y=e(t.y)),"rX"in t&&typeof t.rX<"u"&&(t.rX=e(t.rX)),"rY"in t&&typeof t.rY<"u"&&(t.rY=e(t.rY)),t}}function ud(){return ni((s,e,t)=>(s.relative&&(typeof s.x1<"u"&&(s.x1+=e),typeof s.y1<"u"&&(s.y1+=t),typeof s.x2<"u"&&(s.x2+=e),typeof s.y2<"u"&&(s.y2+=t),typeof s.x<"u"&&(s.x+=e),typeof s.y<"u"&&(s.y+=t),s.relative=!1),s))}function mv(){return ni((s,e,t)=>(s.relative||(typeof s.x1<"u"&&(s.x1-=e),typeof s.y1<"u"&&(s.y1-=t),typeof s.x2<"u"&&(s.x2-=e),typeof s.y2<"u"&&(s.y2-=t),typeof s.x<"u"&&(s.x-=e),typeof s.y<"u"&&(s.y-=t),s.relative=!0),s))}function gv(s=!0,e=!0,t=!0,i=!0){return ni((r,n,o,a,l)=>{if(isNaN(a)&&!(r.type&q.MOVE_TO))throw new Error("path must start with moveto");if(e&&r.type&q.HORIZ_LINE_TO&&(r.type=q.LINE_TO,r.y=r.relative?0:o),t&&r.type&q.VERT_LINE_TO&&(r.type=q.LINE_TO,r.x=r.relative?0:n),s&&r.type&q.CLOSE_PATH&&(r.type=q.LINE_TO,r.x=r.relative?a-n:a,r.y=r.relative?l-o:l),r.type&q.ARC&&(r.rX===0||r.rY===0)&&(r.type=q.LINE_TO,delete r.rX,delete r.rY,delete r.xRot,delete r.lArcFlag,delete r.sweepFlag),i&&r.type&q.QUAD_TO){const h=[n,o],u=r.relative?[n+r.x1,o+r.y1]:[r.x1,r.y1],c=r.relative?[n+r.x,o+r.y]:[r.x,r.y];Uo(h,u,c)&&(r.type=q.LINE_TO,delete r.x1,delete r.y1)}if(i&&r.type&q.CURVE_TO){const h=[n,o],u=r.relative?[n+r.x1,o+r.y1]:[r.x1,r.y1],c=r.relative?[n+r.x2,o+r.y2]:[r.x2,r.y2],d=r.relative?[n+r.x,o+r.y]:[r.x,r.y];Uo(h,u,d)&&Uo(h,c,d)&&(r.type=q.LINE_TO,delete r.x1,delete r.y1,delete r.x2,delete r.y2)}return r})}function cd(){let s=NaN,e=NaN,t=NaN,i=NaN;return ni((r,n,o)=>(r.type&q.SMOOTH_CURVE_TO&&(r.type=q.CURVE_TO,s=isNaN(s)?n:s,e=isNaN(e)?o:e,r.x1=r.relative?n-s:2*n-s,r.y1=r.relative?o-e:2*o-e),r.type&q.CURVE_TO?(s=r.relative?n+r.x2:r.x2,e=r.relative?o+r.y2:r.y2):(s=NaN,e=NaN),r.type&q.SMOOTH_QUAD_TO&&(r.type=q.QUAD_TO,t=isNaN(t)?n:t,i=isNaN(i)?o:i,r.x1=r.relative?n-t:2*n-t,r.y1=r.relative?o-i:2*o-i),r.type&q.QUAD_TO?(t=r.relative?n+r.x1:r.x1,i=r.relative?o+r.y1:r.y1):(t=NaN,i=NaN),r))}function dd(){let s=NaN,e=NaN;return ni((t,i,r)=>{if(t.type&q.SMOOTH_QUAD_TO&&(t.type=q.QUAD_TO,s=isNaN(s)?i:s,e=isNaN(e)?r:e,t.x1=t.relative?i-s:2*i-s,t.y1=t.relative?r-e:2*r-e),t.type&q.QUAD_TO){s=t.relative?i+t.x1:t.x1,e=t.relative?r+t.y1:t.y1;const n=t.x1,o=t.y1;t.type=q.CURVE_TO,t.x1=((t.relative?0:i)+n*2)/3,t.y1=((t.relative?0:r)+o*2)/3,t.x2=(t.x+n*2)/3,t.y2=(t.y+o*2)/3}else s=NaN,e=NaN;return t})}function ni(s){let e=0,t=0,i=NaN,r=NaN;return function(n){if(isNaN(i)&&!(n.type&q.MOVE_TO))throw new Error("path must start with moveto");const o=s(n,e,t,i,r);return n.type&q.CLOSE_PATH&&(e=i,t=r),"x"in n&&typeof n.x<"u"&&(e=n.relative?e+n.x:n.x),"y"in n&&typeof n.y<"u"&&(t=n.relative?t+n.y:n.y),n.type&q.MOVE_TO&&(i=e,r=t),o}}function vv(s=0){ri(s);let e=NaN,t=NaN,i=NaN,r=NaN;return ni((n,o,a,l,h)=>{const u=Math.abs;let c=!1,d=0,f=0;if(n.type&q.SMOOTH_CURVE_TO&&(d=isNaN(e)?0:o-e,f=isNaN(t)?0:a-t),n.type&(q.CURVE_TO|q.SMOOTH_CURVE_TO)?(e=n.relative?o+n.x2:n.x2,t=n.relative?a+n.y2:n.y2):(e=NaN,t=NaN),n.type&q.SMOOTH_QUAD_TO?(i=isNaN(i)?o:2*o-i,r=isNaN(r)?a:2*a-r):n.type&q.QUAD_TO?(i=n.relative?o+n.x1:n.x1,r=n.relative?a+n.y1:n.y2):(i=NaN,r=NaN),n.type&q.LINE_COMMANDS||n.type&q.ARC&&(n.rX===0||n.rY===0||!n.lArcFlag)||n.type&q.CURVE_TO||n.type&q.SMOOTH_CURVE_TO||n.type&q.QUAD_TO||n.type&q.SMOOTH_QUAD_TO){const p=typeof n.x>"u"?0:n.relative?n.x:n.x-o,m=typeof n.y>"u"?0:n.relative?n.y:n.y-a;d=isNaN(i)?typeof n.x1>"u"?d:n.relative?n.x:n.x1-o:i-o,f=isNaN(r)?typeof n.y1>"u"?f:n.relative?n.y:n.y1-a:r-a;const g=typeof n.x2>"u"?0:n.relative?n.x:n.x2-o,v=typeof n.y2>"u"?0:n.relative?n.y:n.y2-a;u(p)<=s&&u(m)<=s&&u(d)<=s&&u(f)<=s&&u(g)<=s&&u(v)<=s&&(c=!0)}return n.type&q.CLOSE_PATH&&u(o-l)<=s&&u(a-h)<=s&&(c=!0),c?[]:n})}function Ji(s,e,t,i,r,n){return ri(s,e,t,i,r,n),ni((o,a,l,h)=>{const u=o.x1,c=o.x2,d=o.relative&&!isNaN(h),f=typeof o.x<"u"?o.x:d?0:a,p=typeof o.y<"u"?o.y:d?0:l;o.type&q.HORIZ_LINE_TO&&e!==0&&(o.type=q.LINE_TO,o.y=o.relative?0:l),o.type&q.VERT_LINE_TO&&t!==0&&(o.type=q.LINE_TO,o.x=o.relative?0:a),typeof o.x<"u"&&(o.x=o.x*s+p*t+(d?0:r)),typeof o.y<"u"&&(o.y=f*e+o.y*i+(d?0:n)),typeof o.x1<"u"&&(o.x1=o.x1*s+o.y1*t+(d?0:r)),typeof o.y1<"u"&&(o.y1=u*e+o.y1*i+(d?0:n)),typeof o.x2<"u"&&(o.x2=o.x2*s+o.y2*t+(d?0:r)),typeof o.y2<"u"&&(o.y2=c*e+o.y2*i+(d?0:n));function m(v){return v*v}const g=s*i-e*t;if(typeof o.xRot<"u"&&(s!==1||e!==0||t!==0||i!==1))if(g===0)delete o.rX,delete o.rY,delete o.xRot,delete o.lArcFlag,delete o.sweepFlag,o.type=q.LINE_TO;else{const v=o.xRot*Math.PI/180,x=Math.sin(v),_=Math.cos(v),E=1/m(o.rX),R=1/m(o.rY),M=m(_)*E+m(x)*R,O=2*x*_*(E-R),N=m(x)*E+m(_)*R,B=M*i*i-O*e*i+N*e*e,G=O*(s*i+e*t)-2*(M*t*i+N*s*e),K=M*t*t-O*s*t+N*s*s,D=(Math.atan2(G,B-K)+Math.PI)%Math.PI/2,C=Math.sin(D),I=Math.cos(D);o.rX=Math.abs(g)/Math.sqrt(B*m(I)+G*C*I+K*m(C)),o.rY=Math.abs(g)/Math.sqrt(B*m(C)-G*C*I+K*m(I)),o.xRot=D*180/Math.PI}return typeof o.sweepFlag<"u"&&0>g&&(o.sweepFlag=+!o.sweepFlag),o})}function yv(s,e=0,t=0){ri(s,e,t);const i=Math.sin(s),r=Math.cos(s);return Ji(r,i,-i,r,e-e*r+t*i,t-e*i-t*r)}function xv(s,e=0){return ri(s,e),Ji(1,0,0,1,s,e)}function _v(s,e=s){return ri(s,e),Ji(s,0,0,e,0,0)}function Tv(s){return ri(s),Ji(1,0,Math.tan(s),1,0,0)}function wv(s){return ri(s),Ji(1,Math.tan(s),0,1,0,0)}function Ev(s=0){return ri(s),Ji(-1,0,0,1,s,0)}function bv(s=0){return ri(s),Ji(1,0,0,-1,0,s)}function Sv(){return ni((s,e,t)=>q.ARC===s.type?dv(s,s.relative?0:e,s.relative?0:t):s)}function Av(){return ni((s,e,t)=>(s.relative&&(e=0,t=0),q.ARC===s.type&&Bl(s,e,t),s))}function fd(){return s=>({...s})}function Rv(){const s=fd(),e=ud(),t=dd(),i=cd(),r=ni((n,o,a)=>{const l=i(t(e(s(n))));function h(c){c>r.maxX&&(r.maxX=c),c<r.minX&&(r.minX=c)}function u(c){c>r.maxY&&(r.maxY=c),c<r.minY&&(r.minY=c)}if(l.type&q.DRAWING_COMMANDS&&(h(o),u(a)),l.type&q.HORIZ_LINE_TO&&h(l.x),l.type&q.VERT_LINE_TO&&u(l.y),l.type&q.LINE_TO&&(h(l.x),u(l.y)),l.type&q.CURVE_TO){h(l.x),u(l.y);const c=Xh(o,l.x1,l.x2,l.x);for(const f of c)0<f&&1>f&&h(Wh(o,l.x1,l.x2,l.x,f));const d=Xh(a,l.y1,l.y2,l.y);for(const f of d)0<f&&1>f&&u(Wh(a,l.y1,l.y2,l.y,f))}if(l.type&q.ARC){h(l.x),u(l.y),Bl(l,o,a);const c=l.xRot/180*Math.PI,d=Math.cos(c)*l.rX,f=Math.sin(c)*l.rX,p=-Math.sin(c)*l.rY,m=Math.cos(c)*l.rY,[g,v]=l.phi1<l.phi2?[l.phi1,l.phi2]:-180>l.phi2?[l.phi2+360,l.phi1+360]:[l.phi2,l.phi1],x=([R,M])=>{const O=Math.atan2(M,R)*180/Math.PI;return O<g?O+360:O},_=Gh(p,-d,0).map(x);for(const R of _)R>g&&R<v&&h(Vh(l.cX,d,p,R));const E=Gh(m,-f,0).map(x);for(const R of E)R>g&&R<v&&u(Vh(l.cY,f,m,R))}return n});return r.minX=1/0,r.maxX=-1/0,r.minY=1/0,r.maxY=-1/0,r}const ut={ROUND:pv,TO_ABS:ud,TO_REL:mv,NORMALIZE_HVZ:gv,NORMALIZE_ST:cd,QT_TO_C:dd,INFO:ni,SANITIZE:vv,MATRIX:Ji,ROTATE:yv,TRANSLATE:xv,SCALE:_v,SKEW_X:Tv,SKEW_Y:wv,X_AXIS_SYMMETRY:Ev,Y_AXIS_SYMMETRY:bv,A_TO_C:Sv,ANNOTATE_ARCS:Av,CLONE:fd,CALCULATE_BOUNDS:Rv,REVERSE_PATH:fv};class pd{round(e){return this.transform(ut.ROUND(e))}toAbs(){return this.transform(ut.TO_ABS())}toRel(){return this.transform(ut.TO_REL())}normalizeHVZ(e,t,i){return this.transform(ut.NORMALIZE_HVZ(e,t,i))}normalizeST(){return this.transform(ut.NORMALIZE_ST())}qtToC(){return this.transform(ut.QT_TO_C())}aToC(){return this.transform(ut.A_TO_C())}sanitize(e){return this.transform(ut.SANITIZE(e))}translate(e,t){return this.transform(ut.TRANSLATE(e,t))}scale(e,t){return this.transform(ut.SCALE(e,t))}rotate(e,t,i){return this.transform(ut.ROTATE(e,t,i))}matrix(e,t,i,r,n,o){return this.transform(ut.MATRIX(e,t,i,r,n,o))}skewX(e){return this.transform(ut.SKEW_X(e))}skewY(e){return this.transform(ut.SKEW_Y(e))}xSymmetry(e){return this.transform(ut.X_AXIS_SYMMETRY(e))}ySymmetry(e){return this.transform(ut.Y_AXIS_SYMMETRY(e))}annotateArcs(){return this.transform(ut.ANNOTATE_ARCS())}}const Cv=s=>s===" "||s==="	"||s==="\r"||s===`
`,jh=s=>48<=s.charCodeAt(0)&&s.charCodeAt(0)<=57;class Pv extends pd{constructor(){super(),Ke(this,"curNumber",""),Ke(this,"curCommandType",-1),Ke(this,"curCommandRelative",!1),Ke(this,"canParseCommandOrComma",!0),Ke(this,"curNumberHasExp",!1),Ke(this,"curNumberHasExpDigits",!1),Ke(this,"curNumberHasDecimal",!1),Ke(this,"curArgs",[])}finish(e=[]){if(this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e}parse(e,t=[]){const i=r=>{t.push(r),this.curArgs.length=0,this.canParseCommandOrComma=!0};for(let r=0;r<e.length;r++){const n=e[r],o=this.curCommandType===q.ARC&&(this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber.length===1&&(this.curNumber==="0"||this.curNumber==="1"),a=jh(n)&&(this.curNumber==="0"&&n==="0"||o);if(jh(n)&&!a){this.curNumber+=n,this.curNumberHasExpDigits=this.curNumberHasExp;continue}if(n==="e"||n==="E"){this.curNumber+=n,this.curNumberHasExp=!0;continue}if((n==="-"||n==="+")&&this.curNumberHasExp&&!this.curNumberHasExpDigits){this.curNumber+=n;continue}if(n==="."&&!this.curNumberHasExp&&!this.curNumberHasDecimal&&!o){this.curNumber+=n,this.curNumberHasDecimal=!0;continue}if(this.curNumber&&this.curCommandType!==-1){const l=Number(this.curNumber);if(isNaN(l))throw new SyntaxError(`Invalid number ending at ${r}`);if(this.curCommandType===q.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>l)throw new SyntaxError(`Expected positive number, got "${l}" at index "${r}"`)}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError(`Expected a flag, got "${this.curNumber}" at index "${r}"`)}this.curArgs.push(l),this.curArgs.length===Mv[this.curCommandType]&&(q.HORIZ_LINE_TO===this.curCommandType?i({type:q.HORIZ_LINE_TO,relative:this.curCommandRelative,x:l}):q.VERT_LINE_TO===this.curCommandType?i({type:q.VERT_LINE_TO,relative:this.curCommandRelative,y:l}):this.curCommandType===q.MOVE_TO||this.curCommandType===q.LINE_TO||this.curCommandType===q.SMOOTH_QUAD_TO?(i({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),q.MOVE_TO===this.curCommandType&&(this.curCommandType=q.LINE_TO)):this.curCommandType===q.CURVE_TO?i({type:q.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===q.SMOOTH_CURVE_TO?i({type:q.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===q.QUAD_TO?i({type:q.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===q.ARC&&i({type:q.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!Cv(n)){if(n===","&&this.canParseCommandOrComma){this.canParseCommandOrComma=!1;continue}if(n==="+"||n==="-"||n==="."){this.curNumber=n,this.curNumberHasDecimal=n===".";continue}if(a){this.curNumber=n,this.curNumberHasDecimal=!1;continue}if(this.curArgs.length!==0)throw new SyntaxError(`Unterminated command at index ${r}.`);if(!this.canParseCommandOrComma)throw new SyntaxError(`Unexpected character "${n}" at index ${r}. Command cannot follow comma`);if(this.canParseCommandOrComma=!1,n==="z"||n==="Z"){t.push({type:q.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1;continue}else if(n==="h"||n==="H")this.curCommandType=q.HORIZ_LINE_TO,this.curCommandRelative=n==="h";else if(n==="v"||n==="V")this.curCommandType=q.VERT_LINE_TO,this.curCommandRelative=n==="v";else if(n==="m"||n==="M")this.curCommandType=q.MOVE_TO,this.curCommandRelative=n==="m";else if(n==="l"||n==="L")this.curCommandType=q.LINE_TO,this.curCommandRelative=n==="l";else if(n==="c"||n==="C")this.curCommandType=q.CURVE_TO,this.curCommandRelative=n==="c";else if(n==="s"||n==="S")this.curCommandType=q.SMOOTH_CURVE_TO,this.curCommandRelative=n==="s";else if(n==="q"||n==="Q")this.curCommandType=q.QUAD_TO,this.curCommandRelative=n==="q";else if(n==="t"||n==="T")this.curCommandType=q.SMOOTH_QUAD_TO,this.curCommandRelative=n==="t";else if(n==="a"||n==="A")this.curCommandType=q.ARC,this.curCommandRelative=n==="a";else throw new SyntaxError(`Unexpected character "${n}" at index ${r}.`)}}return t}transform(e){return Object.create(this,{parse:{value(t,i=[]){const r=Object.getPrototypeOf(this).parse.call(this,t);for(const n of r){const o=e(n);Array.isArray(o)?i.push(...o):i.push(o)}return i}}})}}const Xe=class ka extends pd{constructor(e){super(),Ke(this,"commands"),typeof e=="string"?this.commands=ka.parse(e):this.commands=e}encode(){return ka.encode(this.commands)}getBounds(){const e=ut.CALCULATE_BOUNDS();return this.transform(e),e}transform(e){const t=[];for(const i of this.commands){const r=e(i);Array.isArray(r)?t.push(...r):t.push(r)}return this.commands=t,this}reverse(e=!0){return this.commands=ut.REVERSE_PATH(this.commands,e),this}static encode(e){return uv(e)}static parse(e){const t=new Pv,i=[];return t.parse(e,i),t.finish(i),i}};Ke(Xe,"CLOSE_PATH",1),Ke(Xe,"MOVE_TO",2),Ke(Xe,"HORIZ_LINE_TO",4),Ke(Xe,"VERT_LINE_TO",8),Ke(Xe,"LINE_TO",16),Ke(Xe,"CURVE_TO",32),Ke(Xe,"SMOOTH_CURVE_TO",64),Ke(Xe,"QUAD_TO",128),Ke(Xe,"SMOOTH_QUAD_TO",256),Ke(Xe,"ARC",512),Ke(Xe,"LINE_COMMANDS",Xe.LINE_TO|Xe.HORIZ_LINE_TO|Xe.VERT_LINE_TO),Ke(Xe,"DRAWING_COMMANDS",Xe.HORIZ_LINE_TO|Xe.VERT_LINE_TO|Xe.LINE_TO|Xe.CURVE_TO|Xe.SMOOTH_CURVE_TO|Xe.QUAD_TO|Xe.SMOOTH_QUAD_TO|Xe.ARC);let q=Xe;const Mv={[q.MOVE_TO]:2,[q.LINE_TO]:2,[q.HORIZ_LINE_TO]:1,[q.VERT_LINE_TO]:1,[q.CLOSE_PATH]:0,[q.QUAD_TO]:4,[q.SMOOTH_QUAD_TO]:2,[q.CURVE_TO]:6,[q.SMOOTH_CURVE_TO]:4,[q.ARC]:7},_t=[];for(let s=0;s<256;++s)_t.push((s+256).toString(16).slice(1));function Iv(s,e=0){return(_t[s[e+0]]+_t[s[e+1]]+_t[s[e+2]]+_t[s[e+3]]+"-"+_t[s[e+4]]+_t[s[e+5]]+"-"+_t[s[e+6]]+_t[s[e+7]]+"-"+_t[s[e+8]]+_t[s[e+9]]+"-"+_t[s[e+10]]+_t[s[e+11]]+_t[s[e+12]]+_t[s[e+13]]+_t[s[e+14]]+_t[s[e+15]]).toLowerCase()}let Ho;const Ov=new Uint8Array(16);function Dv(){if(!Ho){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ho=crypto.getRandomValues.bind(crypto)}return Ho(Ov)}const Nv=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Yh={randomUUID:Nv};function Lv(s,e,t){var i;if(Yh.randomUUID&&!s)return Yh.randomUUID();s=s||{};const r=s.random??((i=s.rng)==null?void 0:i.call(s))??Dv();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Iv(r)}const Bv=(s,e)=>{const t=typeof e=="function"?e(s):e;if(t){const{fill:i,fillOpacity:r,stroke:n,strokeWidth:o,strokeOpacity:a}=t;let l="";return i&&(l+=`fill:${i};`,l+=`fill-opacity:${r||"0.25"};`),n&&(l+=`stroke:${n};`,l+=`stroke-width:${o||"1"};`,l+=`stroke-opacity:${a||"1"};`),l}};zi.RECTANGLE,zi.POLYGON,zi.MULTIPOLYGLON;function Fv(s,e,t){let i;const r=Dl();let{annotation:n}=e,{editor:o}=e,{style:a}=e,{target:l}=e,{transform:h}=e,{viewportScale:u}=e,c;return no(()=>(t(6,c=new o({target:l,props:{shape:n.target.selector,computedStyle:i,transform:h,viewportScale:u,svgEl:l.closest("svg")}})),c.$on("change",d=>{c.$$set({shape:d.detail}),r("change",d.detail)}),c.$on("grab",d=>r("grab",d.detail)),c.$on("release",d=>r("release",d.detail)),()=>{c.$destroy()})),s.$$set=d=>{"annotation"in d&&t(0,n=d.annotation),"editor"in d&&t(1,o=d.editor),"style"in d&&t(2,a=d.style),"target"in d&&t(3,l=d.target),"transform"in d&&t(4,h=d.transform),"viewportScale"in d&&t(5,u=d.viewportScale)},s.$$.update=()=>{s.$$.dirty&5&&t(7,i=Bv(n,a)),s.$$.dirty&65&&n&&(c==null||c.$set({shape:n.target.selector})),s.$$.dirty&80&&c&&c.$set({transform:h}),s.$$.dirty&96&&c&&c.$set({viewportScale:u}),s.$$.dirty&192&&c&&i&&c.$set({computedStyle:i})},[n,o,a,l,h,u,c,i]}class kv extends Ot{constructor(e){super(),It(this,e,Fv,null,St,{annotation:0,editor:1,style:2,target:3,transform:4,viewportScale:5})}}typeof navigator>"u"||navigator.userAgent.indexOf("Mac OS X");var _s=(s=>(s[s.WEBGL_LEGACY=0]="WEBGL_LEGACY",s[s.WEBGL=1]="WEBGL",s[s.WEBGL2=2]="WEBGL2",s))(_s||{}),md=(s=>(s[s.UNKNOWN=0]="UNKNOWN",s[s.WEBGL=1]="WEBGL",s[s.CANVAS=2]="CANVAS",s))(md||{}),Ua=(s=>(s[s.COLOR=16384]="COLOR",s[s.DEPTH=256]="DEPTH",s[s.STENCIL=1024]="STENCIL",s))(Ua||{}),ye=(s=>(s[s.NORMAL=0]="NORMAL",s[s.ADD=1]="ADD",s[s.MULTIPLY=2]="MULTIPLY",s[s.SCREEN=3]="SCREEN",s[s.OVERLAY=4]="OVERLAY",s[s.DARKEN=5]="DARKEN",s[s.LIGHTEN=6]="LIGHTEN",s[s.COLOR_DODGE=7]="COLOR_DODGE",s[s.COLOR_BURN=8]="COLOR_BURN",s[s.HARD_LIGHT=9]="HARD_LIGHT",s[s.SOFT_LIGHT=10]="SOFT_LIGHT",s[s.DIFFERENCE=11]="DIFFERENCE",s[s.EXCLUSION=12]="EXCLUSION",s[s.HUE=13]="HUE",s[s.SATURATION=14]="SATURATION",s[s.COLOR=15]="COLOR",s[s.LUMINOSITY=16]="LUMINOSITY",s[s.NORMAL_NPM=17]="NORMAL_NPM",s[s.ADD_NPM=18]="ADD_NPM",s[s.SCREEN_NPM=19]="SCREEN_NPM",s[s.NONE=20]="NONE",s[s.SRC_OVER=0]="SRC_OVER",s[s.SRC_IN=21]="SRC_IN",s[s.SRC_OUT=22]="SRC_OUT",s[s.SRC_ATOP=23]="SRC_ATOP",s[s.DST_OVER=24]="DST_OVER",s[s.DST_IN=25]="DST_IN",s[s.DST_OUT=26]="DST_OUT",s[s.DST_ATOP=27]="DST_ATOP",s[s.ERASE=26]="ERASE",s[s.SUBTRACT=28]="SUBTRACT",s[s.XOR=29]="XOR",s))(ye||{}),fi=(s=>(s[s.POINTS=0]="POINTS",s[s.LINES=1]="LINES",s[s.LINE_LOOP=2]="LINE_LOOP",s[s.LINE_STRIP=3]="LINE_STRIP",s[s.TRIANGLES=4]="TRIANGLES",s[s.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",s[s.TRIANGLE_FAN=6]="TRIANGLE_FAN",s))(fi||{}),te=(s=>(s[s.RGBA=6408]="RGBA",s[s.RGB=6407]="RGB",s[s.RG=33319]="RG",s[s.RED=6403]="RED",s[s.RGBA_INTEGER=36249]="RGBA_INTEGER",s[s.RGB_INTEGER=36248]="RGB_INTEGER",s[s.RG_INTEGER=33320]="RG_INTEGER",s[s.RED_INTEGER=36244]="RED_INTEGER",s[s.ALPHA=6406]="ALPHA",s[s.LUMINANCE=6409]="LUMINANCE",s[s.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",s[s.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",s[s.DEPTH_STENCIL=34041]="DEPTH_STENCIL",s))(te||{}),Ws=(s=>(s[s.TEXTURE_2D=3553]="TEXTURE_2D",s[s.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",s[s.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",s[s.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",s[s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",s[s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",s[s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",s[s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",s))(Ws||{}),fe=(s=>(s[s.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",s[s.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",s[s.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",s[s.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",s[s.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",s[s.UNSIGNED_INT=5125]="UNSIGNED_INT",s[s.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",s[s.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",s[s.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",s[s.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",s[s.BYTE=5120]="BYTE",s[s.SHORT=5122]="SHORT",s[s.INT=5124]="INT",s[s.FLOAT=5126]="FLOAT",s[s.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",s[s.HALF_FLOAT=36193]="HALF_FLOAT",s))(fe||{}),re=(s=>(s[s.FLOAT=0]="FLOAT",s[s.INT=1]="INT",s[s.UINT=2]="UINT",s))(re||{}),Ti=(s=>(s[s.NEAREST=0]="NEAREST",s[s.LINEAR=1]="LINEAR",s))(Ti||{}),Vi=(s=>(s[s.CLAMP=33071]="CLAMP",s[s.REPEAT=10497]="REPEAT",s[s.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",s))(Vi||{}),vi=(s=>(s[s.OFF=0]="OFF",s[s.POW2=1]="POW2",s[s.ON=2]="ON",s[s.ON_MANUAL=3]="ON_MANUAL",s))(vi||{}),Ct=(s=>(s[s.NPM=0]="NPM",s[s.UNPACK=1]="UNPACK",s[s.PMA=2]="PMA",s[s.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",s[s.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",s[s.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",s))(Ct||{}),di=(s=>(s[s.NO=0]="NO",s[s.YES=1]="YES",s[s.AUTO=2]="AUTO",s[s.BLEND=0]="BLEND",s[s.CLEAR=1]="CLEAR",s[s.BLIT=2]="BLIT",s))(di||{}),Fl=(s=>(s[s.AUTO=0]="AUTO",s[s.MANUAL=1]="MANUAL",s))(Fl||{}),Ht=(s=>(s.LOW="lowp",s.MEDIUM="mediump",s.HIGH="highp",s))(Ht||{}),ft=(s=>(s[s.NONE=0]="NONE",s[s.SCISSOR=1]="SCISSOR",s[s.STENCIL=2]="STENCIL",s[s.SPRITE=3]="SPRITE",s[s.COLOR=4]="COLOR",s))(ft||{}),dt=(s=>(s[s.NONE=0]="NONE",s[s.LOW=2]="LOW",s[s.MEDIUM=4]="MEDIUM",s[s.HIGH=8]="HIGH",s))(dt||{}),mi=(s=>(s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",s))(mi||{});const Uv={createCanvas:(s,e)=>{const t=document.createElement("canvas");return t.width=s,t.height=e,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(s,e)=>fetch(s,e),parseXML:s=>new DOMParser().parseFromString(s,"text/xml")},ne={ADAPTER:Uv,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Go=/iPhone/i,qh=/iPod/i,Zh=/iPad/i,Kh=/\biOS-universal(?:.+)Mac\b/i,zo=/\bAndroid(?:.+)Mobile\b/i,Qh=/Android/i,Rs=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Qr=/Silk/i,xi=/Windows Phone/i,Jh=/\bWindows(?:.+)ARM\b/i,$h=/BlackBerry/i,eu=/BB10/i,tu=/Opera Mini/i,iu=/\b(CriOS|Chrome)(?:.+)Mobile/i,su=/Mobile(?:.+)Firefox\b/i,ru=function(s){return typeof s<"u"&&s.platform==="MacIntel"&&typeof s.maxTouchPoints=="number"&&s.maxTouchPoints>1&&typeof MSStream>"u"};function Hv(s){return function(e){return e.test(s)}}function nu(s){var e={userAgent:"",platform:"",maxTouchPoints:0};!s&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof s=="string"?e.userAgent=s:s&&s.userAgent&&(e={userAgent:s.userAgent,platform:s.platform,maxTouchPoints:s.maxTouchPoints||0});var t=e.userAgent,i=t.split("[FBAN");typeof i[1]<"u"&&(t=i[0]),i=t.split("Twitter"),typeof i[1]<"u"&&(t=i[0]);var r=Hv(t),n={apple:{phone:r(Go)&&!r(xi),ipod:r(qh),tablet:!r(Go)&&(r(Zh)||ru(e))&&!r(xi),universal:r(Kh),device:(r(Go)||r(qh)||r(Zh)||r(Kh)||ru(e))&&!r(xi)},amazon:{phone:r(Rs),tablet:!r(Rs)&&r(Qr),device:r(Rs)||r(Qr)},android:{phone:!r(xi)&&r(Rs)||!r(xi)&&r(zo),tablet:!r(xi)&&!r(Rs)&&!r(zo)&&(r(Qr)||r(Qh)),device:!r(xi)&&(r(Rs)||r(Qr)||r(zo)||r(Qh))||r(/\bokhttp\b/i)},windows:{phone:r(xi),tablet:r(Jh),device:r(xi)||r(Jh)},other:{blackberry:r($h),blackberry10:r(eu),opera:r(tu),firefox:r(su),chrome:r(iu),device:r($h)||r(eu)||r(tu)||r(su)||r(iu)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Gv=nu.default??nu,wi=Gv(globalThis.navigator);ne.RETINA_PREFIX=/@([0-9\.]+)x/;ne.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var gd={exports:{}};(function(s){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(l,h,u){this.fn=l,this.context=h,this.once=u||!1}function n(l,h,u,c,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new r(u,c||l,d),p=t?t+h:h;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function o(l,h){--l._eventsCount===0?l._events=new i:delete l._events[h]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],h,u;if(this._eventsCount===0)return l;for(u in h=this._events)e.call(h,u)&&l.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(h)):l},a.prototype.listeners=function(l){var h=t?t+l:l,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var c=0,d=u.length,f=new Array(d);c<d;c++)f[c]=u[c].fn;return f},a.prototype.listenerCount=function(l){var h=t?t+l:l,u=this._events[h];return u?u.fn?1:u.length:0},a.prototype.emit=function(l,h,u,c,d,f){var p=t?t+l:l;if(!this._events[p])return!1;var m=this._events[p],g=arguments.length,v,x;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),g){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,u),!0;case 4:return m.fn.call(m.context,h,u,c),!0;case 5:return m.fn.call(m.context,h,u,c,d),!0;case 6:return m.fn.call(m.context,h,u,c,d,f),!0}for(x=1,v=new Array(g-1);x<g;x++)v[x-1]=arguments[x];m.fn.apply(m.context,v)}else{var _=m.length,E;for(x=0;x<_;x++)switch(m[x].once&&this.removeListener(l,m[x].fn,void 0,!0),g){case 1:m[x].fn.call(m[x].context);break;case 2:m[x].fn.call(m[x].context,h);break;case 3:m[x].fn.call(m[x].context,h,u);break;case 4:m[x].fn.call(m[x].context,h,u,c);break;default:if(!v)for(E=1,v=new Array(g-1);E<g;E++)v[E-1]=arguments[E];m[x].fn.apply(m[x].context,v)}}return!0},a.prototype.on=function(l,h,u){return n(this,l,h,u,!1)},a.prototype.once=function(l,h,u){return n(this,l,h,u,!0)},a.prototype.removeListener=function(l,h,u,c){var d=t?t+l:l;if(!this._events[d])return this;if(!h)return o(this,d),this;var f=this._events[d];if(f.fn)f.fn===h&&(!c||f.once)&&(!u||f.context===u)&&o(this,d);else{for(var p=0,m=[],g=f.length;p<g;p++)(f[p].fn!==h||c&&!f[p].once||u&&f[p].context!==u)&&m.push(f[p]);m.length?this._events[d]=m.length===1?m[0]:m:o(this,d)}return this},a.prototype.removeAllListeners=function(l){var h;return l?(h=t?t+l:l,this._events[h]&&o(this,h)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,s.exports=a})(gd);var zv=gd.exports;const Fr=Nl(zv);var kl={exports:{}};kl.exports=ao;kl.exports.default=ao;function ao(s,e,t){t=t||2;var i=e&&e.length,r=i?e[0]*t:s.length,n=vd(s,0,r,t,!0),o=[];if(!n||n.next===n.prev)return o;var a,l,h,u,c,d,f;if(i&&(n=Yv(s,e,n,t)),s.length>80*t){a=h=s[0],l=u=s[1];for(var p=t;p<r;p+=t)c=s[p],d=s[p+1],c<a&&(a=c),d<l&&(l=d),c>h&&(h=c),d>u&&(u=d);f=Math.max(h-a,u-l),f=f!==0?32767/f:0}return Pr(n,o,t,a,l,f,0),o}function vd(s,e,t,i,r){var n,o;if(r===za(s,e,t,i)>0)for(n=e;n<t;n+=i)o=ou(n,s[n],s[n+1],o);else for(n=t-i;n>=e;n-=i)o=ou(n,s[n],s[n+1],o);return o&&lo(o,o.next)&&(Ir(o),o=o.next),o}function vs(s,e){if(!s)return s;e||(e=s);var t=s,i;do if(i=!1,!t.steiner&&(lo(t,t.next)||Je(t.prev,t,t.next)===0)){if(Ir(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Pr(s,e,t,i,r,n,o){if(s){!o&&n&&Jv(s,i,r,n);for(var a=s,l,h;s.prev!==s.next;){if(l=s.prev,h=s.next,n?Xv(s,i,r,n):Vv(s)){e.push(l.i/t|0),e.push(s.i/t|0),e.push(h.i/t|0),Ir(s),s=h.next,a=h.next;continue}if(s=h,s===a){o?o===1?(s=Wv(vs(s),e,t),Pr(s,e,t,i,r,n,2)):o===2&&jv(s,e,t,i,r,n):Pr(vs(s),e,t,i,r,n,1);break}}}}function Vv(s){var e=s.prev,t=s,i=s.next;if(Je(e,t,i)>=0)return!1;for(var r=e.x,n=t.x,o=i.x,a=e.y,l=t.y,h=i.y,u=r<n?r<o?r:o:n<o?n:o,c=a<l?a<h?a:h:l<h?l:h,d=r>n?r>o?r:o:n>o?n:o,f=a>l?a>h?a:h:l>h?l:h,p=i.next;p!==e;){if(p.x>=u&&p.x<=d&&p.y>=c&&p.y<=f&&Gs(r,a,n,l,o,h,p.x,p.y)&&Je(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Xv(s,e,t,i){var r=s.prev,n=s,o=s.next;if(Je(r,n,o)>=0)return!1;for(var a=r.x,l=n.x,h=o.x,u=r.y,c=n.y,d=o.y,f=a<l?a<h?a:h:l<h?l:h,p=u<c?u<d?u:d:c<d?c:d,m=a>l?a>h?a:h:l>h?l:h,g=u>c?u>d?u:d:c>d?c:d,v=Ha(f,p,e,t,i),x=Ha(m,g,e,t,i),_=s.prevZ,E=s.nextZ;_&&_.z>=v&&E&&E.z<=x;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==r&&_!==o&&Gs(a,u,l,c,h,d,_.x,_.y)&&Je(_.prev,_,_.next)>=0||(_=_.prevZ,E.x>=f&&E.x<=m&&E.y>=p&&E.y<=g&&E!==r&&E!==o&&Gs(a,u,l,c,h,d,E.x,E.y)&&Je(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;_&&_.z>=v;){if(_.x>=f&&_.x<=m&&_.y>=p&&_.y<=g&&_!==r&&_!==o&&Gs(a,u,l,c,h,d,_.x,_.y)&&Je(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;E&&E.z<=x;){if(E.x>=f&&E.x<=m&&E.y>=p&&E.y<=g&&E!==r&&E!==o&&Gs(a,u,l,c,h,d,E.x,E.y)&&Je(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function Wv(s,e,t){var i=s;do{var r=i.prev,n=i.next.next;!lo(r,n)&&yd(r,i,i.next,n)&&Mr(r,n)&&Mr(n,r)&&(e.push(r.i/t|0),e.push(i.i/t|0),e.push(n.i/t|0),Ir(i),Ir(i.next),i=s=n),i=i.next}while(i!==s);return vs(i)}function jv(s,e,t,i,r,n){var o=s;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&ty(o,a)){var l=xd(o,a);o=vs(o,o.next),l=vs(l,l.next),Pr(o,e,t,i,r,n,0),Pr(l,e,t,i,r,n,0);return}a=a.next}o=o.next}while(o!==s)}function Yv(s,e,t,i){var r=[],n,o,a,l,h;for(n=0,o=e.length;n<o;n++)a=e[n]*i,l=n<o-1?e[n+1]*i:s.length,h=vd(s,a,l,i,!1),h===h.next&&(h.steiner=!0),r.push(ey(h));for(r.sort(qv),n=0;n<r.length;n++)t=Zv(r[n],t);return t}function qv(s,e){return s.x-e.x}function Zv(s,e){var t=Kv(s,e);if(!t)return e;var i=xd(t,s);return vs(i,i.next),vs(t,t.next)}function Kv(s,e){var t=e,i=s.x,r=s.y,n=-1/0,o;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){var a=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=i&&a>n&&(n=a,o=t.x<t.next.x?t:t.next,a===i))return o}t=t.next}while(t!==e);if(!o)return null;var l=o,h=o.x,u=o.y,c=1/0,d;t=o;do i>=t.x&&t.x>=h&&i!==t.x&&Gs(r<u?i:n,r,h,u,r<u?n:i,r,t.x,t.y)&&(d=Math.abs(r-t.y)/(i-t.x),Mr(t,s)&&(d<c||d===c&&(t.x>o.x||t.x===o.x&&Qv(o,t)))&&(o=t,c=d)),t=t.next;while(t!==l);return o}function Qv(s,e){return Je(s.prev,s,e.prev)<0&&Je(e.next,s,s.next)<0}function Jv(s,e,t,i){var r=s;do r.z===0&&(r.z=Ha(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==s);r.prevZ.nextZ=null,r.prevZ=null,$v(r)}function $v(s){var e,t,i,r,n,o,a,l,h=1;do{for(t=s,s=null,n=null,o=0;t;){for(o++,i=t,a=0,e=0;e<h&&(a++,i=i.nextZ,!!i);e++);for(l=h;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(r=t,t=t.nextZ,a--):(r=i,i=i.nextZ,l--),n?n.nextZ=r:s=r,r.prevZ=n,n=r;t=i}n.nextZ=null,h*=2}while(o>1);return s}function Ha(s,e,t,i,r){return s=(s-t)*r|0,e=(e-i)*r|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function ey(s){var e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function Gs(s,e,t,i,r,n,o,a){return(r-o)*(e-a)>=(s-o)*(n-a)&&(s-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(n-a)>=(r-o)*(i-a)}function ty(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!iy(s,e)&&(Mr(s,e)&&Mr(e,s)&&sy(s,e)&&(Je(s.prev,s,e.prev)||Je(s,e.prev,e))||lo(s,e)&&Je(s.prev,s,s.next)>0&&Je(e.prev,e,e.next)>0)}function Je(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function lo(s,e){return s.x===e.x&&s.y===e.y}function yd(s,e,t,i){var r=$r(Je(s,e,t)),n=$r(Je(s,e,i)),o=$r(Je(t,i,s)),a=$r(Je(t,i,e));return!!(r!==n&&o!==a||r===0&&Jr(s,t,e)||n===0&&Jr(s,i,e)||o===0&&Jr(t,s,i)||a===0&&Jr(t,e,i))}function Jr(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function $r(s){return s>0?1:s<0?-1:0}function iy(s,e){var t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&yd(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function Mr(s,e){return Je(s.prev,s,s.next)<0?Je(s,e,s.next)>=0&&Je(s,s.prev,e)>=0:Je(s,e,s.prev)<0||Je(s,s.next,e)<0}function sy(s,e){var t=s,i=!1,r=(s.x+e.x)/2,n=(s.y+e.y)/2;do t.y>n!=t.next.y>n&&t.next.y!==t.y&&r<(t.next.x-t.x)*(n-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==s);return i}function xd(s,e){var t=new Ga(s.i,s.x,s.y),i=new Ga(e.i,e.x,e.y),r=s.next,n=e.prev;return s.next=e,e.prev=s,t.next=r,r.prev=t,i.next=t,t.prev=i,n.next=i,i.prev=n,i}function ou(s,e,t,i){var r=new Ga(s,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Ir(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Ga(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ao.deviation=function(s,e,t,i){var r=e&&e.length,n=r?e[0]*t:s.length,o=Math.abs(za(s,0,n,t));if(r)for(var a=0,l=e.length;a<l;a++){var h=e[a]*t,u=a<l-1?e[a+1]*t:s.length;o-=Math.abs(za(s,h,u,t))}var c=0;for(a=0;a<i.length;a+=3){var d=i[a]*t,f=i[a+1]*t,p=i[a+2]*t;c+=Math.abs((s[d]-s[p])*(s[f+1]-s[d+1])-(s[d]-s[f])*(s[p+1]-s[d+1]))}return o===0&&c===0?0:Math.abs((c-o)/o)};function za(s,e,t,i){for(var r=0,n=e,o=t-i;n<t;n+=i)r+=(s[o]-s[n])*(s[n+1]+s[o+1]),o=n;return r}ao.flatten=function(s){for(var e=s[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,r=0;r<s.length;r++){for(var n=0;n<s[r].length;n++)for(var o=0;o<e;o++)t.vertices.push(s[r][n][o]);r>0&&(i+=s[r-1].length,t.holes.push(i))}return t};var ry=kl.exports;const ny=Nl(ry);var Fn={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */Fn.exports;(function(s,e){(function(t){var i=e&&!e.nodeType&&e,r=s&&!s.nodeType&&s,n=typeof ko=="object"&&ko;(n.global===n||n.window===n||n.self===n)&&(t=n);var o,a=2147483647,l=36,h=1,u=26,c=38,d=700,f=72,p=128,m="-",g=/^xn--/,v=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=l-h,R=Math.floor,M=String.fromCharCode,O;function N(k){throw new RangeError(_[k])}function B(k,F){for(var Z=k.length,Q=[];Z--;)Q[Z]=F(k[Z]);return Q}function G(k,F){var Z=k.split("@"),Q="";Z.length>1&&(Q=Z[0]+"@",k=Z[1]),k=k.replace(x,".");var ae=k.split("."),de=B(ae,F).join(".");return Q+de}function K(k){for(var F=[],Z=0,Q=k.length,ae,de;Z<Q;)ae=k.charCodeAt(Z++),ae>=55296&&ae<=56319&&Z<Q?(de=k.charCodeAt(Z++),(de&64512)==56320?F.push(((ae&1023)<<10)+(de&1023)+65536):(F.push(ae),Z--)):F.push(ae);return F}function D(k){return B(k,function(F){var Z="";return F>65535&&(F-=65536,Z+=M(F>>>10&1023|55296),F=56320|F&1023),Z+=M(F),Z}).join("")}function C(k){return k-48<10?k-22:k-65<26?k-65:k-97<26?k-97:l}function I(k,F){return k+22+75*(k<26)-((F!=0)<<5)}function L(k,F,Z){var Q=0;for(k=Z?R(k/d):k>>1,k+=R(k/F);k>E*u>>1;Q+=l)k=R(k/E);return R(Q+(E+1)*k/(k+c))}function W(k){var F=[],Z=k.length,Q,ae=0,de=p,be=f,De,Be,Ye,Ce,Pe,Oe,He,qe,ot;for(De=k.lastIndexOf(m),De<0&&(De=0),Be=0;Be<De;++Be)k.charCodeAt(Be)>=128&&N("not-basic"),F.push(k.charCodeAt(Be));for(Ye=De>0?De+1:0;Ye<Z;){for(Ce=ae,Pe=1,Oe=l;Ye>=Z&&N("invalid-input"),He=C(k.charCodeAt(Ye++)),(He>=l||He>R((a-ae)/Pe))&&N("overflow"),ae+=He*Pe,qe=Oe<=be?h:Oe>=be+u?u:Oe-be,!(He<qe);Oe+=l)ot=l-qe,Pe>R(a/ot)&&N("overflow"),Pe*=ot;Q=F.length+1,be=L(ae-Ce,Q,Ce==0),R(ae/Q)>a-de&&N("overflow"),de+=R(ae/Q),ae%=Q,F.splice(ae++,0,de)}return D(F)}function U(k){var F,Z,Q,ae,de,be,De,Be,Ye,Ce,Pe,Oe=[],He,qe,ot,tt;for(k=K(k),He=k.length,F=p,Z=0,de=f,be=0;be<He;++be)Pe=k[be],Pe<128&&Oe.push(M(Pe));for(Q=ae=Oe.length,ae&&Oe.push(m);Q<He;){for(De=a,be=0;be<He;++be)Pe=k[be],Pe>=F&&Pe<De&&(De=Pe);for(qe=Q+1,De-F>R((a-Z)/qe)&&N("overflow"),Z+=(De-F)*qe,F=De,be=0;be<He;++be)if(Pe=k[be],Pe<F&&++Z>a&&N("overflow"),Pe==F){for(Be=Z,Ye=l;Ce=Ye<=de?h:Ye>=de+u?u:Ye-de,!(Be<Ce);Ye+=l)tt=Be-Ce,ot=l-Ce,Oe.push(M(I(Ce+tt%ot,0))),Be=R(tt/ot);Oe.push(M(I(Be,0))),de=L(Z,qe,Q==ae),Z=0,++Q}++Z,++F}return Oe.join("")}function V(k){return G(k,function(F){return g.test(F)?W(F.slice(4).toLowerCase()):F})}function ie(k){return G(k,function(F){return v.test(F)?"xn--"+U(F):F})}if(o={version:"1.4.1",ucs2:{decode:K,encode:D},decode:W,encode:U,toASCII:ie,toUnicode:V},i&&r)if(s.exports==i)r.exports=o;else for(O in o)o.hasOwnProperty(O)&&(i[O]=o[O]);else t.punycode=o})(ko)})(Fn,Fn.exports);Fn.exports;var _d=TypeError;const oy={},ay=Object.freeze(Object.defineProperty({__proto__:null,default:oy},Symbol.toStringTag,{value:"Module"})),ly=ev(ay);var Td=typeof Map=="function"&&Map.prototype,Vo=Object.getOwnPropertyDescriptor&&Td?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null;Td&&Vo&&typeof Vo.get=="function"&&Vo.get;var wd=typeof Set=="function"&&Set.prototype,Xo=Object.getOwnPropertyDescriptor&&wd?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null;wd&&Xo&&typeof Xo.get=="function"&&Xo.get;var au=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,hy=typeof Symbol=="function"&&typeof Symbol.iterator=="object",uy=ly,lu=uy.custom;cy(lu);function cy(s){if(hy)return s&&typeof s=="object"&&s instanceof Symbol;if(typeof s=="symbol")return!0;if(!s||typeof s!="object"||!au)return!1;try{return au.call(s),!0}catch{}return!1}var Ed=Object,dy=Error,fy=EvalError,py=RangeError,my=ReferenceError,gy=SyntaxError,vy=URIError,yy=Math.abs,xy=Math.floor,_y=Math.max,Ty=Math.min,wy=Math.pow,Ey=Math.round,by=Number.isNaN||function(s){return s!==s},Sy=by,Ay=function(s){return Sy(s)||s===0?s:s<0?-1:1},Ry=Object.getOwnPropertyDescriptor,bn=Ry;if(bn)try{bn([],"length")}catch{bn=null}var bd=bn,Sn=Object.defineProperty||!1;if(Sn)try{Sn({},"a",{value:1})}catch{Sn=!1}var Cy=Sn,hu,uu;function Py(){return uu||(uu=1,hu=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var s={},e=Symbol("test"),t=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(t)!=="[object Symbol]")return!1;var i=42;s[e]=i;for(var r in s)return!1;if(typeof Object.keys=="function"&&Object.keys(s).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(s).length!==0)return!1;var n=Object.getOwnPropertySymbols(s);if(n.length!==1||n[0]!==e||!Object.prototype.propertyIsEnumerable.call(s,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(s,e);if(o.value!==i||o.enumerable!==!0)return!1}return!0}),hu}var Wo,cu;function My(){if(cu)return Wo;cu=1;var s=typeof Symbol<"u"&&Symbol,e=Py();return Wo=function(){return typeof s!="function"||typeof Symbol!="function"||typeof s("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Wo}var du,fu;function Sd(){return fu||(fu=1,du=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),du}var jo,pu;function Ad(){if(pu)return jo;pu=1;var s=Ed;return jo=s.getPrototypeOf||null,jo}var Iy="Function.prototype.bind called on incompatible ",Oy=Object.prototype.toString,Dy=Math.max,Ny="[object Function]",mu=function(s,e){for(var t=[],i=0;i<s.length;i+=1)t[i]=s[i];for(var r=0;r<e.length;r+=1)t[r+s.length]=e[r];return t},Ly=function(s,e){for(var t=[],i=e,r=0;i<s.length;i+=1,r+=1)t[r]=s[i];return t},By=function(s,e){for(var t="",i=0;i<s.length;i+=1)t+=s[i],i+1<s.length&&(t+=e);return t},Fy=function(s){var e=this;if(typeof e!="function"||Oy.apply(e)!==Ny)throw new TypeError(Iy+e);for(var t=Ly(arguments,1),i,r=function(){if(this instanceof i){var h=e.apply(this,mu(t,arguments));return Object(h)===h?h:this}return e.apply(s,mu(t,arguments))},n=Dy(0,e.length-t.length),o=[],a=0;a<n;a++)o[a]="$"+a;if(i=Function("binder","return function ("+By(o,",")+"){ return binder.apply(this,arguments); }")(r),e.prototype){var l=function(){};l.prototype=e.prototype,i.prototype=new l,l.prototype=null}return i},ky=Fy,ho=Function.prototype.bind||ky,Ul=Function.prototype.call,Rd=Function.prototype.apply,Uy=typeof Reflect<"u"&&Reflect&&Reflect.apply,Hy=ho,Gy=Rd,zy=Ul,Vy=Uy,Xy=Vy||Hy.call(zy,Gy),Wy=ho,jy=_d,Yy=Ul,qy=Xy,Cd=function(s){if(s.length<1||typeof s[0]!="function")throw new jy("a function is required");return qy(Wy,Yy,s)},Yo,gu;function Zy(){if(gu)return Yo;gu=1;var s=Cd,e=bd,t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var i=!!t&&e&&e(Object.prototype,"__proto__"),r=Object,n=r.getPrototypeOf;return Yo=i&&typeof i.get=="function"?s([i.get]):typeof n=="function"?function(o){return n(o==null?o:r(o))}:!1,Yo}var qo,vu;function Ky(){if(vu)return qo;vu=1;var s=Sd(),e=Ad(),t=Zy();return qo=s?function(i){return s(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:t?function(i){return t(i)}:null,qo}var Zo,yu;function Qy(){if(yu)return Zo;yu=1;var s=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=ho;return Zo=t.call(s,e),Zo}var Re,Jy=Ed,$y=dy,ex=fy,tx=py,ix=my,er=gy,js=_d,sx=vy,rx=yy,nx=xy,ox=_y,ax=Ty,lx=wy,hx=Ey,ux=Ay,Pd=Function,Ko=function(s){try{return Pd('"use strict"; return ('+s+").constructor;")()}catch{}},Or=bd,cx=Cy,Qo=function(){throw new js},dx=Or?function(){try{return arguments.callee,Qo}catch{try{return Or(arguments,"callee").get}catch{return Qo}}}():Qo,Cs=My()(),gt=Ky(),fx=Ad(),px=Sd(),Md=Rd,kr=Ul,Ds={},mx=typeof Uint8Array>"u"||!gt?Re:gt(Uint8Array),ps={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Re:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Re:ArrayBuffer,"%ArrayIteratorPrototype%":Cs&&gt?gt([][Symbol.iterator]()):Re,"%AsyncFromSyncIteratorPrototype%":Re,"%AsyncFunction%":Ds,"%AsyncGenerator%":Ds,"%AsyncGeneratorFunction%":Ds,"%AsyncIteratorPrototype%":Ds,"%Atomics%":typeof Atomics>"u"?Re:Atomics,"%BigInt%":typeof BigInt>"u"?Re:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Re:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Re:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Re:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":$y,"%eval%":eval,"%EvalError%":ex,"%Float16Array%":typeof Float16Array>"u"?Re:Float16Array,"%Float32Array%":typeof Float32Array>"u"?Re:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Re:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Re:FinalizationRegistry,"%Function%":Pd,"%GeneratorFunction%":Ds,"%Int8Array%":typeof Int8Array>"u"?Re:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Re:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Re:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Cs&&gt?gt(gt([][Symbol.iterator]())):Re,"%JSON%":typeof JSON=="object"?JSON:Re,"%Map%":typeof Map>"u"?Re:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Cs||!gt?Re:gt(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Jy,"%Object.getOwnPropertyDescriptor%":Or,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Re:Promise,"%Proxy%":typeof Proxy>"u"?Re:Proxy,"%RangeError%":tx,"%ReferenceError%":ix,"%Reflect%":typeof Reflect>"u"?Re:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Re:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Cs||!gt?Re:gt(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Re:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Cs&&gt?gt(""[Symbol.iterator]()):Re,"%Symbol%":Cs?Symbol:Re,"%SyntaxError%":er,"%ThrowTypeError%":dx,"%TypedArray%":mx,"%TypeError%":js,"%Uint8Array%":typeof Uint8Array>"u"?Re:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Re:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Re:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Re:Uint32Array,"%URIError%":sx,"%WeakMap%":typeof WeakMap>"u"?Re:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Re:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Re:WeakSet,"%Function.prototype.call%":kr,"%Function.prototype.apply%":Md,"%Object.defineProperty%":cx,"%Object.getPrototypeOf%":fx,"%Math.abs%":rx,"%Math.floor%":nx,"%Math.max%":ox,"%Math.min%":ax,"%Math.pow%":lx,"%Math.round%":hx,"%Math.sign%":ux,"%Reflect.getPrototypeOf%":px};if(gt)try{null.error}catch(s){var gx=gt(gt(s));ps["%Error.prototype%"]=gx}var vx=function s(e){var t;if(e==="%AsyncFunction%")t=Ko("async function () {}");else if(e==="%GeneratorFunction%")t=Ko("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=Ko("async function* () {}");else if(e==="%AsyncGenerator%"){var i=s("%AsyncGeneratorFunction%");i&&(t=i.prototype)}else if(e==="%AsyncIteratorPrototype%"){var r=s("%AsyncGenerator%");r&&gt&&(t=gt(r.prototype))}return ps[e]=t,t},xu={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ur=ho,kn=Qy(),yx=Ur.call(kr,Array.prototype.concat),xx=Ur.call(Md,Array.prototype.splice),_u=Ur.call(kr,String.prototype.replace),Un=Ur.call(kr,String.prototype.slice),_x=Ur.call(kr,RegExp.prototype.exec),Tx=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,wx=/\\(\\)?/g,Ex=function(s){var e=Un(s,0,1),t=Un(s,-1);if(e==="%"&&t!=="%")throw new er("invalid intrinsic syntax, expected closing `%`");if(t==="%"&&e!=="%")throw new er("invalid intrinsic syntax, expected opening `%`");var i=[];return _u(s,Tx,function(r,n,o,a){i[i.length]=o?_u(a,wx,"$1"):n||r}),i},bx=function(s,e){var t=s,i;if(kn(xu,t)&&(i=xu[t],t="%"+i[0]+"%"),kn(ps,t)){var r=ps[t];if(r===Ds&&(r=vx(t)),typeof r>"u"&&!e)throw new js("intrinsic "+s+" exists, but is not available. Please file an issue!");return{alias:i,name:t,value:r}}throw new er("intrinsic "+s+" does not exist!")},Hl=function(s,e){if(typeof s!="string"||s.length===0)throw new js("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new js('"allowMissing" argument must be a boolean');if(_x(/^%?[^%]*%?$/,s)===null)throw new er("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var t=Ex(s),i=t.length>0?t[0]:"",r=bx("%"+i+"%",e),n=r.name,o=r.value,a=!1,l=r.alias;l&&(i=l[0],xx(t,yx([0,1],l)));for(var h=1,u=!0;h<t.length;h+=1){var c=t[h],d=Un(c,0,1),f=Un(c,-1);if((d==='"'||d==="'"||d==="`"||f==='"'||f==="'"||f==="`")&&d!==f)throw new er("property names with quotes must have matching quotes");if((c==="constructor"||!u)&&(a=!0),i+="."+c,n="%"+i+"%",kn(ps,n))o=ps[n];else if(o!=null){if(!(c in o)){if(!e)throw new js("base intrinsic for "+s+" exists, but the property is not available.");return}if(Or&&h+1>=t.length){var p=Or(o,c);u=!!p,u&&"get"in p&&!("originalValue"in p.get)?o=p.get:o=o[c]}else u=kn(o,c),o=o[c];u&&!a&&(ps[n]=o)}}return o},Id=Hl,Od=Cd,Sx=Od([Id("%String.prototype.indexOf%")]),Dd=function(s,e){var t=Id(s,!!e);return typeof t=="function"&&Sx(s,".prototype.")>-1?Od([t]):t},Ax=Hl,Hr=Dd;Ax("%Map%",!0);Hr("Map.prototype.get",!0);Hr("Map.prototype.set",!0);Hr("Map.prototype.has",!0);Hr("Map.prototype.delete",!0);Hr("Map.prototype.size",!0);var Rx=Hl,uo=Dd;Rx("%WeakMap%",!0);uo("WeakMap.prototype.get",!0);uo("WeakMap.prototype.set",!0);uo("WeakMap.prototype.has",!0);uo("WeakMap.prototype.delete",!0);(function(){for(var s=[],e=0;e<256;++e)s.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return s})();const Tu={};function Ae(s,e,t=3){if(Tu[e])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${s}`):(i=i.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${s}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${s}`),console.warn(i))),Tu[e]=!0}function Wt(s){if(typeof s!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(s)}`)}function or(s){return s.split("?")[0].split("#")[0]}function Cx(s){return s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Px(s,e,t){return s.replace(new RegExp(Cx(e),"g"),t)}function Mx(s,e){let t="",i=0,r=-1,n=0,o=-1;for(let a=0;a<=s.length;++a){if(a<s.length)o=s.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(r===a-1||n===1))if(r!==a-1&&n===2){if(t.length<2||i!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){const l=t.lastIndexOf("/");if(l!==t.length-1){l===-1?(t="",i=0):(t=t.slice(0,l),i=t.length-1-t.lastIndexOf("/")),r=a,n=0;continue}}else if(t.length===2||t.length===1){t="",i=0,r=a,n=0;continue}}}else t.length>0?t+=`/${s.slice(r+1,a)}`:t=s.slice(r+1,a),i=a-r-1;r=a,n=0}else o===46&&n!==-1?++n:n=-1}return t}const yt={toPosix(s){return Px(s,"\\","/")},isUrl(s){return/^https?:/.test(this.toPosix(s))},isDataUrl(s){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(s)},isBlobUrl(s){return s.startsWith("blob:")},hasProtocol(s){return/^[^/:]+:/.test(this.toPosix(s))},getProtocol(s){Wt(s),s=this.toPosix(s);const e=/^file:\/\/\//.exec(s);if(e)return e[0];const t=/^[^/:]+:\/{0,2}/.exec(s);return t?t[0]:""},toAbsolute(s,e,t){if(Wt(s),this.isDataUrl(s)||this.isBlobUrl(s))return s;const i=or(this.toPosix(e??ne.ADAPTER.getBaseUrl())),r=or(this.toPosix(t??this.rootname(i)));return s=this.toPosix(s),s.startsWith("/")?yt.join(r,s.slice(1)):this.isAbsolute(s)?s:this.join(i,s)},normalize(s){if(Wt(s),s.length===0)return".";if(this.isDataUrl(s)||this.isBlobUrl(s))return s;s=this.toPosix(s);let e="";const t=s.startsWith("/");this.hasProtocol(s)&&(e=this.rootname(s),s=s.slice(e.length));const i=s.endsWith("/");return s=Mx(s),s.length>0&&i&&(s+="/"),t?`/${s}`:e+s},isAbsolute(s){return Wt(s),s=this.toPosix(s),this.hasProtocol(s)?!0:s.startsWith("/")},join(...s){if(s.length===0)return".";let e;for(let t=0;t<s.length;++t){const i=s[t];if(Wt(i),i.length>0)if(e===void 0)e=i;else{const r=s[t-1]??"";this.joinExtensions.includes(this.extname(r).toLowerCase())?e+=`/../${i}`:e+=`/${i}`}}return e===void 0?".":this.normalize(e)},dirname(s){if(Wt(s),s.length===0)return".";s=this.toPosix(s);let e=s.charCodeAt(0);const t=e===47;let i=-1,r=!0;const n=this.getProtocol(s),o=s;s=s.slice(n.length);for(let a=s.length-1;a>=1;--a)if(e=s.charCodeAt(a),e===47){if(!r){i=a;break}}else r=!1;return i===-1?t?"/":this.isUrl(o)?n+s:n:t&&i===1?"//":n+s.slice(0,i)},rootname(s){Wt(s),s=this.toPosix(s);let e="";if(s.startsWith("/")?e="/":e=this.getProtocol(s),this.isUrl(s)){const t=s.indexOf("/",e.length);t!==-1?e=s.slice(0,t):e=s,e.endsWith("/")||(e+="/")}return e},basename(s,e){Wt(s),e&&Wt(e),s=or(this.toPosix(s));let t=0,i=-1,r=!0,n;if(e!==void 0&&e.length>0&&e.length<=s.length){if(e.length===s.length&&e===s)return"";let o=e.length-1,a=-1;for(n=s.length-1;n>=0;--n){const l=s.charCodeAt(n);if(l===47){if(!r){t=n+1;break}}else a===-1&&(r=!1,a=n+1),o>=0&&(l===e.charCodeAt(o)?--o===-1&&(i=n):(o=-1,i=a))}return t===i?i=a:i===-1&&(i=s.length),s.slice(t,i)}for(n=s.length-1;n>=0;--n)if(s.charCodeAt(n)===47){if(!r){t=n+1;break}}else i===-1&&(r=!1,i=n+1);return i===-1?"":s.slice(t,i)},extname(s){Wt(s),s=or(this.toPosix(s));let e=-1,t=0,i=-1,r=!0,n=0;for(let o=s.length-1;o>=0;--o){const a=s.charCodeAt(o);if(a===47){if(!r){t=o+1;break}continue}i===-1&&(r=!1,i=o+1),a===46?e===-1?e=o:n!==1&&(n=1):e!==-1&&(n=-1)}return e===-1||i===-1||n===0||n===1&&e===i-1&&e===t+1?"":s.slice(e,i)},parse(s){Wt(s);const e={root:"",dir:"",base:"",ext:"",name:""};if(s.length===0)return e;s=or(this.toPosix(s));let t=s.charCodeAt(0);const i=this.isAbsolute(s);let r;e.root=this.rootname(s),i||this.hasProtocol(s)?r=1:r=0;let n=-1,o=0,a=-1,l=!0,h=s.length-1,u=0;for(;h>=r;--h){if(t=s.charCodeAt(h),t===47){if(!l){o=h+1;break}continue}a===-1&&(l=!1,a=h+1),t===46?n===-1?n=h:u!==1&&(u=1):n!==-1&&(u=-1)}return n===-1||a===-1||u===0||u===1&&n===a-1&&n===o+1?a!==-1&&(o===0&&i?e.base=e.name=s.slice(1,a):e.base=e.name=s.slice(o,a)):(o===0&&i?(e.name=s.slice(1,n),e.base=s.slice(1,a)):(e.name=s.slice(o,n),e.base=s.slice(o,a)),e.ext=s.slice(n,a)),e.dir=this.dirname(s),e},sep:"/",delimiter:":",joinExtensions:[".html"]};let Jo;async function Ix(){return Jo??(Jo=(async()=>{var s;const e=document.createElement("canvas").getContext("webgl");if(!e)return Ct.UNPACK;const t=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!t)return Ct.UNPACK;const i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);const n=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,n),e.deleteFramebuffer(r),e.deleteTexture(i),(s=e.getExtension("WEBGL_lose_context"))==null||s.loseContext(),n[0]<=n[3]?Ct.PMA:Ct.UNPACK})()),Jo}let $o;function Ox(){return typeof $o>"u"&&($o=function(){var s;const e={stencil:!0,failIfMajorPerformanceCaveat:ne.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!ne.ADAPTER.getWebGLRenderingContext())return!1;const t=ne.ADAPTER.createCanvas();let i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);const r=!!((s=i==null?void 0:i.getContextAttributes())!=null&&s.stencil);if(i){const n=i.getExtension("WEBGL_lose_context");n&&n.loseContext()}return i=null,r}catch{return!1}}()),$o}var Dx={grad:.9,turn:360,rad:360/(2*Math.PI)},_i=function(s){return typeof s=="string"?s.length>0:typeof s=="number"},vt=function(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*s)/t+0},Gt=function(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),s>t?t:s>e?s:e},Nd=function(s){return(s=isFinite(s)?s%360:0)>0?s:s+360},wu=function(s){return{r:Gt(s.r,0,255),g:Gt(s.g,0,255),b:Gt(s.b,0,255),a:Gt(s.a)}},ea=function(s){return{r:vt(s.r),g:vt(s.g),b:vt(s.b),a:vt(s.a,3)}},Nx=/^#([0-9a-f]{3,8})$/i,en=function(s){var e=s.toString(16);return e.length<2?"0"+e:e},Ld=function(s){var e=s.r,t=s.g,i=s.b,r=s.a,n=Math.max(e,t,i),o=n-Math.min(e,t,i),a=o?n===e?(t-i)/o:n===t?2+(i-e)/o:4+(e-t)/o:0;return{h:60*(a<0?a+6:a),s:n?o/n*100:0,v:n/255*100,a:r}},Bd=function(s){var e=s.h,t=s.s,i=s.v,r=s.a;e=e/360*6,t/=100,i/=100;var n=Math.floor(e),o=i*(1-t),a=i*(1-(e-n)*t),l=i*(1-(1-e+n)*t),h=n%6;return{r:255*[i,a,o,o,l,i][h],g:255*[l,i,i,a,o,o][h],b:255*[o,o,l,i,i,a][h],a:r}},Eu=function(s){return{h:Nd(s.h),s:Gt(s.s,0,100),l:Gt(s.l,0,100),a:Gt(s.a)}},bu=function(s){return{h:vt(s.h),s:vt(s.s),l:vt(s.l),a:vt(s.a,3)}},Su=function(s){return Bd((t=(e=s).s,{h:e.h,s:(t*=((i=e.l)<50?i:100-i)/100)>0?2*t/(i+t)*100:0,v:i+t,a:e.a}));var e,t,i},wr=function(s){return{h:(e=Ld(s)).h,s:(r=(200-(t=e.s))*(i=e.v)/100)>0&&r<200?t*i/100/(r<=100?r:200-r)*100:0,l:r/2,a:e.a};var e,t,i,r},Lx=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Bx=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Fx=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,kx=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Va={string:[[function(s){var e=Nx.exec(s);return e?(s=e[1]).length<=4?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?vt(parseInt(s[3]+s[3],16)/255,2):1}:s.length===6||s.length===8?{r:parseInt(s.substr(0,2),16),g:parseInt(s.substr(2,2),16),b:parseInt(s.substr(4,2),16),a:s.length===8?vt(parseInt(s.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(s){var e=Fx.exec(s)||kx.exec(s);return e?e[2]!==e[4]||e[4]!==e[6]?null:wu({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(s){var e=Lx.exec(s)||Bx.exec(s);if(!e)return null;var t,i,r=Eu({h:(t=e[1],i=e[2],i===void 0&&(i="deg"),Number(t)*(Dx[i]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return Su(r)},"hsl"]],object:[[function(s){var e=s.r,t=s.g,i=s.b,r=s.a,n=r===void 0?1:r;return _i(e)&&_i(t)&&_i(i)?wu({r:Number(e),g:Number(t),b:Number(i),a:Number(n)}):null},"rgb"],[function(s){var e=s.h,t=s.s,i=s.l,r=s.a,n=r===void 0?1:r;if(!_i(e)||!_i(t)||!_i(i))return null;var o=Eu({h:Number(e),s:Number(t),l:Number(i),a:Number(n)});return Su(o)},"hsl"],[function(s){var e=s.h,t=s.s,i=s.v,r=s.a,n=r===void 0?1:r;if(!_i(e)||!_i(t)||!_i(i))return null;var o=function(a){return{h:Nd(a.h),s:Gt(a.s,0,100),v:Gt(a.v,0,100),a:Gt(a.a)}}({h:Number(e),s:Number(t),v:Number(i),a:Number(n)});return Bd(o)},"hsv"]]},Au=function(s,e){for(var t=0;t<e.length;t++){var i=e[t][0](s);if(i)return[i,e[t][1]]}return[null,void 0]},Ux=function(s){return typeof s=="string"?Au(s.trim(),Va.string):typeof s=="object"&&s!==null?Au(s,Va.object):[null,void 0]},ta=function(s,e){var t=wr(s);return{h:t.h,s:Gt(t.s+100*e,0,100),l:t.l,a:t.a}},ia=function(s){return(299*s.r+587*s.g+114*s.b)/1e3/255},Ru=function(s,e){var t=wr(s);return{h:t.h,s:t.s,l:Gt(t.l+100*e,0,100),a:t.a}},Xa=function(){function s(e){this.parsed=Ux(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return s.prototype.isValid=function(){return this.parsed!==null},s.prototype.brightness=function(){return vt(ia(this.rgba),2)},s.prototype.isDark=function(){return ia(this.rgba)<.5},s.prototype.isLight=function(){return ia(this.rgba)>=.5},s.prototype.toHex=function(){return e=ea(this.rgba),t=e.r,i=e.g,r=e.b,o=(n=e.a)<1?en(vt(255*n)):"","#"+en(t)+en(i)+en(r)+o;var e,t,i,r,n,o},s.prototype.toRgb=function(){return ea(this.rgba)},s.prototype.toRgbString=function(){return e=ea(this.rgba),t=e.r,i=e.g,r=e.b,(n=e.a)<1?"rgba("+t+", "+i+", "+r+", "+n+")":"rgb("+t+", "+i+", "+r+")";var e,t,i,r,n},s.prototype.toHsl=function(){return bu(wr(this.rgba))},s.prototype.toHslString=function(){return e=bu(wr(this.rgba)),t=e.h,i=e.s,r=e.l,(n=e.a)<1?"hsla("+t+", "+i+"%, "+r+"%, "+n+")":"hsl("+t+", "+i+"%, "+r+"%)";var e,t,i,r,n},s.prototype.toHsv=function(){return e=Ld(this.rgba),{h:vt(e.h),s:vt(e.s),v:vt(e.v),a:vt(e.a,3)};var e},s.prototype.invert=function(){return ai({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},s.prototype.saturate=function(e){return e===void 0&&(e=.1),ai(ta(this.rgba,e))},s.prototype.desaturate=function(e){return e===void 0&&(e=.1),ai(ta(this.rgba,-e))},s.prototype.grayscale=function(){return ai(ta(this.rgba,-1))},s.prototype.lighten=function(e){return e===void 0&&(e=.1),ai(Ru(this.rgba,e))},s.prototype.darken=function(e){return e===void 0&&(e=.1),ai(Ru(this.rgba,-e))},s.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},s.prototype.alpha=function(e){return typeof e=="number"?ai({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):vt(this.rgba.a,3);var t},s.prototype.hue=function(e){var t=wr(this.rgba);return typeof e=="number"?ai({h:e,s:t.s,l:t.l,a:t.a}):vt(t.h)},s.prototype.isEqual=function(e){return this.toHex()===ai(e).toHex()},s}(),ai=function(s){return s instanceof Xa?s:new Xa(s)},Cu=[],Hx=function(s){s.forEach(function(e){Cu.indexOf(e)<0&&(e(Xa,Va),Cu.push(e))})};function Gx(s,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var r in t)i[t[r]]=r;var n={};s.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,h=i[this.toHex()];if(h)return h;if(o!=null&&o.closest){var u=this.toRgb(),c=1/0,d="black";if(!n.length)for(var f in t)n[f]=new s(t[f]).toRgb();for(var p in t){var m=(a=u,l=n[p],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));m<c&&(c=m,d=p)}return d}},e.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":t[a];return l?new s(l).toRgb():null},"name"])}Hx([Gx]);const Ns=class An{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof An)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}isSourceEqual(e,t){const i=typeof e;if(i!==typeof t)return!1;if(i==="number"||i==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((r,n)=>r===t[n]);if(e!==null&&t!==null){const r=Object.keys(e),n=Object.keys(t);return r.length!==n.length?!1:r.every(o=>e[o]===t[o])}return e===t}toRgba(){const[e,t,i,r]=this._components;return{r:e,g:t,b:i,a:r}}toRgb(){const[e,t,i]=this._components;return{r:e,g:t,b:i}}toRgbaString(){const[e,t,i]=this.toUint8RgbArray();return`rgba(${e},${t},${i},${this.alpha})`}toUint8RgbArray(e){const[t,i,r]=this._components;return e=e??[],e[0]=Math.round(t*255),e[1]=Math.round(i*255),e[2]=Math.round(r*255),e}toRgbArray(e){e=e??[];const[t,i,r]=this._components;return e[0]=t,e[1]=i,e[2]=r,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,i,r,n]=An.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=i,this._components[2]*=r,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let i=this._int>>16&255,r=this._int>>8&255,n=this._int&255;return t&&(i=i*e+.5|0,r=r*e+.5|0,n=n*e+.5|0),(e*255<<24)+(i<<16)+(r<<8)+n}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,i,r]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(i*e)/e,this._components[2]=Math.round(r*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,i,r,n]=this._components;return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e}normalize(e){let t,i,r,n;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const o=e;t=(o>>16&255)/255,i=(o>>8&255)/255,r=(o&255)/255,n=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,i,r,n=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,i,r,n=255]=e,t/=255,i/=255,r/=255,n/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const a=An.HEX_PATTERN.exec(e);a&&(e=`#${a[2]}`)}const o=ai(e);o.isValid()&&({r:t,g:i,b:r,a:n}=o.rgba,t/=255,i/=255,r/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=i,this._components[2]=r,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,i]=this._components;this._int=(e*255<<16)+(t*255<<8)+(i*255|0)}_clamp(e,t=0,i=1){return typeof e=="number"?Math.min(Math.max(e,t),i):(e.forEach((r,n)=>{e[n]=Math.min(Math.max(r,t),i)}),e)}};Ns.shared=new Ns,Ns.temp=new Ns,Ns.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Ue=Ns;function zx(s){return Ae("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),Ue.shared.setValue(s).toHex()}function Vx(s){return Ae("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),Ue.shared.setValue(s).toNumber()}function Xx(){const s=[],e=[];for(let i=0;i<32;i++)s[i]=i,e[i]=i;s[ye.NORMAL_NPM]=ye.NORMAL,s[ye.ADD_NPM]=ye.ADD,s[ye.SCREEN_NPM]=ye.SCREEN,e[ye.NORMAL]=ye.NORMAL_NPM,e[ye.ADD]=ye.ADD_NPM,e[ye.SCREEN]=ye.SCREEN_NPM;const t=[];return t.push(e),t.push(s),t}const Fd=Xx();function kd(s,e){return Fd[e?1:0][s]}function Wx(s,e=null){const t=s*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${t}`);for(let i=0,r=0;i<t;i+=6,r+=4)e[i+0]=r+0,e[i+1]=r+1,e[i+2]=r+2,e[i+3]=r+0,e[i+4]=r+2,e[i+5]=r+3;return e}function Ud(s){if(s.BYTES_PER_ELEMENT===4)return s instanceof Float32Array?"Float32Array":s instanceof Uint32Array?"Uint32Array":"Int32Array";if(s.BYTES_PER_ELEMENT===2){if(s instanceof Uint16Array)return"Uint16Array"}else if(s.BYTES_PER_ELEMENT===1&&s instanceof Uint8Array)return"Uint8Array";return null}function Hn(s){return s+=s===0?1:0,--s,s|=s>>>1,s|=s>>>2,s|=s>>>4,s|=s>>>8,s|=s>>>16,s+1}function Pu(s){return!(s&s-1)&&!!s}function Mu(s){let e=(s>65535?1:0)<<4;s>>>=e;let t=(s>255?1:0)<<3;return s>>>=t,e|=t,t=(s>15?1:0)<<2,s>>>=t,e|=t,t=(s>3?1:0)<<1,s>>>=t,e|=t,e|s>>1}function Ys(s,e,t){const i=s.length;let r;if(e>=i||t===0)return;t=e+t>i?i-e:t;const n=i-t;for(r=e;r<n;++r)s[r]=s[r+t];s.length=n}function Hi(s){return s===0?0:s<0?-1:1}let jx=0;function ys(){return++jx}const Wa=class{constructor(s,e,t,i){this.left=s,this.top=e,this.right=t,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Wa.EMPTY=new Wa(0,0,0,0);let Iu=Wa;const Ou={},li=Object.create(null),Pi=Object.create(null);class Yx{constructor(e,t,i){this._canvas=ne.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||ne.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function Du(s,e,t){for(let i=0,r=4*t*e;i<e;++i,r+=4)if(s[r+3]!==0)return!1;return!0}function Nu(s,e,t,i,r){const n=4*e;for(let o=i,a=i*n+4*t;o<=r;++o,a+=n)if(s[a+3]!==0)return!1;return!0}function qx(s){const{width:e,height:t}=s,i=s.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const r=i.getImageData(0,0,e,t).data;let n=0,o=0,a=e-1,l=t-1;for(;o<t&&Du(r,e,o);)++o;if(o===t)return Iu.EMPTY;for(;Du(r,e,l);)--l;for(;Nu(r,e,n,o,l);)++n;for(;Nu(r,e,a,o,l);)--a;return++a,++l,new Iu(n,o,a,l)}function Zx(s){const e=qx(s),{width:t,height:i}=e;let r=null;if(!e.isEmpty()){const n=s.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");r=n.getImageData(e.left,e.top,t,i)}return{width:t,height:i,data:r}}function Kx(s,e=globalThis.location){if(s.startsWith("data:"))return"";e=e||globalThis.location;const t=new URL(s,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}function Ai(s,e=1){var t;const i=(t=ne.RETINA_PREFIX)==null?void 0:t.exec(s);return i?parseFloat(i[1]):e}var se=(s=>(s.Renderer="renderer",s.Application="application",s.RendererSystem="renderer-webgl-system",s.RendererPlugin="renderer-webgl-plugin",s.CanvasRendererSystem="renderer-canvas-system",s.CanvasRendererPlugin="renderer-canvas-plugin",s.Asset="asset",s.LoadParser="load-parser",s.ResolveParser="resolve-parser",s.CacheParser="cache-parser",s.DetectionParser="detection-parser",s))(se||{});const ja=s=>{if(typeof s=="function"||typeof s=="object"&&s.extension){if(!s.extension)throw new Error("Extension class must have an extension object");s={...typeof s.extension!="object"?{type:s.extension}:s.extension,ref:s}}if(typeof s=="object")s={...s};else throw new Error("Invalid extension type");return typeof s.type=="string"&&(s.type=[s.type]),s},Lu=(s,e)=>ja(s).priority??e,he={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...s){return s.map(ja).forEach(e=>{e.type.forEach(t=>{var i,r;return(r=(i=this._removeHandlers)[t])==null?void 0:r.call(i,e)})}),this},add(...s){return s.map(ja).forEach(e=>{e.type.forEach(t=>{var i,r;const n=this._addHandlers,o=this._queue;n[t]?(i=n[t])==null||i.call(n,e):(o[t]=o[t]||[],(r=o[t])==null||r.push(e))})}),this},handle(s,e,t){var i;const r=this._addHandlers,n=this._removeHandlers;if(r[s]||n[s])throw new Error(`Extension type ${s} already has a handler`);r[s]=e,n[s]=t;const o=this._queue;return o[s]&&((i=o[s])==null||i.forEach(a=>e(a)),delete o[s]),this},handleByMap(s,e){return this.handle(s,t=>{t.name&&(e[t.name]=t.ref)},t=>{t.name&&delete e[t.name]})},handleByList(s,e,t=-1){return this.handle(s,i=>{e.includes(i.ref)||(e.push(i.ref),e.sort((r,n)=>Lu(n,t)-Lu(r,t)))},i=>{const r=e.indexOf(i.ref);r!==-1&&e.splice(r,1)})}};class Ya{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const Qx=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Jx(s){let e="";for(let t=0;t<s;++t)t>0&&(e+=`
else `),t<s-1&&(e+=`if(test == ${t}.0){}`);return e}function $x(s,e){if(s===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const t=e.createShader(e.FRAGMENT_SHADER);for(;;){const i=Qx.replace(/%forloop%/gi,Jx(s));if(e.shaderSource(t,i),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))s=s/2|0;else break}return s}const sa=0,ra=1,na=2,oa=3,aa=4,la=5;class yi{constructor(){this.data=0,this.blendMode=ye.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<sa)}set blend(e){!!(this.data&1<<sa)!==e&&(this.data^=1<<sa)}get offsets(){return!!(this.data&1<<ra)}set offsets(e){!!(this.data&1<<ra)!==e&&(this.data^=1<<ra)}get culling(){return!!(this.data&1<<na)}set culling(e){!!(this.data&1<<na)!==e&&(this.data^=1<<na)}get depthTest(){return!!(this.data&1<<oa)}set depthTest(e){!!(this.data&1<<oa)!==e&&(this.data^=1<<oa)}get depthMask(){return!!(this.data&1<<la)}set depthMask(e){!!(this.data&1<<la)!==e&&(this.data^=1<<la)}get clockwiseFrontFace(){return!!(this.data&1<<aa)}set clockwiseFrontFace(e){!!(this.data&1<<aa)!==e&&(this.data^=1<<aa)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==ye.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new yi;return e.depthTest=!1,e.blend=!0,e}}yi.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const qa=[];function Hd(s,e){if(!s)return null;let t="";if(typeof s=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(s);i&&(t=i[1].toLowerCase())}for(let i=qa.length-1;i>=0;--i){const r=qa[i];if(r.test&&r.test(s,t))return new r(s,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class Jt{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,i,r,n,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:u}=this;this._aliasCount++;for(let c=0,d=u.length;c<d;c++)u[c][h](e,t,i,r,n,o,a,l);return u===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(Jt.prototype,{dispatch:{value:Jt.prototype.emit},run:{value:Jt.prototype.emit}});class Dr{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new Jt("setRealSize"),this.onUpdate=new Jt("update"),this.onError=new Jt("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class co extends Dr{constructor(e,t){const{width:i,height:r}=t||{};if(!i||!r)throw new Error("BufferResource width or height invalid");super(i,r),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,i){const r=e.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===Ct.UNPACK);const n=t.realWidth,o=t.realHeight;return i.width===n&&i.height===o?r.texSubImage2D(t.target,0,0,0,n,o,t.format,i.type,this.data):(i.width=n,i.height=o,r.texImage2D(t.target,0,i.internalFormat,n,o,0,t.format,i.type,this.data)),!0}dispose(){this.data=null}static test(e){return e===null||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const e_={scaleMode:Ti.NEAREST,alphaMode:Ct.NPM},Za=class Ls extends Fr{constructor(e=null,t=null){super(),t=Object.assign({},Ls.defaultOptions,t);const{alphaMode:i,mipmap:r,anisotropicLevel:n,scaleMode:o,width:a,height:l,wrapMode:h,format:u,type:c,target:d,resolution:f,resourceOptions:p}=t;e&&!(e instanceof Dr)&&(e=Hd(e,p),e.internal=!0),this.resolution=f||ne.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((l||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=n,this._wrapMode=h,this._scaleMode=o,this.format=u,this.type=c,this.target=d,this.alphaMode=i,this.uid=ys(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&l>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let i;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,i=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,i=!0),i&&this.dirtyStyleId++,this}setSize(e,t,i){return i=i||this.resolution,this.setRealSize(e*i,t*i,i)}setRealSize(e,t,i){return this.resolution=i||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Pu(this.realWidth)&&Pu(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Pi[this.cacheId],delete li[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Ls.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,i=ne.STRICT_TEXTURE_CACHE){const r=typeof e=="string";let n=null;if(r)n=e;else{if(!e._pixiId){const a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${a}_${ys()}`}n=e._pixiId}let o=Pi[n];if(r&&i&&!o)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return o||(o=new Ls(e,t),o.cacheId=n,Ls.addToCache(o,n)),o}static fromBuffer(e,t,i,r){e=e||new Float32Array(t*i*4);const n=new co(e,{width:t,height:i,...r==null?void 0:r.resourceOptions});let o,a;return e instanceof Float32Array?(o=te.RGBA,a=fe.FLOAT):e instanceof Int32Array?(o=te.RGBA_INTEGER,a=fe.INT):e instanceof Uint32Array?(o=te.RGBA_INTEGER,a=fe.UNSIGNED_INT):e instanceof Int16Array?(o=te.RGBA_INTEGER,a=fe.SHORT):e instanceof Uint16Array?(o=te.RGBA_INTEGER,a=fe.UNSIGNED_SHORT):e instanceof Int8Array?(o=te.RGBA,a=fe.BYTE):(o=te.RGBA,a=fe.UNSIGNED_BYTE),n.internal=!0,new Ls(n,Object.assign({},e_,{type:a,format:o},r))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Pi[t]&&Pi[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),Pi[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=Pi[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete Pi[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete Pi[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};Za.defaultOptions={mipmap:vi.POW2,anisotropicLevel:0,scaleMode:Ti.LINEAR,wrapMode:Vi.CLAMP,alphaMode:Ct.UNPACK,target:Ws.TEXTURE_2D,format:te.RGBA,type:fe.UNSIGNED_BYTE},Za._globalBatch=0;let we=Za;class Ka{constructor(){this.texArray=null,this.blend=0,this.type=fi.TRIANGLES,this.start=0,this.size=0,this.data=null}}let t_=0;class st{constructor(e,t=!0,i=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=t,this.id=t_++,this.disposeRunner=new Jt("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?mi.ELEMENT_ARRAY_BUFFER:mi.ARRAY_BUFFER}get index(){return this.type===mi.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new st(e)}}class Gn{constructor(e,t=0,i=!1,r=fe.FLOAT,n,o,a,l=1){this.buffer=e,this.size=t,this.normalized=i,this.type=r,this.stride=n,this.start=o,this.instance=a,this.divisor=l}destroy(){this.buffer=null}static from(e,t,i,r,n){return new Gn(e,t,i,r,n)}}const i_={Float32Array,Uint32Array,Int32Array,Uint8Array};function s_(s,e){let t=0,i=0;const r={};for(let l=0;l<s.length;l++)i+=e[l],t+=s[l].length;const n=new ArrayBuffer(t*4);let o=null,a=0;for(let l=0;l<s.length;l++){const h=e[l],u=s[l],c=Ud(u);r[c]||(r[c]=new i_[c](n)),o=r[c];for(let d=0;d<u.length;d++){const f=(d/h|0)*i+a,p=d%h;o[f+p]=u[d]}a+=h}return new Float32Array(n)}const Bu={5126:4,5123:2,5121:1};let r_=0;const n_={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class ji{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=r_++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Jt("disposeGeometry"),this.refCount=0}addAttribute(e,t,i=0,r=!1,n,o,a,l=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof st||(t instanceof Array&&(t=new Float32Array(t)),t=new st(t));const h=e.split("|");if(h.length>1){for(let c=0;c<h.length;c++)this.addAttribute(h[c],t,i,r,n);return this}let u=this.buffers.indexOf(t);return u===-1&&(this.buffers.push(t),u=this.buffers.length-1),this.attributes[e]=new Gn(u,i,r,n,o,a,l),this.instanced=this.instanced||l,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof st||(e instanceof Array&&(e=new Uint16Array(e)),e=new st(e)),e.type=mi.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const e=[],t=[],i=new st;let r;for(r in this.attributes){const n=this.attributes[r],o=this.buffers[n.buffer];e.push(o.data),t.push(n.size*Bu[n.type]/4),n.buffer=0}for(i.data=s_(e,t),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new ji;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new st(this.buffers[t].data.slice(0));for(const t in this.attributes){const i=this.attributes[t];e.attributes[t]=new Gn(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=mi.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new ji,i=[],r=[],n=[];let o;for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)r[l]=r[l]||0,r[l]+=o.buffers[l].data.length,n[l]=0}for(let a=0;a<o.buffers.length;a++)i[a]=new n_[Ud(o.buffers[a].data)](r[a]),t.buffers[a]=new st(i[a]);for(let a=0;a<e.length;a++){o=e[a];for(let l=0;l<o.buffers.length;l++)i[l].set(o.buffers[l].data,n[l]),n[l]+=o.buffers[l].data.length}if(t.attributes=o.attributes,o.indexBuffer){t.indexBuffer=t.buffers[o.buffers.indexOf(o.indexBuffer)],t.indexBuffer.type=mi.ELEMENT_ARRAY_BUFFER;let a=0,l=0,h=0,u=0;for(let c=0;c<o.buffers.length;c++)if(o.buffers[c]!==o.indexBuffer){u=c;break}for(const c in o.attributes){const d=o.attributes[c];(d.buffer|0)===u&&(l+=d.size*Bu[d.type]/4)}for(let c=0;c<e.length;c++){const d=e[c].indexBuffer.data;for(let f=0;f<d.length;f++)t.indexBuffer.data[f+h]+=a;a+=e[c].buffers[u].data.length/l,h+=d.length}}return t}}class Gd extends ji{constructor(e=!1){super(),this._buffer=new st(null,e,!1),this._indexBuffer=new st(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,fe.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,fe.FLOAT).addAttribute("aColor",this._buffer,4,!0,fe.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,fe.FLOAT).addIndex(this._indexBuffer)}}const zn=Math.PI*2,o_=180/Math.PI,a_=Math.PI/180;var wt=(s=>(s[s.POLY=0]="POLY",s[s.RECT=1]="RECT",s[s.CIRC=2]="CIRC",s[s.ELIP=3]="ELIP",s[s.RREC=4]="RREC",s))(wt||{});class Ie{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new Ie(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}Ie.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const tn=[new Ie,new Ie,new Ie,new Ie];class Ee{constructor(e=0,t=0,i=0,r=0){this.x=Number(e),this.y=Number(t),this.width=Number(i),this.height=Number(r),this.type=wt.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new Ee(0,0,0,0)}clone(){return new Ee(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const N=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=N)return!1;const B=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>B}const i=this.left,r=this.right,n=this.top,o=this.bottom;if(r<=i||o<=n)return!1;const a=tn[0].set(e.left,e.top),l=tn[1].set(e.left,e.bottom),h=tn[2].set(e.right,e.top),u=tn[3].set(e.right,e.bottom);if(h.x<=a.x||l.y<=a.y)return!1;const c=Math.sign(t.a*t.d-t.b*t.c);if(c===0||(t.apply(a,a),t.apply(l,l),t.apply(h,h),t.apply(u,u),Math.max(a.x,l.x,h.x,u.x)<=i||Math.min(a.x,l.x,h.x,u.x)>=r||Math.max(a.y,l.y,h.y,u.y)<=n||Math.min(a.y,l.y,h.y,u.y)>=o))return!1;const d=c*(l.y-a.y),f=c*(a.x-l.x),p=d*i+f*n,m=d*r+f*n,g=d*i+f*o,v=d*r+f*o;if(Math.max(p,m,g,v)<=d*a.x+f*a.y||Math.min(p,m,g,v)>=d*u.x+f*u.y)return!1;const x=c*(a.y-h.y),_=c*(h.x-a.x),E=x*i+_*n,R=x*r+_*n,M=x*i+_*o,O=x*r+_*o;return!(Math.max(E,R,M,O)<=x*a.x+_*a.y||Math.min(E,R,M,O)>=x*u.x+_*u.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){const t=Math.max(this.x,e.x),i=Math.min(this.x+this.width,e.x+e.width),r=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(i-t,0),this.y=r,this.height=Math.max(n-r,0),this}ceil(e=1,t=.001){const i=Math.ceil((this.x+this.width-t)*e)/e,r=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=i-this.x,this.height=r-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),i=Math.max(this.x+this.width,e.x+e.width),r=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=i-t,this.y=r,this.height=n-r,this}}Ee.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class fo{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.radius=i,this.type=wt.CIRC}clone(){return new fo(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const i=this.radius*this.radius;let r=this.x-e,n=this.y-t;return r*=r,n*=n,r+n<=i}getBounds(){return new Ee(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}fo.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class po{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.width=i,this.height=r,this.type=wt.ELIP}clone(){return new po(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let i=(e-this.x)/this.width,r=(t-this.y)/this.height;return i*=i,r*=r,i+r<=1}getBounds(){return new Ee(this.x-this.width,this.y-this.height,this.width,this.height)}}po.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class ms{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if(typeof t[0]!="number"){const i=[];for(let r=0,n=t.length;r<n;r++)i.push(t[r].x,t[r].y);t=i}this.points=t,this.type=wt.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new ms(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let i=!1;const r=this.points.length/2;for(let n=0,o=r-1;n<r;o=n++){const a=this.points[n*2],l=this.points[n*2+1],h=this.points[o*2],u=this.points[o*2+1];l>t!=u>t&&e<(h-a)*((t-l)/(u-l))+a&&(i=!i)}return i}}ms.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((s,e)=>`${s}, ${e}`,"")}]`};class mo{constructor(e=0,t=0,i=0,r=0,n=20){this.x=e,this.y=t,this.width=i,this.height=r,this.radius=n,this.type=wt.RREC}clone(){return new mo(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+i&&t<=this.y+this.height-i||e>=this.x+i&&e<=this.x+this.width-i)return!0;let r=e-(this.x+i),n=t-(this.y+i);const o=i*i;if(r*r+n*n<=o||(r=e-(this.x+this.width-i),r*r+n*n<=o)||(n=t-(this.y+this.height-i),r*r+n*n<=o)||(r=e-(this.x+i),r*r+n*n<=o))return!0}return!1}}mo.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class ze{constructor(e=1,t=0,i=0,r=1,n=0,o=0){this.array=null,this.a=e,this.b=t,this.c=i,this.d=r,this.tx=n,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,i,r,n,o){return this.a=e,this.b=t,this.c=i,this.d=r,this.tx=n,this.ty=o,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const i=t||this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(e,t){t=t||new Ie;const i=e.x,r=e.y;return t.x=this.a*i+this.c*r+this.tx,t.y=this.b*i+this.d*r+this.ty,t}applyInverse(e,t){t=t||new Ie;const i=1/(this.a*this.d+this.c*-this.b),r=e.x,n=e.y;return t.x=this.d*i*r+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,t.y=this.a*i*n+-this.b*i*r+(-this.ty*this.a+this.tx*this.b)*i,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),r=this.a,n=this.c,o=this.tx;return this.a=r*t-this.b*i,this.b=r*i+this.b*t,this.c=n*t-this.d*i,this.d=n*i+this.d*t,this.tx=o*t-this.ty*i,this.ty=o*i+this.ty*t,this}append(e){const t=this.a,i=this.b,r=this.c,n=this.d;return this.a=e.a*t+e.b*r,this.b=e.a*i+e.b*n,this.c=e.c*t+e.d*r,this.d=e.c*i+e.d*n,this.tx=e.tx*t+e.ty*r+this.tx,this.ty=e.tx*i+e.ty*n+this.ty,this}setTransform(e,t,i,r,n,o,a,l,h){return this.a=Math.cos(a+h)*n,this.b=Math.sin(a+h)*n,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(i*this.a+r*this.c),this.ty=t-(i*this.b+r*this.d),this}prepend(e){const t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const i=this.a,r=this.c;this.a=i*e.a+this.b*e.c,this.b=i*e.b+this.b*e.d,this.c=r*e.a+this.d*e.c,this.d=r*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,i=this.b,r=this.c,n=this.d,o=e.pivot,a=-Math.atan2(-r,n),l=Math.atan2(i,t),h=Math.abs(a+l);return h<1e-5||Math.abs(zn-h)<1e-5?(e.rotation=l,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=l),e.scale.x=Math.sqrt(t*t+i*i),e.scale.y=Math.sqrt(r*r+n*n),e.position.x=this.tx+(o.x*t+o.y*r),e.position.y=this.ty+(o.x*i+o.y*n),e}invert(){const e=this.a,t=this.b,i=this.c,r=this.d,n=this.tx,o=e*r-t*i;return this.a=r/o,this.b=-t/o,this.c=-i/o,this.d=e/o,this.tx=(i*this.ty-r*n)/o,this.ty=-(e*this.ty-t*n)/o,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new ze;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new ze}static get TEMP_MATRIX(){return new ze}}ze.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const rs=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ns=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],os=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],as=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Qa=[],zd=[],sn=Math.sign;function l_(){for(let s=0;s<16;s++){const e=[];Qa.push(e);for(let t=0;t<16;t++){const i=sn(rs[s]*rs[t]+os[s]*ns[t]),r=sn(ns[s]*rs[t]+as[s]*ns[t]),n=sn(rs[s]*os[t]+os[s]*as[t]),o=sn(ns[s]*os[t]+as[s]*as[t]);for(let a=0;a<16;a++)if(rs[a]===i&&ns[a]===r&&os[a]===n&&as[a]===o){e.push(a);break}}}for(let s=0;s<16;s++){const e=new ze;e.set(rs[s],ns[s],os[s],as[s],0,0),zd.push(e)}}l_();const Ze={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:s=>rs[s],uY:s=>ns[s],vX:s=>os[s],vY:s=>as[s],inv:s=>s&8?s&15:-s&7,add:(s,e)=>Qa[s][e],sub:(s,e)=>Qa[s][Ze.inv(e)],rotate180:s=>s^4,isVertical:s=>(s&3)===2,byDirection:(s,e)=>Math.abs(s)*2<=Math.abs(e)?e>=0?Ze.S:Ze.N:Math.abs(e)*2<=Math.abs(s)?s>0?Ze.E:Ze.W:e>0?s>0?Ze.SE:Ze.SW:s>0?Ze.NE:Ze.NW,matrixAppendRotationInv:(s,e,t=0,i=0)=>{const r=zd[Ze.inv(e)];r.tx=t,r.ty=i,s.append(r)}};class Ei{constructor(e,t,i=0,r=0){this._x=i,this._y=r,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new Ei(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}Ei.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Ja=class{constructor(){this.worldTransform=new ze,this.localTransform=new ze,this.position=new Ei(this.onChange,this,0,0),this.scale=new Ei(this.onChange,this,1,1),this.pivot=new Ei(this.onChange,this,0,0),this.skew=new Ei(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const s=this.localTransform;this._localID!==this._currentLocalID&&(s.a=this._cx*this.scale.x,s.b=this._sx*this.scale.x,s.c=this._cy*this.scale.y,s.d=this._sy*this.scale.y,s.tx=this.position.x-(this.pivot.x*s.a+this.pivot.y*s.c),s.ty=this.position.y-(this.pivot.x*s.b+this.pivot.y*s.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(s){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==s._worldID){const t=s.worldTransform,i=this.worldTransform;i.a=e.a*t.a+e.b*t.c,i.b=e.a*t.b+e.b*t.d,i.c=e.c*t.a+e.d*t.c,i.d=e.c*t.b+e.d*t.d,i.tx=e.tx*t.a+e.ty*t.c+t.tx,i.ty=e.tx*t.b+e.ty*t.d+t.ty,this._parentID=s._worldID,this._worldID++}}setFromMatrix(s){s.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(s){this._rotation!==s&&(this._rotation=s,this.updateSkew())}};Ja.IDENTITY=new Ja;let Gl=Ja;Gl.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var h_=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,u_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Fu(s,e,t){const i=s.createShader(e);return s.shaderSource(i,t),s.compileShader(i),i}function ha(s){const e=new Array(s);for(let t=0;t<e.length;t++)e[t]=!1;return e}function Vd(s,e){switch(s){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return ha(2*e);case"bvec3":return ha(3*e);case"bvec4":return ha(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const qs=[{test:s=>s.type==="float"&&s.size===1&&!s.isArray,code:s=>`
            if(uv["${s}"] !== ud["${s}"].value)
            {
                ud["${s}"].value = uv["${s}"]
                gl.uniform1f(ud["${s}"].location, uv["${s}"])
            }
            `},{test:(s,e)=>(s.type==="sampler2D"||s.type==="samplerCube"||s.type==="sampler2DArray")&&s.size===1&&!s.isArray&&(e==null||e.castToBaseTexture!==void 0),code:s=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${s}"], t);

            if(ud["${s}"].value !== t)
            {
                ud["${s}"].value = t;
                gl.uniform1i(ud["${s}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(s,e)=>s.type==="mat3"&&s.size===1&&!s.isArray&&e.a!==void 0,code:s=>`
            gl.uniformMatrix3fv(ud["${s}"].location, false, uv["${s}"].toArray(true));
            `,codeUbo:s=>`
                var ${s}_matrix = uv.${s}.toArray(true);

                data[offset] = ${s}_matrix[0];
                data[offset+1] = ${s}_matrix[1];
                data[offset+2] = ${s}_matrix[2];
        
                data[offset + 4] = ${s}_matrix[3];
                data[offset + 5] = ${s}_matrix[4];
                data[offset + 6] = ${s}_matrix[5];
        
                data[offset + 8] = ${s}_matrix[6];
                data[offset + 9] = ${s}_matrix[7];
                data[offset + 10] = ${s}_matrix[8];
            `},{test:(s,e)=>s.type==="vec2"&&s.size===1&&!s.isArray&&e.x!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${s}"].location, v.x, v.y);
                }`,codeUbo:s=>`
                v = uv.${s};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:s=>s.type==="vec2"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${s}"].location, v[0], v[1]);
                }
            `},{test:(s,e)=>s.type==="vec4"&&s.size===1&&!s.isArray&&e.width!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${s}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(s,e)=>s.type==="vec4"&&s.size===1&&!s.isArray&&e.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${s}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(s,e)=>s.type==="vec3"&&s.size===1&&!s.isArray&&e.red!==void 0,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${s}"].location, v.red, v.green, v.blue)
                }`,codeUbo:s=>`
                    v = uv.${s};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:s=>s.type==="vec4"&&s.size===1&&!s.isArray,code:s=>`
                cv = ud["${s}"].value;
                v = uv["${s}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${s}"].location, v[0], v[1], v[2], v[3])
                }`}],c_={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},d_={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function f_(s,e){var t;const i=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const r in s.uniforms){const n=e[r];if(!n){((t=s.uniforms[r])==null?void 0:t.group)===!0&&(s.uniforms[r].ubo?i.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${r}, '${r}');
                    `):i.push(`
                        renderer.shader.syncUniformGroup(uv.${r}, syncData);
                    `));continue}const o=s.uniforms[r];let a=!1;for(let l=0;l<qs.length;l++)if(qs[l].test(n,o)){i.push(qs[l].code(r,o)),a=!0;break}if(!a){const l=(n.size===1&&!n.isArray?c_:d_)[n.type].replace("location",`ud["${r}"].location`);i.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${l};`)}}return new Function("ud","uv","renderer","syncData",i.join(`
`))}const Xd={};let ar=Xd;function p_(){if(ar===Xd||ar!=null&&ar.isContextLost()){const s=ne.ADAPTER.createCanvas();let e;ne.PREFER_ENV>=_s.WEBGL2&&(e=s.getContext("webgl2",{})),e||(e=s.getContext("webgl",{})||s.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),ar=e}return ar}let rn;function m_(){if(!rn){rn=Ht.MEDIUM;const s=p_();if(s&&s.getShaderPrecisionFormat){const e=s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT);e&&(rn=e.precision?Ht.HIGH:Ht.MEDIUM)}}return rn}function ku(s,e){const t=s.getShaderSource(e).split(`
`).map((h,u)=>`${u}: ${h}`),i=s.getShaderInfoLog(e),r=i.split(`
`),n={},o=r.map(h=>parseFloat(h.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(h=>h&&!n[h]?(n[h]=!0,!0):!1),a=[""];o.forEach(h=>{t[h-1]=`%c${t[h-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const l=t.join(`
`);a[0]=l,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function g_(s,e,t,i){s.getProgramParameter(e,s.LINK_STATUS)||(s.getShaderParameter(t,s.COMPILE_STATUS)||ku(s,t),s.getShaderParameter(i,s.COMPILE_STATUS)||ku(s,i),console.error("PixiJS Error: Could not initialize shader."),s.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",s.getProgramInfoLog(e)))}const v_={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Wd(s){return v_[s]}let nn=null;const Uu={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function jd(s,e){if(!nn){const t=Object.keys(Uu);nn={};for(let i=0;i<t.length;++i){const r=t[i];nn[s[r]]=Uu[r]}}return nn[e]}function Hu(s,e,t){if(s.substring(0,9)!=="precision"){let i=e;return e===Ht.HIGH&&t!==Ht.HIGH&&(i=Ht.MEDIUM),`precision ${i} float;
${s}`}else if(t!==Ht.HIGH&&s.substring(0,15)==="precision highp")return s.replace("precision highp","precision mediump");return s}let lr;function y_(){if(typeof lr=="boolean")return lr;try{lr=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{lr=!1}return lr}let x_=0;const on={},$a=class Bs{constructor(e,t,i="pixi-shader",r={}){this.extra={},this.id=x_++,this.vertexSrc=e||Bs.defaultVertexSrc,this.fragmentSrc=t||Bs.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),on[i]?(on[i]++,i+=`-${on[i]}`):on[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=Hu(this.vertexSrc,Bs.defaultVertexPrecision,Ht.HIGH),this.fragmentSrc=Hu(this.fragmentSrc,Bs.defaultFragmentPrecision,m_())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return u_}static get defaultFragmentSrc(){return h_}static from(e,t,i){const r=e+t;let n=Ou[r];return n||(Ou[r]=n=new Bs(e,t,i)),n}};$a.defaultVertexPrecision=Ht.HIGH,$a.defaultFragmentPrecision=wi.apple.device?Ht.HIGH:Ht.MEDIUM;let bi=$a,__=0;class $t{constructor(e,t,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=__++,this.static=!!t,this.ubo=!!i,e instanceof st?(this.buffer=e,this.buffer.type=mi.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new st(new Float32Array(1)),this.buffer.type=mi.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,i){if(!this.ubo)this.uniforms[e]=new $t(t,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,t,i){return new $t(e,t,i)}static uboFrom(e,t){return new $t(e,t??!0,!0)}}class gi{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof $t?this.uniformGroup=t:this.uniformGroup=new $t(t):this.uniformGroup=new $t({}),this.disposeRunner=new Jt("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const i in t.uniforms){const r=t.uniforms[i];if(r.group===!0&&this.checkUniformExists(e,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,i){const r=bi.from(e,t);return new gi(r,i)}}class T_{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const i=new Int32Array(e);for(let n=0;n<e;n++)i[n]=n;this.defaultGroupCache[e]=$t.from({uSamplers:i},!0);let r=this.fragTemplate;r=r.replace(/%count%/gi,`${e}`),r=r.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new bi(this.vertexSrc,r)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new ze,default:this.defaultGroupCache[e]};return new gi(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`
`,t+=`
`;for(let i=0;i<e;i++)i>0&&(t+=`
else `),i<e-1&&(t+=`if(vTextureId < ${i}.5)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,t+=`
}`;return t+=`
`,t+=`
`,t}}class el{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}function w_(){return!wi.apple.device}function E_(s){let e=!0;const t=ne.ADAPTER.getNavigator();if(wi.tablet||wi.phone){if(wi.apple.device){const i=t.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(e=!1)}if(wi.android.device){const i=t.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(e=!1)}}return e?s:4}class go{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}var b_=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,S_=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const fr=class Yt extends go{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=Gd,this.vertexSize=6,this.state=yi.for2d(),this.size=Yt.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??E_(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??w_(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return Ae("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return S_}static get defaultFragmentTemplate(){return b_}setShaderGenerator({vertex:e=Yt.defaultVertexSrc,fragment:t=Yt.defaultFragmentTemplate}={}){this.shaderGenerator=new T_(e,t)}contextChange(){const e=this.renderer.gl;ne.PREFER_ENV===_s.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),Yt.defaultMaxTextures),this.maxTextures=$x(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=Yt,i=this.size/4,r=Math.floor(i/this.maxTextures)+1;for(;e.length<i;)e.push(new Ka);for(;t.length<r;)t.push(new el);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,i=Yt._textureArrayPool,r=this.renderer.batch,n=this._tempBoundTextures,o=this.renderer.textureGC.count;let a=++we._globalBatch,l=0,h=i[0],u=0;r.copyBoundTextures(n,t);for(let c=0;c<this._bufferSize;++c){const d=e[c];e[c]=null,d._batchEnabled!==a&&(h.count>=t&&(r.boundArray(h,n,a,t),this.buildDrawCalls(h,u,c),u=c,h=i[++l],++a),d._batchEnabled=a,d.touched=o,h.elements[h.count++]=d)}h.count>0&&(r.boundArray(h,n,a,t),this.buildDrawCalls(h,u,this._bufferSize),++l,++a);for(let c=0;c<n.length;c++)n[c]=null;we._globalBatch=a}buildDrawCalls(e,t,i){const{_bufferedElements:r,_attributeBuffer:n,_indexBuffer:o,vertexSize:a}=this,l=Yt._drawCallPool;let h=this._dcIndex,u=this._aIndex,c=this._iIndex,d=l[h];d.start=this._iIndex,d.texArray=e;for(let f=t;f<i;++f){const p=r[f],m=p._texture.baseTexture,g=Fd[m.alphaMode?1:0][p.blendMode];r[f]=null,t<f&&d.blend!==g&&(d.size=c-d.start,t=f,d=l[++h],d.texArray=e,d.start=c),this.packInterleavedGeometry(p,n,o,u,c),u+=p.vertexData.length/2*a,c+=p.indices.length,d.blend=g}t<i&&(d.size=c-d.start,++h),this._dcIndex=h,this._aIndex=u,this._iIndex=c}bindAndClearTexArray(e){const t=this.renderer.texture;for(let i=0;i<e.count;i++)t.bind(e.elements[i],e.ids[i]),e.elements[i]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:i}=this;Yt.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:i}=this.renderer,r=Yt._drawCallPool;let n=null;for(let o=0;o<e;o++){const{texArray:a,type:l,size:h,start:u,blend:c}=r[o];n!==a&&(n=a,this.bindAndClearTexArray(a)),this.state.blendMode=c,i.set(this.state),t.drawElements(l,h,t.UNSIGNED_SHORT,u*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Yt.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Hn(Math.ceil(e/8)),i=Mu(t),r=t*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._aBuffers[r];return n||(this._aBuffers[r]=n=new Ya(r*this.vertexSize*4)),n}getIndexBuffer(e){const t=Hn(Math.ceil(e/12)),i=Mu(t),r=t*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._iBuffers[i];return n||(this._iBuffers[i]=n=new Uint16Array(r)),n}packInterleavedGeometry(e,t,i,r,n){const{uint32View:o,float32View:a}=t,l=r/this.vertexSize,h=e.uvs,u=e.indices,c=e.vertexData,d=e._texture.baseTexture._batchLocation,f=Math.min(e.worldAlpha,1),p=Ue.shared.setValue(e._tintRGB).toPremultiplied(f,e._texture.baseTexture.alphaMode>0);for(let m=0;m<c.length;m+=2)a[r++]=c[m],a[r++]=c[m+1],a[r++]=h[m],a[r++]=h[m+1],o[r++]=p,a[r++]=d;for(let m=0;m<u.length;m++)i[n++]=l+u[m]}};fr.defaultBatchSize=4096,fr.extension={name:"batch",type:se.RendererPlugin},fr._drawCallPool=[],fr._textureArrayPool=[];let ls=fr;he.add(ls);var A_=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,R_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const tl=class pr extends gi{constructor(e,t,i){const r=bi.from(e||pr.defaultVertexSrc,t||pr.defaultFragmentSrc);super(r,i),this.padding=0,this.resolution=pr.defaultResolution,this.multisample=pr.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new yi}apply(e,t,i,r,n){e.applyFilter(this,t,i,r)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return R_}static get defaultFragmentSrc(){return A_}};tl.defaultResolution=1,tl.defaultMultisample=dt.NONE;let Rt=tl;class Vn{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new Ue(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:i,backgroundAlpha:r}=e,n=i??t;n!==void 0&&(this.color=n),this.alpha=r}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}Vn.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Vn.extension={type:[se.RendererSystem,se.CanvasRendererSystem],name:"background"};he.add(Vn);class Yd{constructor(e){this.renderer=e,this.emptyRenderer=new go(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:i}=this.renderer.texture;for(let r=t-1;r>=0;--r)e[r]=i[r]||null,e[r]&&(e[r]._batchLocation=r)}boundArray(e,t,i,r){const{elements:n,ids:o,count:a}=e;let l=0;for(let h=0;h<a;h++){const u=n[h],c=u._batchLocation;if(c>=0&&c<r&&t[c]===u){o[h]=c;continue}for(;l<r;){const d=t[l];if(d&&d._batchEnabled===i&&d._batchLocation===l){l++;continue}o[h]=l,u._batchLocation=l,t[l]=u;break}}}destroy(){this.renderer=null}}Yd.extension={type:se.RendererSystem,name:"batch"};he.add(Yd);let Gu=0;class Xn{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=Gu++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,i=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:i,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=Gu++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;t.addEventListener!==void 0&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let i;if(ne.PREFER_ENV>=_s.WEBGL2&&(i=e.getContext("webgl2",t)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=i||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=r,r||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Xn.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Xn.extension={type:se.RendererSystem,name:"context"};he.add(Xn);class il{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Jt("disposeFramebuffer"),this.multisample=dt.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new we(null,{scaleMode:Ti.NEAREST,resolution:1,mipmap:vi.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new we(null,{scaleMode:Ti.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:vi.OFF,format:te.DEPTH_COMPONENT,type:fe.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const r=this.colorTextures[i],n=r.resolution;r.setSize(e/n,t/n)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(e/i,t/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class qd extends we{constructor(e={}){if(typeof e=="number"){const t=arguments[0],i=arguments[1],r=arguments[2],n=arguments[3];e={width:t,height:i,scaleMode:r,resolution:n}}e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=dt.NONE),super(null,e),this.mipmap=vi.OFF,this.valid=!0,this._clear=new Ue([0,0,0,0]),this.framebuffer=new il(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Ri extends Dr{constructor(e){const t=e,i=t.naturalWidth||t.videoWidth||t.displayWidth||t.width,r=t.naturalHeight||t.videoHeight||t.displayHeight||t.height;super(i,r),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,i){i===void 0&&!t.startsWith("data:")?e.crossOrigin=Kx(t):i!==!1&&(e.crossOrigin=typeof i=="string"?i:"anonymous")}upload(e,t,i,r){const n=e.gl,o=t.realWidth,a=t.realHeight;if(r=r||this.source,typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement){if(!r.complete||r.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement&&r.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===Ct.UNPACK),!this.noSubImage&&t.target===n.TEXTURE_2D&&i.width===o&&i.height===a?n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.format,i.type,r):(i.width=o,i.height=a,n.texImage2D(t.target,0,i.internalFormat,t.format,i.type,r)),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,i=e.naturalHeight||e.videoHeight||e.height;this.resize(t,i),super.update()}dispose(){this.source=null}}class Zd extends Ri{constructor(e,t){if(t=t||{},typeof e=="string"){const i=new Image;Ri.crossOrigin(i,e,t.crossorigin),i.src=e,e=i}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??ne.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.bitmap=null,this._load=null,t.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((t,i)=>{const r=this.source;this.url=r.src;const n=()=>{this.destroyed||(r.onload=null,r.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};r.complete&&r.src?n():(r.onload=n,r.onerror=o=>{i(o),this.onError.emit(o)})}),this._load)}process(){const e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,i=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:i?"cors":"no-cors"}).then(r=>r.blob()).then(r=>t(r,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ct.UNPACK?"premultiply":"none"})).then(r=>this.destroyed?Promise.reject():(this.bitmap=r,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,i){if(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,i,this.bitmap),!this.preserveBitmap){let r=!0;const n=t._glTextures;for(const o in n){const a=n[o];if(a!==i&&a.dirtyId!==t.dirtyId){r=!1;break}}r&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}}class zl{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,i){const r=t.width,n=t.height;if(i){const o=e.width/2/r,a=e.height/2/n,l=e.x/r+o,h=e.y/n+a;i=Ze.add(i,Ze.NW),this.x0=l+o*Ze.uX(i),this.y0=h+a*Ze.uY(i),i=Ze.add(i,2),this.x1=l+o*Ze.uX(i),this.y1=h+a*Ze.uY(i),i=Ze.add(i,2),this.x2=l+o*Ze.uX(i),this.y2=h+a*Ze.uY(i),i=Ze.add(i,2),this.x3=l+o*Ze.uX(i),this.y3=h+a*Ze.uY(i)}else this.x0=e.x/r,this.y0=e.y/n,this.x1=(e.x+e.width)/r,this.y1=e.y/n,this.x2=(e.x+e.width)/r,this.y2=(e.y+e.height)/n,this.x3=e.x/r,this.y3=(e.y+e.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}zl.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const zu=new zl;function an(s){s.destroy=function(){},s.on=function(){},s.once=function(){},s.emit=function(){}}class le extends Fr{constructor(e,t,i,r,n,o,a){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new Ee(0,0,1,1)),e instanceof le&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=r,this.valid=!1,this.destroyed=!1,this._uvs=zu,this.uvMatrix=null,this.orig=i||t,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=o?new Ie(o.x,o.y):new Ie(0,0),this.defaultBorders=a,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:t}=this.baseTexture;t!=null&&t.url&&li[t.url]&&le.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,le.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var e;const t=this._frame.clone(),i=this._frame===this.orig?t:this.orig.clone(),r=new le(this.baseTexture,!this.noFrame&&t,i,(e=this.trim)==null?void 0:e.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===zu&&(this._uvs=new zl),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},i=ne.STRICT_TEXTURE_CACHE){const r=typeof e=="string";let n=null;if(r)n=e;else if(e instanceof we){if(!e.cacheId){const a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e.cacheId=`${a}-${ys()}`,we.addToCache(e,e.cacheId)}n=e.cacheId}else{if(!e._pixiId){const a=(t==null?void 0:t.pixiIdPrefix)||"pixiid";e._pixiId=`${a}_${ys()}`}n=e._pixiId}let o=li[n];if(r&&i&&!o)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!o&&!(e instanceof we)?(t.resolution||(t.resolution=Ai(e)),o=new le(new we(e,t)),o.baseTexture.cacheId=n,we.addToCache(o.baseTexture,n),le.addToCache(o,n)):!o&&e instanceof we&&(o=new le(e),le.addToCache(o,n)),o}static fromURL(e,t){const i=Object.assign({autoLoad:!1},t==null?void 0:t.resourceOptions),r=le.from(e,Object.assign({resourceOptions:i},t),!1),n=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):n.load().then(()=>Promise.resolve(r))}static fromBuffer(e,t,i,r){return new le(we.fromBuffer(e,t,i,r))}static fromLoader(e,t,i,r){const n=new we(e,Object.assign({scaleMode:we.defaultOptions.scaleMode,resolution:Ai(t)},r)),{resource:o}=n;o instanceof Zd&&(o.url=t);const a=new le(n);return i||(i=t),we.addToCache(a.baseTexture,i),le.addToCache(a,i),i!==t&&(we.addToCache(a.baseTexture,t),le.addToCache(a,t)),a.baseTexture.valid?Promise.resolve(a):new Promise(l=>{a.baseTexture.once("loaded",()=>l(a))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),li[t]&&li[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),li[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=li[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete li[e],t}}else if(e!=null&&e.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)li[e.textureCacheIds[t]]===e&&delete li[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:i,width:r,height:n}=e,o=t+r>this.baseTexture.width,a=i+n>this.baseTexture.height;if(o||a){const l=o&&a?"and":"or",h=`X: ${t} + ${r} = ${t+r} > ${this.baseTexture.width}`,u=`Y: ${i} + ${n} = ${i+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${h} ${l} ${u}`)}this.valid=r&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return le._EMPTY||(le._EMPTY=new le(new we),an(le._EMPTY),an(le._EMPTY.baseTexture)),le._EMPTY}static get WHITE(){if(!le._WHITE){const e=ne.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),le._WHITE=new le(we.from(e)),an(le._WHITE),an(le._WHITE.baseTexture)}return le._WHITE}}class Ts extends le{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,i=!0){const r=this.baseTexture.resolution,n=Math.round(e*r)/r,o=Math.round(t*r)/r;this.valid=n>0&&o>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=o,i&&this.baseTexture.resize(n,o),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new Ts(new qd(e))}}class Kd{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,i=dt.NONE){const r=new qd(Object.assign({width:e,height:t,resolution:1,multisample:i},this.textureOptions));return new Ts(r)}getOptimalTexture(e,t,i=1,r=dt.NONE){let n;e=Math.max(Math.ceil(e*i-1e-6),1),t=Math.max(Math.ceil(t*i-1e-6),1),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=Hn(e),t=Hn(t),n=((e&65535)<<16|t&65535)>>>0,r>1&&(n+=r*4294967296)):n=r>1?-r:-1,this.texturePool[n]||(this.texturePool[n]=[]);let o=this.texturePool[n].pop();return o||(o=this.createTexture(e,t,r)),o.filterPoolKey=n,o.setResolution(i),o}getFilterTexture(e,t,i){const r=this.getOptimalTexture(e.width,e.height,t||e.resolution,i||dt.NONE);return r.filterFrame=e.filterFrame,r}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(const t in this.texturePool){const i=this.texturePool[t];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const i=this.texturePool[t];if(i)for(let r=0;r<i.length;r++)i[r].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}Kd.SCREEN_KEY=-1;class C_ extends ji{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Qd extends ji{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new st(this.vertices),this.uvBuffer=new st(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let i=0,r=0;return this.uvs[0]=i,this.uvs[1]=r,this.uvs[2]=i+t.width/e.width,this.uvs[3]=r,this.uvs[4]=i+t.width/e.width,this.uvs[5]=r+t.height/e.height,this.uvs[6]=i,this.uvs[7]=r+t.height/e.height,i=t.x,r=t.y,this.vertices[0]=i,this.vertices[1]=r,this.vertices[2]=i+t.width,this.vertices[3]=r,this.vertices[4]=i+t.width,this.vertices[5]=r+t.height,this.vertices[6]=i,this.vertices[7]=r+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class P_{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=dt.NONE,this.sourceFrame=new Ee,this.destinationFrame=new Ee,this.bindingSourceFrame=new Ee,this.bindingDestinationFrame=new Ee,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const ln=[new Ie,new Ie,new Ie,new Ie],ua=new ze;class Jd{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new Kd,this.statePool=[],this.quad=new C_,this.quadUv=new Qd,this.tempRect=new Ee,this.activeState={},this.globalUniforms=new $t({outputFrame:new Ee,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const i=this.renderer,r=this.defaultFilterStack,n=this.statePool.pop()||new P_,o=i.renderTexture;let a,l;if(o.current){const g=o.current;a=g.resolution,l=g.multisample}else a=i.resolution,l=i.multisample;let h=t[0].resolution||a,u=t[0].multisample??l,c=t[0].padding,d=t[0].autoFit,f=t[0].legacy??!0;for(let g=1;g<t.length;g++){const v=t[g];h=Math.min(h,v.resolution||a),u=Math.min(u,v.multisample??l),c=this.useMaxPadding?Math.max(c,v.padding):c+v.padding,d=d&&v.autoFit,f=f||(v.legacy??!0)}r.length===1&&(this.defaultFilterStack[0].renderTexture=o.current),r.push(n),n.resolution=h,n.multisample=u,n.legacy=f,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(c);const p=this.tempRect.copyFrom(o.sourceFrame);i.projection.transform&&this.transformAABB(ua.copyFrom(i.projection.transform).invert(),p),d?(n.sourceFrame.fit(p),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(p)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,o.current?o.current.resolution:i.resolution,o.sourceFrame,o.destinationFrame,i.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,h,u),n.filters=t,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const m=this.tempRect;m.x=0,m.y=0,m.width=n.sourceFrame.width,m.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(o.sourceFrame),n.bindingDestinationFrame.copyFrom(o.destinationFrame),n.transform=i.projection.transform,i.projection.transform=null,o.bind(n.renderTexture,n.sourceFrame,m),i.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),i=t.filters;this.activeState=t;const r=this.globalUniforms.uniforms;r.outputFrame=t.sourceFrame,r.resolution=t.resolution;const n=r.inputSize,o=r.inputPixel,a=r.inputClamp;if(n[0]=t.destinationFrame.width,n[1]=t.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],o[0]=Math.round(n[0]*t.resolution),o[1]=Math.round(n[1]*t.resolution),o[2]=1/o[0],o[3]=1/o[1],a[0]=.5*o[2],a[1]=.5*o[3],a[2]=t.sourceFrame.width*n[2]-.5*o[2],a[3]=t.sourceFrame.height*n[3]-.5*o[3],t.legacy){const h=r.filterArea;h[0]=t.destinationFrame.width,h[1]=t.destinationFrame.height,h[2]=t.sourceFrame.x,h[3]=t.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const l=e[e.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,t.renderTexture,l.renderTexture,di.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let h=t.renderTexture,u=this.getOptimalFilterTexture(h.width,h.height,t.resolution);u.filterFrame=h.filterFrame;let c=0;for(c=0;c<i.length-1;++c){c===1&&t.multisample>1&&(u=this.getOptimalFilterTexture(h.width,h.height,t.resolution),u.filterFrame=h.filterFrame),i[c].apply(this,h,u,di.CLEAR,t);const d=h;h=u,u=d}i[c].apply(this,h,l.renderTexture,di.BLEND,t),c>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(h),this.returnFilterTexture(u)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=di.CLEAR){const{renderTexture:i,state:r}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e==null?void 0:e.filterFrame){const o=this.tempRect;o.x=0,o.y=0,o.width=e.filterFrame.width,o.height=e.filterFrame.height,i.bind(e,e.filterFrame,o)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=r.stateId&1||this.forceClear;(t===di.CLEAR||t===di.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,i,r){const n=this.renderer;n.state.set(e.state),this.bindAndClear(i,r),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(fi.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(fi.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:i,destinationFrame:r}=this.activeState,{orig:n}=t._texture,o=e.set(r.width,0,0,r.height,i.x,i.y),a=t.worldTransform.copyTo(ze.TEMP_MATRIX);return a.invert(),o.prepend(a),o.scale(1/n.width,1/n.height),o.translate(t.anchor.x,t.anchor.y),o}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,i=1,r=dt.NONE){return this.texturePool.getOptimalTexture(e,t,i,r)}getFilterTexture(e,t,i){if(typeof e=="number"){const n=e;e=t,t=n}e=e||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,i||dt.NONE);return r.filterFrame=e.filterFrame,r}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const i=ln[0],r=ln[1],n=ln[2],o=ln[3];i.set(t.left,t.top),r.set(t.left,t.bottom),n.set(t.right,t.top),o.set(t.right,t.bottom),e.apply(i,i),e.apply(r,r),e.apply(n,n),e.apply(o,o);const a=Math.min(i.x,r.x,n.x,o.x),l=Math.min(i.y,r.y,n.y,o.y),h=Math.max(i.x,r.x,n.x,o.x),u=Math.max(i.y,r.y,n.y,o.y);t.x=a,t.y=l,t.width=h-a,t.height=u-l}roundFrame(e,t,i,r,n){if(!(e.width<=0||e.height<=0||i.width<=0||i.height<=0)){if(n){const{a:o,b:a,c:l,d:h}=n;if((Math.abs(a)>1e-4||Math.abs(l)>1e-4)&&(Math.abs(o)>1e-4||Math.abs(h)>1e-4))return}n=n?ua.copyFrom(n):ua.identity(),n.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.transformAABB(n,e),e.ceil(t),this.transformAABB(n.invert(),e)}}}Jd.extension={type:se.RendererSystem,name:"filter"};he.add(Jd);class M_{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=dt.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const I_=new Ee;class $d{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new il(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Ee,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let t=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;ne.PREFER_ENV===_s.WEBGL_LEGACY&&(t=null,i=null),t?e.drawBuffers=r=>t.drawBuffersWEBGL(r):(this.hasMRT=!1,e.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,i=0){const{gl:r}=this;if(e){const n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==i&&(e.dirtyId++,e.dirtyFormat++,n.mipLevel=i),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,n.dirtySize=e.dirtySize,this.updateFramebuffer(e,i)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let o=0;o<e.colorTextures.length;o++){const a=e.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const o=t.width>>i,a=t.height>>i,l=o/t.width;this.setViewport(t.x*l,t.y*l,o,a)}else{const o=e.width>>i,a=e.height>>i;this.setViewport(0,0,o,a)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,i,r){const n=this.viewport;e=Math.round(e),t=Math.round(t),i=Math.round(i),r=Math.round(r),(n.width!==i||n.height!==r||n.x!==e||n.y!==t)&&(n.x=e,n.y=t,n.width=i,n.height=r,this.gl.viewport(e,t,i,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,i,r,n=Ua.COLOR|Ua.DEPTH){const{gl:o}=this;o.clearColor(e,t,i,r),o.clear(n)}initFramebuffer(e){const{gl:t}=this,i=new M_(t.createFramebuffer());return i.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(e),e.disposeRunner.add(this),i}resizeFramebuffer(e){const{gl:t}=this,i=e.glFramebuffers[this.CONTEXT_UID];if(i.stencil){t.bindRenderbuffer(t.RENDERBUFFER,i.stencil);let o;this.renderer.context.webGLVersion===1?o=t.DEPTH_STENCIL:e.depth&&e.stencil?o=t.DEPTH24_STENCIL8:e.depth?o=t.DEPTH_COMPONENT24:o=t.STENCIL_INDEX8,i.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,o,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,o,e.width,e.height)}const r=e.colorTextures;let n=r.length;t.drawBuffers||(n=Math.min(n,1));for(let o=0;o<n;o++){const a=r[o],l=a.parentTextureArray||a;this.renderer.texture.bind(l,0),o===0&&i.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,i.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:i}=this,r=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures;let o=n.length;i.drawBuffers||(o=Math.min(o,1)),r.multisample>1&&this.canMultisampleFramebuffer(e)?r.msaaBuffer=r.msaaBuffer||i.createRenderbuffer():r.msaaBuffer&&(i.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const a=[];for(let l=0;l<o;l++){const h=n[l],u=h.parentTextureArray||h;this.renderer.texture.bind(u,0),l===0&&r.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,r.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,r.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+l,h.target,u._glTextures[this.CONTEXT_UID].texture,t),a.push(i.COLOR_ATTACHMENT0+l))}if(a.length>1&&i.drawBuffers(a),e.depthTexture&&this.writeDepthTexture){const l=e.depthTexture;this.renderer.texture.bind(l,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,l._glTextures[this.CONTEXT_UID].texture,t)}if((e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)){r.stencil=r.stencil||i.createRenderbuffer();let l,h;this.renderer.context.webGLVersion===1?(l=i.DEPTH_STENCIL_ATTACHMENT,h=i.DEPTH_STENCIL):e.depth&&e.stencil?(l=i.DEPTH_STENCIL_ATTACHMENT,h=i.DEPTH24_STENCIL8):e.depth?(l=i.DEPTH_ATTACHMENT,h=i.DEPTH_COMPONENT24):(l=i.STENCIL_ATTACHMENT,h=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,r.stencil),r.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,r.multisample,h,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,h,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,r.stencil)}else r.stencil&&(i.deleteRenderbuffer(r.stencil),r.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let i=dt.NONE;if(e<=1||t===null)return i;for(let r=0;r<t.length;r++)if(t[r]<=e){i=t[r];break}return i===1&&(i=dt.NONE),i}blit(e,t,i){const{current:r,renderer:n,gl:o,CONTEXT_UID:a}=this;if(n.context.webGLVersion!==2||!r)return;const l=r.glFramebuffers[a];if(!l)return;if(!e){if(!l.msaaBuffer)return;const u=r.colorTextures[0];if(!u)return;l.blitFramebuffer||(l.blitFramebuffer=new il(r.width,r.height),l.blitFramebuffer.addColorTexture(0,u)),e=l.blitFramebuffer,e.colorTextures[0]!==u&&(e.colorTextures[0]=u,e.dirtyId++,e.dirtyFormat++),(e.width!==r.width||e.height!==r.height)&&(e.width=r.width,e.height=r.height,e.dirtyId++,e.dirtySize++)}t||(t=I_,t.width=r.width,t.height=r.height),i||(i=t);const h=t.width===i.width&&t.height===i.height;this.bind(e),o.bindFramebuffer(o.READ_FRAMEBUFFER,l.framebuffer),o.blitFramebuffer(t.left,t.top,t.right,t.bottom,i.left,i.top,i.right,i.bottom,o.COLOR_BUFFER_BIT,h?o.NEAREST:o.LINEAR),o.bindFramebuffer(o.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const i=e.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!i)return;delete e.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(e);n>=0&&this.managedFramebuffers.splice(n,1),e.disposeRunner.remove(this),t||(r.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&r.deleteRenderbuffer(i.msaaBuffer),i.stencil&&r.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<t.length;i++)this.disposeFramebuffer(t[i],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;const i=e.width,r=e.height,n=this.gl,o=t.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,o);let a,l;this.renderer.context.webGLVersion===1?(a=n.DEPTH_STENCIL_ATTACHMENT,l=n.DEPTH_STENCIL):e.depth?(a=n.DEPTH_STENCIL_ATTACHMENT,l=n.DEPTH24_STENCIL8):(a=n.STENCIL_ATTACHMENT,l=n.STENCIL_INDEX8),t.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,t.multisample,l,i,r):n.renderbufferStorage(n.RENDERBUFFER,l,i,r),n.framebufferRenderbuffer(n.FRAMEBUFFER,a,n.RENDERBUFFER,o)}reset(){this.current=this.unknownFramebuffer,this.viewport=new Ee}destroy(){this.renderer=null}}$d.extension={type:se.RendererSystem,name:"framebuffer"};he.add($d);const ca={5126:4,5123:2,5121:1};class ef{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;ne.PREFER_ENV===_s.WEBGL_LEGACY&&(i=null),i?(e.createVertexArray=()=>i.createVertexArrayOES(),e.bindVertexArray=r=>i.bindVertexArrayOES(r),e.deleteVertexArray=r=>i.deleteVertexArrayOES(r)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(t.webGLVersion!==2){const i=e.getExtension("ANGLE_instanced_arrays");i?(e.vertexAttribDivisor=(r,n)=>i.vertexAttribDivisorANGLE(r,n),e.drawElementsInstanced=(r,n,o,a,l)=>i.drawElementsInstancedANGLE(r,n,o,a,l),e.drawArraysInstanced=(r,n,o,a)=>i.drawArraysInstancedANGLE(r,n,o,a)):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:i}=this;let r=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1;r||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=r={},n=!0);const o=r[t.program.id]||this.initGeometryVao(e,t,n);this._activeGeometry=e,this._activeVao!==o&&(this._activeVao=o,this.hasVao?i.bindVertexArray(o):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let i=0;i<e.buffers.length;i++){const r=e.buffers[i];t.update(r)}}checkCompatibility(e,t){const i=e.attributes,r=t.attributeData;for(const n in r)if(!i[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,t){const i=e.attributes,r=t.attributeData,n=["g",e.id];for(const o in i)r[o]&&n.push(o,r[o].location);return n.join("-")}initGeometryVao(e,t,i=!0){const r=this.gl,n=this.CONTEXT_UID,o=this.renderer.buffer,a=t.program;a.glPrograms[n]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,a);const l=this.getSignature(e,a),h=e.glVertexArrayObjects[this.CONTEXT_UID];let u=h[l];if(u)return h[a.id]=u,u;const c=e.buffers,d=e.attributes,f={},p={};for(const m in c)f[m]=0,p[m]=0;for(const m in d)!d[m].size&&a.attributeData[m]?d[m].size=a.attributeData[m].size:d[m].size||console.warn(`PIXI Geometry attribute '${m}' size cannot be determined (likely the bound shader does not have the attribute)`),f[d[m].buffer]+=d[m].size*ca[d[m].type];for(const m in d){const g=d[m],v=g.size;g.stride===void 0&&(f[g.buffer]===v*ca[g.type]?g.stride=0:g.stride=f[g.buffer]),g.start===void 0&&(g.start=p[g.buffer],p[g.buffer]+=v*ca[g.type])}u=r.createVertexArray(),r.bindVertexArray(u);for(let m=0;m<c.length;m++){const g=c[m];o.bind(g),i&&g._glBuffers[n].refCount++}return this.activateVao(e,a),h[a.id]=u,h[l]=u,r.bindVertexArray(null),o.unbind(mi.ARRAY_BUFFER),u}disposeGeometry(e,t){var i;if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const r=e.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,o=e.buffers,a=(i=this.renderer)==null?void 0:i.buffer;if(e.disposeRunner.remove(this),!!r){if(a)for(let l=0;l<o.length;l++){const h=o[l]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!t&&a.dispose(o[l],t))}if(!t){for(const l in r)if(l[0]==="g"){const h=r[l];this._activeVao===h&&this.unbind(),n.deleteVertexArray(h)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let i=0;i<t.length;i++)this.disposeGeometry(this.managedGeometries[t[i]],e)}activateVao(e,t){const i=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,o=e.buffers,a=e.attributes;e.indexBuffer&&n.bind(e.indexBuffer);let l=null;for(const h in a){const u=a[h],c=o[u.buffer],d=c._glBuffers[r];if(t.attributeData[h]){l!==d&&(n.bind(c),l=d);const f=t.attributeData[h].location;if(i.enableVertexAttribArray(f),i.vertexAttribPointer(f,u.size,u.type||i.FLOAT,u.normalized,u.stride,u.start),u.instance)if(this.hasInstance)i.vertexAttribDivisor(f,u.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,i,r){const{gl:n}=this,o=this._activeGeometry;if(o.indexBuffer){const a=o.indexBuffer.data.BYTES_PER_ELEMENT,l=a===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a===2||a===4&&this.canUseUInt32ElementIndex?o.instanced?n.drawElementsInstanced(e,t||o.indexBuffer.data.length,l,(i||0)*a,r||1):n.drawElements(e,t||o.indexBuffer.data.length,l,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else o.instanced?n.drawArraysInstanced(e,i,t||o.getSize(),r||1):n.drawArrays(e,i,t||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}ef.extension={type:se.RendererSystem,name:"geometry"};he.add(ef);const Vu=new ze;class tf{constructor(e,t){this._texture=e,this.mapCoord=new ze,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){t===void 0&&(t=e);const i=this.mapCoord;for(let r=0;r<e.length;r+=2){const n=e[r],o=e[r+1];t[r]=n*i.a+o*i.c+i.tx,t[r+1]=n*i.b+o*i.d+i.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const i=t._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const r=t.orig,n=t.trim;n&&(Vu.set(r.width/n.width,0,0,r.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(Vu));const o=t.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,h=this.clampOffset;return a[0]=(t._frame.x+l+h)/o.width,a[1]=(t._frame.y+l+h)/o.height,a[2]=(t._frame.x+t._frame.width-l+h)/o.width,a[3]=(t._frame.y+t._frame.height-l+h)/o.height,this.uClampOffset[0]=h/o.realWidth,this.uClampOffset[1]=h/o.realHeight,this.isSimple=t._frame.width===o.width&&t._frame.height===o.height&&t.rotate===0,!0}}var O_=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,D_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class N_ extends Rt{constructor(e,t,i){let r=null;typeof e!="string"&&t===void 0&&i===void 0&&(r=e,e=void 0,t=void 0,i=void 0),super(e||D_,t||O_,i),this.maskSprite=r,this.maskMatrix=new ze}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,i,r){const n=this._maskSprite,o=n._texture;o.valid&&(o.uvMatrix||(o.uvMatrix=new tf(o,0)),o.uvMatrix.update(),this.uniforms.npmAlpha=o.baseTexture.alphaMode?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(o.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=o.uvMatrix.uClampFrame,e.applyFilter(this,t,i,r))}}class L_{constructor(e=null){this.type=ft.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Rt.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=ft.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class sf{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let i=t;if(!i.isMaskData){const n=this.maskDataPool.pop()||new L_;n.pooled=!0,n.maskObject=t,i=n}const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(r),i._colorMask=r?r._colorMask:15,i.autoDetect&&this.detect(i),i._target=e,i.type!==ft.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case ft.SCISSOR:this.renderer.scissor.push(i);break;case ft.STENCIL:this.renderer.stencil.push(i);break;case ft.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case ft.COLOR:this.pushColorMask(i);break}i.type===ft.SPRITE&&this.maskStack.push(i)}pop(e){const t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case ft.SCISSOR:this.renderer.scissor.pop(t);break;case ft.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case ft.SPRITE:this.popSpriteMask(t);break;case ft.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===ft.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=ft.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=ft.SCISSOR:e.type=ft.STENCIL:e.type=ft.COLOR}pushSpriteMask(e){const{maskObject:t}=e,i=e._target;let r=e._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new N_])),r[0].resolution=e.resolution,r[0].multisample=e.multisample,r[0].maskSprite=t;const n=i.filterArea;i.filterArea=t.getBounds(!0),this.renderer.filter.push(i,r),i.filterArea=n,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,i=e._colorMask=t&e.colorMask;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(e){const t=e._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}sf.extension={type:se.RendererSystem,name:"mask"};he.add(sf);class rf{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,i=this.getStackLength();this.maskStack=e;const r=this.getStackLength();r!==i&&(r===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Xu=new ze,Wu=[],nf=class Rn extends rf{constructor(e){super(e),this.glConst=ne.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:i}=e,{renderer:r}=this,n=r.renderTexture,o=i.getBounds(!0,Wu.pop()??new Ee);this.roundFrameToPixels(o,n.current?n.current.resolution:r.resolution,n.sourceFrame,n.destinationFrame,r.projection.transform),t&&o.fit(t),e._scissorRectLocal=o}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:i,c:r,d:n}=e;return(Math.abs(i)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||Rn.isMatrixRotated(t.worldTransform)||Rn.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const i=e._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(e,t,i,r,n){Rn.isMatrixRotated(n)||(n=n?Xu.copyFrom(n):Xu.identity(),n.translate(-i.x,-i.y).scale(r.width/i.width,r.height/i.height).translate(r.x,r.y),this.renderer.filter.transformAABB(n,e),e.fit(r),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&Wu.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};nf.extension={type:se.RendererSystem,name:"scissor"};let B_=nf;he.add(B_);class of extends rf{constructor(e){super(e),this.glConst=ne.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:i}=this.renderer,r=e._stencilCounter;r===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),e._stencilCounter++;const n=e._colorMask;n!==0&&(e._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,r,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(e._colorMask=n,i.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(e){const t=this.renderer.gl;if(this.getStackLength()===0)t.disable(t.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,r=i?i._colorMask:15;r!==0&&(i._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,r!==0&&(i._colorMask=r,t.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}of.extension={type:se.RendererSystem,name:"stencil"};he.add(of);class af{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Ae("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return Ae("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return Ae("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}af.extension={type:[se.RendererSystem,se.CanvasRendererSystem],name:"_plugin"};he.add(af);class lf{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new ze,this.transform=null}update(e,t,i,r){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,r),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(e,t,i,r){const n=this.projectionMatrix,o=r?-1:1;n.identity(),n.a=1/t.width*2,n.d=o*(1/t.height*2),n.tx=-1-t.x*n.a,n.ty=-o-t.y*n.d}setTransform(e){}destroy(){this.renderer=null}}lf.extension={type:se.RendererSystem,name:"projection"};he.add(lf);const F_=new Gl,ju=new Ee;class hf{constructor(e){this.renderer=e,this._tempMatrix=new ze}generateTexture(e,t){const{region:i,...r}=t||{},n=(i==null?void 0:i.copyTo(ju))||e.getLocalBounds(ju,!0),o=r.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/o),n.height=Math.max(n.height,1/o),r.width=n.width,r.height=n.height,r.resolution=o,r.multisample??(r.multisample=this.renderer.multisample);const a=Ts.create(r);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const l=e.transform;return e.transform=F_,this.renderer.render(e,{renderTexture:a,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=l,a}destroy(){}}hf.extension={type:[se.RendererSystem,se.CanvasRendererSystem],name:"textureGenerator"};he.add(hf);const is=new Ee,hr=new Ee;class uf{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Ee,this.destinationFrame=new Ee,this.viewportFrame=new Ee}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(e=null,t,i){const r=this.renderer;this.current=e;let n,o,a;e?(n=e.baseTexture,a=n.resolution,t||(is.width=e.frame.width,is.height=e.frame.height,t=is),i||(hr.x=e.frame.x,hr.y=e.frame.y,hr.width=t.width,hr.height=t.height,i=hr),o=n.framebuffer):(a=r.resolution,t||(is.width=r._view.screen.width,is.height=r._view.screen.height,t=is),i||(i=is,i.width=t.width,i.height=t.height));const l=this.viewportFrame;l.x=i.x*a,l.y=i.y*a,l.width=i.width*a,l.height=i.height*a,e||(l.y=r.view.height-(l.y+l.height)),l.ceil(),this.renderer.framebuffer.bind(o,l),this.renderer.projection.update(i,t,a,!o),e?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(i)}clear(e,t){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,r=Ue.shared.setValue(e||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&r.premultiply(r.alpha);const n=this.destinationFrame,o=this.current?this.current.baseTexture:this.renderer._view.screen,a=n.width!==o.width||n.height!==o.height;if(a){let{x:l,y:h,width:u,height:c}=this.viewportFrame;l=Math.round(l),h=Math.round(h),u=Math.round(u),c=Math.round(c),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(l,h,u,c)}this.renderer.framebuffer.clear(r.red,r.green,r.blue,r.alpha,t),a&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}uf.extension={type:se.RendererSystem,name:"renderTexture"};he.add(uf);class k_{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function U_(s,e){const t={},i=e.getProgramParameter(s,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const n=e.getActiveAttrib(s,r);if(n.name.startsWith("gl_"))continue;const o=jd(e,n.type),a={type:o,name:n.name,size:Wd(o),location:e.getAttribLocation(s,n.name)};t[n.name]=a}return t}function H_(s,e){const t={},i=e.getProgramParameter(s,e.ACTIVE_UNIFORMS);for(let r=0;r<i;r++){const n=e.getActiveUniform(s,r),o=n.name.replace(/\[.*?\]$/,""),a=!!n.name.match(/\[.*?\]$/),l=jd(e,n.type);t[o]={name:o,index:r,type:l,size:n.size,isArray:a,value:Vd(l,n.size)}}return t}function G_(s,e){var t;const i=Fu(s,s.VERTEX_SHADER,e.vertexSrc),r=Fu(s,s.FRAGMENT_SHADER,e.fragmentSrc),n=s.createProgram();s.attachShader(n,i),s.attachShader(n,r);const o=(t=e.extra)==null?void 0:t.transformFeedbackVaryings;if(o&&(typeof s.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):s.transformFeedbackVaryings(n,o.names,o.bufferMode==="separate"?s.SEPARATE_ATTRIBS:s.INTERLEAVED_ATTRIBS)),s.linkProgram(n),s.getProgramParameter(n,s.LINK_STATUS)||g_(s,n,i,r),e.attributeData=U_(n,s),e.uniformData=H_(n,s),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const l=Object.keys(e.attributeData);l.sort((h,u)=>h>u?1:-1);for(let h=0;h<l.length;h++)e.attributeData[l[h]].location=h,s.bindAttribLocation(n,h,l[h]);s.linkProgram(n)}s.deleteShader(i),s.deleteShader(r);const a={};for(const l in e.uniformData){const h=e.uniformData[l];a[l]={location:s.getUniformLocation(n,l),value:Vd(h.type,h.size)}}return new k_(n,a)}function z_(s,e,t,i,r){t.buffer.update(r)}const V_={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},cf={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function X_(s){const e=s.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let t=0,i=0,r=0;for(let n=0;n<e.length;n++){const o=e[n];if(t=cf[o.data.type],o.data.size>1&&(t=Math.max(t,16)*o.data.size),o.dataLen=t,i%t!==0&&i<16){const a=i%t%16;i+=a,r+=a}i+t>16?(r=Math.ceil(r/16)*16,o.offset=r,r+=t,i=t):(o.offset=r,i+=t,r+=t)}return r=Math.ceil(r/16)*16,{uboElements:e,size:r}}function W_(s,e){const t=[];for(const i in s)e[i]&&t.push(e[i]);return t.sort((i,r)=>i.index-r.index),t}function j_(s,e){if(!s.autoManage)return{size:0,syncFunc:z_};const t=W_(s.uniforms,e),{uboElements:i,size:r}=X_(t),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let o=0;o<i.length;o++){const a=i[o],l=s.uniforms[a.data.name],h=a.data.name;let u=!1;for(let c=0;c<qs.length;c++){const d=qs[c];if(d.codeUbo&&d.test(a.data,l)){n.push(`offset = ${a.offset/4};`,qs[c].codeUbo(a.data.name,l)),u=!0;break}}if(!u)if(a.data.size>1){const c=Wd(a.data.type),d=Math.max(cf[a.data.type]/16,1),f=c/d,p=(4-f%4)%4;n.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};

                t = 0;

                for(var i=0; i < ${a.data.size*d}; i++)
                {
                    for(var j = 0; j < ${f}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${p};
                }

                `)}else{const c=V_[a.data.type];n.push(`
                cv = ud.${h}.value;
                v = uv.${h};
                offset = ${a.offset/4};
                ${c};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let Y_=0;const hn={textureCount:0,uboCount:0};class df{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Y_++}systemCheck(){if(!y_())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const i=e.program,r=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==i&&(this.program=i,this.gl.useProgram(r.program)),t||(hn.textureCount=0,hn.uboCount=0,this.syncUniformGroup(e.uniformGroup,hn)),r}setUniforms(e){const t=this.shader.program,i=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(i.uniformData,e,this.renderer)}syncUniformGroup(e,t){const i=this.getGlProgram();(!e.static||e.dirtyId!==i.uniformDirtyGroups[e.id])&&(i.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,i,t))}syncUniforms(e,t,i){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,i)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=f_(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const i=this.getGlProgram();if(!e.static||e.dirtyId!==0||!i.uniformGroups[e.id]){e.dirtyId=0;const r=i.uniformGroups[e.id]||this.createSyncBufferGroup(e,i,t);e.buffer.update(),r(i.uniformData,e.uniforms,this.renderer,hn,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,i.uniformBufferBindings[t])}createSyncBufferGroup(e,t,i){const{gl:r}=this.renderer;this.renderer.buffer.bind(e.buffer);const n=this.gl.getUniformBlockIndex(t.program,i);t.uniformBufferBindings[i]=this.shader.uniformBindCount,r.uniformBlockBinding(t.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const o=this.getSignature(e,this.shader.program.uniformData,"ubo");let a=this._uboCache[o];if(a||(a=this._uboCache[o]=j_(e,this.shader.program.uniformData)),e.autoManage){const l=new Float32Array(a.size/4);e.buffer.update(l)}return t.uniformGroups[e.id]=a.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,i){const r=e.uniforms,n=[`${i}-`];for(const o in r)n.push(o),t[o]&&n.push(t[o].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,i=e.program,r=G_(t,i);return i.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}df.extension={type:se.RendererSystem,name:"shader"};he.add(df);class Wn{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.3 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}Wn.defaultOptions={hello:!1},Wn.extension={type:[se.RendererSystem,se.CanvasRendererSystem],name:"startup"};he.add(Wn);function q_(s,e=[]){return e[ye.NORMAL]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.ADD]=[s.ONE,s.ONE],e[ye.MULTIPLY]=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.SCREEN]=[s.ONE,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.OVERLAY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.DARKEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.LIGHTEN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.COLOR_DODGE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.COLOR_BURN]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.HARD_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.SOFT_LIGHT]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.DIFFERENCE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.EXCLUSION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.HUE]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.SATURATION]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.COLOR]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.LUMINOSITY]=[s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.NONE]=[0,0],e[ye.NORMAL_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.ADD_NPM]=[s.SRC_ALPHA,s.ONE,s.ONE,s.ONE],e[ye.SCREEN_NPM]=[s.SRC_ALPHA,s.ONE_MINUS_SRC_COLOR,s.ONE,s.ONE_MINUS_SRC_ALPHA],e[ye.SRC_IN]=[s.DST_ALPHA,s.ZERO],e[ye.SRC_OUT]=[s.ONE_MINUS_DST_ALPHA,s.ZERO],e[ye.SRC_ATOP]=[s.DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],e[ye.DST_OVER]=[s.ONE_MINUS_DST_ALPHA,s.ONE],e[ye.DST_IN]=[s.ZERO,s.SRC_ALPHA],e[ye.DST_OUT]=[s.ZERO,s.ONE_MINUS_SRC_ALPHA],e[ye.DST_ATOP]=[s.ONE_MINUS_DST_ALPHA,s.SRC_ALPHA],e[ye.XOR]=[s.ONE_MINUS_DST_ALPHA,s.ONE_MINUS_SRC_ALPHA],e[ye.SUBTRACT]=[s.ONE,s.ONE,s.ONE,s.ONE,s.FUNC_REVERSE_SUBTRACT,s.FUNC_ADD],e}const Z_=0,K_=1,Q_=2,J_=3,$_=4,eT=5,ff=class sl{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=ye.NONE,this._blendEq=!1,this.map=[],this.map[Z_]=this.setBlend,this.map[K_]=this.setOffset,this.map[Q_]=this.setCullFace,this.map[J_]=this.setDepthTest,this.map[$_]=this.setFrontFace,this.map[eT]=this.setDepthMask,this.checks=[],this.defaultState=new yi,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=q_(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,i=0;for(;t;)t&1&&this.map[i].call(this,!!(e.data&1<<i)),t=t>>1,i++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(sl.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(sl.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],i=this.gl;t.length===2?i.blendFunc(t[0],t[1]):i.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,i.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const i=this.checks.indexOf(e);t&&i===-1?this.checks.push(e):!t&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};ff.extension={type:se.RendererSystem,name:"state"};let tT=ff;he.add(tT);class iT extends Fr{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter(r=>e.systems[r]),i=[...t,...Object.keys(e.systems).filter(r=>!t.includes(r))];for(const r of i)this.addSystem(e.systems[r],r)}addRunners(...e){e.forEach(t=>{this.runners[t]=new Jt(t)})}addSystem(e,t){const i=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=i,this._systemsHash[t]=i;for(const r in this.runners)this.runners[r].add(i);return this}emitWithCustomOptions(e,t){const i=Object.keys(this._systemsHash);e.items.forEach(r=>{const n=i.find(o=>this._systemsHash[o]===r);r[e.name](t[n])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const mr=class Cn{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=Cn.defaultMaxIdle,this.checkCountMax=Cn.defaultCheckCountMax,this.mode=Cn.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==Fl.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let i=!1;for(let r=0;r<t.length;r++){const n=t[r];n.resource&&this.count-n.touched>this.maxIdle&&(e.destroyTexture(n,!0),t[r]=null,i=!0)}if(i){let r=0;for(let n=0;n<t.length;n++)t[n]!==null&&(t[r++]=t[n]);t.length=r}}unload(e){const t=this.renderer.texture,i=e._texture;i&&!i.framebuffer&&t.destroyTexture(i);for(let r=e.children.length-1;r>=0;r--)this.unload(e.children[r])}destroy(){this.renderer=null}};mr.defaultMode=Fl.AUTO,mr.defaultMaxIdle=60*60,mr.defaultCheckCountMax=60*10,mr.extension={type:se.RendererSystem,name:"textureGC"};let hs=mr;he.add(hs);class da{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=fe.UNSIGNED_BYTE,this.internalFormat=te.RGBA,this.samplerType=0}}function sT(s){let e;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?e={[s.RGB]:re.FLOAT,[s.RGBA]:re.FLOAT,[s.ALPHA]:re.FLOAT,[s.LUMINANCE]:re.FLOAT,[s.LUMINANCE_ALPHA]:re.FLOAT,[s.R8]:re.FLOAT,[s.R8_SNORM]:re.FLOAT,[s.RG8]:re.FLOAT,[s.RG8_SNORM]:re.FLOAT,[s.RGB8]:re.FLOAT,[s.RGB8_SNORM]:re.FLOAT,[s.RGB565]:re.FLOAT,[s.RGBA4]:re.FLOAT,[s.RGB5_A1]:re.FLOAT,[s.RGBA8]:re.FLOAT,[s.RGBA8_SNORM]:re.FLOAT,[s.RGB10_A2]:re.FLOAT,[s.RGB10_A2UI]:re.FLOAT,[s.SRGB8]:re.FLOAT,[s.SRGB8_ALPHA8]:re.FLOAT,[s.R16F]:re.FLOAT,[s.RG16F]:re.FLOAT,[s.RGB16F]:re.FLOAT,[s.RGBA16F]:re.FLOAT,[s.R32F]:re.FLOAT,[s.RG32F]:re.FLOAT,[s.RGB32F]:re.FLOAT,[s.RGBA32F]:re.FLOAT,[s.R11F_G11F_B10F]:re.FLOAT,[s.RGB9_E5]:re.FLOAT,[s.R8I]:re.INT,[s.R8UI]:re.UINT,[s.R16I]:re.INT,[s.R16UI]:re.UINT,[s.R32I]:re.INT,[s.R32UI]:re.UINT,[s.RG8I]:re.INT,[s.RG8UI]:re.UINT,[s.RG16I]:re.INT,[s.RG16UI]:re.UINT,[s.RG32I]:re.INT,[s.RG32UI]:re.UINT,[s.RGB8I]:re.INT,[s.RGB8UI]:re.UINT,[s.RGB16I]:re.INT,[s.RGB16UI]:re.UINT,[s.RGB32I]:re.INT,[s.RGB32UI]:re.UINT,[s.RGBA8I]:re.INT,[s.RGBA8UI]:re.UINT,[s.RGBA16I]:re.INT,[s.RGBA16UI]:re.UINT,[s.RGBA32I]:re.INT,[s.RGBA32UI]:re.UINT,[s.DEPTH_COMPONENT16]:re.FLOAT,[s.DEPTH_COMPONENT24]:re.FLOAT,[s.DEPTH_COMPONENT32F]:re.FLOAT,[s.DEPTH_STENCIL]:re.FLOAT,[s.DEPTH24_STENCIL8]:re.FLOAT,[s.DEPTH32F_STENCIL8]:re.FLOAT}:e={[s.RGB]:re.FLOAT,[s.RGBA]:re.FLOAT,[s.ALPHA]:re.FLOAT,[s.LUMINANCE]:re.FLOAT,[s.LUMINANCE_ALPHA]:re.FLOAT,[s.DEPTH_STENCIL]:re.FLOAT},e}function rT(s){let e;return"WebGL2RenderingContext"in globalThis&&s instanceof globalThis.WebGL2RenderingContext?e={[fe.UNSIGNED_BYTE]:{[te.RGBA]:s.RGBA8,[te.RGB]:s.RGB8,[te.RG]:s.RG8,[te.RED]:s.R8,[te.RGBA_INTEGER]:s.RGBA8UI,[te.RGB_INTEGER]:s.RGB8UI,[te.RG_INTEGER]:s.RG8UI,[te.RED_INTEGER]:s.R8UI,[te.ALPHA]:s.ALPHA,[te.LUMINANCE]:s.LUMINANCE,[te.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[fe.BYTE]:{[te.RGBA]:s.RGBA8_SNORM,[te.RGB]:s.RGB8_SNORM,[te.RG]:s.RG8_SNORM,[te.RED]:s.R8_SNORM,[te.RGBA_INTEGER]:s.RGBA8I,[te.RGB_INTEGER]:s.RGB8I,[te.RG_INTEGER]:s.RG8I,[te.RED_INTEGER]:s.R8I},[fe.UNSIGNED_SHORT]:{[te.RGBA_INTEGER]:s.RGBA16UI,[te.RGB_INTEGER]:s.RGB16UI,[te.RG_INTEGER]:s.RG16UI,[te.RED_INTEGER]:s.R16UI,[te.DEPTH_COMPONENT]:s.DEPTH_COMPONENT16},[fe.SHORT]:{[te.RGBA_INTEGER]:s.RGBA16I,[te.RGB_INTEGER]:s.RGB16I,[te.RG_INTEGER]:s.RG16I,[te.RED_INTEGER]:s.R16I},[fe.UNSIGNED_INT]:{[te.RGBA_INTEGER]:s.RGBA32UI,[te.RGB_INTEGER]:s.RGB32UI,[te.RG_INTEGER]:s.RG32UI,[te.RED_INTEGER]:s.R32UI,[te.DEPTH_COMPONENT]:s.DEPTH_COMPONENT24},[fe.INT]:{[te.RGBA_INTEGER]:s.RGBA32I,[te.RGB_INTEGER]:s.RGB32I,[te.RG_INTEGER]:s.RG32I,[te.RED_INTEGER]:s.R32I},[fe.FLOAT]:{[te.RGBA]:s.RGBA32F,[te.RGB]:s.RGB32F,[te.RG]:s.RG32F,[te.RED]:s.R32F,[te.DEPTH_COMPONENT]:s.DEPTH_COMPONENT32F},[fe.HALF_FLOAT]:{[te.RGBA]:s.RGBA16F,[te.RGB]:s.RGB16F,[te.RG]:s.RG16F,[te.RED]:s.R16F},[fe.UNSIGNED_SHORT_5_6_5]:{[te.RGB]:s.RGB565},[fe.UNSIGNED_SHORT_4_4_4_4]:{[te.RGBA]:s.RGBA4},[fe.UNSIGNED_SHORT_5_5_5_1]:{[te.RGBA]:s.RGB5_A1},[fe.UNSIGNED_INT_2_10_10_10_REV]:{[te.RGBA]:s.RGB10_A2,[te.RGBA_INTEGER]:s.RGB10_A2UI},[fe.UNSIGNED_INT_10F_11F_11F_REV]:{[te.RGB]:s.R11F_G11F_B10F},[fe.UNSIGNED_INT_5_9_9_9_REV]:{[te.RGB]:s.RGB9_E5},[fe.UNSIGNED_INT_24_8]:{[te.DEPTH_STENCIL]:s.DEPTH24_STENCIL8},[fe.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[te.DEPTH_STENCIL]:s.DEPTH32F_STENCIL8}}:e={[fe.UNSIGNED_BYTE]:{[te.RGBA]:s.RGBA,[te.RGB]:s.RGB,[te.ALPHA]:s.ALPHA,[te.LUMINANCE]:s.LUMINANCE,[te.LUMINANCE_ALPHA]:s.LUMINANCE_ALPHA},[fe.UNSIGNED_SHORT_5_6_5]:{[te.RGB]:s.RGB},[fe.UNSIGNED_SHORT_4_4_4_4]:{[te.RGBA]:s.RGBA},[fe.UNSIGNED_SHORT_5_5_5_1]:{[te.RGBA]:s.RGBA}},e}class pf{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new we,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=rT(e),this.samplerTypes=sT(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let r=0;r<t;r++)this.boundTextures[r]=null;this.emptyTextures={};const i=new da(e.createTexture());e.bindTexture(e.TEXTURE_2D,i.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=i,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new da(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let r=0;r<6;r++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let r=0;r<this.boundTextures.length;r++)this.bind(null,r)}bind(e,t=0){const{gl:i}=this;if(e=e==null?void 0:e.castToBaseTexture(),(e==null?void 0:e.valid)&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const r=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(e.target,r.texture)),r.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),this.updateTexture(e)):r.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let r=0;r<i.length;r++)i[r]===this.unknownTexture&&this.bind(null,r)}for(let r=0;r<i.length;r++)i[r]===e&&(this.currentLocation!==r&&(t.activeTexture(t.TEXTURE0+r),this.currentLocation=r),t.bindTexture(e.target,this.emptyTextures[e.target].texture),i[r]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:i,CONTEXT_UID:r}=this;if(i)for(let n=e-1;n>=0;--n){const o=t[n];o&&o._glTextures[r].samplerType!==re.FLOAT&&this.renderer.texture.unbind(o)}}initTexture(e){const t=new da(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){var i;t.internalFormat=((i=this.internalFormats[e.type])==null?void 0:i[e.format])??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??re.FLOAT,this.webGLVersion===2&&e.type===fe.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){var t;const i=e._glTextures[this.CONTEXT_UID];if(!i)return;const r=this.renderer;if(this.initTextureType(e,i),(t=e.resource)==null?void 0:t.upload(r,e,i))i.samplerType!==re.FLOAT&&(this.hasIntegerTextures=!0);else{const n=e.realWidth,o=e.realHeight,a=r.gl;(i.width!==n||i.height!==o||i.dirtyId<0)&&(i.width=n,i.height=o,a.texImage2D(e.target,0,i.internalFormat,n,o,0,e.format,i.type,null))}e.dirtyStyleId!==i.dirtyStyleId&&this.updateTextureStyle(e),i.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:i}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),i.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const r=this.managedTextures.indexOf(e);r!==-1&&Ys(this.managedTextures,r,1)}}updateTextureStyle(e){var t;const i=e._glTextures[this.CONTEXT_UID];i&&((e.mipmap===vi.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?i.mipmap=!1:i.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?i.wrapMode=Vi.CLAMP:i.wrapMode=e.wrapMode,(t=e.resource)!=null&&t.style(this.renderer,e,i)||this.setStyle(e,i),i.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const i=this.gl;if(t.mipmap&&e.mipmap!==vi.ON_MANUAL&&i.generateMipmap(e.target),i.texParameteri(e.target,i.TEXTURE_WRAP_S,t.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===Ti.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const r=this.renderer.context.extensions.anisotropicFiltering;if(r&&e.anisotropicLevel>0&&e.scaleMode===Ti.LINEAR){const n=Math.min(e.anisotropicLevel,i.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===Ti.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,e.scaleMode===Ti.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}pf.extension={type:se.RendererSystem,name:"texture"};he.add(pf);class mf{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,r=e._glTransformFeedbacks[i]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:i,renderer:r}=this;t&&r.shader.bind(t),i.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:i,CONTEXT_UID:r}=this,n=t.createTransformFeedback();e._glTransformFeedbacks[r]=n,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,n);for(let o=0;o<e.buffers.length;o++){const a=e.buffers[o];a&&(i.buffer.update(a),a._glBuffers[r].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,o,a._glBuffers[r].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),n}disposeTransformFeedback(e,t){const i=e._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;e.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let o=0;o<e.buffers.length;o++){const a=e.buffers[o];if(!a)continue;const l=a._glBuffers[this.CONTEXT_UID];l&&(l.refCount--,l.refCount===0&&!t&&n.dispose(a,t))}i&&(t||r.deleteTransformFeedback(i),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}mf.extension={type:se.RendererSystem,name:"transformFeedback"};he.add(mf);class jn{constructor(e){this.renderer=e}init(e){this.screen=new Ee(0,0,e.width,e.height),this.element=e.view||ne.ADAPTER.createCanvas(),this.resolution=e.resolution||ne.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const i=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=i,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",i,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){var t;e&&((t=this.element.parentNode)==null||t.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}jn.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},jn.extension={type:[se.RendererSystem,se.CanvasRendererSystem],name:"_view"};he.add(jn);ne.PREFER_ENV=_s.WEBGL2;ne.STRICT_TEXTURE_CACHE=!1;ne.RENDER_OPTIONS={...Xn.defaultOptions,...Vn.defaultOptions,...jn.defaultOptions,...Wn.defaultOptions};Object.defineProperties(ne,{WRAP_MODE:{get(){return we.defaultOptions.wrapMode},set(s){Ae("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),we.defaultOptions.wrapMode=s}},SCALE_MODE:{get(){return we.defaultOptions.scaleMode},set(s){Ae("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),we.defaultOptions.scaleMode=s}},MIPMAP_TEXTURES:{get(){return we.defaultOptions.mipmap},set(s){Ae("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),we.defaultOptions.mipmap=s}},ANISOTROPIC_LEVEL:{get(){return we.defaultOptions.anisotropicLevel},set(s){Ae("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),we.defaultOptions.anisotropicLevel=s}},FILTER_RESOLUTION:{get(){return Ae("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Rt.defaultResolution},set(s){Rt.defaultResolution=s}},FILTER_MULTISAMPLE:{get(){return Ae("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Rt.defaultMultisample},set(s){Rt.defaultMultisample=s}},SPRITE_MAX_TEXTURES:{get(){return ls.defaultMaxTextures},set(s){Ae("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),ls.defaultMaxTextures=s}},SPRITE_BATCH_SIZE:{get(){return ls.defaultBatchSize},set(s){Ae("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),ls.defaultBatchSize=s}},CAN_UPLOAD_SAME_BUFFER:{get(){return ls.canUploadSameBuffer},set(s){Ae("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),ls.canUploadSameBuffer=s}},GC_MODE:{get(){return hs.defaultMode},set(s){Ae("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),hs.defaultMode=s}},GC_MAX_IDLE:{get(){return hs.defaultMaxIdle},set(s){Ae("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),hs.defaultMaxIdle=s}},GC_MAX_CHECK_COUNT:{get(){return hs.defaultCheckCountMax},set(s){Ae("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),hs.defaultCheckCountMax=s}},PRECISION_VERTEX:{get(){return bi.defaultVertexPrecision},set(s){Ae("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),bi.defaultVertexPrecision=s}},PRECISION_FRAGMENT:{get(){return bi.defaultFragmentPrecision},set(s){Ae("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),bi.defaultFragmentPrecision=s}}});var xs=(s=>(s[s.INTERACTION=50]="INTERACTION",s[s.HIGH=25]="HIGH",s[s.NORMAL=0]="NORMAL",s[s.LOW=-25]="LOW",s[s.UTILITY=-50]="UTILITY",s))(xs||{});class fa{constructor(e,t=null,i=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=i,this.once=r}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const gf=class Nt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new fa(null,null,1/0),this.deltaMS=1/Nt.targetFPMS,this.elapsedMS=1/Nt.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,i=xs.NORMAL){return this._addListener(new fa(e,t,i))}addOnce(e,t,i=xs.NORMAL){return this._addListener(new fa(e,t,i,!0))}_addListener(e){let t=this._head.next,i=this._head;if(!t)e.connect(i);else{for(;t;){if(e.priority>t.priority){e.connect(i);break}i=t,t=t.next}e.previous||e.connect(i)}return this._startIfPossible(),this}remove(e,t){let i=this._head.next;for(;i;)i.match(e,t)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const n=e-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=e-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*Nt.targetFPMS;const i=this._head;let r=i.next;for(;r;)r=r.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),i=Math.min(Math.max(0,t)/1e3,Nt.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!Nt._shared){const e=Nt._shared=new Nt;e.autoStart=!0,e._protected=!0}return Nt._shared}static get system(){if(!Nt._system){const e=Nt._system=new Nt;e.autoStart=!0,e._protected=!0}return Nt._system}};gf.targetFPMS=.06;let Lt=gf;Object.defineProperties(ne,{TARGET_FPMS:{get(){return Lt.targetFPMS},set(s){Ae("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),Lt.targetFPMS=s}}});class vf{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,xs.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Lt.shared:new Lt,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}vf.extension=se.Application;he.add(vf);const yf=[];he.handleByList(se.Renderer,yf);function xf(s){for(const e of yf)if(e.test(s))return new e(s);throw new Error("Unable to auto-detect a suitable renderer.")}var nT=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,oT=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const aT=nT,_f=oT;class Tf{constructor(e){this.renderer=e}contextChange(e){let t;if(this.renderer.context.webGLVersion===1){const i=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,i)}else{const i=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,i)}t>=dt.HIGH?this.multisample=dt.HIGH:t>=dt.MEDIUM?this.multisample=dt.MEDIUM:t>=dt.LOW?this.multisample=dt.LOW:this.multisample=dt.NONE}destroy(){}}Tf.extension={type:se.RendererSystem,name:"_multisample"};he.add(Tf);class lT{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class wf{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,r=e._glBuffers[i]||this.createGLBuffer(e);t.bindBuffer(e.type,r.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:i,CONTEXT_UID:r}=this;if(this.boundBufferBases[t]!==e){const n=e._glBuffers[r]||this.createGLBuffer(e);this.boundBufferBases[t]=e,i.bindBufferBase(i.UNIFORM_BUFFER,t,n.buffer)}}bindBufferRange(e,t,i){const{gl:r,CONTEXT_UID:n}=this;i=i||0;const o=e._glBuffers[n]||this.createGLBuffer(e);r.bindBufferRange(r.UNIFORM_BUFFER,t||0,o.buffer,i*256,256)}update(e){const{gl:t,CONTEXT_UID:i}=this,r=e._glBuffers[i]||this.createGLBuffer(e);if(e._updateID!==r.updateID)if(r.updateID=e._updateID,t.bindBuffer(e.type,r.buffer),r.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const n=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;r.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,n)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const i=e._glBuffers[this.CONTEXT_UID],r=this.gl;e.disposeRunner.remove(this),i&&(t||r.deleteBuffer(i.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let i=0;i<t.length;i++)this.dispose(this.managedBuffers[t[i]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:i}=this;return e._glBuffers[t]=new lT(i.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}wf.extension={type:se.RendererSystem,name:"buffer"};he.add(wf);class Ef{constructor(e){this.renderer=e}render(e,t){const i=this.renderer;let r,n,o,a;if(t&&(r=t.renderTexture,n=t.clear,o=t.transform,a=t.skipUpdateTransform),this.renderingToScreen=!r,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=o,!i.context.isLost){if(r||(this.lastObjectRendered=e),!a){const l=e.enableTempParent();e.updateTransform(),e.disableTempParent(l)}i.renderTexture.bind(r),i.batch.currentRenderer.start(),(n??i.background.clearBeforeRender)&&i.renderTexture.clear(),e.render(i),i.batch.currentRenderer.flush(),r&&(t.blit&&i.framebuffer.blit(),r.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Ef.extension={type:se.RendererSystem,name:"objectRenderer"};he.add(Ef);const Pn=class rl extends iT{constructor(e){super(),this.type=md.WEBGL,e=Object.assign({},ne.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new $t({projectionMatrix:new ze},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:rl.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(Ae("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=rl.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e!=null&&e.forceCanvas?!1:Ox()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Ae("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Ae("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Ae("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Ae("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){Ae("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return Ae("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){Ae("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return Ae("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};Pn.extension={type:se.Renderer,priority:1},Pn.__plugins={},Pn.__systems={};let Vl=Pn;he.handleByMap(se.RendererPlugin,Vl.__plugins);he.handleByMap(se.RendererSystem,Vl.__systems);he.add(Vl);class bf extends Dr{constructor(e,t){const{width:i,height:r}=t||{};super(i,r),this.items=[],this.itemDirtyIds=[];for(let n=0;n<e;n++){const o=new we;this.items.push(o),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let i=0;i<this.length;i++)e[i]&&(e[i].castToBaseTexture?this.addBaseTextureAt(e[i].castToBaseTexture(),i):e[i]instanceof Dr?this.addResourceAt(e[i],i):this.addResourceAt(Hd(e[i],t),i))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(t=>t.resource).filter(t=>t).map(t=>t.load());return this._load=Promise.all(e).then(()=>{const{realWidth:t,realHeight:i}=this.items[0];return this.resize(t,i),this.update(),Promise.resolve(this)}),this._load}}class hT extends bf{constructor(e,t){const{width:i,height:r}=t||{};let n,o;Array.isArray(e)?(n=e,o=e.length):o=e,super(o,{width:i,height:r}),n&&this.initFromArray(n,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=Ws.TEXTURE_2D_ARRAY}upload(e,t,i){const{length:r,itemDirtyIds:n,items:o}=this,{gl:a}=e;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,r,0,t.format,i.type,null);for(let l=0;l<r;l++){const h=o[l];n[l]<h.dirtyId&&(n[l]=h.dirtyId,h.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,l,h.resource.width,h.resource.height,1,t.format,i.type,h.resource.source))}return!0}}class uT extends Ri{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return t&&e instanceof t?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const Sf=class gr extends bf{constructor(e,t){const{width:i,height:r,autoLoad:n,linkBaseTexture:o}=t||{};if(e&&e.length!==gr.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:i,height:r});for(let a=0;a<gr.SIDES;a++)this.items[a].target=Ws.TEXTURE_CUBE_MAP_POSITIVE_X+a;this.linkBaseTexture=o!==!1,e&&this.initFromArray(e,t),n!==!1&&this.load()}bind(e){super.bind(e),e.target=Ws.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=Ws.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,i){const r=this.itemDirtyIds;for(let n=0;n<gr.SIDES;n++){const o=this.items[n];(r[n]<o.dirtyId||i.dirtyId<t.dirtyId)&&(o.valid&&o.resource?(o.resource.upload(e,o,i),r[n]=o.dirtyId):r[n]<-1&&(e.gl.texImage2D(o.target,0,i.internalFormat,t.realWidth,t.realHeight,0,t.format,i.type,null),r[n]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===gr.SIDES}};Sf.SIDES=6;let cT=Sf;class zs extends Ri{constructor(e,t){t=t||{};let i,r,n;typeof e=="string"?(i=zs.EMPTY,r=e,n=!0):(i=e,r=null,n=!1),super(i),this.url=r,this.crossOrigin=t.crossOrigin??!0,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??n,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,t)=>{if(this.url===null){e(this);return}try{const i=await ne.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const r=await i.blob();if(this.destroyed)return;const n=await createImageBitmap(r,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ct.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),e(this)}catch(i){if(this.destroyed)return;t(i),this.onError.emit(i)}}),this._load)}upload(e,t,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),super.upload(e,t,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){return zs._EMPTY=zs._EMPTY??ne.ADAPTER.createCanvas(0,0),zs._EMPTY}}const nl=class Mn extends Ri{constructor(e,t){t=t||{},super(ne.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.update(),e(this)},Mn.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;Ri.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,i=e.height;if(!t||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=t*this.scale,n=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/i*t,n=this._overrideHeight||this._overrideWidth/t*i),r=Math.round(r),n=Math.round(n);const o=this.source;o.width=r,o.height=n,o._pixiId=`canvas_${ys()}`,o.getContext("2d").drawImage(e,0,0,t,i,0,0,r,n),this._resolve(),this._resolve=null}}static getSize(e){const t=Mn.SVG_SIZE.exec(e),i={};return t&&(i[t[1]]=Math.round(parseFloat(t[3])),i[t[5]]=Math.round(parseFloat(t[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&Mn.SVG_XML.test(e)}};nl.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,nl.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let ol=nl;class dT extends Ri{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}}const al=class ll extends Ri{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const i=document.createElement("video");t.autoLoad!==!1&&i.setAttribute("preload","auto"),t.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),t.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),t.loop===!0&&i.setAttribute("loop",""),t.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof e=="string"&&(e=[e]);const r=e[0].src||e[0];Ri.crossOrigin(i,r,t.crossorigin);for(let n=0;n<e.length;++n){const o=document.createElement("source");let{src:a,mime:l}=e[n];if(a=a||e[n],a.startsWith("data:"))l=a.slice(5,a.indexOf(";"));else if(!a.startsWith("blob:")){const h=a.split("?").shift().toLowerCase(),u=h.slice(h.lastIndexOf(".")+1);l=l||ll.MIME_TYPES[u]||`video/${u}`}o.src=a,l&&(o.type=l),i.appendChild(o)}e=i}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const t=Lt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t,i)=>{this.valid?t(this):(this._resolve=t,this._reject=i,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(Lt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Lt.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Lt.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||ll.TYPES.includes(t)}};al.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],al.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Af=al;qa.push(zs,Zd,uT,Af,dT,ol,co,cT,hT);class Yn{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?Ee.EMPTY:(e=e||new Ee(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:i,b:r,c:n,d:o,tx:a,ty:l}=e,h=i*t.x+n*t.y+a,u=r*t.x+o*t.y+l;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,u),this.maxY=Math.max(this.maxY,u)}addQuad(e){let t=this.minX,i=this.minY,r=this.maxX,n=this.maxY,o=e[0],a=e[1];t=o<t?o:t,i=a<i?a:i,r=o>r?o:r,n=a>n?a:n,o=e[2],a=e[3],t=o<t?o:t,i=a<i?a:i,r=o>r?o:r,n=a>n?a:n,o=e[4],a=e[5],t=o<t?o:t,i=a<i?a:i,r=o>r?o:r,n=a>n?a:n,o=e[6],a=e[7],t=o<t?o:t,i=a<i?a:i,r=o>r?o:r,n=a>n?a:n,this.minX=t,this.minY=i,this.maxX=r,this.maxY=n}addFrame(e,t,i,r,n){this.addFrameMatrix(e.worldTransform,t,i,r,n)}addFrameMatrix(e,t,i,r,n){const o=e.a,a=e.b,l=e.c,h=e.d,u=e.tx,c=e.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY,g=o*t+l*i+u,v=a*t+h*i+c;d=g<d?g:d,f=v<f?v:f,p=g>p?g:p,m=v>m?v:m,g=o*r+l*i+u,v=a*r+h*i+c,d=g<d?g:d,f=v<f?v:f,p=g>p?g:p,m=v>m?v:m,g=o*t+l*n+u,v=a*t+h*n+c,d=g<d?g:d,f=v<f?v:f,p=g>p?g:p,m=v>m?v:m,g=o*r+l*n+u,v=a*r+h*n+c,d=g<d?g:d,f=v<f?v:f,p=g>p?g:p,m=v>m?v:m,this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addVertexData(e,t,i){let r=this.minX,n=this.minY,o=this.maxX,a=this.maxY;for(let l=t;l<i;l+=2){const h=e[l],u=e[l+1];r=h<r?h:r,n=u<n?u:n,o=h>o?h:o,a=u>a?u:a}this.minX=r,this.minY=n,this.maxX=o,this.maxY=a}addVertices(e,t,i,r){this.addVerticesMatrix(e.worldTransform,t,i,r)}addVerticesMatrix(e,t,i,r,n=0,o=n){const a=e.a,l=e.b,h=e.c,u=e.d,c=e.tx,d=e.ty;let f=this.minX,p=this.minY,m=this.maxX,g=this.maxY;for(let v=i;v<r;v+=2){const x=t[v],_=t[v+1],E=a*x+h*_+c,R=u*_+l*x+d;f=Math.min(f,E-n),m=Math.max(m,E+n),p=Math.min(p,R-o),g=Math.max(g,R+o)}this.minX=f,this.minY=p,this.maxX=m,this.maxY=g}addBounds(e){const t=this.minX,i=this.minY,r=this.maxX,n=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<i?e.minY:i,this.maxX=e.maxX>r?e.maxX:r,this.maxY=e.maxY>n?e.maxY:n}addBoundsMask(e,t){const i=e.minX>t.minX?e.minX:t.minX,r=e.minY>t.minY?e.minY:t.minY,n=e.maxX<t.maxX?e.maxX:t.maxX,o=e.maxY<t.maxY?e.maxY:t.maxY;if(i<=n&&r<=o){const a=this.minX,l=this.minY,h=this.maxX,u=this.maxY;this.minX=i<a?i:a,this.minY=r<l?r:l,this.maxX=n>h?n:h,this.maxY=o>u?o:u}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const i=e.minX>t.x?e.minX:t.x,r=e.minY>t.y?e.minY:t.y,n=e.maxX<t.x+t.width?e.maxX:t.x+t.width,o=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(i<=n&&r<=o){const a=this.minX,l=this.minY,h=this.maxX,u=this.maxY;this.minX=i<a?i:a,this.minY=r<l?r:l,this.maxX=n>h?n:h,this.maxY=o>u?o:u}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,i,r,n,o){e-=n,t-=o,i+=n,r+=o,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>r?this.maxY:r}}class $e extends Fr{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Gl,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Yn,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let i=0;i<t.length;++i){const r=t[i];Object.defineProperty($e.prototype,r,Object.getOwnPropertyDescriptor(e,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new Ee),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new Ee),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Yn);const t=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(i==null?void 0:i.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const o=this.getBounds(!1,e);return this.parent=i,this.transform=t,this._bounds=r,this._bounds.updateID+=this._boundsID-n,o}toGlobal(e,t,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,i,r){return t&&(e=t.toGlobal(e,i,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,i)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e=0,t=0,i=1,r=1,n=0,o=0,a=0,l=0,h=0){return this.position.x=e,this.position.y=t,this.scale.x=i||1,this.scale.y=r||1,this.rotation=n,this.skew.x=o,this.skew.y=a,this.pivot.x=l,this.pivot.y=h,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new fT),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*o_}set angle(e){this.transform.rotation=e*a_}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,t._maskRefCount===0&&(t.renderable=!0,t.isMask=!1))}if(this._mask=e,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount===0&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class fT extends $e{constructor(){super(...arguments),this.sortDirty=null}}$e.prototype.displayObjectUpdateTransform=$e.prototype.updateTransform;const pT=new ze;function mT(s,e){return s.zIndex===e.zIndex?s._lastSortedIndex-e._lastSortedIndex:s.zIndex-e.zIndex}const Rf=class hl extends $e{constructor(){super(),this.children=[],this.sortableChildren=hl.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const i=this.getChildIndex(e),r=this.getChildIndex(t);this.children[i]=t,this.children[r]=e,this.onChildrenChange(i<r?i:r)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(e);Ys(this.children,i,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],i=this.children.indexOf(t);if(i===-1)return null;t.parent=null,t.transform._parentID=-1,Ys(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,Ys(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const i=e,r=t,n=r-i;let o;if(n>0&&n<=r){o=this.children.splice(i,n);for(let a=0;a<o.length;++a)o[a].parent=null,o[a].transform&&(o[a].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let a=0;a<o.length;++a)o[a].emit("removed",this),this.emit("childRemoved",o[a],this,a);return o}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,i=this.children.length;t<i;++t){const r=this.children[t];r._lastSortedIndex=t,!e&&r.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(mT),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const i=this.children[e];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(t._bounds,i._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const i=super.getLocalBounds(e);if(!t)for(let r=0,n=this.children.length;r<n;++r){const o=this.children[r];o.visible&&o.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let i,r;this.cullArea?(i=this.cullArea,r=this.worldTransform):this._render!==hl.prototype._render&&(i=this.getBounds(!0));const n=e.projection.transform;if(n&&(r?(r=pT.copyFrom(r),r.prepend(n)):r=n),i&&t.intersects(i,r))this._render(e);else if(this.cullArea)return;for(let o=0,a=this.children.length;o<a;++o){const l=this.children[o],h=l.cullable;l.cullable=h||!this.cullArea,l.render(e),l.cullable=h}}render(e){var t;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(t=this.filters)!=null&&t.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let i=0,r=this.children.length;i<r;++i)this.children[i].render(e)}}renderAdvanced(e){var t,i,r;const n=this.filters,o=this._mask;if(n){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let l=0;l<n.length;l++)n[l].enabled&&this._enabledFilters.push(n[l])}const a=n&&((t=this._enabledFilters)==null?void 0:t.length)||o&&(!o.isMaskData||o.enabled&&(o.autoDetect||o.type!==ft.NONE));if(a&&e.batch.flush(),n&&(i=this._enabledFilters)!=null&&i.length&&e.filter.push(this,this._enabledFilters),o&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let l=0,h=this.children.length;l<h;++l)this.children[l].render(e)}a&&e.batch.flush(),o&&e.mask.pop(this),n&&(r=this._enabledFilters)!=null&&r.length&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e==null?void 0:e.children,i=this.removeChildren(0,this.children.length);if(t)for(let r=0;r<i.length;++r)i[r].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};Rf.defaultSortableChildren=!1;let ti=Rf;ti.prototype.containerUpdateTransform=ti.prototype.updateTransform;Object.defineProperties(ne,{SORTABLE_CHILDREN:{get(){return ti.defaultSortableChildren},set(s){Ae("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ti.defaultSortableChildren=s}}});const ur=new Ie,gT=new Uint16Array([0,1,2,0,2,3]);class sr extends ti{constructor(e){super(),this._anchor=new Ei(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new Ue(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=ye.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||le.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=gT,this.pluginName="batch",this.isSprite=!0,this._roundPixels=ne.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Hi(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Hi(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,i=t.a,r=t.b,n=t.c,o=t.d,a=t.tx,l=t.ty,h=this.vertexData,u=e.trim,c=e.orig,d=this._anchor;let f=0,p=0,m=0,g=0;if(u?(p=u.x-d._x*c.width,f=p+u.width,g=u.y-d._y*c.height,m=g+u.height):(p=-d._x*c.width,f=p+c.width,g=-d._y*c.height,m=g+c.height),h[0]=i*p+n*g+a,h[1]=o*g+r*p+l,h[2]=i*f+n*g+a,h[3]=o*g+r*f+l,h[4]=i*f+n*m+a,h[5]=o*m+r*f+l,h[6]=i*p+n*m+a,h[7]=o*m+r*p+l,this._roundPixels){const v=ne.RESOLUTION;for(let x=0;x<h.length;++x)h[x]=Math.round(h[x]*v)/v}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,i=e.orig,r=this._anchor,n=this.transform.worldTransform,o=n.a,a=n.b,l=n.c,h=n.d,u=n.tx,c=n.ty,d=-r._x*i.width,f=d+i.width,p=-r._y*i.height,m=p+i.height;if(t[0]=o*d+l*p+u,t[1]=h*p+a*d+c,t[2]=o*f+l*p+u,t[3]=h*p+a*f+c,t[4]=o*f+l*m+u,t[5]=h*m+a*f+c,t[6]=o*d+l*m+u,t[7]=h*m+a*d+c,this._roundPixels){const g=ne.RESOLUTION;for(let v=0;v<t.length;++v)t[v]=Math.round(t[v]*g)/g}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new Yn),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new Ee),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,ur);const t=this._texture.orig.width,i=this._texture.orig.height,r=-t*this.anchor.x;let n=0;return ur.x>=r&&ur.x<r+t&&(n=-i*this.anchor.y,ur.y>=n&&ur.y<n+i)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e==null?void 0:e.texture){const t=typeof e=="boolean"?e:e==null?void 0:e.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const i=e instanceof le?e:le.from(e,t);return new sr(i)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=Hi(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=Hi(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||le.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const Cf=new ze;$e.prototype._cacheAsBitmap=!1;$e.prototype._cacheData=null;$e.prototype._cacheAsBitmapResolution=null;$e.prototype._cacheAsBitmapMultisample=null;class vT{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties($e.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(s){s!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(s){s!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=s,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(s){if(this._cacheAsBitmap===s)return;this._cacheAsBitmap=s;let e;s?(this._cacheData||(this._cacheData=new vT),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}});$e.prototype._renderCached=function(s){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(s),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(s))};$e.prototype._initCachedDisplayObject=function(s){var e,t;if((e=this._cacheData)!=null&&e.sprite)return;const i=this.alpha;this.alpha=1,s.batch.flush();const r=this.getLocalBounds(new Ee,!0);if((t=this.filters)!=null&&t.length){const p=this.filters[0].padding;r.pad(p)}const n=this.cacheAsBitmapResolution||s.resolution;r.ceil(n),r.width=Math.max(r.width,1/n),r.height=Math.max(r.height,1/n);const o=s.renderTexture.current,a=s.renderTexture.sourceFrame.clone(),l=s.renderTexture.destinationFrame.clone(),h=s.projection.transform,u=Ts.create({width:r.width,height:r.height,resolution:n,multisample:this.cacheAsBitmapMultisample??s.multisample}),c=`cacheAsBitmap_${ys()}`;this._cacheData.textureCacheId=c,we.addToCache(u.baseTexture,c),le.addToCache(u,c);const d=this.transform.localTransform.copyTo(Cf).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,s.render(this,{renderTexture:u,clear:!0,transform:d,skipUpdateTransform:!1}),s.framebuffer.blit(),s.projection.transform=h,s.renderTexture.bind(o,a,l),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const f=new sr(u);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(r.x/r.width),f.anchor.y=-(r.y/r.height),f.alpha=i,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=f.containsPoint.bind(f)};$e.prototype._renderCachedCanvas=function(s){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(s),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(s))};$e.prototype._initCachedDisplayObjectCanvas=function(s){var e;if((e=this._cacheData)!=null&&e.sprite)return;const t=this.getLocalBounds(new Ee,!0),i=this.alpha;this.alpha=1;const r=s.canvasContext.activeContext,n=s._projTransform,o=this.cacheAsBitmapResolution||s.resolution;t.ceil(o),t.width=Math.max(t.width,1/o),t.height=Math.max(t.height,1/o);const a=Ts.create({width:t.width,height:t.height,resolution:o}),l=`cacheAsBitmap_${ys()}`;this._cacheData.textureCacheId=l,we.addToCache(a.baseTexture,l),le.addToCache(a,l);const h=Cf;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=t.x,h.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,s.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),s.canvasContext.activeContext=r,s._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const u=new sr(a);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(t.x/t.width),u.anchor.y=-(t.y/t.height),u.alpha=i,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=s._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)};$e.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};$e.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};$e.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,we.removeFromCache(this._cacheData.textureCacheId),le.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};$e.prototype._cacheAsBitmapDestroy=function(s){this.cacheAsBitmap=!1,this.destroy(s)};$e.prototype.name=null;ti.prototype.getChildByName=function(s,e){for(let t=0,i=this.children.length;t<i;t++)if(this.children[t].name===s)return this.children[t];if(e)for(let t=0,i=this.children.length;t<i;t++){const r=this.children[t];if(!r.getChildByName)continue;const n=r.getChildByName(s,!0);if(n)return n}return null};$e.prototype.getGlobalPosition=function(s=new Ie,e=!1){return this.parent?this.parent.toGlobal(this.position,s,e):(s.x=this.position.x,s.y=this.position.y),s};var yT=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class xT extends Rt{constructor(e=1){super(aT,yT,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}const _T={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},TT=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function wT(s){const e=_T[s],t=e.length;let i=TT,r="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<s;a++){let l=n.replace("%index%",a.toString());o=a,a>=t&&(o=s-a-1),l=l.replace("%value%",e[o].toString()),r+=l,r+=`
`}return i=i.replace("%blur%",r),i=i.replace("%size%",s.toString()),i}const ET=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function bT(s,e){const t=Math.ceil(s/2);let i=ET,r="",n;e?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<s;o++){let a=n.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(t-1)}.0`),r+=a,r+=`
`}return i=i.replace("%blur%",r),i=i.replace("%size%",s.toString()),i}class ul extends Rt{constructor(e,t=8,i=4,r=Rt.defaultResolution,n=5){const o=bT(n,e),a=wT(n);super(o,a),this.horizontal=e,this.resolution=r,this._quality=0,this.quality=i,this.blur=t}apply(e,t,i,r){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/t.width):this.uniforms.strength=1/i.height*(i.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,t,i,r);else{const n=e.getFilterTexture(),o=e.renderer;let a=t,l=n;this.state.blend=!1,e.applyFilter(this,a,l,di.CLEAR);for(let h=1;h<this.passes-1;h++){e.bindAndClear(a,di.BLIT),this.uniforms.uSampler=l;const u=l;l=a,a=u,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,l,i,r),e.returnFilterTexture(n)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class ST extends Rt{constructor(e=8,t=4,i=Rt.defaultResolution,r=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new ul(!0,e,t,i,r),this.blurYFilter=new ul(!1,e,t,i,r),this.resolution=i,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,i,r){const n=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(n&&o){const a=e.getFilterTexture();this.blurXFilter.apply(e,t,a,di.CLEAR),this.blurYFilter.apply(e,a,i,r),e.returnFilterTexture(a)}else o?this.blurYFilter.apply(e,t,i,r):this.blurXFilter.apply(e,t,i,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}}var AT=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class cl extends Rt{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(_f,AT,e),this.alpha=1}_loadMatrix(e,t=!1){let i=e;t&&(this._multiply(i,this.uniforms.m,e),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(e,t,i){return e[0]=t[0]*i[0]+t[1]*i[5]+t[2]*i[10]+t[3]*i[15],e[1]=t[0]*i[1]+t[1]*i[6]+t[2]*i[11]+t[3]*i[16],e[2]=t[0]*i[2]+t[1]*i[7]+t[2]*i[12]+t[3]*i[17],e[3]=t[0]*i[3]+t[1]*i[8]+t[2]*i[13]+t[3]*i[18],e[4]=t[0]*i[4]+t[1]*i[9]+t[2]*i[14]+t[3]*i[19]+t[4],e[5]=t[5]*i[0]+t[6]*i[5]+t[7]*i[10]+t[8]*i[15],e[6]=t[5]*i[1]+t[6]*i[6]+t[7]*i[11]+t[8]*i[16],e[7]=t[5]*i[2]+t[6]*i[7]+t[7]*i[12]+t[8]*i[17],e[8]=t[5]*i[3]+t[6]*i[8]+t[7]*i[13]+t[8]*i[18],e[9]=t[5]*i[4]+t[6]*i[9]+t[7]*i[14]+t[8]*i[19]+t[9],e[10]=t[10]*i[0]+t[11]*i[5]+t[12]*i[10]+t[13]*i[15],e[11]=t[10]*i[1]+t[11]*i[6]+t[12]*i[11]+t[13]*i[16],e[12]=t[10]*i[2]+t[11]*i[7]+t[12]*i[12]+t[13]*i[17],e[13]=t[10]*i[3]+t[11]*i[8]+t[12]*i[13]+t[13]*i[18],e[14]=t[10]*i[4]+t[11]*i[9]+t[12]*i[14]+t[13]*i[19]+t[14],e[15]=t[15]*i[0]+t[16]*i[5]+t[17]*i[10]+t[18]*i[15],e[16]=t[15]*i[1]+t[16]*i[6]+t[17]*i[11]+t[18]*i[16],e[17]=t[15]*i[2]+t[16]*i[7]+t[17]*i[12]+t[18]*i[17],e[18]=t[15]*i[3]+t[16]*i[8]+t[17]*i[13]+t[18]*i[18],e[19]=t[15]*i[4]+t[16]*i[9]+t[17]*i[14]+t[18]*i[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const i=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}tint(e,t){const[i,r,n]=Ue.shared.setValue(e).toArray(),o=[i,0,0,0,0,0,r,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(o,t)}greyscale(e,t){const i=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}blackAndWhite(e){const t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;const i=Math.cos(e),r=Math.sin(e),n=Math.sqrt,o=1/3,a=n(o),l=i+(1-i)*o,h=o*(1-i)-a*r,u=o*(1-i)+a*r,c=o*(1-i)+a*r,d=i+o*(1-i),f=o*(1-i)-a*r,p=o*(1-i)-a*r,m=o*(1-i)+a*r,g=i+o*(1-i),v=[l,h,u,0,0,c,d,f,0,0,p,m,g,0,0,0,0,0,1,0];this._loadMatrix(v,t)}contrast(e,t){const i=(e||0)+1,r=-.5*(i-1),n=[i,0,0,0,r,0,i,0,0,r,0,0,i,0,r,0,0,0,1,0];this._loadMatrix(n,t)}saturate(e=0,t){const i=e*2/3+1,r=(i-1)*-.5,n=[i,r,r,0,0,r,i,r,0,0,r,r,i,0,0,0,0,0,1,0];this._loadMatrix(n,t)}desaturate(){this.saturate(-1)}negative(e){const t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){const t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){const t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){const t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){const t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){const t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){const t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){const t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,i,r,n){e=e||.2,t=t||.15,i=i||16770432,r=r||3375104;const o=Ue.shared,[a,l,h]=o.setValue(i).toArray(),[u,c,d]=o.setValue(r).toArray(),f=[.3,.59,.11,0,0,a,l,h,e,0,u,c,d,t,0,a-u,l-c,h-d,0,0];this._loadMatrix(f,n)}night(e,t){e=e||.1;const i=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(i,t)}predator(e,t){const i=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(i,t)}lsd(e){const t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}cl.prototype.grayscale=cl.prototype.greyscale;var RT=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,CT=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class PT extends Rt{constructor(e,t){const i=new ze;e.renderable=!1,super(CT,RT,{mapSampler:e._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=i,t==null&&(t=20),this.scale=new Ie(t,t)}apply(e,t,i,r){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,o=Math.sqrt(n.a*n.a+n.b*n.b),a=Math.sqrt(n.c*n.c+n.d*n.d);o!==0&&a!==0&&(this.uniforms.rotation[0]=n.a/o,this.uniforms.rotation[1]=n.b/o,this.uniforms.rotation[2]=n.c/a,this.uniforms.rotation[3]=n.d/a),e.applyFilter(this,t,i,r)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}}var MT=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,IT=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class OT extends Rt{constructor(){super(IT,MT)}}var DT=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class NT extends Rt{constructor(e=.5,t=Math.random()){super(_f,DT,{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}const Yu={AlphaFilter:xT,BlurFilter:ST,BlurFilterPass:ul,ColorMatrixFilter:cl,DisplacementFilter:PT,FXAAFilter:OT,NoiseFilter:NT};Object.entries(Yu).forEach(([s,e])=>{Object.defineProperty(Yu,s,{get(){return Ae("7.1.0",`filters.${s} has moved to ${s}`),e}})});class LT{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(Lt.system.add(this.tickerUpdate,this,xs.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(Lt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Bi=new LT;class Gr{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Gr.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ie,this.page=new Ie,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,i,r,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class qn extends Gr{constructor(){super(...arguments),this.client=new Ie,this.movement=new Ie,this.offset=new Ie,this.global=new Ie,this.screen=new Ie}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,i){return e.worldTransform.applyInverse(i||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,i,r,n,o,a,l,h,u,c,d,f,p,m){throw new Error("Method not implemented.")}}class qt extends qn{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class Zs extends qn{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}Zs.DOM_DELTA_PIXEL=0,Zs.DOM_DELTA_LINE=1,Zs.DOM_DELTA_PAGE=2;const BT=2048,FT=new Ie,pa=new Ie;class kT{constructor(e){this.dispatch=new Fr,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((i,r)=>i.priority-r.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let i=0,r=t.length;i<r;i++)t[i].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){Bi.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",r=this[i](this.rootTarget,this.rootTarget.eventMode,FT.set(e,t),this.hitTestFn,this.hitPruneFn);return r&&r[0]}propagate(e,t){if(!e.target)return;const i=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let r=0,n=i.length-1;r<n;r++)if(e.currentTarget=i[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(e.currentTarget=i[r],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,i=this._allInteractiveElements){if(i.length===0)return;e.eventPhase=e.BUBBLING_PHASE;const r=Array.isArray(t)?t:[t];for(let n=i.length-1;n>=0;n--)r.forEach(o=>{e.currentTarget=i[n],this.notifyTarget(e,o)})}propagationPath(e){const t=[e];for(let i=0;i<BT&&e!==this.rootTarget;i++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,i,r,n,o=!1){let a=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Bi.pauseUpdate=!1),e.interactiveChildren&&e.children){const u=e.children;for(let c=u.length-1;c>=0;c--){const d=u[c],f=this.hitTestMoveRecursive(d,this._isInteractive(t)?t:d.eventMode,i,r,n,o||n(e,i));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const p=e.isInteractive();(f.length>0||p)&&(p&&this._allInteractiveElements.push(e),f.push(e)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}const l=this._isInteractive(t),h=e.isInteractive();return l&&h&&this._allInteractiveElements.push(e),o||this._hitElements.length>0?null:a?this._hitElements:l&&!n(e,i)&&r(e,i)?h?[e]:[]:null}hitTestRecursive(e,t,i,r,n){if(this._interactivePrune(e)||n(e,i))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Bi.pauseUpdate=!1),e.interactiveChildren&&e.children){const l=e.children;for(let h=l.length-1;h>=0;h--){const u=l[h],c=this.hitTestRecursive(u,this._isInteractive(t)?t:u.eventMode,i,r,n);if(c){if(c.length>0&&!c[c.length-1].parent)continue;const d=e.isInteractive();return(c.length>0||d)&&c.push(e),c}}}const o=this._isInteractive(t),a=e.isInteractive();return o&&r(e,i)?a?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!!(!e||e.isMask||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren||e.isMask)}hitPruneFn(e,t){var i;if(e.hitArea&&(e.worldTransform.applyInverse(t,pa),!e.hitArea.contains(pa.x,pa.y)))return!0;if(e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;if(r&&!((i=r.containsPoint)!=null&&i.call(r,t)))return!0}return!1}hitTestFn(e,t){return e.eventMode==="passive"?!1:e.hitArea?!0:e.containsPoint?e.containsPoint(t):!1}notifyTarget(e,t){var i,r;t=t??e.type;const n=`on${t}`;(r=(i=e.currentTarget)[n])==null||r.call(i,e);const o=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,o),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const r=t.button===2;this.dispatchEvent(t,r?"rightdown":"mousedown")}const i=this.trackingData(e.pointerId);i.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){var t,i;if(!(e instanceof qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const r=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const n=r.pointerType==="mouse"||r.pointerType==="pen",o=this.trackingData(e.pointerId),a=this.findMountedTarget(o.overTargets);if(((t=o.overTargets)==null?void 0:t.length)>0&&a!==r.target){const u=e.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(e,u,a);if(this.dispatchEvent(c,"pointerout"),n&&this.dispatchEvent(c,"mouseout"),!r.composedPath().includes(a)){const d=this.createPointerEvent(e,"pointerleave",a);for(d.eventPhase=d.AT_TARGET;d.target&&!r.composedPath().includes(d.target);)d.currentTarget=d.target,this.notifyTarget(d),n&&this.notifyTarget(d,"mouseleave"),d.target=d.target.parent;this.freeEvent(d)}this.freeEvent(c)}if(a!==r.target){const u=e.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(r,u);this.dispatchEvent(c,"pointerover"),n&&this.dispatchEvent(c,"mouseover");let d=a==null?void 0:a.parent;for(;d&&d!==this.rootTarget.parent&&d!==r.target;)d=d.parent;if(!d||d===this.rootTarget.parent){const f=this.clonePointerEvent(r,"pointerenter");for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==a&&f.target!==this.rootTarget.parent;)f.currentTarget=f.target,this.notifyTarget(f),n&&this.notifyTarget(f,"mouseenter"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(c)}const l=[],h=this.enableGlobalMoveEvents??!0;this.moveOnAll?l.push("pointermove"):this.dispatchEvent(r,"pointermove"),h&&l.push("globalpointermove"),r.pointerType==="touch"&&(this.moveOnAll?l.splice(1,0,"touchmove"):this.dispatchEvent(r,"touchmove"),h&&l.push("globaltouchmove")),n&&(this.moveOnAll?l.splice(1,0,"mousemove"):this.dispatchEvent(r,"mousemove"),h&&l.push("globalmousemove"),this.cursor=(i=r.target)==null?void 0:i.cursor),l.length>0&&this.all(r,l),this._allInteractiveElements.length=0,this._hitElements.length=0,o.overTargets=r.composedPath(),this.freeEvent(r)}mapPointerOver(e){var t;if(!(e instanceof qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const i=this.trackingData(e.pointerId),r=this.createPointerEvent(e),n=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(t=r.target)==null?void 0:t.cursor);const o=this.clonePointerEvent(r,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),n&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;i.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(o)}mapPointerOut(e){if(!(e instanceof qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId);if(t.overTargets){const i=e.pointerType==="mouse"||e.pointerType==="pen",r=this.findMountedTarget(t.overTargets),n=this.createPointerEvent(e,"pointerout",r);this.dispatchEvent(n),i&&this.dispatchEvent(n,"mouseout");const o=this.createPointerEvent(e,"pointerleave",r);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),i&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;t.overTargets=null,this.freeEvent(n),this.freeEvent(o)}this.cursor=null}mapPointerUp(e){if(!(e instanceof qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=performance.now(),i=this.createPointerEvent(e);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const a=i.button===2;this.dispatchEvent(i,a?"rightup":"mouseup")}const r=this.trackingData(e.pointerId),n=this.findMountedTarget(r.pressTargetsByButton[e.button]);let o=n;if(n&&!i.composedPath().includes(n)){let a=n;for(;a&&!i.composedPath().includes(a);){if(i.currentTarget=a,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const l=i.button===2;this.notifyTarget(i,l?"rightupoutside":"mouseupoutside")}a=a.parent}delete r.pressTargetsByButton[e.button],o=a}if(o){const a=this.clonePointerEvent(i,"click");a.target=o,a.path=null,r.clicksByButton[e.button]||(r.clicksByButton[e.button]={clickCount:0,target:a.target,timeStamp:t});const l=r.clicksByButton[e.button];if(l.target===a.target&&t-l.timeStamp<200?++l.clickCount:l.clickCount=1,l.target=a.target,l.timeStamp=t,a.detail=l.clickCount,a.pointerType==="mouse"){const h=a.button===2;this.dispatchEvent(a,h?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(i)}mapPointerUpOutside(e){if(!(e instanceof qt)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),i=this.findMountedTarget(t.pressTargetsByButton[e.button]),r=this.createPointerEvent(e);if(i){let n=i;for(;n;)r.currentTarget=n,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch"?this.notifyTarget(r,"touchendoutside"):(r.pointerType==="mouse"||r.pointerType==="pen")&&this.notifyTarget(r,r.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(r)}mapWheel(e){if(!(e instanceof Zs)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let i=1;i<e.length&&e[i].parent===t;i++)t=e[i];return t}createPointerEvent(e,t,i){const r=this.allocateEvent(qt);return this.copyPointerData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.nativeEvent=e.nativeEvent,r.originalEvent=e,r.target=i??this.hitTest(r.global.x,r.global.y)??this._hitElements[0],typeof t=="string"&&(r.type=t),r}createWheelEvent(e){const t=this.allocateEvent(Zs);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const i=this.allocateEvent(qt);return i.nativeEvent=e.nativeEvent,i.originalEvent=e.originalEvent,this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.target=e.target,i.path=e.composedPath().slice(),i.type=t??i.type,i}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof qt&&t instanceof qt&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof qn&&t instanceof qn&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const i=e.currentTarget._events[t];if(i&&e.currentTarget.isInteractive())if("fn"in i)i.once&&e.currentTarget.removeListener(t,i.fn,void 0,!0),i.fn.call(i.context,e);else for(let r=0,n=i.length;r<n&&!e.propagationImmediatelyStopped;r++)i[r].once&&e.currentTarget.removeListener(t,i[r].fn,void 0,!0),i[r].fn.call(i[r].context,e)}}const UT=1,HT={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},dl=class fl{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new kT(null),Bi.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new qt(null),this.rootWheelEvent=new Zs(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...fl.defaultEventFeatures},{set:(t,i,r)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=r),t[i]=r,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:t,resolution:i}=this.renderer;this.setTargetElement(t),this.resolution=i,fl._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const i=this.cursorStyles[e];if(i)switch(typeof i){case"string":t&&(this.domElement.style.cursor=i);break;case"function":i(e);break;case"object":t&&Object.assign(this.domElement.style,i);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let i=0,r=t.length;i<r;i++){const n=t[i],o=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Bi.pointerMoved();const t=this.normalizeToPointerData(e);for(let i=0,r=t.length;i<r;i++){const n=this.bootstrapEvent(this.rootPointerEvent,t[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const i=t!==this.domElement?"outside":"",r=this.normalizeToPointerData(e);for(let n=0,o=r.length;n<o;n++){const a=this.bootstrapEvent(this.rootPointerEvent,r[n]);a.type+=i,this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);for(let i=0,r=t.length;i<r;i++){const n=this.bootstrapEvent(this.rootPointerEvent,t[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,Bi.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Bi.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Bi.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,i){const r=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;e.x=(t-r.left)*(this.domElement.width/r.width)*n,e.y=(i-r.top)*(this.domElement.height/r.height)*n}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let i=0,r=e.changedTouches.length;i<r;i++){const n=e.changedTouches[i];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=e.type,t.push(n)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const i=e;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=UT),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,t.push(i)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=HT[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};dl.extension={name:"events",type:[se.RendererSystem,se.CanvasRendererSystem]},dl.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let pl=dl;he.add(pl);function qu(s){return s==="dynamic"||s==="static"}const GT={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??qu(pl.defaultEventMode)},set interactive(s){Ae("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=s,this.eventMode=s?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??pl.defaultEventMode},set eventMode(s){this._internalInteractive=qu(s),this._internalEventMode=s},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(s,e,t){const i=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,r=typeof t=="object"?t.signal:void 0,n=typeof t=="object"?t.once===!0:!1,o=typeof e=="function"?void 0:e;s=i?`${s}capture`:s;const a=typeof e=="function"?e:e.handleEvent,l=this;r&&r.addEventListener("abort",()=>{l.off(s,a,o)}),n?l.once(s,a,o):l.on(s,a,o)},removeEventListener(s,e,t){const i=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,r=typeof e=="function"?void 0:e;s=i?`${s}capture`:s,e=typeof e=="function"?e:e.handleEvent,this.off(s,e,r)},dispatchEvent(s){if(!(s instanceof Gr))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return s.defaultPrevented=!1,s.path=null,s.target=this,s.manager.dispatchEvent(s),!s.defaultPrevented}};$e.mixin(GT);const zT={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};$e.mixin(zT);const VT=9,un=100,XT=0,WT=0,Zu=2,Ku=1,jT=-1e3,YT=-1e3,qT=2;class Pf{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(wi.tablet||wi.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width=`${un}px`,t.style.height=`${un}px`,t.style.position="absolute",t.style.top=`${XT}px`,t.style.left=`${WT}px`,t.style.zIndex=Zu.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width=`${Ku}px`,e.style.height=`${Ku}px`,e.style.position="absolute",e.style.top=`${jT}px`,e.style.left=`${YT}px`,e.style.zIndex=qT.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(e=this.renderer.view.parentNode)==null||e.appendChild(this.div))}deactivate(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(e=this.div.parentNode)==null||e.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let i=0;i<t.length;i++)this.updateAccessibleObjects(t[i])}update(){const e=performance.now();if(wi.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:i,width:r,height:n}=this.renderer.view.getBoundingClientRect(),{width:o,height:a,resolution:l}=this.renderer,h=r/o*l,u=n/a*l;let c=this.div;c.style.left=`${t}px`,c.style.top=`${i}px`,c.style.width=`${o}px`,c.style.height=`${a}px`;for(let d=0;d<this.children.length;d++){const f=this.children[d];if(f.renderId!==this.renderId)f._accessibleActive=!1,Ys(this.children,d,1),this.div.removeChild(f._accessibleDiv),this.pool.push(f._accessibleDiv),f._accessibleDiv=null,d--;else{c=f._accessibleDiv;let p=f.hitArea;const m=f.worldTransform;f.hitArea?(c.style.left=`${(m.tx+p.x*m.a)*h}px`,c.style.top=`${(m.ty+p.y*m.d)*u}px`,c.style.width=`${p.width*m.a*h}px`,c.style.height=`${p.height*m.d*u}px`):(p=f.getBounds(),this.capHitArea(p),c.style.left=`${p.x*h}px`,c.style.top=`${p.y*u}px`,c.style.width=`${p.width*h}px`,c.style.height=`${p.height*u}px`,c.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(c.title=f.accessibleTitle),c.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&c.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==c.title||f.tabIndex!==c.tabIndex)&&(c.title=f.accessibleTitle,c.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:i}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>i&&(e.height=i-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=`${un}px`,t.style.height=`${un}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=Zu.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:i}=e.target,r=this.renderer.events.rootBoundary,n=Object.assign(new Gr(r),{target:i});r.rootTarget=this.renderer.lastObjectRendered,t.forEach(o=>r.dispatchEvent(n,o))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===VT&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Pf.extension={name:"accessibility",type:[se.RendererPlugin,se.CanvasRendererPlugin]};he.add(Pf);const Mf=class ml{constructor(e){this.stage=new ti,e=Object.assign({forceCanvas:!1},e),this.renderer=xf(e),ml._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){var e;return(e=this.renderer)==null?void 0:e.view}get screen(){var e;return(e=this.renderer)==null?void 0:e.screen}destroy(e,t){const i=ml._plugins.slice(0);i.reverse(),i.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Mf._plugins=[];let ZT=Mf;he.handleByList(se.Application,ZT._plugins);class If{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let t,i;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:n}=this._resizeTo;t=r,i=n}this.renderer.resize(t,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}If.extension=se.Application;he.add(If);const Qu={loader:se.LoadParser,resolver:se.ResolveParser,cache:se.CacheParser,detection:se.DetectionParser};he.handle(se.Asset,s=>{const e=s.ref;Object.entries(Qu).filter(([t])=>!!e[t]).forEach(([t,i])=>he.add(Object.assign(e[t],{extension:e[t].extension??i})))},s=>{const e=s.ref;Object.keys(Qu).filter(t=>!!e[t]).forEach(t=>he.remove(e[t]))});class KT{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<t;i++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function rr(s,e){if(Array.isArray(e)){for(const t of e)if(s.startsWith(`data:${t}`))return!0;return!1}return s.startsWith(`data:${e}`)}function $i(s,e){const t=s.split("?")[0],i=yt.extname(t).toLowerCase();return Array.isArray(e)?e.includes(i):i===e}const Zt=(s,e,t=!1)=>(Array.isArray(s)||(s=[s]),e?s.map(i=>typeof i=="string"||t?e(i):i):s),gl=(s,e)=>{const t=e.split("?")[1];return t&&(s+=`?${t}`),s};function Of(s,e,t,i,r){const n=e[t];for(let o=0;o<n.length;o++){const a=n[o];t<e.length-1?Of(s.replace(i[t],a),e,t+1,i,r):r.push(s.replace(i[t],a))}}function QT(s){const e=/\{(.*?)\}/g,t=s.match(e),i=[];if(t){const r=[];t.forEach(n=>{const o=n.substring(1,n.length-1).split(",");r.push(o)}),Of(s,r,0,t,i)}else i.push(s);return i}const Zn=s=>!Array.isArray(s);class JT{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const i=Zt(e);let r;for(let a=0;a<this.parsers.length;a++){const l=this.parsers[a];if(l.test(t)){r=l.getCacheableAssets(i,t);break}}r||(r={},i.forEach(a=>{r[a]=t}));const n=Object.keys(r),o={cacheKeys:n,keys:i};if(i.forEach(a=>{this._cacheMap.set(a,o)}),n.forEach(a=>{const l=r?r[a]:t;this._cache.has(a)&&this._cache.get(a)!==l&&console.warn("[Cache] already has key:",a),this._cache.set(a,r[a])}),t instanceof le){const a=t;i.forEach(l=>{a.baseTexture!==le.EMPTY.baseTexture&&we.addToCache(a.baseTexture,l),le.addToCache(a,l)})}}remove(e){if(!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}const t=this._cacheMap.get(e);t.cacheKeys.forEach(i=>{this._cache.delete(i)}),t.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const us=new JT;class $T{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,i)=>(this._parsersValidated=!1,e[t]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const i={promise:null,parser:null};return i.promise=(async()=>{var r,n;let o=null,a=null;if(t.loadParser&&(a=this._parserHash[t.loadParser],a||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!a){for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];if(h.load&&(r=h.test)!=null&&r.call(h,e,t,this)){a=h;break}}if(!a)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}o=await a.load(e,t,this),i.parser=a;for(let l=0;l<this.parsers.length;l++){const h=this.parsers[l];h.parse&&h.parse&&await((n=h.testParse)==null?void 0:n.call(h,o,t,this))&&(o=await h.parse(o,t,this)||o,i.parser=h)}return o})(),i}async load(e,t){this._parsersValidated||this._validateParsers();let i=0;const r={},n=Zn(e),o=Zt(e,h=>({alias:[h],src:h})),a=o.length,l=o.map(async h=>{const u=yt.toAbsolute(h.src);if(!r[h.src])try{this.promiseCache[u]||(this.promiseCache[u]=this._getLoadPromiseAndParser(u,h)),r[h.src]=await this.promiseCache[u].promise,t&&t(++i/a)}catch(c){throw delete this.promiseCache[u],delete r[h.src],new Error(`[Loader.load] Failed to load ${u}.
${c}`)}});return await Promise.all(l),n?r[o[0].src]:r}async unload(e){const t=Zt(e,i=>({alias:[i],src:i})).map(async i=>{var r,n;const o=yt.toAbsolute(i.src),a=this.promiseCache[o];if(a){const l=await a.promise;delete this.promiseCache[o],(n=(r=a.parser)==null?void 0:r.unload)==null||n.call(r,l,i,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t}),{})}}var oi=(s=>(s[s.Low=0]="Low",s[s.Normal=1]="Normal",s[s.High=2]="High",s))(oi||{});const e0=".json",t0="application/json",i0={extension:{type:se.LoadParser,priority:oi.Low},name:"loadJson",test(s){return rr(s,t0)||$i(s,e0)},async load(s){return await(await ne.ADAPTER.fetch(s)).json()}};he.add(i0);const s0=".txt",r0="text/plain",n0={name:"loadTxt",extension:{type:se.LoadParser,priority:oi.Low},test(s){return rr(s,r0)||$i(s,s0)},async load(s){return await(await ne.ADAPTER.fetch(s)).text()}};he.add(n0);const o0=["normal","bold","100","200","300","400","500","600","700","800","900"],a0=[".ttf",".otf",".woff",".woff2"],l0=["font/ttf","font/otf","font/woff","font/woff2"],h0=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function u0(s){const e=yt.extname(s),t=yt.basename(s,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1));let i=t.length>0;for(const n of t)if(!n.match(h0)){i=!1;break}let r=t.join(" ");return i||(r=`"${r.replace(/[\\"]/g,"\\$&")}"`),r}const c0=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function d0(s){return c0.test(s)?s:encodeURI(s)}const f0={extension:{type:se.LoadParser,priority:oi.Low},name:"loadWebFont",test(s){return rr(s,l0)||$i(s,a0)},async load(s,e){var t,i,r;const n=ne.ADAPTER.getFontFaceSet();if(n){const o=[],a=((t=e.data)==null?void 0:t.family)??u0(s),l=((r=(i=e.data)==null?void 0:i.weights)==null?void 0:r.filter(u=>o0.includes(u)))??["normal"],h=e.data??{};for(let u=0;u<l.length;u++){const c=l[u],d=new FontFace(a,`url(${d0(s)})`,{...h,weight:c});await d.load(),n.add(d),o.push(d)}return o.length===1?o[0]:o}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(s){(Array.isArray(s)?s:[s]).forEach(e=>ne.ADAPTER.getFontFaceSet().delete(e))}};he.add(f0);const p0=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let Ks=null,vl=class{constructor(){Ks||(Ks=URL.createObjectURL(new Blob([p0],{type:"application/javascript"}))),this.worker=new Worker(Ks)}};vl.revokeObjectURL=function(){Ks&&(URL.revokeObjectURL(Ks),Ks=null)};const m0=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let Qs=null;class Df{constructor(){Qs||(Qs=URL.createObjectURL(new Blob([m0],{type:"application/javascript"}))),this.worker=new Worker(Qs)}}Df.revokeObjectURL=function(){Qs&&(URL.revokeObjectURL(Qs),Qs=null)};let Ju=0,ma;class g0{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new vl;t.addEventListener("message",i=>{t.terminate(),vl.revokeObjectURL(),e(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){ma===void 0&&(ma=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<ma&&(this._createdWorkers++,e=new Df().worker,e.addEventListener("message",t=>{this.complete(t.data),this.returnWorker(t.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==void 0?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const i=new Promise((r,n)=>{this.queue.push({id:e,arguments:t,resolve:r,reject:n})});return this.next(),i}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),i=t.id;this.resolveHash[Ju]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:Ju++,id:i})}}const $u=new g0;function zr(s,e,t){s.resource.internal=!0;const i=new le(s),r=()=>{delete e.promiseCache[t],us.has(t)&&us.remove(t)};return i.baseTexture.once("destroyed",()=>{t in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),r())}),i.once("destroyed",()=>{s.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),r())}),i}const v0=[".jpeg",".jpg",".png",".webp",".avif"],y0=["image/jpeg","image/png","image/webp","image/avif"];async function x0(s){const e=await ne.ADAPTER.fetch(s);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${s}: ${e.status} ${e.statusText}`);const t=await e.blob();return await createImageBitmap(t)}const vo={name:"loadTextures",extension:{type:se.LoadParser,priority:oi.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(s){return rr(s,y0)||$i(s,v0)},async load(s,e,t){var i;const r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let n;r?this.config.preferWorkers&&await $u.isImageBitmapSupported()?n=await $u.loadImageBitmap(s):n=await x0(s):n=await new Promise((l,h)=>{const u=new Image;u.crossOrigin=this.config.crossOrigin,u.src=s,u.complete?l(u):(u.onload=()=>l(u),u.onerror=c=>h(c))});const o={...e.data};o.resolution??(o.resolution=Ai(s)),r&&((i=o.resourceOptions)==null?void 0:i.ownsImageBitmap)===void 0&&(o.resourceOptions={...o.resourceOptions},o.resourceOptions.ownsImageBitmap=!0);const a=new we(n,o);return a.resource.src=s,zr(a,t,s)},unload(s){s.destroy(!0)}};he.add(vo);const _0=".svg",T0="image/svg+xml",w0={extension:{type:se.LoadParser,priority:oi.High},name:"loadSVG",test(s){return rr(s,T0)||$i(s,_0)},async testParse(s){return ol.test(s)},async parse(s,e,t){var i;const r=new ol(s,(i=e==null?void 0:e.data)==null?void 0:i.resourceOptions);await r.load();const n=new we(r,{resolution:Ai(s),...e==null?void 0:e.data});return n.resource.src=e.src,zr(n,t,e.src)},async load(s,e){return(await ne.ADAPTER.fetch(s)).text()},unload:vo.unload};he.add(w0);const E0=[".mp4",".m4v",".webm",".ogv"],b0=["video/mp4","video/webm","video/ogg"],S0={name:"loadVideo",extension:{type:se.LoadParser,priority:oi.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(s){return rr(s,b0)||$i(s,E0)},async load(s,e,t){var i;let r;const n=await(await ne.ADAPTER.fetch(s)).blob(),o=URL.createObjectURL(n);try{const a={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(i=e==null?void 0:e.data)==null?void 0:i.resourceOptions,autoLoad:!0},l=new Af(o,a);await l.load();const h=new we(l,{alphaMode:await Ix(),resolution:Ai(s),...e==null?void 0:e.data});h.resource.src=s,r=zr(h,t,s),r.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(o)})}catch(a){throw URL.revokeObjectURL(o),a}return r},unload(s){s.destroy(!0)}};he.add(S0);class A0{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(t[i])}`).join("&")}}getAlias(e){const{alias:t,name:i,src:r,srcs:n}=e;return Zt(t||i||r||n,o=>typeof o=="string"?o:Array.isArray(o)?o.map(a=>(a==null?void 0:a.src)??(a==null?void 0:a.srcs)??a):o!=null&&o.src||o!=null&&o.srcs?o.src??o.srcs:o,!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(e,t){const i=[];Array.isArray(t)?t.forEach(r=>{const n=r.src??r.srcs,o=r.alias??r.name;let a;if(typeof o=="string"){const l=this._createBundleAssetId(e,o);i.push(l),a=[o,l]}else{const l=o.map(h=>this._createBundleAssetId(e,h));i.push(...l),a=[...o,...l]}this.add({...r,alias:a,src:n})}):Object.keys(t).forEach(r=>{const n=[r,this._createBundleAssetId(e,r)];if(typeof t[r]=="string")this.add({alias:n,src:t[r]});else if(Array.isArray(t[r]))this.add({alias:n,src:t[r]});else{const o=t[r],a=o.src??o.srcs;this.add({...o,alias:n,src:Array.isArray(a)?a:[a]})}i.push(...n)}),this._bundles[e]=i}add(e,t,i,r,n){const o=[];typeof e=="string"||Array.isArray(e)&&typeof e[0]=="string"?(Ae("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),o.push({alias:e,src:t,data:i,format:r,loadParser:n})):Array.isArray(e)?o.push(...e):o.push(e);let a;a=l=>{this.hasKey(l)&&console.warn(`[Resolver] already has key: ${l} overwriting`)},Zt(o).forEach(l=>{const{src:h,srcs:u}=l;let{data:c,format:d,loadParser:f}=l;const p=Zt(h||u).map(v=>typeof v=="string"?QT(v):Array.isArray(v)?v:[v]),m=this.getAlias(l);Array.isArray(m)?m.forEach(a):a(m);const g=[];p.forEach(v=>{v.forEach(x=>{let _={};if(typeof x!="object"){_.src=x;for(let E=0;E<this._parsers.length;E++){const R=this._parsers[E];if(R.test(x)){_=R.parse(x);break}}}else c=x.data??c,d=x.format??d,f=x.loadParser??f,_={..._,...x};if(!m)throw new Error(`[Resolver] alias is undefined for this asset: ${_.src}`);_=this.buildResolvedAsset(_,{aliases:m,data:c,format:d,loadParser:f}),g.push(_)})}),m.forEach(v=>{this._assetMap[v]=g})})}resolveBundle(e){const t=Zn(e);e=Zt(e);const i={};return e.forEach(r=>{const n=this._bundles[r];if(n){const o=this.resolve(n),a={};for(const l in o){const h=o[l];a[this._extractAssetIdFromBundle(r,l)]=h}i[r]=a}}),t?i[e[0]]:i}resolveUrl(e){const t=this.resolve(e);if(typeof e!="string"){const i={};for(const r in t)i[r]=t[r].src;return i}return t.src}resolve(e){const t=Zn(e);e=Zt(e);const i={};return e.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let n=this._assetMap[r];const o=n[0],a=this._getPreferredOrder(n);a==null||a.priority.forEach(l=>{a.params[l].forEach(h=>{const u=n.filter(c=>c[l]?c[l]===h:!1);u.length&&(n=u)})}),this._resolverHash[r]=n[0]??o}else this._resolverHash[r]=this.buildResolvedAsset({alias:[r],src:r},{});i[r]=this._resolverHash[r]}),t?i[e[0]]:i}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const i=e[0],r=this._preferredOrder.find(n=>n.params.format.includes(i.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}buildResolvedAsset(e,t){const{aliases:i,data:r,loadParser:n,format:o}=t;return(this._basePath||this._rootPath)&&(e.src=yt.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=i??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...r||{},...e.data},e.loadParser=n??e.loadParser,e.format=o??e.format??yt.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}class R0{constructor(){this._detections=[],this._initialized=!1,this.resolver=new A0,this.loader=new $T,this.cache=us,this._backgroundLoader=new KT(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){var t,i;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let a=e.manifest;typeof a=="string"&&(a=await this.load(a)),this.resolver.addManifest(a)}const r=((t=e.texturePreference)==null?void 0:t.resolution)??1,n=typeof r=="number"?[r]:r,o=await this._detectFormats({preferredFormats:(i=e.texturePreference)==null?void 0:i.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:o,resolution:n}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,i,r,n){this.resolver.add(e,t,i,r,n)}async load(e,t){this._initialized||await this.init();const i=Zn(e),r=Zt(e).map(a=>{if(typeof a!="string"){const l=this.resolver.getAlias(a);return l.some(h=>!this.resolver.hasKey(h))&&this.add(a),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),n=this.resolver.resolve(r),o=await this._mapLoadToResolve(n,t);return i?o[r[0]]:o}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let i=!1;typeof e=="string"&&(i=!0,e=[e]);const r=this.resolver.resolveBundle(e),n={},o=Object.keys(r);let a=0,l=0;const h=()=>{t==null||t(++a/l)},u=o.map(c=>{const d=r[c];return l+=Object.keys(d).length,this._mapLoadToResolve(d,h).then(f=>{n[c]=f})});return await Promise.all(u),i?n[e[0]]:n}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return us.get(e);const t={};for(let i=0;i<e.length;i++)t[i]=us.get(e[i]);return t}async _mapLoadToResolve(e,t){const i=Object.values(e),r=Object.keys(e);this._backgroundLoader.active=!1;const n=await this.loader.load(i,t);this._backgroundLoader.active=!0;const o={};return i.forEach((a,l)=>{const h=n[a.src],u=[a.src];a.alias&&u.push(...a.alias),o[r[l]]=h,us.set(u,h)}),o}async unload(e){this._initialized||await this.init();const t=Zt(e).map(r=>typeof r!="string"?r.src:r),i=this.resolver.resolve(t);await this._unloadFromResolved(i)}async unloadBundle(e){this._initialized||await this.init(),e=Zt(e);const t=this.resolver.resolveBundle(e),i=Object.keys(t).map(r=>this._unloadFromResolved(t[r]));await Promise.all(i)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(i=>{us.remove(i.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const i of e.detections)e.skipDetections||await i.test()?t=await i.add(t):e.skipDetections||(t=await i.remove(t));return t=t.filter((i,r)=>t.indexOf(i)===r),t}get detections(){return this._detections}get preferWorkers(){return vo.config.preferWorkers}set preferWorkers(e){Ae("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(i=>i in e).forEach(i=>{t.config[i]=e[i]})})}}const cn=new R0;he.handleByList(se.LoadParser,cn.loader.parsers).handleByList(se.ResolveParser,cn.resolver.parsers).handleByList(se.CacheParser,cn.cache.parsers).handleByList(se.DetectionParser,cn.detections);const C0={extension:se.CacheParser,test:s=>Array.isArray(s)&&s.every(e=>e instanceof le),getCacheableAssets:(s,e)=>{const t={};return s.forEach(i=>{e.forEach((r,n)=>{t[i+(n===0?"":n+1)]=r})}),t}};he.add(C0);async function Nf(s){if("Image"in globalThis)return new Promise(e=>{const t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=s});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(s)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const P0={extension:{type:se.DetectionParser,priority:1},test:async()=>Nf("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async s=>[...s,"avif"],remove:async s=>s.filter(e=>e!=="avif")};he.add(P0);const M0={extension:{type:se.DetectionParser,priority:0},test:async()=>Nf("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async s=>[...s,"webp"],remove:async s=>s.filter(e=>e!=="webp")};he.add(M0);const ec=["png","jpg","jpeg"],I0={extension:{type:se.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async s=>[...s,...ec],remove:async s=>s.filter(e=>!ec.includes(e))};he.add(I0);const O0="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Xl(s){return O0?!1:document.createElement("video").canPlayType(s)!==""}const D0={extension:{type:se.DetectionParser,priority:0},test:async()=>Xl("video/webm"),add:async s=>[...s,"webm"],remove:async s=>s.filter(e=>e!=="webm")};he.add(D0);const N0={extension:{type:se.DetectionParser,priority:0},test:async()=>Xl("video/mp4"),add:async s=>[...s,"mp4","m4v"],remove:async s=>s.filter(e=>e!=="mp4"&&e!=="m4v")};he.add(N0);const L0={extension:{type:se.DetectionParser,priority:0},test:async()=>Xl("video/ogg"),add:async s=>[...s,"ogv"],remove:async s=>s.filter(e=>e!=="ogv")};he.add(L0);const B0={extension:se.ResolveParser,test:vo.test,parse:s=>{var e;return{resolution:parseFloat(((e=ne.RETINA_PREFIX.exec(s))==null?void 0:e[1])??"1"),format:yt.extname(s).slice(1),src:s}}};he.add(B0);var Tt=(s=>(s[s.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",s[s.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",s[s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",s[s.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",s[s.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",s[s.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",s[s.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",s[s.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",s[s.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",s[s.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",s[s.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",s[s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",s[s.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",s[s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",s[s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",s[s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",s[s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",s[s.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",s[s.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",s[s.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",s[s.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",s[s.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",s[s.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",s[s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",s[s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",s[s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",s))(Tt||{});const Kn={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let hi,Fs;function tc(){Fs={bptc:hi.getExtension("EXT_texture_compression_bptc"),astc:hi.getExtension("WEBGL_compressed_texture_astc"),etc:hi.getExtension("WEBGL_compressed_texture_etc"),s3tc:hi.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:hi.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:hi.getExtension("WEBGL_compressed_texture_pvrtc")||hi.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:hi.getExtension("WEBGL_compressed_texture_etc1"),atc:hi.getExtension("WEBGL_compressed_texture_atc")}}const F0={extension:{type:se.DetectionParser,priority:2},test:async()=>{const s=ne.ADAPTER.createCanvas().getContext("webgl");return s?(hi=s,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async s=>{Fs||tc();const e=[];for(const t in Fs)Fs[t]&&e.push(t);return[...e,...s]},remove:async s=>(Fs||tc(),s.filter(e=>!(e in Fs)))};he.add(F0);class k0 extends co{constructor(e,t={width:1,height:1,autoLoad:!0}){let i,r;typeof e=="string"?(i=e,r=new Uint8Array):(i=null,r=e),super(r,t),this.origin=i,this.buffer=r?new Ya(r):null,this._load=null,this.loaded=!1,this.origin!==null&&t.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new Ya(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)),this._load)}}class gs extends k0{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=gs._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||gs._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,i){const r=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;r.pixelStorei(r.UNPACK_ALIGNMENT,4);for(let n=0,o=this.levels;n<o;n++){const{levelID:a,levelWidth:l,levelHeight:h,levelBuffer:u}=this._levelBuffers[n];r.compressedTexImage2D(r.TEXTURE_2D,a,this.format,l,h,0,u)}return!0}onBlobLoaded(){this._levelBuffers=gs._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e===36196)return"etc1";if(e===35986||e===35987||e===34798)return"atc";if(e>=36492&&e<=36495)return"bptc";if(e===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,i,r,n,o,a){const l=new Array(i);let h=e.byteOffset,u=o,c=a,d=u+r-1&~(r-1),f=c+n-1&~(n-1),p=d*f*Kn[t];for(let m=0;m<i;m++)l[m]={levelID:m,levelWidth:i>1?u:d,levelHeight:i>1?c:f,levelBuffer:new Uint8Array(e.buffer,h,p)},h+=p,u=u>>1||1,c=c>>1||1,d=u+r-1&~(r-1),f=c+n-1&~(n-1),p=d*f*Kn[t];return l}}const ga=4,dn=124,U0=32,ic=20,H0=542327876,fn={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},G0={FOURCC:2},pn={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},z0=1,V0=2,X0=4,W0=64,j0=512,Y0=131072,q0=827611204,Z0=861165636,K0=894720068,Q0=808540228,J0=4,$0={[q0]:Tt.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Z0]:Tt.COMPRESSED_RGBA_S3TC_DXT3_EXT,[K0]:Tt.COMPRESSED_RGBA_S3TC_DXT5_EXT},ew={70:Tt.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Tt.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Tt.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Tt.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Tt.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Tt.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Tt.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Tt.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Tt.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:Tt.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:Tt.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:Tt.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:Tt.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function tw(s){const e=new Uint32Array(s);if(e[0]!==H0)throw new Error("Invalid DDS file magic word");const t=new Uint32Array(s,0,dn/Uint32Array.BYTES_PER_ELEMENT),i=t[fn.HEIGHT],r=t[fn.WIDTH],n=t[fn.MIPMAP_COUNT],o=new Uint32Array(s,fn.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,U0/Uint32Array.BYTES_PER_ELEMENT),a=o[z0];if(a&X0){const l=o[G0.FOURCC];if(l!==Q0){const x=$0[l],_=ga+dn,E=new Uint8Array(s,_);return[new gs(E,{format:x,width:r,height:i,levels:n})]}const h=ga+dn,u=new Uint32Array(e.buffer,h,ic/Uint32Array.BYTES_PER_ELEMENT),c=u[pn.DXGI_FORMAT],d=u[pn.RESOURCE_DIMENSION],f=u[pn.MISC_FLAG],p=u[pn.ARRAY_SIZE],m=ew[c];if(m===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(f===J0)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");const g=new Array,v=ga+dn+ic;if(p===1)g.push(new Uint8Array(s,v));else{const x=Kn[m];let _=0,E=r,R=i;for(let O=0;O<n;O++){const N=Math.max(1,E+3&-4),B=Math.max(1,R+3&-4),G=N*B*x;_+=G,E=E>>>1,R=R>>>1}let M=v;for(let O=0;O<p;O++)g.push(new Uint8Array(s,M,_)),M+=_}return g.map(x=>new gs(x,{format:m,width:r,height:i,levels:n}))}throw a&W0?new Error("DDSParser does not support uncompressed texture data."):a&j0?new Error("DDSParser does not supported YUV uncompressed texture data."):a&Y0?new Error("DDSParser does not support single-channel (lumninance) texture data!"):a&V0?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const sc=[171,75,84,88,32,49,49,187,13,10,26,10],iw=67305985,jt={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},yl=64,rc={[fe.UNSIGNED_BYTE]:1,[fe.UNSIGNED_SHORT]:2,[fe.INT]:4,[fe.UNSIGNED_INT]:4,[fe.FLOAT]:4,[fe.HALF_FLOAT]:8},sw={[te.RGBA]:4,[te.RGB]:3,[te.RG]:2,[te.RED]:1,[te.LUMINANCE]:1,[te.LUMINANCE_ALPHA]:2,[te.ALPHA]:1},rw={[fe.UNSIGNED_SHORT_4_4_4_4]:2,[fe.UNSIGNED_SHORT_5_5_5_1]:2,[fe.UNSIGNED_SHORT_5_6_5]:2};function nw(s,e,t=!1){const i=new DataView(e);if(!ow(s,i))return null;const r=i.getUint32(jt.ENDIANNESS,!0)===iw,n=i.getUint32(jt.GL_TYPE,r),o=i.getUint32(jt.GL_FORMAT,r),a=i.getUint32(jt.GL_INTERNAL_FORMAT,r),l=i.getUint32(jt.PIXEL_WIDTH,r),h=i.getUint32(jt.PIXEL_HEIGHT,r)||1,u=i.getUint32(jt.PIXEL_DEPTH,r)||1,c=i.getUint32(jt.NUMBER_OF_ARRAY_ELEMENTS,r)||1,d=i.getUint32(jt.NUMBER_OF_FACES,r),f=i.getUint32(jt.NUMBER_OF_MIPMAP_LEVELS,r),p=i.getUint32(jt.BYTES_OF_KEY_VALUE_DATA,r);if(h===0||u!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(c!==1)throw new Error("WebGL does not support array textures");const m=4,g=4,v=l+3&-4,x=h+3&-4,_=new Array(c);let E=l*h;n===0&&(E=v*x);let R;if(n!==0?rc[n]?R=rc[n]*sw[o]:R=rw[n]:R=Kn[a],R===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const M=t?lw(i,p,r):null;let O=E*R,N=l,B=h,G=v,K=x,D=yl+p;for(let C=0;C<f;C++){const I=i.getUint32(D,r);let L=D+4;for(let W=0;W<c;W++){let U=_[W];U||(U=_[W]=new Array(f)),U[C]={levelID:C,levelWidth:f>1||n!==0?N:G,levelHeight:f>1||n!==0?B:K,levelBuffer:new Uint8Array(e,L,O)},L+=O}D+=I+4,D=D%4!==0?D+4-D%4:D,N=N>>1||1,B=B>>1||1,G=N+m-1&-4,K=B+g-1&-4,O=G*K*R}return n!==0?{uncompressed:_.map(C=>{let I=C[0].levelBuffer,L=!1;return n===fe.FLOAT?I=new Float32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4):n===fe.UNSIGNED_INT?(L=!0,I=new Uint32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4)):n===fe.INT&&(L=!0,I=new Int32Array(C[0].levelBuffer.buffer,C[0].levelBuffer.byteOffset,C[0].levelBuffer.byteLength/4)),{resource:new co(I,{width:C[0].levelWidth,height:C[0].levelHeight}),type:n,format:L?aw(o):o}}),kvData:M}:{compressed:_.map(C=>new gs(null,{format:a,width:l,height:h,levels:f,levelBuffers:C})),kvData:M}}function ow(s,e){for(let t=0;t<sc.length;t++)if(e.getUint8(t)!==sc[t])return console.error(`${s} is not a valid *.ktx file!`),!1;return!0}function aw(s){switch(s){case te.RGBA:return te.RGBA_INTEGER;case te.RGB:return te.RGB_INTEGER;case te.RG:return te.RG_INTEGER;case te.RED:return te.RED_INTEGER;default:return s}}function lw(s,e,t){const i=new Map;let r=0;for(;r<e;){const n=s.getUint32(yl+r,t),o=yl+r+4,a=3-(n+3)%4;if(n===0||n>e-r){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let l=0;for(;l<n&&s.getUint8(o+l)!==0;l++);if(l===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const h=new TextDecoder().decode(new Uint8Array(s.buffer,o,l)),u=new DataView(s.buffer,o+l+1,n-l-1);i.set(h,u),r+=4+n+a}return i}const hw={extension:{type:se.LoadParser,priority:oi.High},name:"loadDDS",test(s){return $i(s,".dds")},async load(s,e,t){const i=await(await ne.ADAPTER.fetch(s)).arrayBuffer(),r=tw(i).map(n=>{const o=new we(n,{mipmap:vi.OFF,alphaMode:Ct.NO_PREMULTIPLIED_ALPHA,resolution:Ai(s),...e.data});return zr(o,t,s)});return r.length===1?r[0]:r},unload(s){Array.isArray(s)?s.forEach(e=>e.destroy(!0)):s.destroy(!0)}};he.add(hw);const uw={extension:{type:se.LoadParser,priority:oi.High},name:"loadKTX",test(s){return $i(s,".ktx")},async load(s,e,t){const i=await(await ne.ADAPTER.fetch(s)).arrayBuffer(),{compressed:r,uncompressed:n,kvData:o}=nw(s,i),a=r??n,l={mipmap:vi.OFF,alphaMode:Ct.NO_PREMULTIPLIED_ALPHA,resolution:Ai(s),...e.data},h=a.map(u=>{a===n&&Object.assign(l,{type:u.type,format:u.format});const c=u.resource??u,d=new we(c,l);return d.ktxKeyValueData=o,zr(d,t,s)});return h.length===1?h[0]:h},unload(s){Array.isArray(s)?s.forEach(e=>e.destroy(!0)):s.destroy(!0)}};he.add(uw);const cw=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],dw={extension:se.ResolveParser,test:s=>{const e=yt.extname(s).slice(1);return["basis","ktx","dds"].includes(e)},parse:s=>{var e,t;const i=s.split("."),r=i.pop();if(["ktx","dds"].includes(r)){const n=i.pop();if(cw.includes(n))return{resolution:parseFloat(((e=ne.RETINA_PREFIX.exec(s))==null?void 0:e[1])??"1"),format:n,src:s}}return{resolution:parseFloat(((t=ne.RETINA_PREFIX.exec(s))==null?void 0:t[1])??"1"),format:r,src:s}}};he.add(dw);const mn=new Ee,fw=4,Lf=class vr{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(e,t,i,r){const n=new Image;return n.src=await this.base64(e,t,i,r),n}async base64(e,t,i,r){const n=this.canvas(e,r);if(n.toBlob!==void 0)return new Promise((o,a)=>{n.toBlob(l=>{if(!l){a(new Error("ICanvas.toBlob failed!"));return}const h=new FileReader;h.onload=()=>o(h.result),h.onerror=a,h.readAsDataURL(l)},t,i)});if(n.toDataURL!==void 0)return n.toDataURL(t,i);if(n.convertToBlob!==void 0){const o=await n.convertToBlob({type:t,quality:i});return new Promise((a,l)=>{const h=new FileReader;h.onload=()=>a(h.result),h.onerror=l,h.readAsDataURL(o)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:i,width:r,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,t);o&&vr._flipY(i,r,n),a&&vr._unpremultiplyAlpha(i);const l=new Yx(r,n,1),h=new ImageData(new Uint8ClampedArray(i.buffer),r,n);return l.context.putImageData(h,0,0),l.canvas}pixels(e,t){const{pixels:i,width:r,height:n,flipY:o,premultipliedAlpha:a}=this._rawPixels(e,t);return o&&vr._flipY(i,r,n),a&&vr._unpremultiplyAlpha(i),i}_rawPixels(e,t){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let r,n=!1,o=!1,a,l=!1;e&&(e instanceof Ts?a=e:(a=i.generateTexture(e,{region:t,resolution:i.resolution,multisample:i.multisample}),l=!0,t&&(mn.width=t.width,mn.height=t.height,t=mn)));const h=i.gl;if(a){if(r=a.baseTexture.resolution,t=t??a.frame,n=!1,o=a.baseTexture.alphaMode>0&&a.baseTexture.format===te.RGBA,!l){i.renderTexture.bind(a);const f=a.framebuffer.glFramebuffers[i.CONTEXT_UID];f.blitFramebuffer&&i.framebuffer.bind(f.blitFramebuffer)}}else r=i.resolution,t||(t=mn,t.width=i.width/r,t.height=i.height/r),n=!0,o=this._rendererPremultipliedAlpha,i.renderTexture.bind();const u=Math.max(Math.round(t.width*r),1),c=Math.max(Math.round(t.height*r),1),d=new Uint8Array(fw*u*c);return h.readPixels(Math.round(t.x*r),Math.round(t.y*r),u,c,h.RGBA,h.UNSIGNED_BYTE,d),l&&(a==null||a.destroy(!0)),{pixels:d,width:u,height:c,flipY:n,premultipliedAlpha:o}}destroy(){this.renderer=null}static _flipY(e,t,i){const r=t<<2,n=i>>1,o=new Uint8Array(r);for(let a=0;a<n;a++){const l=a*r,h=(i-a-1)*r;o.set(e.subarray(l,l+r)),e.copyWithin(l,h,h+r),e.set(o,h)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let i=0;i<t;i+=4){const r=e[i+3];if(r!==0){const n=255.001/r;e[i]=e[i]*n+.5,e[i+1]=e[i+1]*n+.5,e[i+2]=e[i+2]*n+.5}}}};Lf.extension={name:"extract",type:se.RendererSystem};let pw=Lf;he.add(pw);const Qn={build(s){const e=s.points;let t,i,r,n,o,a;if(s.type===wt.CIRC){const p=s.shape;t=p.x,i=p.y,o=a=p.radius,r=n=0}else if(s.type===wt.ELIP){const p=s.shape;t=p.x,i=p.y,o=p.width,a=p.height,r=n=0}else{const p=s.shape,m=p.width/2,g=p.height/2;t=p.x+m,i=p.y+g,o=a=Math.max(0,Math.min(p.radius,Math.min(m,g))),r=m-o,n=g-a}if(!(o>=0&&a>=0&&r>=0&&n>=0)){e.length=0;return}const l=Math.ceil(2.3*Math.sqrt(o+a)),h=l*8+(r?4:0)+(n?4:0);if(e.length=h,h===0)return;if(l===0){e.length=8,e[0]=e[6]=t+r,e[1]=e[3]=i+n,e[2]=e[4]=t-r,e[5]=e[7]=i-n;return}let u=0,c=l*4+(r?2:0)+2,d=c,f=h;{const p=r+o,m=n,g=t+p,v=t-p,x=i+m;if(e[u++]=g,e[u++]=x,e[--c]=x,e[--c]=v,n){const _=i-m;e[d++]=v,e[d++]=_,e[--f]=_,e[--f]=g}}for(let p=1;p<l;p++){const m=Math.PI/2*(p/l),g=r+Math.cos(m)*o,v=n+Math.sin(m)*a,x=t+g,_=t-g,E=i+v,R=i-v;e[u++]=x,e[u++]=E,e[--c]=E,e[--c]=_,e[d++]=_,e[d++]=R,e[--f]=R,e[--f]=x}{const p=r,m=n+a,g=t+p,v=t-p,x=i+m,_=i-m;e[u++]=g,e[u++]=x,e[--f]=_,e[--f]=g,r&&(e[u++]=v,e[u++]=x,e[--f]=_,e[--f]=v)}},triangulate(s,e){const t=s.points,i=e.points,r=e.indices;if(t.length===0)return;let n=i.length/2;const o=n;let a,l;if(s.type!==wt.RREC){const u=s.shape;a=u.x,l=u.y}else{const u=s.shape;a=u.x+u.width/2,l=u.y+u.height/2}const h=s.matrix;i.push(s.matrix?h.a*a+h.c*l+h.tx:a,s.matrix?h.b*a+h.d*l+h.ty:l),n++,i.push(t[0],t[1]);for(let u=2;u<t.length;u+=2)i.push(t[u],t[u+1]),r.push(n++,o,n);r.push(o+1,o,n)}};function nc(s,e=!1){const t=s.length;if(t<6)return;let i=0;for(let r=0,n=s[t-2],o=s[t-1];r<t;r+=2){const a=s[r],l=s[r+1];i+=(a-n)*(l+o),n=a,o=l}if(!e&&i>0||e&&i<=0){const r=t/2;for(let n=r+r%2;n<t;n+=2){const o=t-n-2,a=t-n-1,l=n,h=n+1;[s[o],s[l]]=[s[l],s[o]],[s[a],s[h]]=[s[h],s[a]]}}}const Bf={build(s){s.points=s.shape.points.slice()},triangulate(s,e){let t=s.points;const i=s.holes,r=e.points,n=e.indices;if(t.length>=6){nc(t,!1);const o=[];for(let h=0;h<i.length;h++){const u=i[h];nc(u.points,!0),o.push(t.length/2),t=t.concat(u.points)}const a=ny(t,o,2);if(!a)return;const l=r.length/2;for(let h=0;h<a.length;h+=3)n.push(a[h]+l),n.push(a[h+1]+l),n.push(a[h+2]+l);for(let h=0;h<t.length;h++)r.push(t[h])}}},mw={build(s){const e=s.shape,t=e.x,i=e.y,r=e.width,n=e.height,o=s.points;o.length=0,r>=0&&n>=0&&o.push(t,i,t+r,i,t+r,i+n,t,i+n)},triangulate(s,e){const t=s.points,i=e.points;if(t.length===0)return;const r=i.length/2;i.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},gw={build(s){Qn.build(s)},triangulate(s,e){Qn.triangulate(s,e)}};var Ft=(s=>(s.MITER="miter",s.BEVEL="bevel",s.ROUND="round",s))(Ft||{}),Gi=(s=>(s.BUTT="butt",s.ROUND="round",s.SQUARE="square",s))(Gi||{});const tr={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(s,e=20){if(!this.adaptive||!s||isNaN(s))return e;let t=Math.ceil(s/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}};class oc{static curveTo(e,t,i,r,n,o){const a=o[o.length-2],l=o[o.length-1]-t,h=a-e,u=r-t,c=i-e,d=Math.abs(l*c-h*u);if(d<1e-8||n===0)return(o[o.length-2]!==e||o[o.length-1]!==t)&&o.push(e,t),null;const f=l*l+h*h,p=u*u+c*c,m=l*u+h*c,g=n*Math.sqrt(f)/d,v=n*Math.sqrt(p)/d,x=g*m/f,_=v*m/p,E=g*c+v*h,R=g*u+v*l,M=h*(v+x),O=l*(v+x),N=c*(g+_),B=u*(g+_),G=Math.atan2(O-R,M-E),K=Math.atan2(B-R,N-E);return{cx:E+e,cy:R+t,radius:n,startAngle:G,endAngle:K,anticlockwise:h*u>c*l}}static arc(e,t,i,r,n,o,a,l,h){const u=a-o,c=tr._segmentsCount(Math.abs(u)*n,Math.ceil(Math.abs(u)/zn)*40),d=u/(c*2),f=d*2,p=Math.cos(d),m=Math.sin(d),g=c-1,v=g%1/g;for(let x=0;x<=g;++x){const _=x+v*x,E=d+o+f*_,R=Math.cos(E),M=-Math.sin(E);h.push((p*R+m*M)*n+i,(p*-M+m*R)*n+r)}}}class vw{constructor(){this.reset()}begin(e,t,i){this.reset(),this.style=e,this.start=t,this.attribStart=i}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class Wl{static curveLength(e,t,i,r,n,o,a,l){let h=0,u=0,c=0,d=0,f=0,p=0,m=0,g=0,v=0,x=0,_=0,E=e,R=t;for(let M=1;M<=10;++M)u=M/10,c=u*u,d=c*u,f=1-u,p=f*f,m=p*f,g=m*e+3*p*u*i+3*f*c*n+d*a,v=m*t+3*p*u*r+3*f*c*o+d*l,x=E-g,_=R-v,E=g,R=v,h+=Math.sqrt(x*x+_*_);return h}static curveTo(e,t,i,r,n,o,a){const l=a[a.length-2],h=a[a.length-1];a.length-=2;const u=tr._segmentsCount(Wl.curveLength(l,h,e,t,i,r,n,o));let c=0,d=0,f=0,p=0,m=0;a.push(l,h);for(let g=1,v=0;g<=u;++g)v=g/u,c=1-v,d=c*c,f=d*c,p=v*v,m=p*v,a.push(f*l+3*d*v*e+3*c*p*i+m*n,f*h+3*d*v*t+3*c*p*r+m*o)}}function ac(s,e,t,i,r,n,o,a){const l=s-t*r,h=e-i*r,u=s+t*n,c=e+i*n;let d,f;o?(d=i,f=-t):(d=-i,f=t);const p=l+d,m=h+f,g=u+d,v=c+f;return a.push(p,m,g,v),2}function ss(s,e,t,i,r,n,o,a){const l=t-s,h=i-e;let u=Math.atan2(l,h),c=Math.atan2(r-s,n-e);a&&u<c?u+=Math.PI*2:!a&&u>c&&(c+=Math.PI*2);let d=u;const f=c-u,p=Math.abs(f),m=Math.sqrt(l*l+h*h),g=(15*p*Math.sqrt(m)/Math.PI>>0)+1,v=f/g;if(d+=v,a){o.push(s,e,t,i);for(let x=1,_=d;x<g;x++,_+=v)o.push(s,e,s+Math.sin(_)*m,e+Math.cos(_)*m);o.push(s,e,r,n)}else{o.push(t,i,s,e);for(let x=1,_=d;x<g;x++,_+=v)o.push(s+Math.sin(_)*m,e+Math.cos(_)*m,s,e);o.push(r,n,s,e)}return g*2}function yw(s,e){const t=s.shape;let i=s.points||t.points.slice();const r=e.closePointEps;if(i.length===0)return;const n=s.lineStyle,o=new Ie(i[0],i[1]),a=new Ie(i[i.length-2],i[i.length-1]),l=t.type!==wt.POLY||t.closeStroke,h=Math.abs(o.x-a.x)<r&&Math.abs(o.y-a.y)<r;if(l){i=i.slice(),h&&(i.pop(),i.pop(),a.set(i[i.length-2],i[i.length-1]));const U=(o.x+a.x)*.5,V=(a.y+o.y)*.5;i.unshift(U,V),i.push(U,V)}const u=e.points,c=i.length/2;let d=i.length;const f=u.length/2,p=n.width/2,m=p*p,g=n.miterLimit*n.miterLimit;let v=i[0],x=i[1],_=i[2],E=i[3],R=0,M=0,O=-(x-E),N=v-_,B=0,G=0,K=Math.sqrt(O*O+N*N);O/=K,N/=K,O*=p,N*=p;const D=n.alignment,C=(1-D)*2,I=D*2;l||(n.cap===Gi.ROUND?d+=ss(v-O*(C-I)*.5,x-N*(C-I)*.5,v-O*C,x-N*C,v+O*I,x+N*I,u,!0)+2:n.cap===Gi.SQUARE&&(d+=ac(v,x,O,N,C,I,!0,u))),u.push(v-O*C,x-N*C,v+O*I,x+N*I);for(let U=1;U<c-1;++U){v=i[(U-1)*2],x=i[(U-1)*2+1],_=i[U*2],E=i[U*2+1],R=i[(U+1)*2],M=i[(U+1)*2+1],O=-(x-E),N=v-_,K=Math.sqrt(O*O+N*N),O/=K,N/=K,O*=p,N*=p,B=-(E-M),G=_-R,K=Math.sqrt(B*B+G*G),B/=K,G/=K,B*=p,G*=p;const V=_-v,ie=x-E,k=_-R,F=M-E,Z=V*k+ie*F,Q=ie*k-F*V,ae=Q<0;if(Math.abs(Q)<.001*Math.abs(Z)){u.push(_-O*C,E-N*C,_+O*I,E+N*I),Z>=0&&(n.join===Ft.ROUND?d+=ss(_,E,_-O*C,E-N*C,_-B*C,E-G*C,u,!1)+4:d+=2,u.push(_-B*I,E-G*I,_+B*C,E+G*C));continue}const de=(-O+v)*(-N+E)-(-O+_)*(-N+x),be=(-B+R)*(-G+E)-(-B+_)*(-G+M),De=(V*be-k*de)/Q,Be=(F*de-ie*be)/Q,Ye=(De-_)*(De-_)+(Be-E)*(Be-E),Ce=_+(De-_)*C,Pe=E+(Be-E)*C,Oe=_-(De-_)*I,He=E-(Be-E)*I,qe=Math.min(V*V+ie*ie,k*k+F*F),ot=ae?C:I,tt=qe+ot*ot*m,y=Ye<=tt;let A=n.join;if(A===Ft.MITER&&Ye/m>g&&(A=Ft.BEVEL),y)switch(A){case Ft.MITER:{u.push(Ce,Pe,Oe,He);break}case Ft.BEVEL:{ae?u.push(Ce,Pe,_+O*I,E+N*I,Ce,Pe,_+B*I,E+G*I):u.push(_-O*C,E-N*C,Oe,He,_-B*C,E-G*C,Oe,He),d+=2;break}case Ft.ROUND:{ae?(u.push(Ce,Pe,_+O*I,E+N*I),d+=ss(_,E,_+O*I,E+N*I,_+B*I,E+G*I,u,!0)+4,u.push(Ce,Pe,_+B*I,E+G*I)):(u.push(_-O*C,E-N*C,Oe,He),d+=ss(_,E,_-O*C,E-N*C,_-B*C,E-G*C,u,!1)+4,u.push(_-B*C,E-G*C,Oe,He));break}}else{switch(u.push(_-O*C,E-N*C,_+O*I,E+N*I),A){case Ft.MITER:{ae?u.push(Oe,He,Oe,He):u.push(Ce,Pe,Ce,Pe),d+=2;break}case Ft.ROUND:{ae?d+=ss(_,E,_+O*I,E+N*I,_+B*I,E+G*I,u,!0)+2:d+=ss(_,E,_-O*C,E-N*C,_-B*C,E-G*C,u,!1)+2;break}}u.push(_-B*C,E-G*C,_+B*I,E+G*I),d+=2}}v=i[(c-2)*2],x=i[(c-2)*2+1],_=i[(c-1)*2],E=i[(c-1)*2+1],O=-(x-E),N=v-_,K=Math.sqrt(O*O+N*N),O/=K,N/=K,O*=p,N*=p,u.push(_-O*C,E-N*C,_+O*I,E+N*I),l||(n.cap===Gi.ROUND?d+=ss(_-O*(C-I)*.5,E-N*(C-I)*.5,_-O*C,E-N*C,_+O*I,E+N*I,u,!1)+2:n.cap===Gi.SQUARE&&(d+=ac(_,E,O,N,C,I,!1,u)));const L=e.indices,W=tr.epsilon*tr.epsilon;for(let U=f;U<d+f-2;++U)v=u[U*2],x=u[U*2+1],_=u[(U+1)*2],E=u[(U+1)*2+1],R=u[(U+2)*2],M=u[(U+2)*2+1],!(Math.abs(v*(E-M)+_*(M-x)+R*(x-E))<W)&&L.push(U,U+1,U+2)}function xw(s,e){let t=0;const i=s.shape,r=s.points||i.points,n=i.type!==wt.POLY||i.closeStroke;if(r.length===0)return;const o=e.points,a=e.indices,l=r.length/2,h=o.length/2;let u=h;for(o.push(r[0],r[1]),t=1;t<l;t++)o.push(r[t*2],r[t*2+1]),a.push(u,u+1),u++;n&&a.push(u,h)}function lc(s,e){s.lineStyle.native?xw(s,e):yw(s,e)}class jl{static curveLength(e,t,i,r,n,o){const a=e-2*i+n,l=t-2*r+o,h=2*i-2*e,u=2*r-2*t,c=4*(a*a+l*l),d=4*(a*h+l*u),f=h*h+u*u,p=2*Math.sqrt(c+d+f),m=Math.sqrt(c),g=2*c*m,v=2*Math.sqrt(f),x=d/m;return(g*p+m*d*(p-v)+(4*f*c-d*d)*Math.log((2*m+x+p)/(x+v)))/(4*g)}static curveTo(e,t,i,r,n){const o=n[n.length-2],a=n[n.length-1],l=tr._segmentsCount(jl.curveLength(o,a,e,t,i,r));let h=0,u=0;for(let c=1;c<=l;++c){const d=c/l;h=o+(e-o)*d,u=a+(t-a)*d,n.push(h+(e+(i-e)*d-h)*d,u+(t+(r-t)*d-u)*d)}}}const va={[wt.POLY]:Bf,[wt.CIRC]:Qn,[wt.ELIP]:Qn,[wt.RECT]:mw,[wt.RREC]:gw},hc=[],gn=[];class Jn{constructor(e,t=null,i=null,r=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=i,this.fillStyle=t,this.matrix=r,this.type=e.type}clone(){return new Jn(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const Ps=new Ie,Ff=class kf extends Gd{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Yn,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),gn.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),hc.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,i=null,r=null){const n=new Jn(e,t,i,r);return this.graphicsData.push(n),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const i=new Jn(e,null,null,t),r=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=r.lineStyle,r.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let i=0;i<t.length;++i){const r=t[i];if(r.fillStyle.visible&&r.shape&&(r.matrix?r.matrix.applyInverse(e,Ps):Ps.copyFrom(e),r.shape.contains(Ps.x,Ps.y))){let n=!1;if(r.holes){for(let o=0;o<r.holes.length;o++)if(r.holes[o].shape.contains(Ps.x,Ps.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let i=null,r=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],r=i.style);for(let l=this.shapeIndex;l<t.length;l++){this.shapeIndex++;const h=t[l],u=h.fillStyle,c=h.lineStyle;va[h.type].build(h),h.matrix&&this.transformPoints(h.points,h.matrix),(u.visible||c.visible)&&this.processHoles(h.holes);for(let d=0;d<2;d++){const f=d===0?u:c;if(!f.visible)continue;const p=f.texture.baseTexture,m=this.indices.length,g=this.points.length/2;p.wrapMode=Vi.REPEAT,d===0?this.processFill(h):this.processLine(h);const v=this.points.length/2-g;v!==0&&(i&&!this._compareStyles(r,f)&&(i.end(m,g),i=null),i||(i=hc.pop()||new vw,i.begin(f,m,g),this.batches.push(i),r=f),this.addUvs(this.points,e,f.texture,g,v,f.matrix))}}const n=this.indices.length,o=this.points.length/2;if(i&&i.end(n,o),this.batches.length===0){this.batchable=!0;return}const a=o>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const i=this.graphicsData[e],r=i.fillStyle,n=i.lineStyle;if(r&&!r.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,i=e.length;t<i;t++){const r=e[t];for(let n=0;n<r.size;n++){const o=r.start+n;this.indicesUint16[o]=this.indicesUint16[o]-r.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<kf.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++we._globalBatch;for(let c=0;c<this.drawCalls.length;c++)this.drawCalls[c].texArray.clear(),gn.push(this.drawCalls[c]);this.drawCalls.length=0;const t=this.colors,i=this.textureIds;let r=gn.pop();r||(r=new Ka,r.texArray=new el),r.texArray.count=0,r.start=0,r.size=0,r.type=fi.TRIANGLES;let n=0,o=null,a=0,l=!1,h=fi.TRIANGLES,u=0;this.drawCalls.push(r);for(let c=0;c<this.batches.length;c++){const d=this.batches[c],f=8,p=d.style,m=p.texture.baseTexture;l!==!!p.native&&(l=!!p.native,h=l?fi.LINES:fi.TRIANGLES,o=null,n=f,e++),o!==m&&(o=m,m._batchEnabled!==e&&(n===f&&(e++,n=0,r.size>0&&(r=gn.pop(),r||(r=new Ka,r.texArray=new el),this.drawCalls.push(r)),r.start=u,r.size=0,r.texArray.count=0,r.type=h),m.touched=1,m._batchEnabled=e,m._batchLocation=n,m.wrapMode=Vi.REPEAT,r.texArray.elements[r.texArray.count++]=m,n++)),r.size+=d.size,u+=d.size,a=m._batchLocation,this.addColors(t,p.color,p.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,a,d.attribSize,d.attribStart)}we._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,i=this.colors,r=this.textureIds,n=new ArrayBuffer(e.length*3*4),o=new Float32Array(n),a=new Uint32Array(n);let l=0;for(let h=0;h<e.length/2;h++)o[l++]=e[h*2],o[l++]=e[h*2+1],o[l++]=t[h*2],o[l++]=t[h*2+1],a[l++]=i[h],o[l++]=r[h];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?Bf.triangulate(e,this):va[e.type].triangulate(e,this)}processLine(e){lc(e,this);for(let t=0;t<e.holes.length;t++)lc(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const i=e[t];va[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let i=0;i<e.length/2;i++){const r=e[i*2],n=e[i*2+1];e[i*2]=t.a*r+t.c*n+t.tx,e[i*2+1]=t.b*r+t.d*n+t.ty}}addColors(e,t,i,r,n=0){const o=Ue.shared.setValue(t).toLittleEndianNumber(),a=Ue.shared.setValue(o).toPremultiplied(i);e.length=Math.max(e.length,n+r);for(let l=0;l<r;l++)e[n+l]=a}addTextureIds(e,t,i,r=0){e.length=Math.max(e.length,r+i);for(let n=0;n<i;n++)e[r+n]=t}addUvs(e,t,i,r,n,o=null){let a=0;const l=t.length,h=i.frame;for(;a<n;){let c=e[(r+a)*2],d=e[(r+a)*2+1];if(o){const f=o.a*c+o.c*d+o.tx;d=o.b*c+o.d*d+o.ty,c=f}a++,t.push(c/h.width,d/h.height)}const u=i.baseTexture;(h.width<u.width||h.height<u.height)&&this.adjustUvs(t,i,l,n)}adjustUvs(e,t,i,r){const n=t.baseTexture,o=1e-6,a=i+r*2,l=t.frame,h=l.width/n.width,u=l.height/n.height;let c=l.x/l.width,d=l.y/l.height,f=Math.floor(e[i]+o),p=Math.floor(e[i+1]+o);for(let m=i+2;m<a;m+=2)f=Math.min(f,Math.floor(e[m]+o)),p=Math.min(p,Math.floor(e[m+1]+o));c-=f,d-=p;for(let m=i;m<a;m+=2)e[m]=(e[m]+c)*h,e[m+1]=(e[m+1]+d)*u}};Ff.BATCHABLE_SIZE=100;let _w=Ff;class yo{constructor(){this.color=16777215,this.alpha=1,this.texture=le.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new yo;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=le.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Yl extends yo{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Gi.BUTT,this.join=Ft.MITER,this.miterLimit=10}clone(){const e=new Yl;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Gi.BUTT,this.join=Ft.MITER,this.miterLimit=10}}const ya={},xl=class In extends ti{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new yo,this._lineStyle=new Yl,this._matrix=null,this._holeMode=!1,this.state=yi.for2d(),this._geometry=e||new _w,this._geometry.refCount++,this._transformID=-1,this._tintColor=new Ue(16777215),this.blendMode=ye.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new In(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,i,r=.5,n=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:i,alignment:r,native:n}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:le.WHITE,color:e!=null&&e.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Gi.BUTT,join:Ft.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.width>0&&e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:i},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new ms,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new ms,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,r=i[i.length-2],n=i[i.length-1];return(r!==e||n!==t)&&i.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,i,r){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),jl.curveTo(e,t,i,r,n),this}bezierCurveTo(e,t,i,r,n,o){return this._initCurve(),Wl.curveTo(e,t,i,r,n,o,this.currentPath.points),this}arcTo(e,t,i,r,n){this._initCurve(e,t);const o=this.currentPath.points,a=oc.curveTo(e,t,i,r,n,o);if(a){const{cx:l,cy:h,radius:u,startAngle:c,endAngle:d,anticlockwise:f}=a;this.arc(l,h,u,c,d,f)}return this}arc(e,t,i,r,n,o=!1){if(r===n)return this;if(!o&&n<=r?n+=zn:o&&r<=n&&(r+=zn),n-r===0)return this;const a=e+Math.cos(r)*i,l=t+Math.sin(r)*i,h=this._geometry.closePointEps;let u=this.currentPath?this.currentPath.points:null;if(u){const c=Math.abs(u[u.length-2]-a),d=Math.abs(u[u.length-1]-l);c<h&&d<h||u.push(a,l)}else this.moveTo(a,l),u=this.currentPath.points;return oc.arc(a,l,e,t,i,r,n,o,u),this}beginFill(e=0,t){return this.beginTextureFill({texture:le.WHITE,color:e,alpha:t})}normalizeColor(e){const t=Ue.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:le.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:i},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,i,r){return this.drawShape(new Ee(e,t,i,r))}drawRoundedRect(e,t,i,r,n){return this.drawShape(new mo(e,t,i,r,n))}drawCircle(e,t,i){return this.drawShape(new fo(e,t,i))}drawEllipse(e,t,i,r){return this.drawShape(new po(e,t,i,r))}drawPolygon(...e){let t,i=!0;const r=e[0];r.points?(i=r.closeStroke,t=r.points):Array.isArray(e[0])?t=e[0]:t=e;const n=new ms(t);return n.closeStroke=i,this.drawShape(n),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===wt.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,i=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(e.points);for(let r=0;r<i;r++){const n=e.batches[r],o=n.style.color,a=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),l=new Float32Array(e.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),h=new Uint16Array(e.indicesUint16.buffer,n.start*2,n.size),u={vertexData:a,blendMode:t,indices:h,uvs:l,_batchRGB:Ue.shared.setValue(o).toRgbArray(),_tintRGB:o,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=u}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,i=this.batches.length;t<i;t++){const r=this.batches[t];r.worldAlpha=this.worldAlpha*r.alpha,e.plugins[this.pluginName].render(r)}}}_renderDirect(e){const t=this._resolveDirectShader(e),i=this._geometry,r=this.worldAlpha,n=t.uniforms,o=i.drawCalls;n.translationMatrix=this.transform.worldTransform,Ue.shared.setValue(this._tintColor).premultiply(r).toArray(n.tint),e.shader.bind(t),e.geometry.bind(i,t),e.state.set(this.state);for(let a=0,l=o.length;a<l;a++)this._renderDrawCallDirect(e,i.drawCalls[a])}_renderDrawCallDirect(e,t){const{texArray:i,type:r,size:n,start:o}=t,a=i.count;for(let l=0;l<a;l++)e.texture.bind(i.elements[l],l);e.geometry.draw(r,n,o)}_resolveDirectShader(e){let t=this.shader;const i=this.pluginName;if(!t){if(!ya[i]){const{maxTextures:r}=e.plugins[i],n=new Int32Array(r);for(let l=0;l<r;l++)n[l]=l;const o={tint:new Float32Array([1,1,1,1]),translationMatrix:new ze,default:$t.from({uSamplers:n},!0)},a=e.plugins[i]._shader.program;ya[i]=new gi(a,o)}t=ya[i]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:i,maxX:r,maxY:n}=e.bounds;this._bounds.addFrame(this.transform,t,i,r,n)}containsPoint(e){return this.worldTransform.applyInverse(e,In._TEMP_POINT),this._geometry.containsPoint(In._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=Ue.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,i=t.a,r=t.b,n=t.c,o=t.d,a=t.tx,l=t.ty,h=this._geometry.points,u=this.vertexData;let c=0;for(let d=0;d<h.length;d+=2){const f=h[d],p=h[d+1];u[c++]=i*f+n*p+a,u[c++]=o*p+r*f+l}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};xl.curves=tr,xl._TEMP_POINT=new Ie;let Nr=xl;class Tw{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const xa=new Ie,uc=new ms,Uf=class Hf extends ti{constructor(e,t,i,r=fi.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=i||yi.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=ne.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===fi.TRIANGLES&&t.length<Hf.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const r=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[r]),e.plugins[r].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,i=e._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const r=this.transform.worldTransform,n=r.a,o=r.b,a=r.c,l=r.d,h=r.tx,u=r.ty,c=this.vertexData;for(let d=0;d<c.length/2;d++){const f=t[d*2],p=t[d*2+1];c[d*2]=n*f+a*p+h,c[d*2+1]=o*f+l*p+u}if(this._roundPixels){const d=ne.RESOLUTION;for(let f=0;f<c.length;++f)c[f]=Math.round(c[f]*d)/d}this.vertexDirty=i}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new Tw(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,xa);const t=this.geometry.getBuffer("aVertexPosition").data,i=uc.points,r=this.geometry.getIndex().data,n=r.length,o=this.drawMode===4?3:1;for(let a=0;a+2<n;a+=o){const l=r[a]*2,h=r[a+1]*2,u=r[a+2]*2;if(i[0]=t[l],i[1]=t[l+1],i[2]=t[h],i[3]=t[h+1],i[4]=t[u],i[5]=t[u+1],uc.contains(xa.x,xa.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};Uf.BATCHABLE_SIZE=100;let cc=Uf;class ww extends ji{constructor(e,t,i){super();const r=new st(e),n=new st(t,!0),o=new st(i,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,fe.FLOAT).addAttribute("aTextureCoord",n,2,!1,fe.FLOAT).addIndex(o),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var Ew=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,bw=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class dc extends gi{constructor(e,t){const i={uSampler:e,alpha:1,uTextureMatrix:ze.IDENTITY,uColor:new Float32Array([1,1,1,1])};t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t),t.uniforms&&Object.assign(i,t.uniforms),super(t.program||bi.from(bw,Ew),i),this._colorDirty=!1,this.uvMatrix=new tf(e),this.batchable=t.program===void 0,this.pluginName=t.pluginName,this._tintColor=new Ue(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;Ue.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class fc{constructor(e,t,i){this.geometry=new ji,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<e.length;++r){let n=e[r];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||fe.FLOAT,offset:n.offset},t[r]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new st(Wx(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];a.offset=t,t+=a.size,this.dynamicStride+=a.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new st(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];a.offset=r,r+=a.size,this.staticStride+=a.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new st(this.staticData,!0,!1);for(let o=0;o<this.dynamicProperties.length;++o){const a=this.dynamicProperties[o];e.addAttribute(a.attributeName,this.dynamicBuffer,0,a.type===fe.UNSIGNED_BYTE,a.type,this.dynamicStride*4,a.offset*4)}for(let o=0;o<this.staticProperties.length;++o){const a=this.staticProperties[o];e.addAttribute(a.attributeName,this.staticBuffer,0,a.type===fe.UNSIGNED_BYTE,a.type,this.staticStride*4,a.offset*4)}}uploadDynamic(e,t,i){for(let r=0;r<this.dynamicProperties.length;r++){const n=this.dynamicProperties[r];n.uploadFunction(e,t,i,n.type===fe.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,i){for(let r=0;r<this.staticProperties.length;r++){const n=this.staticProperties[r];n.uploadFunction(e,t,i,n.type===fe.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var Sw=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,Aw=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Gf extends go{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new ze,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:fe.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=gi.from(Aw,Sw,{}),this.state=yi.for2d()}render(e){const t=e.children,i=e._maxSize,r=e._batchSize,n=this.renderer;let o=t.length;if(o===0)return;o>i&&!e.autoResize&&(o=i);let a=e._buffers;a||(a=e._buffers=this.generateBuffers(e));const l=t[0]._texture.baseTexture,h=l.alphaMode>0;this.state.blendMode=kd(e.blendMode,h),n.state.set(this.state);const u=n.gl,c=e.worldTransform.copyTo(this.tempMatrix);c.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Ue.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,h).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=l,this.renderer.shader.bind(this.shader);let d=!1;for(let f=0,p=0;f<o;f+=r,p+=1){let m=o-f;m>r&&(m=r),p>=a.length&&a.push(this._generateOneMoreBuffer(e));const g=a[p];g.uploadDynamic(t,f,m);const v=e._bufferUpdateIDs[p]||0;d=d||g._updateID<v,d&&(g._updateID=e._updateID,g.uploadStatic(t,f,m)),n.geometry.bind(g.geometry),u.drawElements(u.TRIANGLES,m*6,u.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],i=e._maxSize,r=e._batchSize,n=e._properties;for(let o=0;o<i;o+=r)t.push(new fc(this.properties,n,r));return t}_generateOneMoreBuffer(e){const t=e._batchSize,i=e._properties;return new fc(this.properties,i,t)}uploadVertices(e,t,i,r,n,o){let a=0,l=0,h=0,u=0;for(let c=0;c<i;++c){const d=e[t+c],f=d._texture,p=d.scale.x,m=d.scale.y,g=f.trim,v=f.orig;g?(l=g.x-d.anchor.x*v.width,a=l+g.width,u=g.y-d.anchor.y*v.height,h=u+g.height):(a=v.width*(1-d.anchor.x),l=v.width*-d.anchor.x,h=v.height*(1-d.anchor.y),u=v.height*-d.anchor.y),r[o]=l*p,r[o+1]=u*m,r[o+n]=a*p,r[o+n+1]=u*m,r[o+n*2]=a*p,r[o+n*2+1]=h*m,r[o+n*3]=l*p,r[o+n*3+1]=h*m,o+=n*4}}uploadPosition(e,t,i,r,n,o){for(let a=0;a<i;a++){const l=e[t+a].position;r[o]=l.x,r[o+1]=l.y,r[o+n]=l.x,r[o+n+1]=l.y,r[o+n*2]=l.x,r[o+n*2+1]=l.y,r[o+n*3]=l.x,r[o+n*3+1]=l.y,o+=n*4}}uploadRotation(e,t,i,r,n,o){for(let a=0;a<i;a++){const l=e[t+a].rotation;r[o]=l,r[o+n]=l,r[o+n*2]=l,r[o+n*3]=l,o+=n*4}}uploadUvs(e,t,i,r,n,o){for(let a=0;a<i;++a){const l=e[t+a]._texture._uvs;l?(r[o]=l.x0,r[o+1]=l.y0,r[o+n]=l.x1,r[o+n+1]=l.y1,r[o+n*2]=l.x2,r[o+n*2+1]=l.y2,r[o+n*3]=l.x3,r[o+n*3+1]=l.y3,o+=n*4):(r[o]=0,r[o+1]=0,r[o+n]=0,r[o+n+1]=0,r[o+n*2]=0,r[o+n*2+1]=0,r[o+n*3]=0,r[o+n*3+1]=0,o+=n*4)}}uploadTint(e,t,i,r,n,o){for(let a=0;a<i;++a){const l=e[t+a],h=Ue.shared.setValue(l._tintRGB).toPremultiplied(l.alpha,l.texture.baseTexture.alphaMode>0);r[o]=h,r[o+n]=h,r[o+n*2]=h,r[o+n*3]=h,o+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Gf.extension={name:"particle",type:se.RendererPlugin};he.add(Gf);var xo=(s=>(s[s.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",s[s.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",s))(xo||{});const vn={willReadFrequently:!0},ui=class ue{static get experimentalLetterSpacingSupported(){let e=ue._experimentalLetterSpacingSupported;if(e!==void 0){const t=ne.ADAPTER.getCanvasRenderingContext2D().prototype;e=ue._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,i,r,n,o,a,l,h){this.text=e,this.style=t,this.width=i,this.height=r,this.lines=n,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=h}static measureText(e,t,i,r=ue._canvas){i=i??t.wordWrap;const n=t.toFontString(),o=ue.measureFont(n);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);const a=r.getContext("2d",vn);a.font=n;const l=(i?ue.wordWrap(e,t,r):e).split(/(?:\r\n|\r|\n)/),h=new Array(l.length);let u=0;for(let p=0;p<l.length;p++){const m=ue._measureText(l[p],t.letterSpacing,a);h[p]=m,u=Math.max(u,m)}let c=u+t.strokeThickness;t.dropShadow&&(c+=t.dropShadowDistance);const d=t.lineHeight||o.fontSize+t.strokeThickness;let f=Math.max(d,o.fontSize+t.strokeThickness*2)+t.leading+(l.length-1)*(d+t.leading);return t.dropShadow&&(f+=t.dropShadowDistance),new ue(e,t,c,f,l,h,d+t.leading,u,o)}static _measureText(e,t,i){let r=!1;ue.experimentalLetterSpacingSupported&&(ue.experimentalLetterSpacing?(i.letterSpacing=`${t}px`,i.textLetterSpacing=`${t}px`,r=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let n=i.measureText(e).width;return n>0&&(r?n-=t:n+=(ue.graphemeSegmenter(e).length-1)*t),n}static wordWrap(e,t,i=ue._canvas){const r=i.getContext("2d",vn);let n=0,o="",a="";const l=Object.create(null),{letterSpacing:h,whiteSpace:u}=t,c=ue.collapseSpaces(u),d=ue.collapseNewlines(u);let f=!c;const p=t.wordWrapWidth+h,m=ue.tokenize(e);for(let g=0;g<m.length;g++){let v=m[g];if(ue.isNewline(v)){if(!d){a+=ue.addLine(o),f=!c,o="",n=0;continue}v=" "}if(c){const _=ue.isBreakingSpace(v),E=ue.isBreakingSpace(o[o.length-1]);if(_&&E)continue}const x=ue.getFromCache(v,h,l,r);if(x>p)if(o!==""&&(a+=ue.addLine(o),o="",n=0),ue.canBreakWords(v,t.breakWords)){const _=ue.wordWrapSplit(v);for(let E=0;E<_.length;E++){let R=_[E],M=R,O=1;for(;_[E+O];){const B=_[E+O];if(!ue.canBreakChars(M,B,v,E,t.breakWords))R+=B;else break;M=B,O++}E+=O-1;const N=ue.getFromCache(R,h,l,r);N+n>p&&(a+=ue.addLine(o),f=!1,o="",n=0),o+=R,n+=N}}else{o.length>0&&(a+=ue.addLine(o),o="",n=0);const _=g===m.length-1;a+=ue.addLine(v,!_),f=!1,o="",n=0}else x+n>p&&(f=!1,a+=ue.addLine(o),o="",n=0),(o.length>0||!ue.isBreakingSpace(v)||f)&&(o+=v,n+=x)}return a+=ue.addLine(o,!1),a}static addLine(e,t=!0){return e=ue.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,i,r){let n=i[e];return typeof n!="number"&&(n=ue._measureText(e,t,r)+t,i[e]=n),n}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const i=e[t];if(!ue.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:ue._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:ue._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let i="";if(typeof e!="string")return t;for(let r=0;r<e.length;r++){const n=e[r],o=e[r+1];if(ue.isBreakingSpace(n,o)||ue.isNewline(n)){i!==""&&(t.push(i),i=""),t.push(n);continue}i+=n}return i!==""&&t.push(i),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,i,r,n){return!0}static wordWrapSplit(e){return ue.graphemeSegmenter(e)}static measureFont(e){if(ue._fonts[e])return ue._fonts[e];const t={ascent:0,descent:0,fontSize:0},i=ue._canvas,r=ue._context;r.font=e;const n=ue.METRICS_STRING+ue.BASELINE_SYMBOL,o=Math.ceil(r.measureText(n).width);let a=Math.ceil(r.measureText(ue.BASELINE_SYMBOL).width);const l=Math.ceil(ue.HEIGHT_MULTIPLIER*a);if(a=a*ue.BASELINE_MULTIPLIER|0,o===0||l===0)return ue._fonts[e]=t,t;i.width=o,i.height=l,r.fillStyle="#f00",r.fillRect(0,0,o,l),r.font=e,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(n,0,a);const h=r.getImageData(0,0,o,l).data,u=h.length,c=o*4;let d=0,f=0,p=!1;for(d=0;d<a;++d){for(let m=0;m<c;m+=4)if(h[f+m]!==255){p=!0;break}if(!p)f+=c;else break}for(t.ascent=a-d,f=u-c,p=!1,d=l;d>a;--d){for(let m=0;m<c;m+=4)if(h[f+m]!==255){p=!0;break}if(!p)f-=c;else break}return t.descent=d-a,t.fontSize=t.ascent+t.descent,ue._fonts[e]=t,t}static clearMetrics(e=""){e?delete ue._fonts[e]:ue._fonts={}}static get _canvas(){var e;if(!ue.__canvas){let t;try{const i=new OffscreenCanvas(0,0);if((e=i.getContext("2d",vn))!=null&&e.measureText)return ue.__canvas=i,i;t=ne.ADAPTER.createCanvas()}catch{t=ne.ADAPTER.createCanvas()}t.width=t.height=10,ue.__canvas=t}return ue.__canvas}static get _context(){return ue.__context||(ue.__context=ue._canvas.getContext("2d",vn)),ue.__context}};ui.METRICS_STRING="|q",ui.BASELINE_SYMBOL="M",ui.BASELINE_MULTIPLIER=1.4,ui.HEIGHT_MULTIPLIER=2,ui.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const s=new Intl.Segmenter;return e=>[...s.segment(e)].map(t=>t.segment)}return s=>[...s]})(),ui.experimentalLetterSpacing=!1,ui._fonts={},ui._newlines=[10,13],ui._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Di=ui;const Rw=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],zf=class yr{constructor(e){this.styleID=0,this.reset(),Ta(this,e,e)}clone(){const e={};return Ta(e,this,yr.defaultStyle),new yr(e)}reset(){Ta(this,yr.defaultStyle,yr.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=_a(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=_a(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){Cw(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=_a(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let i=t.length-1;i>=0;i--){let r=t[i].trim();!/([\"\'])[^\'\"]+\1/.test(r)&&!Rw.includes(r)&&(r=`"${r}"`),t[i]=r}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};zf.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:xo.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Yi=zf;function _a(s){const e=Ue.shared,t=i=>{const r=e.setValue(i);return r.alpha===1?r.toHex():r.toRgbaString()};return Array.isArray(s)?s.map(t):t(s)}function Cw(s,e){if(!Array.isArray(s)||!Array.isArray(e)||s.length!==e.length)return!1;for(let t=0;t<s.length;++t)if(s[t]!==e[t])return!1;return!0}function Ta(s,e,t){for(const i in t)Array.isArray(e[i])?s[i]=e[i].slice():s[i]=e[i]}const Pw={texture:!0,children:!1,baseTexture:!0},Vf=class _l extends sr{constructor(e,t,i){let r=!1;i||(i=ne.ADAPTER.createCanvas(),r=!0),i.width=3,i.height=3;const n=le.from(i);n.orig=new Ee,n.trim=new Ee,super(n),this._ownCanvas=r,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=_l.defaultResolution??ne.RESOLUTION,this._autoResolution=_l.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return Di.experimentalLetterSpacing}static set experimentalLetterSpacing(e){Ae("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Di.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const i=this.context,r=Di.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=r.width,o=r.height,a=r.lines,l=r.lineHeight,h=r.lineWidths,u=r.maxLineWidth,c=r.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,o)+t.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=t.strokeThickness,i.textBaseline=t.textBaseline,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit;let d,f;const p=t.dropShadow?2:1;for(let m=0;m<p;++m){const g=t.dropShadow&&m===0,v=g?Math.ceil(Math.max(1,o)+t.padding*2):0,x=v*this._resolution;if(g){i.fillStyle="black",i.strokeStyle="black";const E=t.dropShadowColor,R=t.dropShadowBlur*this._resolution,M=t.dropShadowDistance*this._resolution;i.shadowColor=Ue.shared.setValue(E).setAlpha(t.dropShadowAlpha).toRgbaString(),i.shadowBlur=R,i.shadowOffsetX=Math.cos(t.dropShadowAngle)*M,i.shadowOffsetY=Math.sin(t.dropShadowAngle)*M+x}else i.fillStyle=this._generateFillStyle(t,a,r),i.strokeStyle=t.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let _=(l-c.fontSize)/2;l-c.fontSize<0&&(_=0);for(let E=0;E<a.length;E++)d=t.strokeThickness/2,f=t.strokeThickness/2+E*l+c.ascent+_,t.align==="right"?d+=u-h[E]:t.align==="center"&&(d+=(u-h[E])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(a[E],d+t.padding,f+t.padding-v,!0),t.fill&&this.drawLetterSpacing(a[E],d+t.padding,f+t.padding-v)}this.updateTexture()}drawLetterSpacing(e,t,i,r=!1){const n=this._style.letterSpacing;let o=!1;if(Di.experimentalLetterSpacingSupported&&(Di.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,o=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||o){r?this.context.strokeText(e,t,i):this.context.fillText(e,t,i);return}let a=t;const l=Di.graphemeSegmenter(e);let h=this.context.measureText(e).width,u=0;for(let c=0;c<l.length;++c){const d=l[c];r?this.context.strokeText(d,a,i):this.context.fillText(d,a,i);let f="";for(let p=c+1;p<l.length;++p)f+=l[p];u=this.context.measureText(f).width,a+=h-u+n,h=u}}updateTexture(){const e=this.canvas;if(this._style.trim){const o=Zx(e);o.data&&(e.width=o.width,e.height=o.height,this.context.putImageData(o.data,0,0))}const t=this._texture,i=this._style,r=i.trim?0:i.padding,n=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-r,t.trim.y=-r,t.orig.width=t._frame.width-r*2,t.orig.height=t._frame.height-r*2,this._onTextureUpdate(),n.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,i){const r=e.fill;if(Array.isArray(r)){if(r.length===1)return r[0]}else return r;let n;const o=e.dropShadow?e.dropShadowDistance:0,a=e.padding||0,l=this.canvas.width/this._resolution-o-a*2,h=this.canvas.height/this._resolution-o-a*2,u=r.slice(),c=e.fillGradientStops.slice();if(!c.length){const d=u.length+1;for(let f=1;f<d;++f)c.push(f/d)}if(u.unshift(r[0]),c.unshift(0),u.push(r[r.length-1]),c.push(1),e.fillGradientType===xo.LINEAR_VERTICAL){n=this.context.createLinearGradient(l/2,a,l/2,h+a);const d=i.fontProperties.fontSize+e.strokeThickness;for(let f=0;f<t.length;f++){const p=i.lineHeight*(f-1)+d,m=i.lineHeight*f;let g=m;f>0&&p>m&&(g=(m+p)/2);const v=m+d,x=i.lineHeight*(f+1);let _=v;f+1<t.length&&x<v&&(_=(v+x)/2);const E=(_-g)/h;for(let R=0;R<u.length;R++){let M=0;typeof c[R]=="number"?M=c[R]:M=R/u.length;let O=Math.min(1,Math.max(0,g/h+M*E));O=Number(O.toFixed(5)),n.addColorStop(O,u[R])}}}else{n=this.context.createLinearGradient(a,h/2,l+a,h/2);const d=u.length+1;let f=1;for(let p=0;p<u.length;p++){let m;typeof c[p]=="number"?m=c[p]:m=f/d,n.addColorStop(m,u[p]),f++}}return n}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Pw,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=Hi(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=Hi(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof Yi?this._style=e:this._style=new Yi(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};Vf.defaultAutoResolution=!0;let Xf=Vf;class Mw{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Iw(s,e){var t;let i=!1;if((t=s==null?void 0:s._textures)!=null&&t.length){for(let r=0;r<s._textures.length;r++)if(s._textures[r]instanceof le){const n=s._textures[r].baseTexture;e.includes(n)||(e.push(n),i=!0)}}return i}function Ow(s,e){if(s.baseTexture instanceof we){const t=s.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function Dw(s,e){if(s._texture&&s._texture instanceof le){const t=s._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function Nw(s,e){return e instanceof Xf?(e.updateText(!0),!0):!1}function Lw(s,e){if(e instanceof Yi){const t=e.toFontString();return Di.measureFont(t),!0}return!1}function Bw(s,e){if(s instanceof Xf){e.includes(s.style)||e.push(s.style),e.includes(s)||e.push(s);const t=s._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function Fw(s,e){return s instanceof Yi?(e.includes(s)||e.push(s),!0):!1}const Wf=class jf{constructor(e){this.limiter=new Mw(jf.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Bw),this.registerFindHook(Fw),this.registerFindHook(Iw),this.registerFindHook(Ow),this.registerFindHook(Dw),this.registerUploadHook(Nw),this.registerUploadHook(Lw)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,Lt.system.addOnce(this.tick,this,xs.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let i=0,r=this.uploadHooks.length;i<r;i++)if(this.uploadHooks[i](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Lt.system.addOnce(this.tick,this,xs.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,i=e.length;t<i;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,i=this.addHooks.length;t<i&&!this.addHooks[t](e,this.queue);t++);if(e instanceof ti)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&Lt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};Wf.uploadsPerFrame=4;let Tl=Wf;Object.defineProperties(ne,{UPLOADS_PER_FRAME:{get(){return Tl.uploadsPerFrame},set(s){Ae("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Tl.uploadsPerFrame=s}}});function Yf(s,e){return e instanceof we?(e._glTextures[s.CONTEXT_UID]||s.texture.bind(e),!0):!1}function kw(s,e){if(!(e instanceof Nr))return!1;const{geometry:t}=e;e.finishPoly(),t.updateBatches();const{batches:i}=t;for(let r=0;r<i.length;r++){const{texture:n}=i[r].style;n&&Yf(s,n.baseTexture)}return t.batchable||s.geometry.bind(t,e._resolveDirectShader(s)),!0}function Uw(s,e){return s instanceof Nr?(e.push(s),!0):!1}class qf extends Tl{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(Uw),this.registerUploadHook(Yf),this.registerUploadHook(kw)}}qf.extension={name:"prepare",type:se.RendererSystem};he.add(qf);var Hw=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,Gw=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,zw=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,pc=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Vw=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const yn=new ze;class Zf extends go{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new Qd,this.state=yi.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=gi.from(pc,Vw,t),this.shader=e.context.webGLVersion>1?gi.from(Gw,Hw,t):gi.from(pc,zw,t)}render(e){const t=this.renderer,i=this.quad;let r=i.vertices;r[0]=r[6]=e._width*-e.anchor.x,r[1]=r[3]=e._height*-e.anchor.y,r[2]=r[4]=e._width*(1-e.anchor.x),r[5]=r[7]=e._height*(1-e.anchor.y);const n=e.uvRespectAnchor?e.anchor.x:0,o=e.uvRespectAnchor?e.anchor.y:0;r=i.uvs,r[0]=r[6]=-n,r[1]=r[3]=-o,r[2]=r[4]=1-n,r[5]=r[7]=1-o,i.invalidate();const a=e._texture,l=a.baseTexture,h=l.alphaMode>0,u=e.tileTransform.localTransform,c=e.uvMatrix;let d=l.isPowerOfTwo&&a.frame.width===l.width&&a.frame.height===l.height;d&&(l._glTextures[t.CONTEXT_UID]?d=l.wrapMode!==Vi.CLAMP:l.wrapMode===Vi.CLAMP&&(l.wrapMode=Vi.REPEAT));const f=d?this.simpleShader:this.shader,p=a.width,m=a.height,g=e._width,v=e._height;yn.set(u.a*p/g,u.b*p/v,u.c*m/g,u.d*m/v,u.tx/g,u.ty/v),yn.invert(),d?yn.prepend(c.mapCoord):(f.uniforms.uMapCoord=c.mapCoord.toArray(!0),f.uniforms.uClampFrame=c.uClampFrame,f.uniforms.uClampOffset=c.uClampOffset),f.uniforms.uTransform=yn.toArray(!0),f.uniforms.uColor=Ue.shared.setValue(e.tint).premultiply(e.worldAlpha,h).toArray(f.uniforms.uColor),f.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),f.uniforms.uSampler=a,t.shader.bind(f),t.geometry.bind(i),this.state.blendMode=kd(e.blendMode,h),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Zf.extension={name:"tilingSprite",type:se.RendererPlugin};he.add(Zf);const Kf=class xr{constructor(e,t,i){this.linkedSheets=[],(e instanceof we||e instanceof le)&&(e={texture:e,data:t,resolutionFilename:i});const{texture:r,data:n,resolutionFilename:o=null,cachePrefix:a=""}=e;this.cachePrefix=a,this._texture=r instanceof le?r:null,this.baseTexture=r instanceof we?r:this._texture.baseTexture,this.textures={},this.animations={},this.data=n;const l=this.baseTexture.resource;this.resolution=this._updateResolution(o||(l?l.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let i=Ai(e,null);return i===null&&(i=typeof t=="number"?t:parseFloat(t??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=xr.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const i=xr.BATCH_SIZE;for(;t-e<i&&t<this._frameKeys.length;){const r=this._frameKeys[t],n=this._frames[r],o=n.frame;if(o){let a=null,l=null;const h=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,u=new Ee(0,0,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution);n.rotated?a=new Ee(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new Ee(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(l=new Ee(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[r]=new le(this.baseTexture,a,u,l,n.rotated?2:0,n.anchor,n.borders),le.addToCache(this.textures[r],this.cachePrefix+r.toString())}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let i=0;i<e[t].length;i++){const r=e[t][i];this.animations[t].push(this.textures[r])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*xr.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*xr.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){var t;for(const i in this.textures)this.textures[i].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)==null||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};Kf.BATCH_SIZE=1e3;let mc=Kf;const Xw=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function Qf(s,e,t){const i={};if(s.forEach(r=>{i[r]=e}),Object.keys(e.textures).forEach(r=>{i[`${e.cachePrefix}${r}`]=e.textures[r]}),!t){const r=yt.dirname(s[0]);e.linkedSheets.forEach((n,o)=>{Object.assign(i,Qf([`${r}/${e.data.meta.related_multi_packs[o]}`],n,!0))})}return i}const Ww={extension:se.Asset,cache:{test:s=>s instanceof mc,getCacheableAssets:(s,e)=>Qf(s,e,!1)},resolver:{test:s=>{const e=s.split("?")[0].split("."),t=e.pop(),i=e.pop();return t==="json"&&Xw.includes(i)},parse:s=>{var e;const t=s.split(".");return{resolution:parseFloat(((e=ne.RETINA_PREFIX.exec(s))==null?void 0:e[1])??"1"),format:t[t.length-2],src:s}}},loader:{name:"spritesheetLoader",extension:{type:se.LoadParser,priority:oi.Normal},async testParse(s,e){return yt.extname(e.src).toLowerCase()===".json"&&!!s.frames},async parse(s,e,t){var i,r;const{texture:n,imageFilename:o,cachePrefix:a}=(e==null?void 0:e.data)??{};let l=yt.dirname(e.src);l&&l.lastIndexOf("/")!==l.length-1&&(l+="/");let h;if(n&&n.baseTexture)h=n;else{const d=gl(l+(o??s.meta.image),e.src);h=(await t.load([d]))[d]}const u=new mc({texture:h.baseTexture,data:s,resolutionFilename:e.src,cachePrefix:a});await u.parse();const c=(i=s==null?void 0:s.meta)==null?void 0:i.related_multi_packs;if(Array.isArray(c)){const d=[];for(const p of c){if(typeof p!="string")continue;let m=l+p;(r=e.data)!=null&&r.ignoreMultiPack||(m=gl(m,e.src),d.push(t.load({src:m,data:{ignoreMultiPack:!0}})))}const f=await Promise.all(d);u.linkedSheets=f,f.forEach(p=>{p.linkedSheets=[u].concat(u.linkedSheets.filter(m=>m!==p))})}return u},unload(s){s.destroy(!0)}}};he.add(Ww);class $n{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class On{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in t){const o=t[n].match(/^[a-z]+/gm)[0],a=t[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),l={};for(const h in a){const u=a[h].split("="),c=u[0],d=u[1].replace(/"/gm,""),f=parseFloat(d),p=isNaN(f)?d:f;l[c]=p}i[o].push(l)}const r=new $n;return i.info.forEach(n=>r.info.push({face:n.face,size:parseInt(n.size,10)})),i.common.forEach(n=>r.common.push({lineHeight:parseInt(n.lineHeight,10)})),i.page.forEach(n=>r.page.push({id:parseInt(n.id,10),file:n.file})),i.char.forEach(n=>r.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),i.kerning.forEach(n=>r.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),i.distanceField.forEach(n=>r.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),r}}class wl{static test(e){const t=e;return typeof e!="string"&&"getElementsByTagName"in e&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){const t=new $n,i=e.getElementsByTagName("info"),r=e.getElementsByTagName("common"),n=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),a=e.getElementsByTagName("kerning"),l=e.getElementsByTagName("distanceField");for(let h=0;h<i.length;h++)t.info.push({face:i[h].getAttribute("face"),size:parseInt(i[h].getAttribute("size"),10)});for(let h=0;h<r.length;h++)t.common.push({lineHeight:parseInt(r[h].getAttribute("lineHeight"),10)});for(let h=0;h<n.length;h++)t.page.push({id:parseInt(n[h].getAttribute("id"),10)||0,file:n[h].getAttribute("file")});for(let h=0;h<o.length;h++){const u=o[h];t.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(let h=0;h<a.length;h++)t.kerning.push({first:parseInt(a[h].getAttribute("first"),10),second:parseInt(a[h].getAttribute("second"),10),amount:parseInt(a[h].getAttribute("amount"),10)});for(let h=0;h<l.length;h++)t.distanceField.push({fieldType:l[h].getAttribute("fieldType"),distanceRange:parseInt(l[h].getAttribute("distanceRange"),10)});return t}}class El{static test(e){return typeof e=="string"&&e.includes("<font>")?wl.test(ne.ADAPTER.parseXML(e)):!1}static parse(e){return wl.parse(ne.ADAPTER.parseXML(e))}}const wa=[On,wl,El];function jw(s){for(let e=0;e<wa.length;e++)if(wa[e].test(s))return wa[e];return null}function Yw(s,e,t,i,r,n){const o=t.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;let a;const l=t.dropShadow?t.dropShadowDistance:0,h=t.padding||0,u=s.width/i-l-h*2,c=s.height/i-l-h*2,d=o.slice(),f=t.fillGradientStops.slice();if(!f.length){const p=d.length+1;for(let m=1;m<p;++m)f.push(m/p)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),t.fillGradientType===xo.LINEAR_VERTICAL){a=e.createLinearGradient(u/2,h,u/2,c+h);let p=0;const m=(n.fontProperties.fontSize+t.strokeThickness)/c;for(let g=0;g<r.length;g++){const v=n.lineHeight*g;for(let x=0;x<d.length;x++){let _=0;typeof f[x]=="number"?_=f[x]:_=x/d.length;const E=v/c+_*m;let R=Math.max(p,E);R=Math.min(R,1),a.addColorStop(R,d[x]),p=R}}}else{a=e.createLinearGradient(h,c/2,u+h,c/2);const p=d.length+1;let m=1;for(let g=0;g<d.length;g++){let v;typeof f[g]=="number"?v=f[g]:v=m/p,a.addColorStop(v,d[g]),m++}}return a}function qw(s,e,t,i,r,n,o){const a=t.text,l=t.fontProperties;e.translate(i,r),e.scale(n,n);const h=o.strokeThickness/2,u=-(o.strokeThickness/2);if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=Yw(s,e,o,n,[a],t),e.strokeStyle=o.stroke,o.dropShadow){const c=o.dropShadowColor,d=o.dropShadowBlur*n,f=o.dropShadowDistance*n;e.shadowColor=Ue.shared.setValue(c).setAlpha(o.dropShadowAlpha).toRgbaString(),e.shadowBlur=d,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*f,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*f}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,h,u+t.lineHeight-l.descent),o.fill&&e.fillText(a,h,u+t.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Dn(s){return s.codePointAt?s.codePointAt(0):s.charCodeAt(0)}function Jf(s){return Array.from?Array.from(s):s.split("")}function Zw(s){typeof s=="string"&&(s=[s]);const e=[];for(let t=0,i=s.length;t<i;t++){const r=s[t];if(Array.isArray(r)){if(r.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const n=r[0].charCodeAt(0),o=r[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,l=o;a<=l;a++)e.push(String.fromCharCode(a))}else e.push(...Jf(r))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const Mi=class ci{constructor(e,t,i){var r;const[n]=e.info,[o]=e.common,[a]=e.page,[l]=e.distanceField,h=Ai(a.file),u={};this._ownsTextures=i,this.font=n.face,this.size=n.size,this.lineHeight=o.lineHeight/h,this.chars={},this.pageTextures=u;for(let c=0;c<e.page.length;c++){const{id:d,file:f}=e.page[c];u[d]=t instanceof Array?t[c]:t[f],l!=null&&l.fieldType&&l.fieldType!=="none"&&(u[d].baseTexture.alphaMode=Ct.NO_PREMULTIPLIED_ALPHA,u[d].baseTexture.mipmap=vi.OFF)}for(let c=0;c<e.char.length;c++){const{id:d,page:f}=e.char[c];let{x:p,y:m,width:g,height:v,xoffset:x,yoffset:_,xadvance:E}=e.char[c];p/=h,m/=h,g/=h,v/=h,x/=h,_/=h,E/=h;const R=new Ee(p+u[f].frame.x/h,m+u[f].frame.y/h,g,v);this.chars[d]={xOffset:x,yOffset:_,xAdvance:E,kerning:{},texture:new le(u[f].baseTexture,R),page:f}}for(let c=0;c<e.kerning.length;c++){let{first:d,second:f,amount:p}=e.kerning[c];d/=h,f/=h,p/=h,this.chars[f]&&(this.chars[f].kerning[d]=p)}this.distanceFieldRange=l==null?void 0:l.distanceRange,this.distanceFieldType=((r=l==null?void 0:l.fieldType)==null?void 0:r.toLowerCase())??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,i){let r;if(e instanceof $n)r=e;else{const o=jw(e);if(!o)throw new Error("Unrecognized data format for font.");r=o.parse(e)}t instanceof le&&(t=[t]);const n=new ci(r,t,i);return ci.available[n.font]=n,n}static uninstall(e){const t=ci.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete ci.available[e]}static from(e,t,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:n,resolution:o,textureWidth:a,textureHeight:l,...h}=Object.assign({},ci.defaultOptions,i),u=Zw(r),c=t instanceof Yi?t:new Yi(t),d=a,f=new $n;f.info[0]={face:c.fontFamily,size:c.fontSize},f.common[0]={lineHeight:c.fontSize};let p=0,m=0,g,v,x,_=0;const E=[];for(let M=0;M<u.length;M++){g||(g=ne.ADAPTER.createCanvas(),g.width=a,g.height=l,v=g.getContext("2d"),x=new we(g,{resolution:o,...h}),E.push(new le(x)),f.page.push({id:E.length-1,file:""}));const O=u[M],N=Di.measureText(O,c,!1,g),B=N.width,G=Math.ceil(N.height),K=Math.ceil((c.fontStyle==="italic"?2:1)*B);if(m>=l-G*o){if(m===0)throw new Error(`[BitmapFont] textureHeight ${l}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${O}')`);--M,g=null,v=null,x=null,m=0,p=0,_=0;continue}if(_=Math.max(G+N.fontProperties.descent,_),K*o+p>=d){if(p===0)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${O}')`);--M,m+=_*o,m=Math.ceil(m),p=0,_=0;continue}qw(g,v,N,p,m,o,c);const D=Dn(N.text);f.char.push({id:D,page:E.length-1,x:p/o,y:m/o,width:K,height:G,xoffset:0,yoffset:0,xadvance:B-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0)}),p+=(K+2*n)*o,p=Math.ceil(p)}if(!(i!=null&&i.skipKerning))for(let M=0,O=u.length;M<O;M++){const N=u[M];for(let B=0;B<O;B++){const G=u[B],K=v.measureText(N).width,D=v.measureText(G).width,C=v.measureText(N+G).width-(K+D);C&&f.kerning.push({first:Dn(N),second:Dn(G),amount:C})}}const R=new ci(f,E,!0);return ci.available[e]!==void 0&&ci.uninstall(e),ci.available[e]=R,R}};Mi.ALPHA=[["a","z"],["A","Z"]," "],Mi.NUMERIC=[["0","9"]],Mi.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Mi.ASCII=[[" ","~"]],Mi.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Mi.ALPHANUMERIC},Mi.available={};let Ii=Mi;var Kw=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,Qw=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const gc=[],vc=[],yc=[],Jw=class $f extends ti{constructor(e,t={}){super();const{align:i,tint:r,maxWidth:n,letterSpacing:o,fontName:a,fontSize:l}=Object.assign({},$f.styleDefaults,t);if(!Ii.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new Ue(r),this._font=void 0,this._fontName=a,this._fontSize=l,this.text=e,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=o,this._anchor=new Ei(()=>{this.dirty=!0},this,0,0),this._roundPixels=ne.ROUND_PIXELS,this.dirty=!0,this._resolution=ne.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var e;const t=Ii.available[this._fontName],i=this.fontSize,r=i/t.size,n=new Ie,o=[],a=[],l=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",u=Jf(h),c=this._maxWidth*t.size/i,d=t.distanceFieldType==="none"?gc:vc;let f=null,p=0,m=0,g=0,v=-1,x=0,_=0,E=0,R=0;for(let D=0;D<u.length;D++){const C=u[D],I=Dn(C);if(/(?:\s)/.test(C)&&(v=D,x=p,R++),C==="\r"||C===`
`){a.push(p),l.push(-1),m=Math.max(m,p),++g,++_,n.x=0,n.y+=t.lineHeight,f=null,R=0;continue}const L=t.chars[I];if(!L)continue;f&&L.kerning[f]&&(n.x+=L.kerning[f]);const W=yc.pop()||{texture:le.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ie};W.texture=L.texture,W.line=g,W.charCode=I,W.position.x=Math.round(n.x+L.xOffset+this._letterSpacing/2),W.position.y=Math.round(n.y+L.yOffset),W.prevSpaces=R,o.push(W),p=W.position.x+Math.max(L.xAdvance-L.xOffset,L.texture.orig.width),n.x+=L.xAdvance+this._letterSpacing,E=Math.max(E,L.yOffset+L.texture.height),f=I,v!==-1&&c>0&&n.x>c&&(++_,Ys(o,1+v-_,1+D-v),D=v,v=-1,a.push(x),l.push(o.length>0?o[o.length-1].prevSpaces:0),m=Math.max(m,x),g++,n.x=0,n.y+=t.lineHeight,f=null,R=0)}const M=u[u.length-1];M!=="\r"&&M!==`
`&&(/(?:\s)/.test(M)&&(p=x),a.push(p),m=Math.max(m,p),l.push(-1));const O=[];for(let D=0;D<=g;D++){let C=0;this._align==="right"?C=m-a[D]:this._align==="center"?C=(m-a[D])/2:this._align==="justify"&&(C=l[D]<0?0:(m-a[D])/l[D]),O.push(C)}const N=o.length,B={},G=[],K=this._activePagesMeshData;d.push(...K);for(let D=0;D<N;D++){const C=o[D].texture,I=C.baseTexture.uid;if(!B[I]){let L=d.pop();if(!L){const U=new ww;let V,ie;t.distanceFieldType==="none"?(V=new dc(le.EMPTY),ie=ye.NORMAL):(V=new dc(le.EMPTY,{program:bi.from(Qw,Kw),uniforms:{uFWidth:0}}),ie=ye.NORMAL_NPM);const k=new cc(U,V);k.blendMode=ie,L={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:k,vertices:null,uvs:null,indices:null}}L.index=0,L.indexCount=0,L.vertexCount=0,L.uvsCount=0,L.total=0;const{_textureCache:W}=this;W[I]=W[I]||new le(C.baseTexture),L.mesh.texture=W[I],L.mesh.tint=this._tintColor.value,G.push(L),B[I]=L}B[I].total++}for(let D=0;D<K.length;D++)G.includes(K[D])||this.removeChild(K[D].mesh);for(let D=0;D<G.length;D++)G[D].mesh.parent!==this&&this.addChild(G[D].mesh);this._activePagesMeshData=G;for(const D in B){const C=B[D],I=C.total;if(!(((e=C.indices)==null?void 0:e.length)>6*I)||C.vertices.length<cc.BATCHABLE_SIZE*2)C.vertices=new Float32Array(4*2*I),C.uvs=new Float32Array(4*2*I),C.indices=new Uint16Array(6*I);else{const L=C.total,W=C.vertices;for(let U=L*4*2;U<W.length;U++)W[U]=0}C.mesh.size=6*I}for(let D=0;D<N;D++){const C=o[D];let I=C.position.x+O[C.line]*(this._align==="justify"?C.prevSpaces:1);this._roundPixels&&(I=Math.round(I));const L=I*r,W=C.position.y*r,U=C.texture,V=B[U.baseTexture.uid],ie=U.frame,k=U._uvs,F=V.index++;V.indices[F*6+0]=0+F*4,V.indices[F*6+1]=1+F*4,V.indices[F*6+2]=2+F*4,V.indices[F*6+3]=0+F*4,V.indices[F*6+4]=2+F*4,V.indices[F*6+5]=3+F*4,V.vertices[F*8+0]=L,V.vertices[F*8+1]=W,V.vertices[F*8+2]=L+ie.width*r,V.vertices[F*8+3]=W,V.vertices[F*8+4]=L+ie.width*r,V.vertices[F*8+5]=W+ie.height*r,V.vertices[F*8+6]=L,V.vertices[F*8+7]=W+ie.height*r,V.uvs[F*8+0]=k.x0,V.uvs[F*8+1]=k.y0,V.uvs[F*8+2]=k.x1,V.uvs[F*8+3]=k.y1,V.uvs[F*8+4]=k.x2,V.uvs[F*8+5]=k.y2,V.uvs[F*8+6]=k.x3,V.uvs[F*8+7]=k.y3}this._textWidth=m*r,this._textHeight=(n.y+t.lineHeight)*r;for(const D in B){const C=B[D];if(this.anchor.x!==0||this.anchor.y!==0){let U=0;const V=this._textWidth*this.anchor.x,ie=this._textHeight*this.anchor.y;for(let k=0;k<C.total;k++)C.vertices[U++]-=V,C.vertices[U++]-=ie,C.vertices[U++]-=V,C.vertices[U++]-=ie,C.vertices[U++]-=V,C.vertices[U++]-=ie,C.vertices[U++]-=V,C.vertices[U++]-=ie}this._maxLineHeight=E*r;const I=C.mesh.geometry.getBuffer("aVertexPosition"),L=C.mesh.geometry.getBuffer("aTextureCoord"),W=C.mesh.geometry.getIndex();I.data=C.vertices,L.data=C.uvs,W.data=C.indices,I.update(),L.update(),W.update()}for(let D=0;D<o.length;D++)yc.push(o[D]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:i,size:r}=Ii.available[this._fontName];if(i!=="none"){const{a:n,b:o,c:a,d:l}=this.worldTransform,h=Math.sqrt(n*n+o*o),u=Math.sqrt(a*a+l*l),c=(Math.abs(h)+Math.abs(u))/2,d=this.fontSize/r,f=e._view.resolution;for(const p of this._activePagesMeshData)p.mesh.shader.uniforms.uFWidth=c*t*d*f}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=Ii.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!Ii.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??Ii.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,i=Ii.available[this._fontName].distanceFieldType==="none"?gc:vc;i.push(...this._activePagesMeshData);for(const r of this._activePagesMeshData)this.removeChild(r.mesh);this._activePagesMeshData=[],i.filter(r=>t[r.mesh.texture.baseTexture.uid]).forEach(r=>{r.mesh.texture=le.EMPTY});for(const r in t)t[r].destroy(),delete t[r];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};Jw.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const $w=[".xml",".fnt"],eE={extension:{type:se.LoadParser,priority:oi.Normal},name:"loadBitmapFont",test(s){return $w.includes(yt.extname(s).toLowerCase())},async testParse(s){return On.test(s)||El.test(s)},async parse(s,e,t){const i=On.test(s)?On.parse(s):El.parse(s),{src:r}=e,{page:n}=i,o=[];for(let h=0;h<n.length;++h){const u=n[h].file;let c=yt.join(yt.dirname(r),u);c=gl(c,r),o.push(c)}const a=await t.load(o),l=o.map(h=>a[h]);return Ii.install(i,l,!0)},async load(s,e){return(await ne.ADAPTER.fetch(s)).text()},unload(s){s.destroy()}};he.add(eE);const bl=class ks extends Yi{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new ks(Object.keys(ks.defaultOptions).reduce((t,i)=>({...t,[i]:e[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(e=>{URL.revokeObjectURL(e.src),e.refs--,e.refs===0&&(e.fontFace&&document.fonts.delete(e.fontFace),delete ks.availableFonts[e.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){const{availableFonts:i}=ks;if(i[e]){const r=i[e];return this._fonts.push(r),r.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return ne.ADAPTER.fetch(e).then(r=>r.blob()).then(async r=>new Promise((n,o)=>{const a=URL.createObjectURL(r),l=new FileReader;l.onload=()=>n([a,l.result]),l.onerror=o,l.readAsDataURL(r)})).then(async([r,n])=>{const o=Object.assign({family:yt.basename(e,yt.extname(e)),weight:"normal",style:"normal",display:"auto",src:r,dataSrc:n,refs:1,originalUrl:e,fontFace:null},t);i[e]=o,this._fonts.push(o),this.styleID++;const a=new FontFace(o.family,`url(${o.src})`,{weight:o.weight,style:o.style,display:o.display});o.fontFace=a,await a.load(),document.fonts.add(a),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const t=e.filter(i=>!this._overrides.includes(i));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter(i=>this._overrides.includes(i));t.length>0&&(this._overrides=this._overrides.filter(i=>!t.includes(i)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style};
                font-display: ${t.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=Vx(e)),typeof e=="number"?zx(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),r=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(t*255|0).toString(16).padStart(2,"0"));const n=`${i}px ${r}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${n} ${e}`}reset(){Object.assign(this,ks.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(t=>setTimeout(t,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=ne.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};bl.availableFonts={},bl.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let Ea=bl;const xn=class Us extends sr{constructor(e="",t={}){super(le.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const i=new Image,r=le.from(i,{scaleMode:ne.SCALE_MODE,resourceOptions:{autoLoad:!1}});r.orig=new Ee,r.trim=new Ee,this.texture=r;const n="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xhtml",a=document.createElementNS(n,"svg"),l=document.createElementNS(n,"foreignObject"),h=document.createElementNS(o,"div"),u=document.createElementNS(o,"style");l.setAttribute("width","10000"),l.setAttribute("height","10000"),l.style.overflow="hidden",a.appendChild(l),this.maxWidth=Us.defaultMaxWidth,this.maxHeight=Us.defaultMaxHeight,this._domElement=h,this._styleElement=u,this._svgRoot=a,this._foreignObject=l,this._foreignObject.appendChild(u),this._foreignObject.appendChild(h),this._image=i,this._loadImage=new Image,this._autoResolution=Us.defaultAutoResolution,this._resolution=Us.defaultResolution??ne.RESOLUTION,this.text=e,this.style=t}measureText(e){var t,i;const{text:r,style:n,resolution:o}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:r,style:n.toCSS(o)}),this._styleElement.textContent=n.toGlobalCSS(),document.body.appendChild(this._svgRoot);const a=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:l,height:h}=a;(l>this.maxWidth||h>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const u=Math.min(this.maxWidth,Math.ceil(l)),c=Math.min(this.maxHeight,Math.ceil(h));return this._svgRoot.setAttribute("width",u.toString()),this._svgRoot.setAttribute("height",c.toString()),r!==this._text&&(this._domElement.innerHTML=this._text),n!==this._style&&(Object.assign(this._domElement,{style:(t=this._style)==null?void 0:t.toCSS(o)}),this._styleElement.textContent=(i=this._style)==null?void 0:i.toGlobalCSS()),{width:u+n.padding*2,height:c+n.padding*2}}async updateText(e=!0){const{style:t,_image:i,_loadImage:r}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:n,height:o}=this.measureText();i.width=r.width=Math.ceil(Math.max(1,n)),i.height=r.height=Math.ceil(Math.max(1,o)),this._updateID++;const a=this._updateID;await new Promise(l=>{r.onload=async()=>{if(a<this._updateID){l();return}await t.onBeforeDraw(),i.src=r.src,r.onload=null,r.src="",this.updateTexture(),l()};const h=new XMLSerializer().serializeToString(this._svgRoot);r.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(h)}`})}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:i,resolution:r}=this,{padding:n}=e,{baseTexture:o}=t;t.trim.width=t._frame.width=i.width/r,t.trim.height=t._frame.height=i.height/r,t.trim.x=-n,t.trim.y=-n,t.orig.width=t._frame.width-n*2,t.orig.height=t._frame.height-n*2,this._onTextureUpdate(),o.setRealSize(i.width,i.height,r),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){var t,i,r,n,o;typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Us.defaultDestroyOptions,e),super.destroy(e);const a=null;this.ownsStyle&&((t=this._style)==null||t.cleanFonts()),this._style=a,(i=this._svgRoot)==null||i.remove(),this._svgRoot=a,(r=this._domElement)==null||r.remove(),this._domElement=a,(n=this._foreignObject)==null||n.remove(),this._foreignObject=a,(o=this._styleElement)==null||o.remove(),this._styleElement=a,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=a,this._image.src="",this._image=a}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=Hi(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=Hi(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&(e=e||{},e instanceof Ea?(this.ownsStyle=!1,this._style=e):e instanceof Yi?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Ea.from(e)):(this.ownsStyle=!0,this._style=new Ea(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(e===""||e===null||e===void 0?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};xn.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},xn.defaultMaxWidth=2024,xn.defaultMaxHeight=2024,xn.defaultAutoResolution=!0;const tE=16777215,iE=.25,sE=16777215,rE=1,nE=1.5;let Fi=!1,Er;const Sl=s=>{const e={tint:s!=null&&s.fill?new Ue(s.fill).toNumber():tE,alpha:(s==null?void 0:s.fillOpacity)!==void 0?Math.min(s.fillOpacity,1):String(s==null?void 0:s.fill).toLowerCase().startsWith("rgba(")?new Ue(s==null?void 0:s.fill).alpha:iE},t={tint:s!=null&&s.stroke?new Ue(s.stroke).toNumber():sE,alpha:(s==null?void 0:s.strokeOpacity)!==void 0?Math.min(s.strokeOpacity,1):String(s==null?void 0:s.stroke).toLowerCase().startsWith("rgba(")?new Ue(s==null?void 0:s.stroke).alpha:rE,lineWidth:(s==null?void 0:s.strokeWidth)===void 0?nE:s.strokeWidth};return{fillStyle:e,strokeStyle:t}},_o=s=>(e,t,i)=>{const{fillStyle:r,strokeStyle:n}=Sl(i),o=new Nr;o.beginFill(16777215),s(t,o),o.endFill(),o.tint=r.tint,o.alpha=r.alpha,e.addChild(o);const a=new Nr,l=n.lineWidth===1?1:n.lineWidth/Er;return a.lineStyle(l,16777215,1,.5,n.lineWidth===1),s(t,a),a.tint=n.tint||16777215,a.alpha=n.alpha,e.addChild(a),{fill:o,stroke:a,strokeWidth:n.lineWidth}},oE=_o((s,e)=>{const{x:t,y:i,w:r,h:n}=s.geometry;e.drawRect(t,i,r,n)}),aE=_o((s,e)=>{const{cx:t,cy:i,rx:r,ry:n}=s.geometry;e.drawEllipse(t,i,r,n)}),lE=_o((s,e)=>{const t=s.geometry.points.reduce((i,r)=>[...i,...r],[]);e.drawPolygon(t)}),hE=_o((s,e)=>{const t=i=>i.points.reduce((r,n)=>[...r,...n],[]);s.geometry.polygons.forEach(i=>{const[r,...n]=i.rings;e.drawPolygon(t(r)),n.forEach(o=>{e.beginHole(),e.drawPolygon(t(o)),e.endHole()})})}),ep=s=>{const e=s.viewport.getContainerSize().x;return s.viewport.getZoom(!0)*e/s.world.getContentFactor()},xc=(s,e,t,i)=>()=>{const r=s.viewport.viewportToImageRectangle(s.viewport.getBounds(!0)),n=ep(s);(n!==Er||!Fi)&&(Fi=!0,t.forEach(({stroke:d,strokeWidth:f})=>{const{lineStyle:p}=d.geometry.graphicsData[0];f>1?(Fi=n===Er,p.width=f/n,p.native=!1,d.geometry.invalidate()):f===1&&!p.native&&(p.width=1,p.native=!0,d.geometry.invalidate())})),Er=n;const o=s.viewport.getFlip();let a=Math.PI*s.viewport.getRotation(!0)/180;a<0&&(a+=2*Math.PI),a>2*Math.PI&&(a-=2*Math.PI);const l=o?s.viewport._containerInnerSize.x+r.x*n:-r.x*n,h=-r.y*n;let u,c;a>0&&a<=Math.PI/2?(u=r.height*n,c=0):a>Math.PI/2&&a<=Math.PI?(u=r.width*n,c=r.height*n):a>Math.PI&&a<=Math.PI*1.5?(u=0,c=r.width*n):(u=0,c=0),e.position.x=u+l*Math.cos(a)-h*Math.sin(a),e.position.y=c+l*Math.sin(a)+h*Math.cos(a),e.scale.set(o?-n:n,n),e.rotation=a,i.render(e)},uE=(s,e)=>{const t=new Nr,i=xf({width:e.width,height:e.height,backgroundAlpha:0,view:e,antialias:!0,resolution:2}),r=new Map;let n=new Set,o,a;Er=ep(s);const l=(x,_)=>{Fi=!1;const{selector:E}=x.target,R=typeof a=="function"?a(x,_):a;let M;E.type===je.RECTANGLE?M=oE(t,E,R):E.type===je.POLYGON?M=lE(t,E,R):E.type===je.ELLIPSE?M=aE(t,E,R):E.type===je.MULTIPOLYGLON?M=hE(t,E,R):console.warn(`Unsupported shape type: ${E.type}`),M&&r.set(x.id,{annotation:x,...M})},h=x=>{const _=r.get(x.id);_&&(r.delete(x.id),_.fill.destroy(),_.stroke.destroy())},u=(x,_,E)=>{Fi=!1;const R=r.get(x.id);if(R&&(r.delete(x.id),R.fill.destroy(),R.stroke.destroy(),l(_,E),n.has(_.id))){const{fill:M,stroke:O}=r.get(_.id);t.removeChild(M),t.removeChild(O)}},c=(x,_)=>{const E=r.get(x);E&&(r.delete(x),E.fill.destroy(),E.stroke.destroy(),l(E.annotation,_))},d=(x,_)=>{i.resize(x,_),i.render(t)},f=x=>{Fi=!1;const{children:_}=t;r.forEach(({fill:E,stroke:R,annotation:M})=>{const O=x?n.has(M.id)||x(M):!0;O&&!_.includes(E)?(t.addChild(E),t.addChild(R)):!O&&_.includes(E)&&(t.removeChild(E),t.removeChild(R))}),i.render(t)},p=x=>{const _=new Set(x.selected.map(M=>M.id)),E=x.selected.filter(({id:M})=>!n.has(M)),R=[...n].filter(M=>!_.has(M));E.forEach(({id:M,editable:O})=>{if(O){const N=r.get(M);N&&(t.removeChild(N.fill),t.removeChild(N.stroke))}else c(M,{selected:!0,hovered:M===o})}),R.forEach(M=>c(M,{hovered:M===o})),n=_,i.render(t)},m=x=>{o!==x&&(o&&!n.has(o)&&c(o,{selected:n.has(o)}),x&&c(x,{selected:n.has(x),hovered:!0}),o=x,i.render(t))},g=x=>{if(typeof x=="function")r.forEach(({annotation:_,fill:E,stroke:R,strokeWidth:M},O)=>{M>1&&(Fi=!1);const N={selected:n.has(_.id),hovered:o===_.id},{fillStyle:B,strokeStyle:G}=Sl(x(_,N));E.tint=B.tint,E.alpha=B.alpha,R.tint=G.tint||16777215,R.alpha=G.alpha,r.set(_.id,{annotation:_,fill:E,stroke:R,strokeWidth:G.lineWidth})});else{const{fillStyle:_,strokeStyle:E}=Sl(x);E.lineWidth>1&&(Fi=!1),r.forEach(({annotation:R,fill:M,stroke:O,strokeWidth:N},B)=>{M.tint=_.tint,M.alpha=_.alpha,O.tint=E.tint||16777215,O.alpha=E.alpha,r.set(R.id,{annotation:R,fill:M,stroke:O,strokeWidth:E.lineWidth})})}a=x,i.render(t),xc(s,t,r,i)()},v=x=>{x?e.classList.remove("hidden"):e.classList.add("hidden")};return{addAnnotation:l,destroy:()=>i.destroy(),redraw:xc(s,t,r,i),removeAnnotation:h,resize:d,setFilter:f,setHovered:m,setSelected:p,setStyle:g,setVisible:v,updateAnnotation:u}};function cE(s,e,t){let i,r,{filter:n}=e,{state:o}=e,{style:a}=e,{viewer:l}=e,{visible:h=!0}=e;const{store:u,hover:c,selection:d,viewport:f}=o;Ln(s,c,M=>t(11,i=M)),Ln(s,d,M=>t(8,r=M));const p=Dl();let m,g;const v=M=>{const O=new Nn.Point(M.x,M.y),{x:N,y:B}=l.viewport.pointFromPixel(O);return l.viewport.viewportToImageCoordinates(N,B)},x=M=>{const{x:O,y:N}=M.position;g={x:O,y:N}},_=M=>O=>{const{x:N,y:B}=v(new Nn.Point(O.offsetX,O.offsetY)),G=u.getAt(N,B,n);G?(M.classList.add("hover"),i!==G.id&&(c.set(G.id),m.setHovered(G.id))):(M.classList.remove("hover"),i&&(c.set(void 0),m.setHovered(void 0)))},E=M=>{if(!g)return;const O=M.originalEvent,{x:N,y:B}=M.position,G=N-g.x,K=B-g.y;if(Math.sqrt(G*G+K*K)<5){const{x:D,y:C}=v(M.position),I=u.getAt(D,C,n);I?p("click",{originalEvent:O,annotation:I}):p("click",{originalEvent:O})}g=void 0};let R;return no(()=>{var M;const{offsetWidth:O,offsetHeight:N}=l.canvas,B=document.createElement("canvas");B.width=O,B.height=N,B.className="a9s-gl-canvas",(M=l.element.querySelector(".openseadragon-canvas"))==null||M.appendChild(B),t(7,m=uE(l,B));const G=_(B);B.addEventListener("pointermove",G);const K=new ResizeObserver(U=>{try{const{width:V,height:ie}=U[0].contentRect;B.width=V,B.height=ie,m.resize(V,ie)}catch{console.warn("WebGL canvas already disposed")}});K.observe(B);const D=()=>{const U=l.viewport.getBounds();R=l.viewport.viewportToImageRectangle(U);const{x:V,y:ie,width:k,height:F}=R,Z=u.getIntersecting(V,ie,k,F);f.set(Z.map(Q=>Q.id))};l.addHandler("canvas-press",x),l.addHandler("canvas-release",E),l.addHandler("update-viewport",m.redraw),l.addHandler("animation-finish",D);const C=U=>U.filter(V=>Ui(V)),I=U=>Ui(U.oldValue)&&Ui(U.newValue),L=U=>{const{selector:V}=U.target;if(V.type===je.POLYGON){const ie=lv(V);return{...U,target:{...U.target,selector:{...ie}}}}else if(V.type===je.MULTIPOLYGLON){const ie=ov(V);return{...U,target:{...U.target,selector:{...ie}}}}else return U},W=U=>{const{created:V,updated:ie,deleted:k}=U.changes;if((V||[]).filter(F=>Ui(F)).map(L).forEach(F=>m.addAnnotation(F)),C(k||[]).forEach(F=>m.removeAnnotation(F)),(ie||[]).filter(F=>I(F)).map(({oldValue:F,newValue:Z})=>({oldValue:F,newValue:L(Z)})).forEach(({oldValue:F,newValue:Z})=>m.updateAnnotation(F,Z)),R){const{x:F,y:Z,width:Q,height:ae}=R,de=u.getIntersecting(F,Z,Q,ae);f.set(de.map(be=>be.id))}else f.set(u.all().map(F=>F.id));m.redraw()};return u.observe(W),()=>{var U;B.removeEventListener("pointermove",G),K.disconnect(),l.removeHandler("canvas-press",x),l.removeHandler("canvas-release",E),l.removeHandler("update-viewport",m.redraw),l.removeHandler("animation-finish",D),u.unobserve(W),m.destroy(),(U=B.parentNode)==null||U.removeChild(B)}}),s.$$set=M=>{"filter"in M&&t(2,n=M.filter),"state"in M&&t(3,o=M.state),"style"in M&&t(4,a=M.style),"viewer"in M&&t(5,l=M.viewer),"visible"in M&&t(6,h=M.visible)},s.$$.update=()=>{s.$$.dirty&132&&(m==null||m.setFilter(n)),s.$$.dirty&384&&(m==null||m.setSelected(r)),s.$$.dirty&144&&(m==null||m.setStyle(a)),s.$$.dirty&192&&(m==null||m.setVisible(h))},[c,d,n,o,a,l,h,m,r]}class dE extends Ot{constructor(e){super(),It(this,e,cE,null,St,{filter:2,state:3,style:4,viewer:5,visible:6})}}const tp=(s,e,t,i)=>{if(!i)return s;if(e.shiftKey||e.ctrlKey||e.metaKey){const r=(t.selected||[]).map(n=>n.id);return r.includes(s)?r.filter(n=>n!==s):[...r,s]}else return s},fE=s=>({transform:s&2,scale:s&1}),_c=s=>({transform:s[1],scale:s[0]});function pE(s){let e;const t=s[4].default,i=Hg(t,s,s[3],_c);return{c(){i&&i.c()},m(r,n){i&&i.m(r,n),e=!0},p(r,[n]){i&&i.p&&(!e||n&11)&&zg(i,t,r,r[3],e?Gg(t,r[3],n,fE):Vg(r[3]),_c)},i(r){e||(_e(i,r),e=!0)},o(r){Se(i,r),e=!1},d(r){i&&i.d(r)}}}function mE(s,e,t){let{$$slots:i={},$$scope:r}=e,{viewer:n}=e,o=1,a;const l=()=>{const h=n.viewport.getContainerSize().x,u=n.viewport.getZoom(!0),c=n.viewport.getFlip(),d=n.viewport.pixelFromPoint(new Nn.Point(0,0),!0);c&&(d.x=h-d.x);const f=u*h/n.world.getContentFactor(),p=c?-f:f,m=n.viewport.getRotation(!0);t(1,a=`translate(${d.x}, ${d.y}) scale(${p}, ${f}) rotate(${m})`),t(0,o=u*h/n.world.getContentFactor())};return no(()=>(n.addHandler("update-viewport",l),()=>{n.removeHandler("update-viewport",l)})),s.$$set=h=>{"viewer"in h&&t(2,n=h.viewer),"$$scope"in h&&t(3,r=h.$$scope)},[o,a,n,r,i]}class ql extends Ot{constructor(e){super(),It(this,e,mE,pE,St,{viewer:2})}}function gE(s,e,t){const i=Dl();let{drawingMode:r}=e,{opts:n}=e,{target:o}=e,{tool:a}=e,{transform:l}=e,{viewer:h}=e,{viewportScale:u}=e,c;return no(()=>{const d=o.closest("svg"),f=[],p=(m,g,v)=>{if(d==null||d.addEventListener(m,g,v),f.push(()=>d==null?void 0:d.removeEventListener(m,g,v)),m==="pointerup"||m==="dblclick"){const x=E=>{const{originalEvent:R}=E;g(R)},_=m==="pointerup"?"canvas-click":"canvas-double-click";h.addHandler(_,x),f.push(()=>h.removeHandler(_,x))}else if(m==="pointermove"){const x=_=>{const{originalEvent:E}=_;g(E)};h.addHandler("canvas-drag",x),f.push(()=>h.removeHandler("canvas-drag",x))}};return t(7,c=new a({target:o,props:{addEventListener:p,drawingMode:r,opts:n,transform:l,viewportScale:u,svgEl:d}})),c.$on("create",m=>i("create",m.detail)),()=>{f.forEach(m=>m()),c.$destroy()}}),s.$$set=d=>{"drawingMode"in d&&t(0,r=d.drawingMode),"opts"in d&&t(1,n=d.opts),"target"in d&&t(2,o=d.target),"tool"in d&&t(3,a=d.tool),"transform"in d&&t(4,l=d.transform),"viewer"in d&&t(5,h=d.viewer),"viewportScale"in d&&t(6,u=d.viewportScale)},s.$$.update=()=>{s.$$.dirty&144&&c&&c.$set({transform:l}),s.$$.dirty&192&&c&&c.$set({viewportScale:u})},[r,n,o,a,l,h,u,c]}class vE extends Ot{constructor(e){super(),It(this,e,gE,null,St,{drawingMode:0,opts:1,target:2,tool:3,transform:4,viewer:5,viewportScale:6})}}function Tc(s,e,t){const i=s.slice();i[35]=e[t];const r=i[16](i[35].target.selector);return i[36]=r,i}function yE(s){let e=`${s[2]}-${s[6]}`,t,i,r=wc(s);return{c(){r.c(),t=Ci()},m(n,o){r.m(n,o),nt(n,t,o),i=!0},p(n,o){o[0]&68&&St(e,e=`${n[2]}-${n[6]}`)?(Vt(),Se(r,1,1,Et),Xt(),r=wc(n),r.c(),_e(r,1),r.m(t.parentNode,t)):r.p(n,o)},i(n){i||(_e(r),i=!0)},o(n){Se(r),i=!1},d(n){n&&et(t),r.d(n)}}}function xE(s){let e,t,i=Wi(s[8].filter(s[26])),r=[];for(let o=0;o<i.length;o+=1)r[o]=Sc(Tc(s,i,o));const n=o=>Se(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=Ci()},m(o,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(o,a);nt(o,e,a),t=!0},p(o,a){if(a[0]&96642|a[1]&8){i=Wi(o[8].filter(o[26]));let l;for(l=0;l<i.length;l+=1){const h=Tc(o,i,l);r[l]?(r[l].p(h,a),_e(r[l],1)):(r[l]=Sc(h),r[l].c(),_e(r[l],1),r[l].m(e.parentNode,e))}for(Vt(),l=i.length;l<r.length;l+=1)n(l);Xt()}},i(o){if(!t){for(let a=0;a<i.length;a+=1)_e(r[a]);t=!0}},o(o){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)Se(r[a]);t=!1},d(o){o&&et(e),ro(r,o)}}}function wc(s){let e,t;return e=new vE({props:{target:s[7],tool:s[9],drawingMode:s[4],transform:{elementToImage:s[11]},viewer:s[3],viewportScale:s[34],opts:s[5]}}),e.$on("create",s[15]),{c(){Bt(e.$$.fragment)},m(i,r){Pt(e,i,r),t=!0},p(i,r){const n={};r[0]&128&&(n.target=i[7]),r[0]&512&&(n.tool=i[9]),r[0]&16&&(n.drawingMode=i[4]),r[0]&8&&(n.viewer=i[3]),r[1]&8&&(n.viewportScale=i[34]),r[0]&32&&(n.opts=i[5]),e.$set(n)},i(i){t||(_e(e.$$.fragment,i),t=!0)},o(i){Se(e.$$.fragment,i),t=!1},d(i){Mt(e,i)}}}function Ec(s){let e=s[35].id,t,i,r=bc(s);return{c(){r.c(),t=Ci()},m(n,o){r.m(n,o),nt(n,t,o),i=!0},p(n,o){o[0]&256&&St(e,e=n[35].id)?(Vt(),Se(r,1,1,Et),Xt(),r=bc(n),r.c(),_e(r,1),r.m(t.parentNode,t)):r.p(n,o)},i(n){i||(_e(r),i=!0)},o(n){Se(r),i=!1},d(n){n&&et(t),r.d(n)}}}function bc(s){let e,t;return e=new kv({props:{target:s[7],editor:s[16](s[35].target.selector),annotation:s[35],style:s[1],transform:{elementToImage:s[11]},viewportScale:s[34]}}),e.$on("grab",s[12]),e.$on("change",function(){Il(s[14](s[35]))&&s[14](s[35]).apply(this,arguments)}),e.$on("release",s[13]),{c(){Bt(e.$$.fragment)},m(i,r){Pt(e,i,r),t=!0},p(i,r){s=i;const n={};r[0]&128&&(n.target=s[7]),r[0]&256&&(n.editor=s[16](s[35].target.selector)),r[0]&256&&(n.annotation=s[35]),r[0]&2&&(n.style=s[1]),r[1]&8&&(n.viewportScale=s[34]),e.$set(n)},i(i){t||(_e(e.$$.fragment,i),t=!0)},o(i){Se(e.$$.fragment,i),t=!1},d(i){Mt(e,i)}}}function Sc(s){let e,t,i=s[36]&&Ec(s);return{c(){i&&i.c(),e=Ci()},m(r,n){i&&i.m(r,n),nt(r,e,n),t=!0},p(r,n){r[36]?i?(i.p(r,n),n[0]&256&&_e(i,1)):(i=Ec(r),i.c(),_e(i,1),i.m(e.parentNode,e)):i&&(Vt(),Se(i,1,1,()=>{i=null}),Xt())},i(r){t||(_e(i),t=!0)},o(r){Se(i),t=!1},d(r){r&&et(e),i&&i.d(r)}}}function _E(s){let e,t,i,r,n,o;const a=[xE,yE],l=[];function h(u,c){var d;return u[7]&&((d=u[8])==null?void 0:d.length)===1?0:u[7]&&u[9]&&u[0]?1:-1}return~(i=h(s))&&(r=l[i]=a[i](s)),{c(){e=rt("svg"),t=rt("g"),r&&r.c(),ee(t,"transform",n=s[33]),ee(t,"class","svelte-1k5cy2d"),ee(e,"tabindex",0),ee(e,"class","a9s-annotationlayer a9s-osd-drawinglayer svelte-1k5cy2d"),Zr(e,"drawing",s[0]),Zr(e,"editing",s[8])},m(u,c){nt(u,e,c),pi(e,t),~i&&l[i].m(t,null),s[27](t),o=!0},p(u,c){let d=i;i=h(u),i===d?~i&&l[i].p(u,c):(r&&(Vt(),Se(l[d],1,1,()=>{l[d]=null}),Xt()),~i?(r=l[i],r?r.p(u,c):(r=l[i]=a[i](u),r.c()),_e(r,1),r.m(t,null)):r=null),(!o||c[1]&4&&n!==(n=u[33]))&&ee(t,"transform",n),(!o||c[0]&1)&&Zr(e,"drawing",u[0]),(!o||c[0]&256)&&Zr(e,"editing",u[8])},i(u){o||(_e(r),o=!0)},o(u){Se(r),o=!1},d(u){u&&et(e),~i&&l[i].d(),s[27](null)}}}function TE(s){let e,t;return e=new ql({props:{viewer:s[3],$$slots:{default:[_E,({transform:i,scale:r})=>({33:i,34:r}),({transform:i,scale:r})=>[0,(i?4:0)|(r?8:0)]]},$$scope:{ctx:s}}}),{c(){Bt(e.$$.fragment)},m(i,r){Pt(e,i,r),t=!0},p(i,r){const n={};r[0]&8&&(n.viewer=i[3]),r[0]&1023|r[1]&268&&(n.$$scope={dirty:r,ctx:i}),e.$set(n)},i(i){t||(_e(e.$$.fragment,i),t=!0)},o(i){Se(e.$$.fragment,i),t=!1},d(i){Mt(e,i)}}}function wE(s,e,t){let i,r,n,o,{drawingEnabled:a}=e,{filter:l}=e,{multiSelect:h}=e,{preferredDrawingMode:u}=e,{state:c}=e,{style:d=void 0}=e,{toolName:f=ed()[0]}=e,{user:p}=e,{viewer:m}=e,g=0;const v=()=>t(6,g+=1),x=()=>f,_=()=>a;let E;const{store:R,selection:M,hover:O}=c;Ln(s,M,k=>t(25,o=k));let N,B,G;const K=k=>{R.unobserve(N);const F=k.filter(({editable:Z})=>Z).map(({id:Z})=>Z);F.length>0?(t(8,B=F.map(Z=>R.getAnnotation(Z))),N=Z=>{const{updated:Q}=Z.changes;t(8,B=(Q||[]).map(ae=>ae.newValue))},R.observe(N,{annotations:F}),m.forceRedraw()):t(8,B=void 0)},D=(k,F)=>{const{x:Z,y:Q}=m.viewport.viewerElementToImageCoordinates(new Nn.Point(k,F));return[Z,Q]},C=k=>{m.setMouseNavEnabled(!1),G=k.timeStamp},I=k=>{if(m.setMouseNavEnabled(!0),performance.now()-(G||0)<300){const{offsetX:F,offsetY:Z}=k.detail,[Q,ae]=D(F,Z),de=R.getAt(Q,ae);if(de&&(!l||l(de))&&!B.find(be=>be.id===de.id)){O.set(de.id);const be=tp(de.id,k.detail,M,h);M.userSelect(be)}}},L=k=>F=>{var Z;const{target:Q}=k,ae=10*60*1e3,de=((Z=Q.creator)==null?void 0:Z.id)!==p.id||!Q.created||new Date().getTime()-Q.created.getTime()>ae;R.updateTarget({...Q,selector:F.detail,created:de?Q.created:new Date,updated:de?new Date:void 0,updatedBy:de?p:void 0})},W=k=>{const F=Lv(),Z={id:F,bodies:[],target:{annotation:F,selector:k.detail,creator:p,created:new Date}};R.addAnnotation(Z),M.setSelected(Z.id),m.setMouseNavEnabled(!0)},U=k=>fg(k),V=k=>Ui(k);function ie(k){Bn[k?"unshift":"push"](()=>{E=k,t(7,E)})}return s.$$set=k=>{"drawingEnabled"in k&&t(0,a=k.drawingEnabled),"filter"in k&&t(17,l=k.filter),"multiSelect"in k&&t(18,h=k.multiSelect),"preferredDrawingMode"in k&&t(19,u=k.preferredDrawingMode),"state"in k&&t(20,c=k.state),"style"in k&&t(1,d=k.style),"toolName"in k&&t(2,f=k.toolName),"user"in k&&t(21,p=k.user),"viewer"in k&&t(3,m=k.viewer)},s.$$.update=()=>{s.$$.dirty[0]&4&&t(9,{tool:i,opts:r}=td(f)||{tool:void 0,opts:void 0},i,(t(5,r),t(2,f))),s.$$.dirty[0]&524320&&t(4,n=(r==null?void 0:r.drawingMode)||u),s.$$.dirty[0]&25&&(a&&n==="drag"?m.setMouseNavEnabled(!1):m.setMouseNavEnabled(!0)),s.$$.dirty[0]&1&&a&&M.clear(),s.$$.dirty[0]&33554457&&o.selected.length===0&&n==="drag"&&a&&m.setMouseNavEnabled(!1),s.$$.dirty[0]&33554432&&K(o.selected)},[a,d,f,m,n,r,g,E,B,i,M,D,C,I,L,W,U,l,h,u,c,p,v,x,_,o,V,ie]}class EE extends Ot{constructor(e){super(),It(this,e,wE,TE,St,{drawingEnabled:0,filter:17,multiSelect:18,preferredDrawingMode:19,state:20,style:1,toolName:2,user:21,viewer:3,cancelDrawing:22,getDrawingTool:23,isDrawingEnabled:24},null,[-1,-1])}get cancelDrawing(){return this.$$.ctx[22]}get getDrawingTool(){return this.$$.ctx[23]}get isDrawingEnabled(){return this.$$.ctx[24]}}function bE(s){let e,t,i,r,n,o,a,l=s[2].appearance.label+"",h,u,c,d;return{c(){e=rt("g"),t=rt("rect"),a=rt("text"),h=od(l),ee(t,"class","a9s-presence-label-bg svelte-1rehw2p"),ee(t,"x",s[0]),ee(t,"y",i=s[1]-18/s[3]),ee(t,"height",r=18/s[3]),ee(t,"fill",n=s[2].appearance.color),ee(t,"stroke",o=s[2].appearance.color),ee(a,"font-size",u=12/s[3]),ee(a,"x",c=s[0]+Math.round(5/s[3])),ee(a,"y",d=s[1]-5/s[3]),ee(a,"class","svelte-1rehw2p"),ee(e,"class","a9s-presence-label")},m(f,p){nt(f,e,p),pi(e,t),pi(e,a),pi(a,h),s[6](e)},p(f,[p]){p&1&&ee(t,"x",f[0]),p&10&&i!==(i=f[1]-18/f[3])&&ee(t,"y",i),p&8&&r!==(r=18/f[3])&&ee(t,"height",r),p&4&&n!==(n=f[2].appearance.color)&&ee(t,"fill",n),p&4&&o!==(o=f[2].appearance.color)&&ee(t,"stroke",o),p&4&&l!==(l=f[2].appearance.label+"")&&Wg(h,l),p&8&&u!==(u=12/f[3])&&ee(a,"font-size",u),p&9&&c!==(c=f[0]+Math.round(5/f[3]))&&ee(a,"x",c),p&10&&d!==(d=f[1]-5/f[3])&&ee(a,"y",d)},i:Et,o:Et,d(f){f&&et(e),s[6](null)}}}function SE(s,e,t){let{x:i}=e,{y:r}=e,{user:n}=e,{scale:o}=e,{hAlign:a=null}=e,l;const h=c=>{const d=l.querySelector("text"),f=l.querySelector("rect"),p=d.getBBox().width+10/c;a==="CENTER"&&l.setAttribute("style",`transform: translateX(-${p/2}px)`),f.setAttribute("width",`${p}`)};function u(c){Bn[c?"unshift":"push"](()=>{l=c,t(4,l)})}return s.$$set=c=>{"x"in c&&t(0,i=c.x),"y"in c&&t(1,r=c.y),"user"in c&&t(2,n=c.user),"scale"in c&&t(3,o=c.scale),"hAlign"in c&&t(5,a=c.hAlign)},s.$$.update=()=>{s.$$.dirty&24&&l&&h(o)},[i,r,n,o,l,a,u]}class ip extends Ot{constructor(e){super(),It(this,e,SE,bE,St,{x:0,y:1,user:2,scale:3,hAlign:5})}}function AE(s){let e,t,i,r,n,o;return t=new ip({props:{scale:s[1],user:s[0],x:s[3][0],y:s[3][1],hAlign:"CENTER"}}),{c(){e=rt("g"),Bt(t.$$.fragment),i=rt("polygon"),ee(i,"class","a9s-presence-shape a9s-presence-polygon svelte-fgq4n0"),ee(i,"stroke",r=s[0].appearance.color),ee(i,"fill","transparent"),ee(i,"points",n=s[2].points.map(Ac).join(" ")),ee(e,"class","a9s-presence-overlay")},m(a,l){nt(a,e,l),Pt(t,e,null),pi(e,i),o=!0},p(a,[l]){const h={};l&2&&(h.scale=a[1]),l&1&&(h.user=a[0]),l&8&&(h.x=a[3][0]),l&8&&(h.y=a[3][1]),t.$set(h),(!o||l&1&&r!==(r=a[0].appearance.color))&&ee(i,"stroke",r),(!o||l&4&&n!==(n=a[2].points.map(Ac).join(" ")))&&ee(i,"points",n)},i(a){o||(_e(t.$$.fragment,a),o=!0)},o(a){Se(t.$$.fragment,a),o=!1},d(a){a&&et(e),Mt(t)}}}const Ac=s=>s.join(",");function RE(s,e,t){let i,r,{annotation:n}=e,{user:o}=e,{scale:a}=e;const l=h=>{let[u,...c]=h.points;return c.forEach(([d,f])=>{f<u[1]&&(u=[d,f])}),u};return s.$$set=h=>{"annotation"in h&&t(4,n=h.annotation),"user"in h&&t(0,o=h.user),"scale"in h&&t(1,a=h.scale)},s.$$.update=()=>{s.$$.dirty&16&&t(2,i=n.target.selector.geometry),s.$$.dirty&4&&t(3,r=l(i))},[o,a,i,r,n]}class CE extends Ot{constructor(e){super(),It(this,e,RE,AE,St,{annotation:4,user:0,scale:1})}}function PE(s){let e,t,i,r,n,o,a,l,h;return t=new ip({props:{scale:s[1],user:s[0],x:s[2].x,y:s[2].y}}),{c(){e=rt("g"),Bt(t.$$.fragment),i=rt("rect"),ee(i,"class","a9s-presence-shape a9s-presence-rectangle svelte-gze948"),ee(i,"stroke",r=s[0].appearance.color),ee(i,"fill","transparent"),ee(i,"x",n=s[2].x),ee(i,"y",o=s[2].y),ee(i,"width",a=s[2].w),ee(i,"height",l=s[2].h),ee(e,"class","a9s-presence-overlay")},m(u,c){nt(u,e,c),Pt(t,e,null),pi(e,i),h=!0},p(u,[c]){const d={};c&2&&(d.scale=u[1]),c&1&&(d.user=u[0]),c&4&&(d.x=u[2].x),c&4&&(d.y=u[2].y),t.$set(d),(!h||c&1&&r!==(r=u[0].appearance.color))&&ee(i,"stroke",r),(!h||c&4&&n!==(n=u[2].x))&&ee(i,"x",n),(!h||c&4&&o!==(o=u[2].y))&&ee(i,"y",o),(!h||c&4&&a!==(a=u[2].w))&&ee(i,"width",a),(!h||c&4&&l!==(l=u[2].h))&&ee(i,"height",l)},i(u){h||(_e(t.$$.fragment,u),h=!0)},o(u){Se(t.$$.fragment,u),h=!1},d(u){u&&et(e),Mt(t)}}}function ME(s,e,t){let i,{annotation:r}=e,{user:n}=e,{scale:o}=e;return s.$$set=a=>{"annotation"in a&&t(3,r=a.annotation),"user"in a&&t(0,n=a.user),"scale"in a&&t(1,o=a.scale)},s.$$.update=()=>{s.$$.dirty&8&&t(2,i=r.target.selector.geometry)},[n,o,i,r]}class IE extends Ot{constructor(e){super(),It(this,e,ME,PE,St,{annotation:3,user:0,scale:1})}}const{Boolean:OE}=nd;function Rc(s,e,t){const i=s.slice();return i[8]=e[t],i}function Cc(s){let e,t;return e=new ql({props:{viewer:s[0],$$slots:{default:[LE,({transform:i,scale:r})=>({6:i,7:r}),({transform:i,scale:r})=>(i?64:0)|(r?128:0)]},$$scope:{ctx:s}}}),{c(){Bt(e.$$.fragment)},m(i,r){Pt(e,i,r),t=!0},p(i,r){const n={};r&1&&(n.viewer=i[0]),r&2244&&(n.$$scope={dirty:r,ctx:i}),e.$set(n)},i(i){t||(_e(e.$$.fragment,i),t=!0)},o(i){Se(e.$$.fragment,i),t=!1},d(i){Mt(e,i)}}}function Pc(s){let e,t,i=Wi(s[2]),r=[];for(let o=0;o<i.length;o+=1)r[o]=Mc(Rc(s,i,o));const n=o=>Se(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=Ci()},m(o,a){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(o,a);nt(o,e,a),t=!0},p(o,a){if(a&132){i=Wi(o[2]);let l;for(l=0;l<i.length;l+=1){const h=Rc(o,i,l);r[l]?(r[l].p(h,a),_e(r[l],1)):(r[l]=Mc(h),r[l].c(),_e(r[l],1),r[l].m(e.parentNode,e))}for(Vt(),l=i.length;l<r.length;l+=1)n(l);Xt()}},i(o){if(!t){for(let a=0;a<i.length;a+=1)_e(r[a]);t=!0}},o(o){r=r.filter(OE);for(let a=0;a<r.length;a+=1)Se(r[a]);t=!1},d(o){o&&et(e),ro(r,o)}}}function DE(s){let e,t;return e=new CE({props:{annotation:s[8].annotation,user:s[8].selectedBy,scale:s[7]}}),{c(){Bt(e.$$.fragment)},m(i,r){Pt(e,i,r),t=!0},p(i,r){const n={};r&4&&(n.annotation=i[8].annotation),r&4&&(n.user=i[8].selectedBy),r&128&&(n.scale=i[7]),e.$set(n)},i(i){t||(_e(e.$$.fragment,i),t=!0)},o(i){Se(e.$$.fragment,i),t=!1},d(i){Mt(e,i)}}}function NE(s){let e,t;return e=new IE({props:{annotation:s[8].annotation,user:s[8].selectedBy,scale:s[7]}}),{c(){Bt(e.$$.fragment)},m(i,r){Pt(e,i,r),t=!0},p(i,r){const n={};r&4&&(n.annotation=i[8].annotation),r&4&&(n.user=i[8].selectedBy),r&128&&(n.scale=i[7]),e.$set(n)},i(i){t||(_e(e.$$.fragment,i),t=!0)},o(i){Se(e.$$.fragment,i),t=!1},d(i){Mt(e,i)}}}function Mc(s){let e,t,i,r;const n=[NE,DE],o=[];function a(l,h){return l[8].annotation.target.selector.type===je.RECTANGLE?0:l[8].annotation.target.selector.type===je.POLYGON?1:-1}return~(e=a(s))&&(t=o[e]=n[e](s)),{c(){t&&t.c(),i=Ci()},m(l,h){~e&&o[e].m(l,h),nt(l,i,h),r=!0},p(l,h){let u=e;e=a(l),e===u?~e&&o[e].p(l,h):(t&&(Vt(),Se(o[u],1,1,()=>{o[u]=null}),Xt()),~e?(t=o[e],t?t.p(l,h):(t=o[e]=n[e](l),t.c()),_e(t,1),t.m(i.parentNode,i)):t=null)},i(l){r||(_e(t),r=!0)},o(l){Se(t),r=!1},d(l){l&&et(i),~e&&o[e].d(l)}}}function LE(s){let e,t,i,r,n=s[2].length>0&&Pc(s);return{c(){e=rt("svg"),t=rt("g"),n&&n.c(),ee(t,"transform",i=s[6]),ee(e,"class","a9s-osd-presencelayer svelte-1krwc4m")},m(o,a){nt(o,e,a),pi(e,t),n&&n.m(t,null),r=!0},p(o,a){o[2].length>0?n?(n.p(o,a),a&4&&_e(n,1)):(n=Pc(o),n.c(),_e(n,1),n.m(t,null)):n&&(Vt(),Se(n,1,1,()=>{n=null}),Xt()),(!r||a&64&&i!==(i=o[6]))&&ee(t,"transform",i)},i(o){r||(_e(n),r=!0)},o(o){Se(n),r=!1},d(o){o&&et(e),n&&n.d()}}}function BE(s){let e=!!s[1],t,i,r=e&&Cc(s);return{c(){r&&r.c(),t=Ci()},m(n,o){r&&r.m(n,o),nt(n,t,o),i=!0},p(n,[o]){o&2&&(e=!!n[1]),e?r?(r.p(n,o),o&2&&_e(r,1)):(r=Cc(n),r.c(),_e(r,1),r.m(t.parentNode,t)):r&&(Vt(),Se(r,1,1,()=>{r=null}),Xt())},i(n){i||(_e(r),i=!0)},o(n){Se(r),i=!1},d(n){n&&et(t),r&&r.d(n)}}}function FE(s,e,t){let{store:i}=e,{viewer:r}=e,{provider:n}=e,o=[],a;const l=(h,u)=>{t(2,o=[...o.filter(({selectedBy:c})=>c.presenceKey!==h.presenceKey),...(u||[]).map(c=>({annotation:i.getAnnotation(c),selectedBy:h}))].filter(({annotation:c})=>(c||console.warn("Selection event on unknown annotation"),!!c))),a&&i.unobserve(a),a=c=>{const{deleted:d,updated:f}=c.changes,p=new Set((d||[]).map(g=>g.id)),m=o.filter(({annotation:g})=>!p.has(g.id)).map(g=>{const v=(f||[]).find(x=>x.oldValue.id===g.annotation.id);return v?{selectedBy:g.selectedBy,annotation:v.newValue}:g});t(2,o=m)},i.observe(a,{annotations:o.map(c=>c.annotation.id)})};return Yg(()=>{a&&i.unobserve(a)}),s.$$set=h=>{"store"in h&&t(3,i=h.store),"viewer"in h&&t(0,r=h.viewer),"provider"in h&&t(1,n=h.provider)},s.$$.update=()=>{s.$$.dirty&2&&n&&n.on("selectionChange",l)},[r,n,o,i]}class kE extends Ot{constructor(e){super(),It(this,e,FE,BE,St,{store:3,viewer:0,provider:1})}}function UE(s){let e,t,i,r,n;return{c(){e=rt("rect"),ee(e,"x",t=s[0].x),ee(e,"y",i=s[0].y),ee(e,"width",r=s[0].w),ee(e,"height",n=s[0].h)},m(o,a){nt(o,e,a)},p(o,[a]){a&1&&t!==(t=o[0].x)&&ee(e,"x",t),a&1&&i!==(i=o[0].y)&&ee(e,"y",i),a&1&&r!==(r=o[0].w)&&ee(e,"width",r),a&1&&n!==(n=o[0].h)&&ee(e,"height",n)},i:Et,o:Et,d(o){o&&et(e)}}}function HE(s,e,t){let i,{annotation:r}=e;return s.$$set=n=>{"annotation"in n&&t(1,r=n.annotation)},s.$$.update=()=>{s.$$.dirty&2&&t(0,i=r.target.selector.geometry)},[i,r]}class GE extends Ot{constructor(e){super(),It(this,e,HE,UE,St,{annotation:1})}}function zE(s){let e,t;return{c(){e=rt("polygon"),ee(e,"points",t=s[0].points.map(Ic).join(" "))},m(i,r){nt(i,e,r)},p(i,[r]){r&1&&t!==(t=i[0].points.map(Ic).join(" "))&&ee(e,"points",t)},i:Et,o:Et,d(i){i&&et(e)}}}const Ic=s=>s.join(",");function VE(s,e,t){let i,{annotation:r}=e;return s.$$set=n=>{"annotation"in n&&t(1,r=n.annotation)},s.$$.update=()=>{s.$$.dirty&2&&t(0,i=r.target.selector.geometry)},[i,r]}class XE extends Ot{constructor(e){super(),It(this,e,VE,zE,St,{annotation:1})}}function Oc(s,e,t){const i=s.slice();return i[2]=e[t],i}function Dc(s){let e,t;return{c(){e=rt("path"),t=rt("path"),ee(e,"fill-rule","evenodd"),ee(e,"d",Oi(s[2])),ee(t,"class","a9s-inner"),ee(t,"fill-rule","evenodd"),ee(t,"d",Oi(s[2]))},m(i,r){nt(i,e,r),nt(i,t,r)},p:Et,d(i){i&&(et(e),et(t))}}}function WE(s){let e,t=Wi(s[0]),i=[];for(let r=0;r<t.length;r+=1)i[r]=Dc(Oc(s,t,r));return{c(){e=rt("g");for(let r=0;r<i.length;r+=1)i[r].c()},m(r,n){nt(r,e,n);for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(e,null)},p(r,[n]){if(n&1){t=Wi(r[0]);let o;for(o=0;o<t.length;o+=1){const a=Oc(r,t,o);i[o]?i[o].p(a,n):(i[o]=Dc(a),i[o].c(),i[o].m(e,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=t.length}},i:Et,o:Et,d(r){r&&et(e),ro(i,r)}}}function jE(s,e,t){let{annotation:i}=e;const{polygons:r}=i.target.selector.geometry;return s.$$set=n=>{"annotation"in n&&t(1,i=n.annotation)},[r,i]}class YE extends Ot{constructor(e){super(),It(this,e,jE,WE,St,{annotation:1})}}function qE(s){let e,t,i,r,n;return{c(){e=rt("ellipse"),ee(e,"cx",t=s[0].cx),ee(e,"cy",i=s[0].cy),ee(e,"rx",r=s[0].rx),ee(e,"ry",n=s[0].ry)},m(o,a){nt(o,e,a)},p(o,[a]){a&1&&t!==(t=o[0].cx)&&ee(e,"cx",t),a&1&&i!==(i=o[0].cy)&&ee(e,"cy",i),a&1&&r!==(r=o[0].rx)&&ee(e,"rx",r),a&1&&n!==(n=o[0].ry)&&ee(e,"ry",n)},i:Et,o:Et,d(o){o&&et(e)}}}function ZE(s,e,t){let i,{annotation:r}=e;return s.$$set=n=>{"annotation"in n&&t(1,r=n.annotation)},s.$$.update=()=>{s.$$.dirty&2&&t(0,i=r.target.selector.geometry)},[i,r]}class KE extends Ot{constructor(e){super(),It(this,e,ZE,qE,St,{annotation:1})}}const{Boolean:QE}=nd;function Nc(s,e,t){const i=s.slice();return i[10]=e[t],i}function Lc(s){let e,t;return e=new ql({props:{viewer:s[0],$$slots:{default:[ib,({transform:i})=>({9:i}),({transform:i})=>i?512:0]},$$scope:{ctx:s}}}),{c(){Bt(e.$$.fragment)},m(i,r){Pt(e,i,r),t=!0},p(i,r){const n={};r&1&&(n.viewer=i[0]),r&8710&&(n.$$scope={dirty:r,ctx:i}),e.$set(n)},i(i){t||(_e(e.$$.fragment,i),t=!0)},o(i){Se(e.$$.fragment,i),t=!1},d(i){Mt(e,i)}}}function JE(s){let e,t;return e=new KE({props:{annotation:s[10]}}),{c(){Bt(e.$$.fragment)},m(i,r){Pt(e,i,r),t=!0},p(i,r){const n={};r&2&&(n.annotation=i[10]),e.$set(n)},i(i){t||(_e(e.$$.fragment,i),t=!0)},o(i){Se(e.$$.fragment,i),t=!1},d(i){Mt(e,i)}}}function $E(s){let e,t;return e=new YE({props:{annotation:s[10]}}),{c(){Bt(e.$$.fragment)},m(i,r){Pt(e,i,r),t=!0},p(i,r){const n={};r&2&&(n.annotation=i[10]),e.$set(n)},i(i){t||(_e(e.$$.fragment,i),t=!0)},o(i){Se(e.$$.fragment,i),t=!1},d(i){Mt(e,i)}}}function eb(s){let e,t;return e=new XE({props:{annotation:s[10]}}),{c(){Bt(e.$$.fragment)},m(i,r){Pt(e,i,r),t=!0},p(i,r){const n={};r&2&&(n.annotation=i[10]),e.$set(n)},i(i){t||(_e(e.$$.fragment,i),t=!0)},o(i){Se(e.$$.fragment,i),t=!1},d(i){Mt(e,i)}}}function tb(s){let e,t;return e=new GE({props:{annotation:s[10]}}),{c(){Bt(e.$$.fragment)},m(i,r){Pt(e,i,r),t=!0},p(i,r){const n={};r&2&&(n.annotation=i[10]),e.$set(n)},i(i){t||(_e(e.$$.fragment,i),t=!0)},o(i){Se(e.$$.fragment,i),t=!1},d(i){Mt(e,i)}}}function Bc(s){let e,t,i,r;const n=[tb,eb,$E,JE],o=[];function a(l,h){return l[10].target.selector.type===je.RECTANGLE?0:l[10].target.selector.type===je.POLYGON?1:l[10].target.selector.type===je.MULTIPOLYGLON?2:l[10].target.selector.type===je.ELLIPSE?3:-1}return~(e=a(s))&&(t=o[e]=n[e](s)),{c(){t&&t.c(),i=Ci()},m(l,h){~e&&o[e].m(l,h),nt(l,i,h),r=!0},p(l,h){let u=e;e=a(l),e===u?~e&&o[e].p(l,h):(t&&(Vt(),Se(o[u],1,1,()=>{o[u]=null}),Xt()),~e?(t=o[e],t?t.p(l,h):(t=o[e]=n[e](l),t.c()),_e(t,1),t.m(i.parentNode,i)):t=null)},i(l){r||(_e(t),r=!0)},o(l){Se(t),r=!1},d(l){l&&et(i),~e&&o[e].d(l)}}}function ib(s){let e,t,i,r,n,o,a,l,h,u,c,d,f,p,m=Wi(s[1].filter(s[6])),g=[];for(let x=0;x<m.length;x+=1)g[x]=Bc(Nc(s,m,x));const v=x=>Se(g[x],1,1,()=>{g[x]=null});return{c(){var x,_,E,R;e=rt("svg"),t=rt("g"),i=rt("rect"),l=rt("rect");for(let M=0;M<g.length;M+=1)g[M].c();ee(i,"class","a9s-union-bg svelte-1p8m4b9"),ee(i,"x",r=(x=s[2])==null?void 0:x.minX),ee(i,"y",n=(_=s[2])==null?void 0:_.minY),ee(i,"width",o=s[2]?s[2].maxX-s[2].minX:0),ee(i,"height",a=s[2]?s[2].maxY-s[2].minY:0),ee(l,"class","a9s-union-fg svelte-1p8m4b9"),ee(l,"x",h=(E=s[2])==null?void 0:E.minX),ee(l,"y",u=(R=s[2])==null?void 0:R.minY),ee(l,"width",c=s[2]?s[2].maxX-s[2].minX:0),ee(l,"height",d=s[2]?s[2].maxY-s[2].minY:0),ee(t,"transform",f=s[9]),ee(e,"class","a9s-osd-selectionlayer svelte-1p8m4b9")},m(x,_){nt(x,e,_),pi(e,t),pi(t,i),pi(t,l);for(let E=0;E<g.length;E+=1)g[E]&&g[E].m(t,null);p=!0},p(x,_){var E,R,M,O;if((!p||_&4&&r!==(r=(E=x[2])==null?void 0:E.minX))&&ee(i,"x",r),(!p||_&4&&n!==(n=(R=x[2])==null?void 0:R.minY))&&ee(i,"y",n),(!p||_&4&&o!==(o=x[2]?x[2].maxX-x[2].minX:0))&&ee(i,"width",o),(!p||_&4&&a!==(a=x[2]?x[2].maxY-x[2].minY:0))&&ee(i,"height",a),(!p||_&4&&h!==(h=(M=x[2])==null?void 0:M.minX))&&ee(l,"x",h),(!p||_&4&&u!==(u=(O=x[2])==null?void 0:O.minY))&&ee(l,"y",u),(!p||_&4&&c!==(c=x[2]?x[2].maxX-x[2].minX:0))&&ee(l,"width",c),(!p||_&4&&d!==(d=x[2]?x[2].maxY-x[2].minY:0))&&ee(l,"height",d),_&2){m=Wi(x[1].filter(x[6]));let N;for(N=0;N<m.length;N+=1){const B=Nc(x,m,N);g[N]?(g[N].p(B,_),_e(g[N],1)):(g[N]=Bc(B),g[N].c(),_e(g[N],1),g[N].m(t,null))}for(Vt(),N=m.length;N<g.length;N+=1)v(N);Xt()}(!p||_&512&&f!==(f=x[9]))&&ee(t,"transform",f)},i(x){if(!p){for(let _=0;_<m.length;_+=1)_e(g[_]);p=!0}},o(x){g=g.filter(QE);for(let _=0;_<g.length;_+=1)Se(g[_]);p=!1},d(x){x&&et(e),ro(g,x)}}}function sb(s){let e=!!s[2],t,i,r=e&&Lc(s);return{c(){r&&r.c(),t=Ci()},m(n,o){r&&r.m(n,o),nt(n,t,o),i=!0},p(n,[o]){o&4&&(e=!!n[2]),e?r?(r.p(n,o),o&4&&_e(r,1)):(r=Lc(n),r.c(),_e(r,1),r.m(t.parentNode,t)):r&&(Vt(),Se(r,1,1,()=>{r=null}),Xt())},i(n){i||(_e(r),i=!0)},o(n){Se(r),i=!1},d(n){n&&et(t),r&&r.d(n)}}}function rb(s,e,t){let i,r,n,{state:o}=e,{viewer:a}=e;const{store:l}=o,{selection:h}=o;Ln(s,h,d=>t(5,n=d));const u=d=>{let f=-1/0,p=-1/0,m=1/0,g=1/0;for(let v of d.filter(x=>Ui(x))){const{bounds:x}=v.target.selector.geometry;x.maxX>f&&(f=x.maxX),x.maxY>p&&(p=x.maxY),x.minX<m&&(m=x.minX),x.minY<g&&(g=x.minY)}return a.forceRedraw(),{maxX:f,maxY:p,minX:m,minY:g}},c=d=>Ui(d);return s.$$set=d=>{"state"in d&&t(4,o=d.state),"viewer"in d&&t(0,a=d.viewer)},s.$$.update=()=>{s.$$.dirty&32&&t(1,i=n.selected.map(({id:d})=>l.getAnnotation(d))),s.$$.dirty&2&&t(2,r=i.length>1?u(i):void 0)},[a,i,r,h,o,n,c]}class nb extends Ot{constructor(e){super(),It(this,e,rb,sb,St,{state:4,viewer:0})}}const Fc=(s,e)=>{e==="auto"?s.addHandler("open",t=>{const i=s.world.getItemCount();s.world.getItemAt(i-1).addOnceHandler("fully-loaded-change",r=>{const{fullyLoaded:n}=r;if(n){const o=s.canvas.querySelector("canvas"),a=Ng(o);s.element.setAttribute("data-theme",a)}})}):s.element.setAttribute("data-theme",e)},sp=(s,e,t)=>(i,r={})=>{const n=typeof i=="string"?i:i.id,o=e.getAnnotation(n);if(!o||!Ui(o))return;const a=s.container.getBoundingClientRect(),{padding:l}=r;let[h,u,c,d]=l?Array.isArray(l)?l:[l,l,l,l]:[0,0,0,0];h=h/a.height,u=u/a.width,c=c/a.height,d=d/a.width;const{minX:f,minY:p,maxX:m,maxY:g}=o.target.selector.geometry.bounds,v=m-f,x=g-p,_=f-d*v,E=p-h*x,R=v+(u+d)*v,M=x+(h+c)*x,O=s.viewport.imageToViewportRectangle(_,E,R,M);s.viewport[t](O,r.immediately)},ob=(s,e)=>sp(s,e,"fitBounds"),ab=(s,e)=>sp(s,e,"fitBoundsWithConstraints"),ub=(s,e={})=>{const t=Lg(e,{drawingEnabled:!1,drawingMode:Si?"drag":"click",userSelectAction:kc.EDIT,theme:"light"}),i=Og(t),{hover:r,selection:n,store:o}=i,a=xp(o,t.initialHistory),l=_p(i,a,t.adapter,t.autoSave);let h=Cp(),u=t.drawingEnabled,c=t.drawingMode,d=t.modalSelect;const f=Bg(a,s.element),p=new dE({target:s.element,props:{state:i,viewer:s,style:t.style,filter:void 0}}),m=new kE({target:s.element.querySelector(".openseadragon-canvas"),props:{provider:void 0,store:o,viewer:s}}),g=new EE({target:s.element.querySelector(".openseadragon-canvas"),props:{drawingEnabled:!!u,filter:void 0,multiSelect:t.multiSelect,preferredDrawingMode:c,state:i,style:t.style,user:h,viewer:s}}),v=new nb({target:s.element.querySelector(".openseadragon-canvas"),props:{state:i,viewer:s}});p.$on("click",F=>{const{originalEvent:Z,annotation:Q}=F.detail,ae=de=>tp(de.id,Z,n,t.multiSelect);d?n.isEmpty()&&Q&&n.userSelect(ae(Q),Z):Q&&!(c==="click"&&u)?n.userSelect(ae(Q),Z):n.isEmpty()||n.clear()}),s.element.addEventListener("pointerdown",F=>{if(r.current){const Z=o.getAnnotation(r.current);l.emit("clickAnnotation",Z,F)}}),Fc(s,t.theme);const x=wp(i,a,t.adapter),_=()=>g.cancelDrawing(),E=()=>{p.$destroy(),m.$destroy(),g.$destroy(),v.$destroy(),f.destroy(),a.destroy()},R=ob(s,o),M=ab(s,o),O=()=>g.getDrawingTool(),N=()=>h,B=()=>g.isDrawingEnabled(),G=(F,Z,Q)=>Eg(F,Z,Q),K=(F,Z)=>pg(F,Z),D=F=>{if(!td(F))throw`No drawing tool named ${F}`;g.$set({toolName:F})},C=F=>{u=F,g.$set({drawingEnabled:F})},I=F=>{p.$set({filter:F}),g.$set({filter:F})},L=F=>d=F,W=F=>{p.$set({style:F}),g.$set({style:F})},U=F=>m.$set({provider:F}),V=F=>Fc(s,F),ie=F=>{h=F,g.$set({user:F})},k=F=>p.$set({visible:F});return{...x,cancelDrawing:_,destroy:E,fitBounds:R,fitBoundsWithConstraints:M,getDrawingTool:O,getUser:N,isDrawingEnabled:B,listDrawingTools:ed,on:l.on,off:l.off,registerDrawingTool:G,registerShapeEditor:K,setDrawingEnabled:C,setDrawingTool:D,setFilter:I,setModalSelect:L,setPresenceProvider:U,setStyle:W,setTheme:V,setUser:ie,setVisible:k,state:i,viewer:s}};export{kc as $,Nn as O,ub as d,rp as g};
